--REQ0037383 - Ana - 23/09/2019 
DECLARE
  --Busca contas - Unilos
  CURSOR cr_crapass IS
    SELECT cdcooper, nrdconta, nrdctitg, flgctitg
    FROM   CRAPASS 
    WHERE  cdcooper = 6 --Unilos
    AND    nrdconta IN ( 34401,  34410,  34428,  34436,  34444,  34452,  34495
          ,  34568,  34576,  34584,  34592,  34606,  34622,  34665,  34703,  34711,  34738,  34797,  34827,  34835,  34843,  34851,  34878,  34908,  34940,  34959,  34967,  34975
          ,  34983,  35009,  35041,  35203,  35254,  35262,  35289,  35297,  35300,  35351,  35360,  35408,  35424,  35505,  35564,  35572,  35610,  35629,  35661,  35700,  35726
          ,  35777,  35785,  35858,  35890,  35904,  35912,  35920,  35955,  35971,  35998,  36013,  36056,  36080,  36110,  36145,  36196,  36200,  36226,  36277,  36285,  36340
          ,  36358,  36366,  36374,  36390,  36439,  36447,  36455,  36501,  36536,  36552,  36587,  36595,  36650,  36684,  36714,  36749,  36757,  36790,  36854,  36870,  36897
          ,  36943,  36951,  36960,  37028,  37052,  37117,  37133,  37141,  37150,  37249,  37273,  37281,  37311,  37338,  37346,  37400,  37435,  37532,  37575,  37591,  37605
          ,  37630,  37656,  37710,  37729,  37745,  37800,  37826,  37850,  37893,  37907,  37923,  37931,  37958,  37974,  37982,  37990,  38008,  38016,  38032,  38067,  38083
          ,  38091,  38105,  38121,  38199,  38202,  38210,  38229,  38237,  38261,  38288,  38334,  38393,  38415,  38440,  38474,  38571,  38580,  38652,  38660,  38695,  38717
          ,  38750,  38814,  38849,  38857,  38881,  38911,  38938,  38954,  39020,  39039,  39055,  39080,  39101,  39110,  39160,  39179,  39195,  39233,  39241,  39268,  39276
          ,  39284,  39349,  39365,  39373,  39381,  39420,  39438,  39454,  39462,  39489,  39497,  39535,  39551,  39560,  39578,  39586,  39608,  39640,  39713,  39748,  39802
          ,  39837,  39845,  39861,  39870,  39918,  39926,  39950,  39969,  39993,  40010,  40037,  40053,  40061,  40070,  40118,  40126,  40142,  40150,  40169,  40193,  40223
          ,  40266,  40282,  40304,  40312,  40339,  40355,  40363,  40371,  40401,  40436,  40479,  40487,  40495,  40517,  40533,  40550,  40584,  40622,  40630,  40649,  40665
          ,  40681,  40690,  40720,  40738,  40797,  40800,  40827,  40835,  40843,  40959,  41041,  41050,  41114,  41149,  41173,  41181,  41190,  41203,  41220,  41238,  41254
          ,  41297,  41300,  41319,  41343,  41378,  41416,  41475,  41521,  41530,  41548,  41556,  41564,  41580,  41602,  41637,  41670,  41696,  41785,  41815,  41866,  41882
          ,  41890,  41963,  41998,  42013,  42030,  42056,  42072,  42080,  42099,  42161,  42170,  42200,  42234,  42269,  42285,  42307,  42315,  42323,  42358,  42374,  42404
          ,  42420,  42439,  42480,  42498,  42510,  42536,  42552,  42617,  42641,  42676,  42706,  42714,  42749,  42757,  42811,  42854,  42978,  42994,  43001,  43028,  43036
          ,  43117,  43168,  43192,  43206,  43214,  43273,  43354,  43400,  43486,  43532,  43559,  43567,  43613,  43680,  43699,  43710,  43788,  43907,  43915,  43974,  44016
          ,  44075,  44164,  44229,  44288,  44334,  44350,  44415,  44423,  44466,  44482,  44504,  44512,  44520,  44580,  44628,  44652,  44695,  44709,  44717,  44741,  44776
          ,  44784,  44806,  44814,  44822,  44849,  44857,  44911,  44946,  44954,  44989,  44997,  45012,  45047,  45055,  45080,  45179,  45209,  45225,  45241,  45292,  45314
          ,  45322,  45365,  45381,  45390,  45411,  45454,  45470,  45519,  45527,  45535,  45560,  45586,  45608,  45616,  45624,  45640,  45667,  45675,  45691,  45705,  45721
          ,  45810,  45896,  45900,  45918,  45969,  45977,  45985,  46000,  46019,  46043,  46060,  46124,  46140,  46175,  46183,  46205,  46213,  46221,  46264,  46280,  46299
          ,  46302,  46655,  46930,  47260,  47503,  47724,  48070,  48380,  48704,  49190,  49620,  49956,  50326,  50725,  51098,  51543,  51934,  52604,  53490,  53945,  54380
          ,  46310,  46671,  46981,  47295,  47520,  47732,  48100,  48399,  48720,  49263,  49646,  49972,  50393,  50733,  51128,  51586,  51977,  52655,  53546,  53953,  54496
          ,  46345,  46698,  46990,  47309,  47546,  47759,  48119,  48410,  48780,  49271,  49697,  49980,  50407,  50741,  51152,  51608,  51985,  52906,  53562,  53961,  54518
          ,  46396,  46701,  47007,  47325,  47554,  47767,  48127,  48429,  48828,  49344,  49727,  50008,  50415,  50776,  51268,  51632,  51993,  52914,  53589,  54003,  54526
          ,  46400,  46710,  47040,  47341,  47562,  47791,  48143,  48488,  48844,  49352,  49735,  50067,  50466,  50830,  51276,  51713,  52000,  52930,  53597,  54020,  54550
          ,  46442,  46728,  47066,  47350,  47570,  47872,  48160,  48500,  48941,  49379,  49778,  50083,  50482,  50890,  51349,  51721,  52035,  52957,  53619,  54097,  54682
          ,  46485,  46760,  47082,  47384,  47635,  47902,  48194,  48526,  49026,  49409,  49808,  50113,  50520,  50903,  51373,  51730,  52086,  52981,  53651,  54127,  54704
          ,  46493,  46817,  47104,  47414,  47643,  47937,  48259,  48569,  49042,  49441,  49816,  50172,  50539,  50938,  51446,  51748,  52183,  53015,  53694,  54259,  54720
          ,  46515,  46850,  47112,  47430,  47660,  47988,  48275,  48631,  49077,  49476,  49824,  50202,  50555,  50970,  51470,  51756,  52310,  53201,  53759,  54275,  54739
          ,  46531,  46876,  47155,  47457,  47678,  48011,  48330,  48640,  49115,  49565,  49840,  50210,  50601,  51012,  51497,  51799,  52345,  53309,  53791,  54348,  54836
          ,  46604,  46914,  47180,  47473,  47694,  48020,  48348,  48658,  49123,  49603,  49921,  50245,  50652,  51047,  51500,  51810,  52370,  53406,  53813,  54356,  54844
          ,  46647,  46922,  47198,  47481,  47716,  48038,  48372,  48682,  49182,  49611,  49930,  50261,  50660,  51063,  51535,  51918,  52558,  53422,  53937,  54372,  54879
          ,  54941,  55956,  56642 ,  57452,  58173,  58955,  59757 ,  60739,  61433,  62235,  62820,  63770,  64661,  66010,  67040,  67458,  68128,  68977,  70165 ,  70700,  71285
          ,  54968,  55980,  56693 ,  57517,  58181,  59030,  59781 ,  60755,  61441,  62260,  62855,  63789,  64785,  66028,  67075,  67474,  68144,  69000,  70173 ,  70734,  71293
          ,  55000,  56014,  56758 ,  57541,  58238,  59048,  59919 ,  60810,  61450,  62294,  62898,  63797,  64955,  66060,  67091,  67571,  68209,  69043,  70181 ,  70769,  71307
          ,  55018,  56022,  56774 ,  57584,  58254,  59137,  59927 ,  60828,  61492,  62324,  62936,  63835,  65005,  66095,  67113,  67598,  68276,  69094,  70297 ,  70777,  71323
          ,  55093,  56030,  56782 ,  57649,  58335,  59170,  59960 ,  60836,  61522,  62383,  63010,  63894,  65030,  66141,  67121,  67610,  68284,  69221,  70343 ,  70785,  71331
          ,  55107,  56073,  56790 ,  57738,  58378,  59188,  59986 ,  60879,  61530,  62405,  63134,  63916,  65056,  66150,  67130,  67695,  68306,  69264,  70351 ,  70807,  71340
          ,  55131,  56146,  56804 ,  57789,  58386,  59196,  60089 ,  60917,  61689,  62430,  63169,  63932,  65080,  66168,  67156,  67717,  68314,  69400,  70360 ,  70823,  71366
          ,  55182,  56162,  56839 ,  57819,  58408,  59269,  60097 ,  60950,  61697,  62464,  63177,  63940,  65099,  66311,  67210,  67768,  68381,  69574,  70386 ,  70882,  71390
          ,  55247,  56197,  56847 ,  57827,  58432,  59277,  60119 ,  60968,  61727,  62472,  63193,  64076,  65102,  66338,  67288,  67792,  68403,  69647,  70394 ,  70890,  71412
          ,  55255,  56227,  56855 ,  57843,  58440,  59307,  60143 ,  60976,  61743,  62480,  63215,  64106,  65218,  66370,  67296,  67857,  68411,  69655,  70408 ,  70904,  71455
          ,  55263,  56243,  56901 ,  57851,  58491,  59323,  60160 ,  60992,  61824,  62510,  63290,  64165,  65242,  66400,  67300,  67865,  68446,  69710,  70416 ,  70955,  71498
          ,  55298,  56278,  56936 ,  57886,  58530,  59366,  60208 ,  61115,  61832,  62529,  63410,  64181,  65404,  66532,  67318,  67873,  68586,  69779,  70424 ,  70998,  71501
          ,  55360,  56340,  56952 ,  57894,  58599,  59420,  60348 ,  61123,  61867,  62545,  63444,  64190,  65439,  66591,  67326,  67903,  68616,  69809,  70432 ,  71013,  71510
          ,  55522,  56359,  56960 ,  57924,  58602,  59447,  60399 ,  61131,  61964,  62553,  63517,  64300,  65480,  66753,  67350,  67920,  68640,  69876,  70530 ,  71072,  71536
          ,  55581,  56375,  56979 ,  57940,  58661,  59455,  60488 ,  61166,  62006,  62561,  63525,  64327,  65552,  66842,  67369,  67938,  68691,  69914,  70548 ,  71080,  71544
          ,  55670,  56413,  56995 ,  58009,  58688,  59480)
     AND    flgctitg <> 3
     ORDER BY nrdconta;

    rw_crapass       cr_crapass%rowtype;
    vr_qtdcta        NUMBER;
BEGIN
  FOR rw_crapass IN cr_crapass LOOP
    BEGIN
      --Atualiza status da conta ITG
      UPDATE CRAPASS
      SET    flgctitg = 3
      WHERE  cdcooper = rw_crapass.cdcooper
      AND    nrdconta = rw_crapass.nrdconta;
    END;

    BEGIN
      --Inclui log de alteração da conta ITG
      INSERT INTO crapalt 
        (nrdconta
        ,dtaltera
        ,cdoperad
        ,dsaltera
        ,tpaltera
        ,flgctitg
        ,cdcooper)
      VALUES
        (rw_crapass.nrdconta
        ,sysdate
        ,1
        ,'exclusao conta-itg('||rw_crapass.nrdctitg||')- ope.1'
        ,2 
        ,0  --nao enviada
        ,rw_crapass.cdcooper);
    END;
    vr_qtdcta := cr_crapass%rowcount;
  END LOOP;
  
  dbms_output.put_line('Qtde contas atualizadas:'||vr_qtdcta);
  COMMIT;
EXCEPTION
  WHEN OTHERS THEN 
    ROLLBACK;
END;
 
