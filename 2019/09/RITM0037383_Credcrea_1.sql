DECLARE 
  --Busca contas - Credcrea
  CURSOR cr_crapass IS
    SELECT cdcooper, nrdconta, nrdctitg, flgctitg
    FROM   CRAPASS 
    WHERE  cdcooper = 7 --Crecrea
    AND    nrdconta IN (78  ,  10723,  17582,  22292,  31739,  38180,  44814,  53252,  59811,  66672,  72818,  77798,  87173,  95060
        ,  116 ,  10758,  17736,  22799,  31844,  38806,  45160,  53708,  60089,  66737,  72869,  77984,  87432,  95206
        ,  221 ,  11002,  17795,  22802,  32433,  38873,  45250,  54178,  60410,  67024,  73172,  78204,  87670,  95257
        ,  248 ,  11169,  17841,  23167,  32727,  38920,  45411,  54275,  60860,  67369,  73229,  78239,  89915,  95419
        ,  310 ,  11533,  18040,  23205,  32735,  39306,  45764,  54330,  61050,  67504,  73687,  78964,  90298,  95427
        ,  329 ,  11622,  18066,  23302,  32743,  39780,  46493,  54470,  61204,  67806,  73733,  79022,  90425,  95958
        ,  1309,  11851,  18112,  23531,  32751,  40088,  47023,  54810,  61298,  67946,  73830,  79073,  91154,  96008
        ,  1546,  11878,  18619,  23558,  33065,  40177,  47325,  54836,  61620,  68004,  73881,  79090,  91189,  96342
        ,  1554,  12769,  18805,  23710,  33278,  40363,  47619,  55387,  61840,  68802,  74004,  79413,  91243,  96458
        ,  1988,  12793,  19240,  24171,  33820,  40649,  47759,  55603,  62081,  68888,  74179,  79600,  91260,  97071
        ,  2690,  12840,  19437,  24422,  33944,  41106,  47880,  55700,  62197,  68900,  74900,  79707,  91367,  97195
        ,  2798,  12947,  19763,  26743,  34398,  41319,  48011,  55816,  62383,  69183,  74969,  79910,  91863,  97527
        ,  3450,  13382,  19801,  26824,  34703,  41343,  48364,  55883,  62618,  69531,  75000,  80446,  91901,  97608
        ,  3476,  13625,  19879,  26964,  34746,  41483,  48534,  55999,  62715,  69922,  75221,  80454,  92452,  97870
        ,  4030,  13900,  20087,  26980,  34886,  41645,  48658,  56227,  63070,  70017,  75540,  80632,  92495,  97918
        ,  4057,  14028,  20222,  27286,  34959,  41815,  49018,  56260,  63339,  70033,  75787,  81140,  92894,  97926
        ,  4162,  14036,  20737,  27391,  35238,  41831,  49212,  56294,  63622,  70165,  75809,  81299,  93041,  97969
        ,  4278,  14060,  20800,  27642,  35386,  42234,  49328,  56391,  63886,  70505,  75868,  81302,  93114,  98167
        ,  4650,  14087,  20931,  27766,  35408,  42919,  49700,  56731,  63894,  70769,  76090,  81639,  93424,  98388
        ,  5096,  14141,  21261,  28541,  36048,  43028,  49794,  56782,  63916,  71471,  76201,  81930,  93688,  98515
        ,  5290,  14818,  21482,  28754,  36315,  43060,  50350,  56960,  63932,  71552,  76414,  82341,  93769,  98728
        ,  5363,  14893,  21660,  29289,  36617,  43257,  50601,  57010,  64017,  71633,  76422,  82686,  93793,  98876
        ,  6041,  15008,  21679,  29386,  36765,  43842,  50890,  57169,  65226,  71820,  76511,  83860,  93807,  98892
        ,  6610,  15075,  21717,  29998,  37168,  43850,  51365,  57347,  65374,  71919,  76813,  84255,  93963,  99236
        ,  6718,  15644,  21776,  30058,  37630,  43869,  51691,  57827,  65625,  72125,  76929,  84565,  93980,  99341
        ,  7137,  16063,  21989,  30350,  37648,  44024,  51829,  58980,  65668,  72419,  77348,  86169,  94188,  99350
        ,  7560,  16616,  21997,  30538,  37702,  44601,  52450,  59030,  65927,  72591,  77399,  86371,  94420,  99376
        ,  7650,  17434,  22039,  30767,  37931,  44687,  53163,  59099,  66273,  72621,  77569,  86665,  94862,  99562
        ,  8818,  17485,  22179,  31615,  38091,  44717,  53210,  59170,  66494,  72664,  77704,  87092,  94927,  99740
        ,  99767,  99929,  100137,  100293,  100366,  100471,  100641,  100897,  100927,  101338,  101346,  101460,  101524
        ,  101699,  101710,  102075,  102270,  102440,  102490,  102601,  102741,  102750,  102873,  102997,  103020,  103357
        ,  103446,  103977,  103993,  104035,  104051,  104272,  104396,  104426,  104876,  105627,  105945,  107018,  107034
        ,  107107,  107190,  107328,  107387,  107921,  108510,  108642,  108812,  108820,  108936,  109177,  109266,  109495
        ,  109550,  109614,  109940,  110469,  110680,  110728,  110892,  111090,  111635,  111716,  111910,  112011,  112070
        ,  112445,  112488,  112968,  113042,  113069,  113263,  113689,  113913,  114669,  114723,  114774,  114804,  114880
        ,  115258,  115274,  115673,  115746,  115843,  116114,  116246,  116785,  116920,  116947,  117455,  118354,  119466
        ,  119474,  119865,  120316,  120448,  120561,  120600,  120804,  120936,  121843,  121851,  122050,  122505,  122530
        ,  122602,  122742,  122963,  123072,  123390,  123706,  123897,  123960,  123978,  124095,  124958,  125024,  125075
        ,  125121,  125172,  125199,  125210,  125326,  125369,  126071,  126136,  126314,  126411,  126896,  127086,  127124
        ,  127264,  127647,  127680,  127809,  127850,  127949,  128015,  128325,  128341,  129003,  129020,  129046,  129178
        ,  129259,  129356,  129372,  129437,  129470,  130389,  130524,  130559,  130575,  130958,  131067,  131385,  131547
        ,  132020,  132322,  132721,  133043,  133248,  134015,  134031,  134732,  134805,  134872,  135470,  135550,  135828
        ,  136719,  137243,  137294,  137316,  137510,  138029,  138142,  138169,  138452,  138606,  138681,  138746,  139017
        ,  139491,  139769,  140619,  140945,  140961,  141100,  141194,  141518,  141682,  141801,  141909,  141968,  142077
        ,  142492,  142786,  142972,  143090,  143138,  143308,  143324,  143642,  143650,  143669,  143723,  143740,  143928
        ,  144126,  144274,  144304,  144410,  144460,  144487,  144550,  144975,  145033,  145084,  145203,  145416,  145440
        ,  145505,  145726,  145807,  145815,  145947,  145980,  146188,  146307,  146803,  146919,  147044,  147320,  147389
        ,  147761,  147842,  148270,  148482,  148725,  148830,  148890,  148911,  149268,  149381,  149608,  149721,  149772
        ,  149861,  150088,  150193,  150231,  150495,  150533,  150657,  150797,  150860,  150878,  151033,  151220,  151467
        ,  151874,  151904,  152056,  152080,  152153,  152331,  152463,  152617,  153028,  153044,  153125,  153230,  153559
        ,  153923,  153940,  154008,  154148,  154342,  154628,  154709,  154881,  156027,  156116,  156191,  156353,  156809
        ,  156981,  156990,  157007,  157376,  157694,  158160,  158771,  159310,  159379,  160083,  160091,  160156,  160385
        ,  160768,  160873,  161179,  161187,  161721,  162213,  162221,  162590,  162639,  162736,  162914,  162990,  163007
        ,  163120,  163198,  163236,  163295,  163368,  163490,  163570,  163708,  163767,  163953,  164127,  164240,  164836
        ,  165816,  165999,  166073,  166103,  166375,  166430,  166510,  166529,  166600,  166618,  167240,  167517,  167843
        ,  168173,  168211,  168238,  168602,  168610,  168785,  176818,  186996,  187925,  189235,  194476,  215201,  224006
        ,  234257,  242276,  252808,  266701,  282731,  331775
        ,  168947,  176931,  187089,  187968,  189251,  199346,  215422,  224987,  234575,  242349,  253200,  267317,  288888,  332127
        ,  169030,  177083,  187097,  187984,  189367,  199664,  215791,  225894,  234915,  242586,  253634,  267708,  310204,  332224
        ,  169340,  177091,  187143,  188093,  189391,  199745,  216097,  226157,  234966,  243671,  254614,  268062,  310441,  332291
        ,  169412,  177121,  187151,  188115,  189430,  201758,  216194,  226238,  235440,  245186,  255173,  268739,  310727,  332542
        ,  170151,  177504,  187232,  188123,  189464,  202606,  216259,  226637,  235881,  245232,  255246,  269247,  310794,  332704
        ,  170372,  178381,  187275,  188174,  189472,  203041,  217018,  226793,  236381,  245305,  255351,  269514,  310808,  332801
        ,  170488,  179191,  187291,  188204,  189561,  203572,  217239,  226874,  236390,  245410,  255491,  269697,  310905,  333158
        ,  170976,  179213,  187313,  188212,  189570,  203602,  217271,  227072,  236659,  246158,  255610,  269743,  311030,  333484
        ,  171042,  179639,  187321,  188387,  189588,  206695,  217280,  227927,  236713,  246310,  256013,  269921,  311065,  333492
        ,  171158,  180432,  187330,  188409,  189596,  207403,  217611,  228087,  236730,  246336,  256390,  270016,  311553,  333980
        ,  172286,  180629,  187348,  188450,  189618,  207594,  217646,  228338,  236772,  247162,  257338,  270113,  311588,  334278
        ,  172766,  181145,  187356,  188506,  189626,  208531,  217760,  228516,  236934,  248584,  257362,  270202,  311790,  334855
        ,  172812,  181161,  187402,  188581,  189685,  210412,  217972,  229032,  236993,  248851,  257788,  270423,  311995,  334910
        ,  173088,  181234,  187429,  188590,  189693,  210730,  218308,  229229,  237795,  248878,  258121,  270598,  312045,  335320
        ,  173240,  184403,  187437,  188603,  189731,  211079,  218316,  230111,  237922,  248924,  258440,  272370,  312126,  335355
        ,  173355,  184462,  187445,  188735,  189740,  211087,  219207,  230448,  237949,  248940,  259209,  272426,  312150,  335380
        ,  173479,  185388,  187461,  188743,  190241,  211095,  219665,  230499,  238546,  248991,  260339,  273350,  312355)
     AND    flgctitg <> 3
     ORDER BY nrdconta;

    rw_crapass       cr_crapass%rowtype;
    vr_qtdcta        NUMBER;
BEGIN
  FOR rw_crapass IN cr_crapass LOOP
    BEGIN
      --Atualiza status da conta ITG
      UPDATE CRAPASS
      SET    flgctitg = 3
      WHERE  cdcooper = rw_crapass.cdcooper
      AND    nrdconta = rw_crapass.nrdconta;
    END;

    BEGIN
      --Inclui log de alteração da conta ITG
      INSERT INTO crapalt 
        (nrdconta
        ,dtaltera
        ,cdoperad
        ,dsaltera
        ,tpaltera
        ,flgctitg
        ,cdcooper)
      VALUES
        (rw_crapass.nrdconta
        ,sysdate
        ,1
        ,'exclusao conta-itg('||rw_crapass.nrdctitg||')- ope.1'
        ,2 
        ,0  --nao enviada
        ,rw_crapass.cdcooper);
    END;
    vr_qtdcta := cr_crapass%rowcount;
  END LOOP;
  
  dbms_output.put_line('Qtde contas atualizadas:'||vr_qtdcta);
  COMMIT;
EXCEPTION
  WHEN OTHERS THEN 
    ROLLBACK;
END;
 
