--REQ0037383 - Ana - 23/09/2019
DECLARE
  --Busca contas - Unilos
  CURSOR cr_crapass IS
    SELECT cdcooper, nrdconta, nrdctitg, flgctitg
    FROM   CRAPASS 
    WHERE  cdcooper = 6 --Unilos
    AND    nrdconta IN ( 60526 ,  61174,  62022,  62596,  63533,  64351,  65625,  66850,  67377,  67970,  68845,  69965,  70556 ,  71145,  71560
          ,  55689,  56456,  57142 ,  58050,  58718,  59501,  60534 ,  61263,  62049,  62634,  63541,  64475,  65641,  66869,  67385,  67989,  68853,  70017,  70599 ,  71153,  71633
          ,  55700,  56472,  57215 ,  58076,  58750,  59510,  60569 ,  61280,  62057,  62642,  63606,  64505,  65676,  66915,  67393,  67997,  68896,  70033,  70602 ,  71161,  71811
          ,  55751,  56480,  57304 ,  58092,  58777,  59536,  60607 ,  61298,  62065,  62677,  63614,  64548,  65757,  66958,  67407,  68020,  68900,  70041,  70610 ,  71196,  72036
          ,  55786,  56499,  57312 ,  58106,  58793,  59560,  60658 ,  61336,  62073,  62707,  63720,  64629,  65820,  66974,  67423,  68047,  68918,  70076,  70661 ,  71218,  72133
          ,  55816,  56510,  57339 ,  58122,  58807,  59609,  60674 ,  61409,  62146,  62731,  63738,  64645,  65935,  67016,  67431,  68071,  68942,  70084,  70670 ,  71242,  72338
          ,  55905,  56588,  57347 ,  58149,  58840,  59749,  60682 ,  61425,  62170,  62782,  63746,  64653,  65943,  67024,  67440,  68110,  68969,  70106,  70688 ,  71269,  72362
          ,  72435,  75124,  79014,  80438,  80969,  81604,  84387,  88722,  94030 ,  100633,  101834,  104230,  108154,  114235,  118923,  121304,  121584,  121827,  122157,  122424
          ,  72567,  75418,  79030,  80446,  81000,  81850,  84425,  88919,  94099 ,  100714,  101842,  104396,  108650,  114537,  118966,  121312,  121592,  121835,  122173,  122432
          ,  72591,  75655,  79120,  80462,  81078,  81949,  84948,  89575,  94161 ,  100897,  101869,  104450,  108812,  114880,  119067,  121320,  121606,  121851,  122181,  122440
          ,  72680,  75906,  79294,  80489,  81094,  81981,  84972,  89672,  94331 ,  100900,  101931,  104540,  109673,  115193,  119091,  121339,  121630,  121860,  122203,  122459
          ,  72710,  76031,  79677,  80519,  81124,  82015,  85022,  89990,  94390 ,  101001,  102040,  104574,  109827,  115223,  119300,  121347,  121649,  121894,  122211,  122491
          ,  72940,  76112,  80004,  80560,  81132,  82104,  85049,  90182,  94773 ,  101044,  102121,  104590,  109908,  115800,  119474,  121355,  121657,  121908,  122220,  122505
          ,  73148,  76171,  80012,  80594,  81167,  82198,  85286,  90190,  94803 ,  101052,  102156,  104612,  109924,  116068,  119733,  121363,  121665,  121924,  122246,  122513
          ,  73237,  76643,  80020,  80624,  81183,  82236,  85642,  90751,  100021,  101060,  102180,  104698,  110256,  116467,  119857,  121371,  121673,  121932,  122262,  122521
          ,  73326,  76660,  80063,  80632,  81191,  82279,  86010,  90808,  100056,  101079,  102270,  104990,  110345,  116475,  120103,  121380,  121681,  121940,  122270,  122530
          ,  73334,  76740,  80080,  80659,  81205,  82481,  86142,  91065,  100064,  101087,  102407,  105040,  110400,  116564,  120618,  121398,  121690,  121959,  122289,  122556
          ,  73350,  76902,  80110,  80713,  81221,  82759,  86355,  91120,  100072,  101290,  102539,  105430,  110477,  116742,  120820,  121401,  121703,  121967,  122297,  122564
          ,  73431,  77240,  80128,  80721,  81230,  82767,  86630,  91596,  100099,  101303,  102547,  105503,  110639,  116890,  120863,  121410,  121711,  121991,  122300,  122572
          ,  73482,  77607,  80136,  80730,  81310,  83135,  86975,  91812,  100137,  101311,  102571,  105732,  111937,  117374,  120995,  121428,  121720,  122009,  122319,  122580
          ,  73504,  77895,  80179,  80764,  81337,  83194,  87114,  91936,  100153,  101370,  102601,  105902,  112500,  117692,  121177,  121436,  121738,  122041,  122327,  122599
          ,  73547,  78018,  80187,  80799,  81370,  83208,  87262,  92142,  100161,  101397,  102814,  106666,  112569,  117862,  121185,  121444,  121746,  122068,  122335,  122602
          ,  73636,  78069,  80195,  80802,  81400,  83283,  87572,  92622,  100170,  101427,  103110,  106798,  112780,  117897,  121193,  121479,  121754,  122084,  122351,  122629
          ,  74373,  78336,  80225,  80829,  81418,  83402,  87793,  92886,  100269,  101460,  103160,  107280,  113042,  117919,  121207,  121495,  121762,  122092,  122360,  122637
          ,  74454,  78352,  80284,  80837,  81426,  83453,  87815,  92916,  100471,  101516,  103209,  107352,  113107,  118052,  121231,  121517,  121770,  122106,  122378,  122645
          ,  74489,  78360,  80365,  80845,  81434,  83852,  87998,  92975,  100501,  101575,  103888,  107727,  113115,  118184,  121240,  121533,  121789,  122114,  122386,  122661
          ,  74691,  78387,  80381,  80896,  81469,  84050,  88056,  93564,  100560,  101630,  103977,  107760,  113751,  118257,  121258,  121541,  121797,  122122,  122394,  122670
          ,  74950,  78484,  80411,  80918,  81477,  84247,  88226,  93637,  100595,  101761,  104035,  107859,  113859,  118389,  121266,  121568,  121800,  122130,  122408,  122696
          ,  75078,  78794,  80420,  80950,  81566,  84280,  88579,  93971,  100617,  101826,  104086,  107964,  113980,  118575,  121290,  121576,  121819,  122149,  122416,  122700
          ,  123048,  500313,  501891,  503460,  504793,  506320,  508853,  129801,  501107,  502634,  504238,  505676,  507458,  503231,  504661,  506206,  508403,  122718,  122971
          ,  123056,  500356,  501905,  503479,  504815,  506362,  508977,  130273,  501158,  502685,  504246,  505730,  507466,  503274,  504670,  506214,  508454,  122734,  123005
          ,  123099,  500364,  501921,  503533,  504858,  506370,  509051,  130800,  501255,  502707,  504254,  505765,  507482,  503339,  504718,  506230,  508497,  122742,  123021
          ,  123129,  500380,  501964,  503541,  504866,  506478,  509086,  131342,  501280,  502715,  504262,  505790,  507490,  503398,  504734,  506257,  508586,  122750,  123030
          ,  123145,  500410,  501972,  503550,  504939,  506494,  509124,  131415,  501298,  502782,  504289,  505811,  507652,  503436,  504742,  506273,  508667,  122777,  129763 
          ,  123161,  500445,  502162,  503606,  504980,  506559,  509132,  131601,  501336,  502790,  504300,  505854,  507725,  503452,  504777,  506281,  508705,  122785,  501778
          ,  123196,  500496,  502197,  503673,  505110,  506702,  509221,  132381,  501387,  502871,  504319,  505960,  507733,  507326,  573795,  421200,  501786,  122807,  126403
          ,  123200,  500518,  502200,  503703,  505137,  506761,  509310,  133191,  501417,  502898,  504335,  505978,  507784,  507342,  573825,  500089,  501824,  122823,  126454
          ,  123218,  500550,  502251,  503720,  505161,  506796,  509388,  133280,  501425,  502979,  504351,  506001,  507822,  507369,  573876,  500100,  501832,  122840,  126756
          ,  123234,  500569,  502278,  503754,  505170,  506800,  509442,  133310,  501450,  502987,  504360,  506010,  507830,  507385,  820024,  500151,  501840,  122866,  127566
          ,  123242,  500585,  502294,  503827,  505196,  506850,  509507,  134678,  501484,  502995,  504467,  506028,  507849,  507415,  850004,  500240,  501867,  122874
          ,  124052,  500690,  502332,  503851,  505358,  506931,  509523,  134686,  501506,  503010,  504521,  506036,  507946,  500895,  502480,  504122,  505552,  122882
          ,  124940,  500712,  502340,  503860,  505382,  507016,  509710,  136271,  501514,  503053,  504548,  506044,  508039,  500984,  502499,  504130,  505587,  122890
          ,  124990,  500720,  502359,  503932,  505390,  507059,  509760,  137189,  501522,  503096,  504564,  506087,  508047,  501000,  502537,  504165,  505595,  122904
          ,  125180,  500747,  502367,  503940,  505404,  507067,  509981,  137499,  501549,  503100,  504602,  506117,  508080,  501026,  502545,  504181,  505609,  122912
          ,  125318,  500755,  502391,  503991,  505447,  507113,  573671,  137561,  501620,  503118,  504610,  506141,  508225,  501042,  502570,  504211,  505650,  122947
          ,  125644,  500763,  502405,  504033,  505471,  507172,  573728,  142603,  501638,  503126,  504637,  506168,  508292,  125830,  500798,  502413,  504068,  122955
          ,  505498,  507202,  573779,  153869,  501654,  503177,  504645,  506176,  508314,  125857,  500836,  502464,  504076,  505544,  507318,  573787,  155012,  122963)
     AND    flgctitg <> 3
     ORDER BY nrdconta;

    rw_crapass       cr_crapass%rowtype;
    vr_qtdcta        NUMBER;
BEGIN
  FOR rw_crapass IN cr_crapass LOOP
    BEGIN
      --Atualiza status da conta ITG
      UPDATE CRAPASS
      SET    flgctitg = 3
      WHERE  cdcooper = rw_crapass.cdcooper
      AND    nrdconta = rw_crapass.nrdconta;
    END;

    BEGIN
      --Inclui log de alteração da conta ITG
      INSERT INTO crapalt 
        (nrdconta
        ,dtaltera
        ,cdoperad
        ,dsaltera
        ,tpaltera
        ,flgctitg
        ,cdcooper)
      VALUES
        (rw_crapass.nrdconta
        ,sysdate
        ,1
        ,'exclusao conta-itg('||rw_crapass.nrdctitg||')- ope.1'
        ,2 
        ,0  --nao enviada
        ,rw_crapass.cdcooper);
    END;
    vr_qtdcta := cr_crapass%rowcount;
  END LOOP;
  
  dbms_output.put_line('Qtde contas atualizadas:'||vr_qtdcta);
  COMMIT;
EXCEPTION
  WHEN OTHERS THEN 
    ROLLBACK;
END;
 
