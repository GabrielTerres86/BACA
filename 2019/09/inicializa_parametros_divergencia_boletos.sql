DECLARE

  CURSOR CR_CRAPCOP IS
    SELECT COP.CDCOOPER
      FROM CRAPCOP COP;
  RW_CRAPCOP CR_CRAPCOP%ROWTYPE;
  
  CURSOR CR_CRAPTAB(PR_CDCOOPER CRAPCOP.CDCOOPER%TYPE
                   ,PR_CDACESSO CRAPTAB.CDACESSO%TYPE) IS
    SELECT TAB.DSTEXTAB
      FROM CRAPTAB TAB
     WHERE TAB.CDCOOPER = PR_CDCOOPER
       AND TAB.NMSISTEM = 'CRED'
       AND TAB.TPTABELA = 'GENERI'
       AND TAB.CDEMPRES = 0
       AND TAB.TPREGIST = 0
       AND TAB.CDACESSO = PR_CDACESSO;
  RW_CRAPTAB CR_CRAPTAB%ROWTYPE;

  TYPE PARAMETROS_VARCHAR IS TABLE OF CRAPTAB.CDACESSO%TYPE;
  TYPE VALORES_VARCHAR IS TABLE OF CRAPTAB.DSTEXTAB%TYPE;

  VR_PARAMETROS PARAMETROS_VARCHAR;
  VR_VALORES VALORES_VARCHAR;

BEGIN

  VR_PARAMETROS := PARAMETROS_VARCHAR('SIT_PAG_DIVERGENTE', 'PAG_A_MENOR', 'PAG_A_MAIOR', 'TIP_TOLERANCIA', 'VL_TOLERANCIA');
  VR_VALORES := VALORES_VARCHAR('2', '0', '0', '1', '0,00');

  DBMS_OUTPUT.PUT_LINE('Cooperativa - Parametro: Valor');
  
  IF VR_VALORES.COUNT = VR_PARAMETROS.COUNT THEN
    FOR RW_CRAPCOP IN CR_CRAPCOP LOOP
      FOR VR_PARAMETRO IN 1..VR_PARAMETROS.COUNT LOOP

        OPEN CR_CRAPTAB(PR_CDCOOPER => RW_CRAPCOP.CDCOOPER
                       ,PR_CDACESSO => VR_PARAMETROS(VR_PARAMETRO));
        FETCH CR_CRAPTAB INTO RW_CRAPTAB;
        IF CR_CRAPTAB%NOTFOUND THEN
          CLOSE CR_CRAPTAB;
          BEGIN
            INSERT INTO CRAPTAB (CDCOOPER, NMSISTEM, TPTABELA, CDEMPRES, TPREGIST, CDACESSO, DSTEXTAB)
               VALUES (RW_CRAPCOP.CDCOOPER, 'CRED', 'GENERI', 0, 0, VR_PARAMETROS(VR_PARAMETRO), VR_VALORES(VR_PARAMETRO));
            COMMIT;
            DBMS_OUTPUT.PUT_LINE(RW_CRAPCOP.CDCOOPER || ' - ' || VR_PARAMETROS(VR_PARAMETRO) || ': ' || VR_VALORES(VR_PARAMETRO));
          EXCEPTION
            WHEN OTHERS THEN
              CECRED.PC_INTERNAL_EXCEPTION(PR_CDCOOPER => RW_CRAPCOP.CDCOOPER
                                          ,PR_COMPLEME => VR_PARAMETROS(VR_PARAMETRO) || ': ' || VR_VALORES(VR_PARAMETRO));
              ROLLBACK;
          END;
        ELSE
          CLOSE CR_CRAPTAB;
        END IF;
        
      END LOOP;
    END LOOP;
  END IF;

EXCEPTION
  WHEN OTHERS THEN
    CECRED.PC_INTERNAL_EXCEPTION;
    ROLLBACK;
END;
