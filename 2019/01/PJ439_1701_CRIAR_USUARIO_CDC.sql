declare 

  cursor cr_usuario is
    select decode(a.inpessoa,1,lpad(a.nrcpfcgc,11,'0'),lpad(a.nrcpfcgc,14,'0')) login
          ,lower(RAWTOHEX(DBMS_OBFUSCATION_TOOLKIT.md5(input => UTL_RAW.cast_to_raw(decode(a.inpessoa,1,lpad(a.nrcpfcgc,11,'0'),lpad(a.nrcpfcgc,14,'0')))))) as senha
          ,l.idcooperado_cdc
          ,c.cdcooper
          ,c.nrdconta
          ,a.inpessoa
          ,l.nmfantasia
          ,l.dsemail
      from crapass a
      join crapcdr c on (c.cdcooper=a.cdcooper and c.nrdconta=a.nrdconta and c.flgconve=1)
      join tbsite_cooperado_cdc l on (l.cdcooper=c.cdcooper and l.nrdconta=c.nrdconta and l.idmatriz is null)
     where a.dtdemiss is null
       and a.nrcpfcgc in 
          (28988714000179,
          28041263000168,
          26347847000130,
          28688063000100,
          25231098000119,
          30781616000108,
          31174869000186,
          24910376000100,
          19048307000190,
          22550108000190,
          04351725000185,
          29564948000151,
          08318398000110,
          20687343000183,
          30061604000109,
          29382956000187,
          21701050000176,
          29154137000182,
          27551595000120,
          17729050000107,
          20639212000120,
          30193737000139,
          26271543000137,
          26248782000176,
          30688995000196,
          11062814000177,
          15553317000122,
          23771075000171,
          29540810000112,
          09495512000140,
          76842285000170,
          30572942000105,
          30799451000100,
          79529897000103,
          27740746000198,
          29066803000120,
          28301962000108,
          27865703000139,
          20390824000122,
          18830154000176,
          09200199000176,
          11282954000150,
          27988464000104,
          08952149000182,
          09092969000104,
          20604375000178,
          04622855000105,
          29866028000198,
          23531485000145,
          30364818000154,
          21873318000157,
          18269952000170,
          23090510000100,
          14020383000174,
          29073054000169,
          30842747000158,
          18125134000102,
          19688793000101,
          26231189000117,
          14964635000113,
          04397877000119,
          25083794000125,
          00190762000106,
          29436465000171,
          30871253000100,
          09126625000179,
          29374909000191,
          27284549000101,
          28584485000127,
          28631686000138,
          29185772000127,
          24373111000101,
          03791062000157,
          22952513000135,
          17709504000188,
          26233158000103,
          09112373000129,
          19584855000135,
          03271824000194,
          09025056000175,
          22942953000101,
          09282787000104,
          20742033000114,
          26231020000167,
          24436006000174,
          08850243000120,
          00565477000114,
          26237532000130,
          00382610000105,
          24281334000149,
          29431385000123,
          76625870000118,
          28052171000183,
          24926038000158,
          20131674000132,
          29755293000107,
          29027017000114,
          24891606000122,
          28237441000120,
          85247104000158,
          29873863000155,
          29536888000163,
          10453062000102,
          23204727000196,
          22056015000104,
          22547317000185,
          13331104000120,
          30329762000105,
          02106829000107,
          28778726000179,
          08598481000190,
          28272155000104,
          22646490000130,
          15078677000110,
          29209725000176,
          30296519000120,
          29780167000102,
          30458652000135,
          20819746000139,
          04806281000125,
          24804561000101,
          21384579000103,
          23139534000107,
          07012114000109,
          30287670000100,
          14178675000130,
          26968411000169,
          16435691000196,
          21383913000104,
          11451824000102,
          26865098000133,
          27147965000168,
          29720480000147,
          07270589000197,
          30126157000129,
          30371349000109,
          30061654000196,
          83133728000119,
          24107323000147,
          28445777000189,
          30111765000160,
          30001038000140,
          30263169000103,
          18894248000109,
          03762643000160,
          28296197000177,
          05814607000129,
          30058134000124,
          30139739000140,
          26956825000178,
          29740287000178,
          25140383000124,
          12030536000139,
          02868866000144,
          27117228000112,
          29601205000104,
          09108775000150,
          21515665000108,
          29499592000110,
          28918081000122,
          29769162000170,
          23080186000131,
          05620939000172,
          27546965000130,
          19092148000121,
          04928174000170,
          30148071000105,
          30312507000141,
          00186050000105,
          22728201000142,
          23184240000199,
          22352053000104,
          30022375000113,
          20902212000171,
          22163148000180,
          28917905000140,
          83555029000167,
          16890582000169,
          28580029000109,
          29627663000112,
          29432114000192,
          29932725000108,
          29045493000168,
          24829490000100,
          29201435000186,
          24504572000176,
          21360675000111,
          27165341000173,
          26299112000189,
          29616320000152,
          29506486000116,
          21426514000183,
          14090934000176,
          29845954000187,
          28601747000114,
          17458047000104,
          29137991000130,
          24922498000108,
          07601858000150,
          28939962000120,
          85156826000105,
          95857728000140,
          10811162000163,
          57789596000178,
          29462093000158,
          25316778000135,
          18015091000102,
          18073051000109,
          23349290000189,
          15259334000151,
          27908899000100,
          80561374000115,
          16882591000108,
          22143068000162,
          29659094000197,
          04996761000104,
          18147040000126,
          09096338000163,
          11870253000132,
          29940320000103,
          07945944000180,
          17027379000126,
          27064163000194,
          27206406000181,
          23495537000175,
          03395352000181,
          05330801000139,
          25992137000109,
          20653171000127,
          24666789000182,
          21799138000172,
          13301758000101,
          21904400000100,
          23372737000130,
          29531243000138,
          02267742000103,
          08795652000171,
          29618480000130,
          13261211000120,
          29618012000166,
          00844958000169,
          06272418000134,
          10978660000103,
          14038804000194,
          25362412000100,
          03123708000128,
          01405592000194,
          07480351000196,
          05881779000115,
          26617774000150,
          13484064000157,
          22009589000121,
          26166022000110,
          29202341000121,
          22347113000109,
          26809513000131,
          17015299000150,
          05371374000137,
          29235958000143,
          12914376000190,
          23150784000130,
          29113287000148,
          28786677000116,
          08144793000124,
          02985238000149,
          26643329000164,
          19736574000150,
          29067119000163,
          21832976000109,
          06966884000110,
          17862237000184,
          12108050000176,
          29539218000109,
          22833465000166,
          29112740000100,
          21306735000118,
          28453575000189,
          29569394000185,
          24343934000194,
          82859695000126,
          04534505000197,
          19835174000100,
          04153478000102,
          15017421000100,
          24550194000167,
          19090473000155,
          19796786000123,
          03813072000146,
          22716101000104,
          20201194000109,
          26152212000188,
          24162787000156,
          28466377000150,
          11390321000166,
          28690959000115,
          05360636000168,
          28908783000125,
          06010767000188,
          28414206000187,
          29291856000145,
          29294044000153,
          29308918000184,
          32022359000156,
          28811535000161,
          23495961000110,
          27512380000108,
          29229829000142,
          18995824000104,
          15873740000100,
          27081659000176,
          21876195000108,
          12007817000170,
          21979039000172,
          14002404000129,
          20866517000175,
          24361600000143,
          20195956000101,
          25075511000101,
          27403315000136,
          07194089000113,
          28680024000158,
          16925227000188,
          26950155000182,
          28919471000117,
          28163845000117,
          22035490000102,
          28915120000138,
          24965397000114,
          13402491000149,
          28772100000155,
          29149863000107,
          29161602000102,
          26544194000180,
          23043576000131,
          29091591000131,
          24384602000158,
          13805273000155,
          04448826000179,
          20701261000146,
          03224630000138,
          23287876000166,
          03959775000187,
          28142414000174,
          23114958000109,
          77553756000192,
          27583598000145,
          82094640000172,
          28594635000183,
          29091348000113,
          24747076000143);
     
  cursor cr_valida (pr_dslogin in tbepr_cdc_usuario.dslogin%type) is
    select *
      from tbepr_cdc_usuario u
     where u.dslogin = pr_dslogin;
     
  rw_usuario                   cr_usuario%rowtype;  
  rw_valida                    cr_valida%rowtype;  
  vr_idusuario                 tbepr_cdc_usuario.idusuario%type;
  vr_idvendedor                tbepr_cdc_vendedor.idvendedor%type;

begin
  
  for rw_usuario in cr_usuario loop
    --dbms_output.put_line ('Passei: ' || rw_usuario.idcooperado_cdc);
    -- criar controle para nao gerar mais de um login igual
    OPEN cr_valida  (rw_usuario.login);
    FETCH cr_valida INTO rw_valida;
    
    IF cr_valida%NOTFOUND THEN
    
      begin
        insert into tbepr_cdc_usuario (dslogin, dssenha, flgadmin)
        values (rw_usuario.login, rw_usuario.senha, 1)
        returning idusuario into vr_idusuario;
        
        insert into tbepr_cdc_vendedor (nmvendedor, nrcpf, dsemail, idcooperado_cdc)
        values (rw_usuario.nmfantasia, rw_usuario.login, rw_usuario.dsemail, rw_usuario.idcooperado_cdc)
        returning idvendedor into vr_idvendedor;
        
        insert into tbepr_cdc_usuario_vinculo (idusuario,idcooperado_cdc,idvendedor )
        values (vr_idusuario, rw_usuario.idcooperado_cdc, vr_idvendedor);
        
        commit;
        
      exception
        when others then
          dbms_output.put_line ('EROO: ' || SQLERRM);
          null;
      end;
    ELSE
      null;
      dbms_output.put_line ('Usuário já existe');
    END IF;
    CLOSE cr_valida;
  end loop;
  
end;