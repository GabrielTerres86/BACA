
  begin
  
    declare
    
      ds_exc_erro_v exception;
      ds_dados_rollback_v clob := null;
      ds_texto_rollback_v varchar2(32600);
    
      cd_cooperativa_v      crapcop.cdcooper%type := 3;
      ds_nome_arquivo_bkp_v varchar2(100);
      ds_nome_diretorio_v   crapprm.dsvlrprm%type;
      ds_critica_v          crapcri.dscritic%type;
    
      qt_registro    number(10) := 0;
      nr_arquivo     number(10) := 1;
      qt_reg_arquivo number(10) := 50000;
    
      vr_dscritic VARCHAR2(1000);
    
      cursor c01 is
        select b.rowid as id_linha,
               b.dtfimvig,
               b.dtcancel,
               b.cdsitseg,
               b.cdopeexc,
               b.cdageexc,
               b.dtinsexc,
               b.cdopecnl
          from crapcop d, tbseg_prestamista c, crapseg b
         where c.cdcooper = d.cdcooper
           and b.cdsitseg <> 5
           and c.cdcooper = b.cdcooper
           and c.nrdconta = b.nrdconta
           and c.nrctrseg = b.nrctrseg
           and c.nrproposta in ('770359015577',
                                '770358812341',
                                '770354707969',
                                '770354707950',
                                '770351340002',
                                '770350770240',
                                '770357593891',
                                '770354564823')
        UNION ALL       
        select b.rowid as id_linha,
               b.dtfimvig,
               b.dtcancel,
               b.cdsitseg,
               b.cdopeexc,
               b.cdageexc,
               b.dtinsexc,
               b.cdopecnl
          from crapcop d, tbseg_prestamista c, crapseg b
         where c.cdcooper = d.cdcooper
           and b.cdsitseg <> 5
           and c.cdcooper = b.cdcooper
           and c.nrdconta = b.nrdconta
           and c.nrctrseg = b.nrctrseg
           and c.nrproposta in ('770358678254',
                                '770359647573',
                                '770359140193',
                                '770354436906',
                                '770573468465',
                                '770354527782',
                                '770354977834',
                                '770354287625',
                                '770356441770',
                                '770355589102',
                                '770356689976',
                                '770354561948',
                                '770354240009',
                                '770572919285',
                                '770572919277',
                                '770572919269',
                                '770572919250',
                                '770572919242',
                                '770572919234',
                                '770572919226',
                                '770355991067',
                                '770355924068',
                                '770354157136',
                                '770356934202',
                                '770354609983',
                                '770572920194',
                                '770354637537',
                                '770355921670',
                                '770359023588',
                                '770354786524',
                                '770358428754',
                                '770358859127',
                                '770353895214',
                                '770355879216',
                                '770358230016',
                                '770355340481',
                                '770359581076',
                                '770355544168',
                                '770354048906',
                                '770359968787',
                                '770354553015',
                                '770357630428',
                                '770354519798',
                                '770357910013',
                                '770573542860',
                                '770573542851',
                                '770573542843',
                                '770573542835',
                                '770573542827',
                                '770573542819',
                                '770573542800',
                                '770354908352',
                                '770354908344',
                                '770359194250',
                                '770352532940',
                                '770357371082',
                                '770357415802',
                                '770355722996',
                                '770354360420',
                                '770355198316',
                                '770357792851',
                                '770354783894',
                                '770355150500',
                                '770358588140',
                                '770354456044',
                                '770356945042',
                                '770573094875',
                                '770359937903',
                                '770357030447',
                                '770359998112',
                                '770355216594',
                                '770355811697',
                                '770356875460',
                                '770572944018',
                                '770572944000',
                                '770572943992',
                                '770572943984',
                                '770572943976',
                                '770354651394',
                                '770358003788',
                                '770358733239',
                                '770351403233',
                                '770350886982',
                                '770353737503',
                                '770357297834',
                                '770356840933',
                                '770359220618',
                                '770350762205',
                                '770355562441',
                                '770355886700',
                                '770573152417',
                                '770573152409',
                                '770573152395',
                                '770573152387',
                                '770573152379',
                                '770573152360',
                                '770573152352',
                                '770354510251',
                                '770354094347',
                                '770355212947',
                                '770352682268',
                                '770356936523',
                                '770355328791',
                                '770355275086',
                                '770359160020',
                                '770354671700',
                                '770573730658',
                                '770356630955',
                                '770354739119',
                                '770353593234',
                                '770573627920',
                                '770573417593',
                                '770351892129',
                                '770359654502',
                                '770355528421',
                                '770357595223',
                                '770355702103',
                                '770358916929',
                                '770357410150',
                                '770356115660',
                                '770572920496',
                                '770572920488',
                                '770354945525',
                                '770357127491',
                                '770358284248',
                                '770355617670',
                                '770354488752',
                                '770354999927',
                                '770355556590',
                                '770357463998',
                                '770573317980',
                                '770573317971',
                                '770573317963',
                                '770573317939',
                                '770350482695',
                                '770350480838',
                                '770355955192',
                                '770356775104',
                                '770355697436',
                                '770356730798',
                                '770354613891',
                                '770355884180',
                                '770353657895',
                                '770356231473',
                                '770355298876',
                                '770358689515',
                                '770354109379',
                                '770355829570',
                                '770352007668',
                                '770355212963',
                                '770356454120',
                                '770357066662',
                                '770357877512',
                                '770357446422',
                                '770355921590',
                                '770357878900',
                                '770359150369',
                                '770350720103',
                                '770349036363',
                                '770349036355',
                                '770354597969',
                                '770353765787',
                                '770356446135',
                                '770357084814',
                                '770354467585',
                                '770352697583',
                                '770355870774',
                                '770356651200',
                                '770354537028',
                                '770357473942',
                                '770354477076',
                                '770355977579',
                                '770355249441',
                                '770355245535',
                                '770351690070',
                                '770357237084',
                                '770358754490',
                                '770355517438',
                                '770355214001',
                                '770356932684',
                                '770355893790',
                                '770359355190',
                                '770350559876',
                                '770350559850',
                                '770350545379',
                                '770359218389',
                                '770357580587',
                                '770354883406',
                                '770355213382',
                                '770357977665',
                                '770358874320',
                                '770355199452',
                                '770351350903',
                                '770354879301',
                                '770355708144',
                                '770355893090',
                                '770355214168',
                                '770355244490',
                                '770354726459',
                                '770355729699',
                                '770356916808',
                                '770356516265',
                                '770355181685',
                                '770354968940',
                                '770355154327',
                                '770356334574',
                                '770359945841',
                                '770356194039',
                                '770356864336',
                                '770355982793',
                                '770573084730',
                                '770359849664',
                                '770357716462',
                                '770356589750',
                                '770355585026',
                                '770358788394',
                                '770353582720',
                                '770352764809',
                                '770359248377',
                                '770355878600',
                                '770355728579',
                                '770355456897',
                                '770355215130',
                                '770353904345',
                                '770354136023',
                                '770356864867',
                                '770359807899',
                                '770357968690',
                                '770355952673',
                                '770356589190',
                                '770352499161',
                                '770357098580',
                                '770355734544',
                                '770573151399',
                                '770354631660',
                                '770355783677',
                                '770349319071',
                                '770353480790',
                                '770358823831',
                                '770355943755',
                                '770354929937',
                                '770354929929',
                                '770353570366',
                                '770351031751',
                                '770355216080',
                                '770356246713',
                                '770357597927',
                                '770359342780',
                                '770355222144',
                                '770357898609',
                                '770355953874',
                                '770355064042',
                                '770355205568',
                                '770355040062',
                                '770358701434',
                                '770359007540',
                                '770356760948',
                                '770356231759',
                                '770355386864',
                                '770355386856',
                                '770355321584',
                                '770352846325',
                                '770573426860',
                                '770573273567',
                                '770573273559',
                                '770573273540',
                                '770573273532',
                                '770573273524',
                                '770573273516',
                                '770573273508',
                                '770573273494',
                                '770573273486',
                                '770573273478',
                                '770349522977',
                                '770349522934',
                                '770356585836',
                                '770355686604',
                                '770357801524',
                                '770352148512',
                                '770359350422',
                                '770356848195',
                                '770356848187',
                                '770356262204',
                                '770355955141',
                                '770353832522',
                                '770355957063',
                                '770359423047',
                                '770355077349',
                                '770358072631',
                                '770354868709',
                                '770355465497',
                                '770358227546',
                                '770359114761',
                                '770358869211',
                                '770355625010',
                                '770573417321',
                                '770573417313',
                                '770350300970',
                                '770355230937',
                                '770359140851',
                                '770355151697',
                                '770355142094',
                                '770354364514',
                                '770359702426',
                                '770354957078',
                                '770357115400',
                                '770357531608',
                                '770353930281',
                                '770359118627',
                                '770355406229',
                                '770354460866',
                                '770573107160',
                                '770350424725',
                                '770350422226',
                                '770355380130',
                                '770351043601',
                                '770357030749',
                                '770355665852',
                                '770355093034',
                                '770573718879',
                                '770357306728',
                                '770353495895',
                                '770573089090',
                                '770572920798',
                                '770572920780',
                                '770354560607',
                                '770357361710',
                                '770353925474',
                                '770355310671',
                                '770358490107',
                                '770354650649',
                                '770355803201',
                                '770357320534',
                                '770354829053',
                                '770351323787',
                                '770350444378',
                                '770350444360',
                                '770349758660',
                                '770349758652',
                                '770349758636',
                                '770353998820',
                                '770359292058',
                                '770356736044',
                                '770357700221',
                                '770358744133',
                                '770354536889',
                                '770359373228',
                                '770356433599',
                                '770353952030',
                                '770353484290',
                                '770355983170',
                                '770359408307',
                                '770573446372',
                                '770355718425',
                                '770572920640',
                                '770572920631',
                                '770572920623',
                                '770572920615',
                                '770572920607',
                                '770572920593',
                                '770572920585',
                                '770355089592',
                                '770356970780',
                                '770355198200',
                                '770356488377',
                                '770356705467',
                                '770357245958',
                                '770357546630',
                                '770355719995',
                                '770357444900',
                                '770357310601',
                                '770355582337',
                                '770573542797',
                                '770354935244',
                                '770355222870',
                                '770357129630',
                                '770573318897',
                                '770351321393',
                                '770359101490',
                                '770573795067',
                                '770572876080',
                                '770353832212',
                                '770355633080',
                                '770355063542',
                                '770572932419',
                                '770358735495',
                                '770354978245',
                                '770355586936',
                                '770359650612',
                                '770359650485',
                                '770359650426',
                                '770573238982',
                                '770355771490',
                                '770359793855',
                                '770355229181',
                                '770356199383',
                                '770352119369',
                                '770350824090',
                                '770355698092',
                                '770357978661',
                                '770353926950',
                                '770573625579',
                                '770358104940',
                                '770356079043',
                                '770356079035',
                                '770356079027',
                                '770356079019',
                                '770356079000',
                                '770356078993',
                                '770356078985',
                                '770356078977',
                                '770354842831',
                                '770355329283',
                                '770573150414',
                                '770573150406',
                                '770573150392',
                                '770573150384',
                                '770573150376',
                                '770573150368',
                                '770351376392',
                                '770354629801',
                                '770353121472',
                                '770354267616',
                                '770353648225',
                                '770356337190',
                                '770573626389',
                                '770349693631',
                                '770352761451',
                                '770351156368',
                                '770355750981',
                                '770356370864',
                                '770358522157',
                                '770350098658',
                                '770359812981',
                                '770354978148',
                                '770572943453',
                                '770572943445',
                                '770572943437',
                                '770354895420',
                                '770356323106',
                                '770355443272',
                                '770356657888',
                                '770359710410',
                                '770355979130',
                                '770356539680',
                                '770353229869',
                                '770356840550',
                                '770355199630',
                                '770357785600',
                                '770573796969',
                                '770359177038',
                                '770359177011',
                                '770358524478',
                                '770351318139',
                                '770356938569',
                                '770355584925',
                                '770354444364',
                                '770356257316',
                                '770358698484',
                                '770358266983',
                                '770354152223',
                                '770573423208',
                                '770356931246',
                                '770358167772',
                                '770573734807',
                                '770358230890',
                                '770355511243',
                                '770573323270',
                                '770572920348',
                                '770572920330',
                                '770572920321',
                                '770572920313',
                                '770572920305',
                                '770572920291',
                                '770572920283',
                                '770351926260',
                                '770355056376',
                                '770355903567',
                                '770353715704',
                                '770355254798',
                                '770359701616',
                                '770356974760',
                                '770356665228',
                                '770356665210',
                                '770356665201',
                                '770356237439',
                                '770355491030',
                                '770359214448',
                                '770356528271',
                                '770355511146',
                                '770357987407',
                                '770354895641',
                                '770359319347',
                                '770357850037',
                                '770359510250',
                                '770359186479',
                                '770573389654',
                                '770352624250',
                                '770356319656',
                                '770351532530',
                                '770356235894',
                                '770356244001',
                                '770356889371',
                                '770354681030',
                                '770355305910',
                                '770354399016',
                                '770355878643',
                                '770356808940',
                                '770357647401',
                                '770355784819',
                                '770356721616',
                                '770353708589',
                                '770351656255',
                                '770354163993',
                                '770573150996',
                                '770354931907',
                                '770356918347',
                                '770354752840',
                                '770355001105',
                                '770356155114',
                                '770353641140',
                                '770356993349',
                                '770358352383',
                                '770358424694',
                                '770355666921',
                                '770355978800',
                                '770354534258',
                                '770357852501',
                                '770357852498',
                                '770357852480',
                                '770357852471',
                                '770357852463',
                                '770354903725',
                                '770354642280',
                                '770359394438',
                                '770355988848',
                                '770355925170',
                                '770355262111',
                                '770573627083',
                                '770358836437',
                                '770359342020',
                                '770355132161',
                                '770573150899',
                                '770573150880',
                                '770573150872',
                                '770355415252',
                                '770358240631',
                                '770573624769',
                                '770351350962',
                                '770355447642',
                                '770355212920',
                                '770356192435',
                                '770357531624',
                                '770355483860',
                                '770354618095',
                                '770353611240',
                                '770351615940',
                                '770355733475',
                                '770358713777',
                                '770356172655',
                                '770355726380',
                                '770355612848',
                                '770357605490',
                                '770350780947',
                                '770355358364',
                                '770355002284',
                                '770356241665',
                                '770355536467',
                                '770355578780',
                                '770359968965',
                                '770355984346',
                                '770573151208',
                                '770573151194',
                                '770573151186',
                                '770573151178',
                                '770573151160',
                                '770573091957',
                                '770573091868',
                                '770358936911',
                                '770355871916',
                                '770359555490',
                                '770357701201',
                                '770355731812',
                                '770355865100',
                                '770355787567',
                                '770358677959',
                                '770354498090',
                                '770358880495',
                                '770354769794',
                                '770357202639',
                                '770354865726',
                                '770355701611',
                                '770358796567',
                                '770357729548',
                                '770359859643',
                                '770359814178',
                                '770355924580',
                                '770354902117',
                                '770355201040',
                                '770355733262',
                                '770356257669',
                                '770357861853',
                                '770356092287',
                                '770357586992',
                                '770357586984',
                                '770355597261',
                                '770356544510',
                                '770354689790',
                                '770351161825',
                                '770349134632',
                                '770349134624',
                                '770355971309',
                                '770573235959',
                                '770359177658',
                                '770573706781',
                                '770356295919',
                                '770358015344',
                                '770573091400',
                                '770573091396',
                                '770353070584',
                                '770352562785',
                                '770352562777',
                                '770352562769',
                                '770352562750',
                                '770352562742',
                                '770352562734',
                                '770356504747',
                                '770355796825',
                                '770352682799',
                                '770358234763',
                                '770354791838',
                                '770354137470',
                                '770355272613',
                                '770357315654',
                                '770350740988',
                                '770357024838',
                                '770356574095',
                                '770355729710',
                                '770354506610',
                                '770356097289',
                                '770354614715',
                                '770355234878',
                                '770355954714',
                                '770357698154',
                                '770358491057',
                                '770355430669',
                                '770354659514',
                                '770353758705',
                                '770359412070',
                                '770358765190',
                                '770358504400',
                                '770357325366',
                                '770357002940',
                                '770355264246',
                                '770357250226',
                                '770573559401',
                                '770356169735',
                                '770355250164',
                                '770359629591',
                                '770353548921',
                                '770573022122',
                                '770354428342',
                                '770573543521',
                                '770573543513',
                                '770573543505',
                                '770573543491',
                                '770354907500',
                                '770356538870',
                                '770354271583',
                                '770354894300',
                                '770359257180',
                                '770358210953',
                                '770355559246',
                                '770355447928',
                                '770359694067',
                                '770354100312',
                                '770354479540',
                                '770355102602',
                                '770359688890',
                                '770354456125',
                                '770355063569',
                                '770354863901',
                                '770355883299',
                                '770356092058',
                                '770349231336',
                                '770356946472',
                                '770573837274',
                                '770353772694',
                                '770352665576',
                                '770356787528',
                                '770353889486',
                                '770355465837',
                                '770573728327',
                                '770573543181',
                                '770354743752',
                                '770356308999',
                                '770350461850',
                                '770349729571',
                                '770349729563',
                                '770349727390',
                                '770349727382',
                                '770349727374',
                                '770349727366',
                                '770349727340',
                                '770349727331',
                                '770353071840',
                                '770352420972',
                                '770352417840',
                                '770355442764',
                                '770358472389',
                                '770355297675',
                                '770358049400',
                                '770359331053',
                                '770355556514',
                                '770353774433',
                                '770357709075',
                                '770356727665',
                                '770357934230',
                                '770359232683',
                                '770356812697',
                                '770356473396',
                                '770357542804',
                                '770353694570',
                                '770358261264',
                                '770354879751',
                                '770359526474',
                                '770356953320',
                                '770356529197',
                                '770358047718',
                                '770355214567',
                                '770356587979',
                                '770355917681',
                                '770357567505',
                                '770354317508',
                                '770356832787',
                                '770356050002',
                                '770354628139',
                                '770355927121',
                                '770355506142',
                                '770356668863',
                                '770355301168',
                                '770355551245',
                                '770353728520',
                                '770356980760',
                                '770357521700',
                                '770357336392',
                                '770359194366',
                                '770573564618',
                                '770350542795',
                                '770355026752',
                                '770353728768',
                                '770355216314',
                                '770356320484',
                                '770356058658',
                                '770357664063',
                                '770355297659',
                                '770355171256',
                                '770357007488',
                                '770356443519',
                                '770356438671',
                                '770357938350',
                                '770357938333',
                                '770357791022',
                                '770572990605',
                                '770352833924',
                                '770355910008',
                                '770572937372',
                                '770351320087',
                                '770358912001',
                                '770354541629',
                                '770355222381',
                                '770355442543',
                                '770356880668',
                                '770358241077',
                                '770355502546',
                                '770572876861',
                                '770352043788',
                                '770357565057',
                                '770358772021',
                                '770354284294',
                                '770573418530',
                                '770354048523',
                                '770572882454',
                                '770356971345',
                                '770355248151',
                                '770352260053',
                                '770351350768',
                                '770355516016',
                                '770350682058',
                                '770355996573',
                                '770357385938',
                                '770349130556',
                                '770356796390',
                                '770355413730',
                                '770354670640',
                                '770358750869',
                                '770355160262',
                                '770354477475',
                                '770355985695',
                                '770358396445',
                                '770351322446',
                                '770355329070',
                                '770355959775',
                                '770353984187',
                                '770355546497',
                                '770352474592',
                                '770355516776',
                                '770358754198',
                                '770355879313',
                                '770355463923',
                                '770355463915',
                                '770355215890',
                                '770355973999',
                                '770359975589',
                                '770573231660',
                                '770356290003',
                                '770356553993',
                                '770353395610',
                                '770355750388',
                                '770359364431',
                                '770359132956',
                                '770356759702',
                                '770355332292',
                                '770358685927',
                                '770359970218',
                                '770357232082',
                                '770353678000',
                                '770573542673',
                                '770573542665',
                                '770573542657',
                                '770573542649',
                                '770356320948',
                                '770355332098',
                                '770355024067',
                                '770355399974',
                                '770355272419',
                                '770352614262',
                                '770356586603',
                                '770355735249',
                                '770358007228',
                                '770573273370',
                                '770573273362',
                                '770354808420',
                                '770358829740',
                                '770358829732',
                                '770358829724',
                                '770358829716',
                                '770358829708',
                                '770358829694',
                                '770358829686',
                                '770358829678',
                                '770358829660',
                                '770357645590',
                                '770351373857',
                                '770357054940',
                                '770355222799',
                                '770355302636',
                                '770354762145',
                                '770349759519',
                                '770359742983',
                                '770355587150',
                                '770356101014',
                                '770354514443',
                                '770354748797',
                                '770355403025',
                                '770573626729',
                                '770358396305',
                                '770359231970',
                                '770354439689',
                                '770356742613',
                                '770358823696',
                                '770355975622',
                                '770355728072',
                                '770355477258',
                                '770355154726',
                                '770350899456',
                                '770355811980',
                                '770349224470',
                                '770356730569',
                                '770572876462',
                                '770359641095',
                                '770355041581',
                                '770355140423',
                                '770354582228',
                                '770355631060',
                                '770573609751',
                                '770354696223',
                                '770357479657',
                                '770354597837',
                                '770573620593',
                                '770573620585',
                                '770573620500',
                                '770573274040',
                                '770573274032',
                                '770573274024',
                                '770573274016',
                                '770573274008',
                                '770573273990',
                                '770573273982',
                                '770354536803',
                                '770354676508',
                                '770351350830',
                                '770359405219',
                                '770355747174',
                                '770359392710',
                                '770354034700',
                                '770354562391',
                                '770357575095',
                                '770358816410',
                                '770573152654',
                                '770573152646',
                                '770573152638',
                                '770573152620',
                                '770573152611',
                                '770573152603',
                                '770354516020',
                                '770359709765',
                                '770356679121',
                                '770354833956',
                                '770573541804',
                                '770573541790',
                                '770573541782',
                                '770573541774',
                                '770573541766',
                                '770573541758',
                                '770573541740',
                                '770354642107',
                                '770357086604',
                                '770355330346',
                                '770350553908',
                                '770350553894',
                                '770350553886',
                                '770350553878',
                                '770350553860',
                                '770350553851',
                                '770350553843',
                                '770350552650',
                                '770350552642',
                                '770350227636',
                                '770350192476',
                                '770350112545',
                                '770354866943',
                                '770354008491',
                                '770359593120',
                                '770355658872',
                                '770356397320',
                                '770356795156',
                                '770356360150',
                                '770354975025',
                                '770354497867',
                                '770355922740',
                                '770353078739',
                                '770356877594',
                                '770359588895',
                                '770358929494',
                                '770355135012',
                                '770358294731',
                                '770351912405',
                                '770354630826',
                                '770355505898',
                                '770355591441',
                                '770350422331',
                                '770349708337',
                                '770349708329',
                                '770573173970',
                                '770573173961',
                                '770573173953',
                                '770350252452',
                                '770350252444',
                                '770359761848',
                                '770351737590',
                                '770356986261',
                                '770356491424',
                                '770357445892',
                                '770355792994',
                                '770573834763',
                                '770350417800',
                                '770355221563',
                                '770355221555',
                                '770354522438',
                                '770572994481',
                                '770357196612',
                                '770355199312',
                                '770358038441',
                                '770355586448',
                                '770572937038',
                                '770356850190',
                                '770349142171',
                                '770356124561',
                                '770573543157',
                                '770573543149',
                                '770573543130',
                                '770573543122',
                                '770573543114',
                                '770354651289',
                                '770354651270',
                                '770354651203',
                                '770355917754',
                                '770356234669',
                                '770356900278');
    
      procedure valida_diretorio_p(ds_nome_diretorio_p in varchar2,
                                   ds_critica_p        out crapcri.dscritic%TYPE) is
      
        ds_critica_v    crapcri.dscritic%type;
        ie_tipo_saida_v varchar2(3);
        ds_saida_v      varchar2(1000);
      
      begin
      
        if (gene0001.fn_exis_diretorio(ds_nome_diretorio_p)) then
        
          ds_critica_p := null;
        
        else
        
          gene0001.pc_OSCommand_Shell(pr_des_comando => 'mkdir ' ||
                                                        ds_nome_diretorio_p ||
                                                        ' 1> /dev/null',
                                      pr_typ_saida   => ie_tipo_saida_v,
                                      pr_des_saida   => ds_saida_v);
        
          if (ie_tipo_saida_v = 'ERR') then
          
            ds_critica_v := 'CRIAR DIRETORIO ARQUIVO -> Nao foi possivel criar o diretorio para gerar os arquivos. ' ||
                            ds_saida_v;
            raise ds_exc_erro_v;
          
          end if;
        
          gene0001.pc_OSCommand_Shell(pr_des_comando => 'chmod 777 ' ||
                                                        ds_nome_diretorio_p ||
                                                        ' 1> /dev/null',
                                      pr_typ_saida   => ie_tipo_saida_v,
                                      pr_des_saida   => ds_saida_v);
        
          if (ie_tipo_saida_v = 'ERR') then
          
            ds_critica_v := 'PERMISSAO NO DIRETORIO -> Nao foi possivel adicionar permissao no diretorio dos arquivos. ' ||
                            ds_saida_v;
            raise ds_exc_erro_v;
          
          end if;
        
        end if;
      
      exception
        when ds_exc_erro_v then
        
          ds_critica_p := ds_critica_v;
        
      end valida_diretorio_p;
    
    begin
    
      if (upper(gene0001.fn_database_name) like '%AYLLOSP%') then
      
        select max(a.dsvlrprm)
          into ds_nome_diretorio_v
          from crapprm a
         where a.nmsistem = 'CRED'
           and a.cdcooper = cd_cooperativa_v
           and a.cdacesso = 'ROOT_MICROS';
      
        if (ds_nome_diretorio_v is null) then
        
          select max(a.dsvlrprm)
            into ds_nome_diretorio_v
            from crapprm a
           where a.nmsistem = 'CRED'
             and a.cdcooper = 0
             and a.cdacesso = 'ROOT_MICROS';
        
        end if;
      
        ds_nome_diretorio_v := ds_nome_diretorio_v ||
                               'cpd/bacas/INC0135228';
      
      else
      
        ds_nome_diretorio_v := gene0001.fn_diretorio(pr_tpdireto => 'C',
                                                     pr_cdcooper => 3);
      
        ds_nome_diretorio_v := ds_nome_diretorio_v || '/INC0135228';
      
      end if;
    
      valida_diretorio_p(ds_nome_diretorio_p => ds_nome_diretorio_v,
                         ds_critica_p        => ds_critica_v);
    
      if (trim(ds_critica_v) is not null) then
      
        raise ds_exc_erro_v;
      
      end if;
    
      for r01 in c01 loop
      
        begin
        
          if (qt_reg_arquivo >= 50000) then
          
            qt_reg_arquivo := 0;
          
            dbms_lob.createtemporary(ds_dados_rollback_v,
                                     true,
                                     dbms_lob.CALL);
            dbms_lob.open(ds_dados_rollback_v, dbms_lob.lob_readwrite);
            gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                    ds_texto_rollback_v,
                                    'begin ' || chr(13),
                                    false);
            ds_nome_arquivo_bkp_v := 'ROLLBACK_INC0135228_' || nr_arquivo ||
                                     '.sql';
          
            nr_arquivo := nr_arquivo + 1;
          
          end if;
        
          qt_registro    := qt_registro + 1;
          qt_reg_arquivo := qt_reg_arquivo + 1;
        
          update crapseg a
             set a.dtfimvig = trunc(sysdate),
                 a.dtcancel = trunc(sysdate),
                 a.cdsitseg = 5,
                 a.cdopeexc = '1',
                 a.cdageexc = 1,
                 a.dtinsexc = trunc(sysdate),
                 a.cdopecnl = '1'
           where a.rowid = r01.id_linha;
        
          gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                  ds_texto_rollback_v,
                                  'update crapseg a ' || chr(13) ||
                                  'set  a.dtfimvig  = ' || 'to_date(' ||
                                  chr(39) ||
                                  trim(to_char(r01.dtfimvig, 'dd/mm/yyyy')) ||
                                  chr(39) || ',' || chr(39) || 'dd/mm/yyyy' ||
                                  chr(39) || '), ' || chr(13) ||
                                  ' a.dtcancel  = ' || 'to_date(' ||
                                  chr(39) ||
                                  trim(to_char(r01.dtcancel, 'dd/mm/yyyy')) ||
                                  chr(39) || ',' || chr(39) || 'dd/mm/yyyy' ||
                                  chr(39) || '), ' || chr(13) ||
                                  ' a.cdsitseg  = ' ||
                                  replace(nvl(trim(to_char(r01.cdsitseg)),
                                              'null'),
                                          ',',
                                          '.') || ', ' || chr(13) ||
                                  ' a.cdopeexc  = ' || chr(39) ||
                                  r01.cdopeexc || chr(39) || ', ' ||
                                  chr(13) || ' a.cdageexc  = ' ||
                                  replace(nvl(trim(to_char(r01.cdageexc)),
                                              'null'),
                                          ',',
                                          '.') || ', ' || chr(13) ||
                                  ' a.dtinsexc  = ' || 'to_date(' ||
                                  chr(39) ||
                                  trim(to_char(r01.dtinsexc, 'dd/mm/yyyy')) ||
                                  chr(39) || ',' || chr(39) || 'dd/mm/yyyy' ||
                                  chr(39) || '), ' || chr(13) ||
                                  ' a.cdopecnl  = ' || chr(39) ||
                                  r01.cdopecnl || chr(39) || chr(13) ||
                                  'where  a.rowid   = ' || chr(39) ||
                                  r01.id_linha || chr(39) || ';' || chr(13) ||
                                  chr(13),
                                  false);
        
          if (qt_registro >= 10000) then
          
            gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                    ds_texto_rollback_v,
                                    'commit;' || chr(13) || chr(13),
                                    FALSE);
          
            commit;
          
            qt_registro := 0;
          
          end if;
        
          if (qt_reg_arquivo >= 50000) then
          
            gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                    ds_texto_rollback_v,
                                    'commit;' || chr(13) || chr(13),
                                    FALSE);
            gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                    ds_texto_rollback_v,
                                    'end;' || chr(13),
                                    FALSE);
            gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                    ds_texto_rollback_v,
                                    chr(13),
                                    TRUE);
          
            gene0002.pc_solicita_relato_arquivo(pr_cdcooper  => cd_cooperativa_v,
                                                pr_cdprogra  => 'ATENDA',
                                                pr_dtmvtolt  => trunc(sysdate),
                                                pr_dsxml     => ds_dados_rollback_v,
                                                pr_dsarqsaid => ds_nome_diretorio_v || '/' ||
                                                                ds_nome_arquivo_bkp_v,
                                                pr_flg_impri => 'N',
                                                pr_flg_gerar => 'S',
                                                pr_flgremarq => 'N',
                                                pr_nrcopias  => 1,
                                                pr_des_erro  => ds_critica_v);
          
            if (trim(ds_critica_v) is not null) then
            
              rollback;
              raise ds_exc_erro_v;
            
            end if;
          
            dbms_lob.close(ds_dados_rollback_v);
            dbms_lob.freetemporary(ds_dados_rollback_v);
          
          end if;
        
        exception
          when others then
            vr_dscritic := 'Falha ao atualizar crapseg';
            rollback;
            exit;
        end;
      
      end loop;
    
      if (qt_reg_arquivo <> 50000) then
      
        gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                ds_texto_rollback_v,
                                'commit;' || chr(13) || chr(13),
                                FALSE);
        gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                ds_texto_rollback_v,
                                'end;' || chr(13),
                                FALSE);
        gene0002.pc_escreve_xml(ds_dados_rollback_v,
                                ds_texto_rollback_v,
                                chr(13),
                                TRUE);
      
        gene0002.pc_solicita_relato_arquivo(pr_cdcooper  => cd_cooperativa_v,
                                            pr_cdprogra  => 'ATENDA',
                                            pr_dtmvtolt  => trunc(sysdate),
                                            pr_dsxml     => ds_dados_rollback_v,
                                            pr_dsarqsaid => ds_nome_diretorio_v || '/' ||
                                                            ds_nome_arquivo_bkp_v,
                                            pr_flg_impri => 'N',
                                            pr_flg_gerar => 'S',
                                            pr_flgremarq => 'N',
                                            pr_nrcopias  => 1,
                                            pr_des_erro  => ds_critica_v);
      
        if (trim(ds_critica_v) is not null) then
        
          raise ds_exc_erro_v;
        
        end if;
      
        dbms_lob.close(ds_dados_rollback_v);
        dbms_lob.freetemporary(ds_dados_rollback_v);
      
      end if;
    
      if (trim(vr_dscritic) is not null) then
      
        ds_critica_v := vr_dscritic;
        raise ds_exc_erro_v;
      
      end if;
    
      commit;
    
    exception
      when ds_exc_erro_v then
      
        raise_application_error(-20111, ds_critica_v);
      
    end;
  
end;
