declare
  vr_idsicredi varchar2(10);
  vr_autenticacao VARCHAR(100);
  vr_dscritic varchar2(4000);
  vr_dscomprovante crappro.dscomprovante_parceiro%TYPE;

  CURSOR cr_pagamentos IS
    SELECT 5415816 IDENTIFICADOR, '341000000008137601805202205300400011289' AUTENTICACAO_MECANICA FROM DUAL UNION
    SELECT 5415846, '341000000008137651805202205300400016574' FROM DUAL UNION
    SELECT 5415867, '341000000008137741805202205300400004002' FROM DUAL UNION
    SELECT 5415868, '341000000008137751805202205300400012407' FROM DUAL UNION
    SELECT 5415890, '341000000008137761805202205300400016574' FROM DUAL UNION
    SELECT 5415904, '341000000008137791805202205300413011922' FROM DUAL UNION
    SELECT 5415905, '341000000008137801805202205300400016574' FROM DUAL UNION
    SELECT 5415980, '341000000008138001805202205300400014515' FROM DUAL UNION
    SELECT 5415981, '341000000008138011805202205300400012096' FROM DUAL UNION
    SELECT 5416004, '341000000008138021805202205300400011544' FROM DUAL UNION
    SELECT 5416005, '341000000008138031805202205300400013629' FROM DUAL UNION
    SELECT 5416059, '341000000008138261805202205300500245896' FROM DUAL UNION
    SELECT 5416060, '341000000008138271805202205300500038521' FROM DUAL UNION
    SELECT 5416061, '341000000008138281805202205300500008346' FROM DUAL UNION
    SELECT 5416062, '341000000008138291805202205300500470559' FROM DUAL UNION
    SELECT 5416063, '341000000008138301805202205300500064951' FROM DUAL UNION
    SELECT 5416064, '341000000008138311805202205300500016574' FROM DUAL UNION
    SELECT 5416065, '341000000008138321805202205300500016574' FROM DUAL UNION
    SELECT 5416066, '341000000008138331805202205300500005402' FROM DUAL UNION
    SELECT 5416113, '341000000008138341805202205300500020000' FROM DUAL UNION
    SELECT 5416139, '341000000008138441805202205300505738756' FROM DUAL UNION
    SELECT 5416175, '341000000008138551805202205300507272843' FROM DUAL UNION
    SELECT 5416176, '341000000008138561805202205300500046516' FROM DUAL UNION
    SELECT 5416177, '341000000008138571805202205300500086516' FROM DUAL UNION
    SELECT 5416178, '341000000008138581805202205300501070061' FROM DUAL UNION
    SELECT 5416179, '341000000008138591805202205300507300749' FROM DUAL UNION
    SELECT 5416180, '341000000008138601805202205300500018783' FROM DUAL UNION
    SELECT 5416181, '341000000008138611805202205300500011580' FROM DUAL UNION
    SELECT 5416221, '341000000008138721805202205300500103348' FROM DUAL UNION
    SELECT 5416222, '341000000008138731805202205300500117244' FROM DUAL UNION
    SELECT 5416223, '341000000008138741805202205300500143043' FROM DUAL UNION
    SELECT 5416224, '341000000008138751805202205300500191828' FROM DUAL UNION
    SELECT 5416225, '341000000008138761805202205300500016574' FROM DUAL UNION
    SELECT 5416226, '341000000008138771805202205300500010867' FROM DUAL UNION
    SELECT 5416227, '341000000008138781805202205300500052358' FROM DUAL UNION
    SELECT 5416228, '341000000008138791805202205300500030394' FROM DUAL UNION
    SELECT 5416263, '341000000008138861805202205300500027965' FROM DUAL UNION
    SELECT 5416264, '341000000008138871805202205300500020200' FROM DUAL UNION
    SELECT 5416265, '341000000008138881805202205300500012701' FROM DUAL UNION
    SELECT 5416299, '341000000008139001805202205300500135796' FROM DUAL UNION
    SELECT 5416300, '341000000008139011805202205300500001534' FROM DUAL UNION
    SELECT 5416335, '341000000008139211805202205300600013853' FROM DUAL UNION
    SELECT 5416336, '341000000008139221805202205300600271522' FROM DUAL UNION
    SELECT 5416337, '341000000008139231805202205300600452536' FROM DUAL UNION
    SELECT 5416376, '341000000008139251805202205300600016574' FROM DUAL UNION
    SELECT 5416377, '341000000008139261805202205300600987174' FROM DUAL UNION
    SELECT 5416378, '341000000008139271805202205300600081508' FROM DUAL UNION
    SELECT 5416379, '341000000008139281805202205300600008781' FROM DUAL UNION
    SELECT 5416417, '341000000008139451805202205300706914802' FROM DUAL UNION
    SELECT 5416418, '341000000008139461805202205300700087558' FROM DUAL UNION
    SELECT 5416419, '341000000008139471805202205300700016574' FROM DUAL UNION
    SELECT 5416420, '341000000008139481805202205300700001031' FROM DUAL UNION
    SELECT 5416482, '341000000008139671805202205300700005258' FROM DUAL UNION
    SELECT 5416483, '341000000008139681805202205300701040244' FROM DUAL UNION
    SELECT 5416520, '341000000008139771805202205300700036396' FROM DUAL UNION
    SELECT 5416521, '341000000008139781805202205300700011741' FROM DUAL UNION
    SELECT 5416522, '341000000008139791805202205300700181923' FROM DUAL UNION
    SELECT 5416523, '341000000008139801805202205300701002321' FROM DUAL UNION
    SELECT 5416524, '341000000008139811805202205300700884595' FROM DUAL UNION
    SELECT 5416525, '341000000008139821805202205300700010178' FROM DUAL UNION
    SELECT 5416559, '341000000008139831805202205300700040746' FROM DUAL UNION
    SELECT 5416560, '341000000008139841805202205300700008827' FROM DUAL UNION
    SELECT 5416561, '341000000008139851805202205300700891695' FROM DUAL UNION
    SELECT 5416562, '341000000008139861805202205300701051287' FROM DUAL UNION
    SELECT 5416563, '341000000008139871805202205300700256447' FROM DUAL UNION
    SELECT 5416564, '341000000008139881805202205300700224336' FROM DUAL UNION
    SELECT 5416601, '341000000008139961805202205300700052170' FROM DUAL UNION
    SELECT 5416602, '341000000008139971805202205300700091801' FROM DUAL UNION
    SELECT 5416603, '341000000008139981805202205300700019890' FROM DUAL UNION
    SELECT 5416640, '341000000008140091805202205300700009000' FROM DUAL UNION
    SELECT 5416641, '341000000008140101805202205300700234764' FROM DUAL UNION
    SELECT 5416642, '341000000008140111805202205300800004347' FROM DUAL UNION
    SELECT 5416643, '341000000008140121805202205300800224262' FROM DUAL UNION
    SELECT 5416644, '341000000008140131805202205300800193657' FROM DUAL UNION
    SELECT 5416665, '341000000008140221805202205300800011864' FROM DUAL UNION
    SELECT 5416666, '341000000008140231805202205300800002571' FROM DUAL UNION
    SELECT 5416667, '341000000008140241805202205300800019680' FROM DUAL UNION
    SELECT 5416668, '341000000008140251805202205300800011041' FROM DUAL UNION
    SELECT 5416669, '341000000008140261805202205300800224640' FROM DUAL UNION
    SELECT 5416699, '341000000008140301805202205300802186705' FROM DUAL UNION
    SELECT 5416700, '341000000008140311805202205300800003811' FROM DUAL UNION
    SELECT 5416701, '341000000008140321805202205300800002392' FROM DUAL UNION
    SELECT 5416702, '341000000008140331805202205300800047392' FROM DUAL UNION
    SELECT 5416703, '341000000008140341805202205300800374400' FROM DUAL UNION
    SELECT 5416704, '341000000008140351805202205300800269611' FROM DUAL UNION
    SELECT 5416733, '341000000008140381805202205300800018594' FROM DUAL UNION
    SELECT 5416734, '341000000008140391805202205300800016574' FROM DUAL UNION
    SELECT 5416850, '341000000008140771805202205300800078525' FROM DUAL UNION
    SELECT 5416851, '341000000008140781805202205300800261731' FROM DUAL UNION
    SELECT 5416852, '341000000008140791805202205300800090632' FROM DUAL UNION
    SELECT 5416904, '341000000008140821805202205300800001079' FROM DUAL UNION
    SELECT 5416905, '341000000008140831805202205300800253968' FROM DUAL UNION
    SELECT 5416906, '341000000008140841805202205300800003347' FROM DUAL UNION
    SELECT 5416907, '341000000008140851805202205300800016168' FROM DUAL UNION
    SELECT 5416908, '341000000008140861805202205300800464356' FROM DUAL UNION
    SELECT 5416909, '341000000008140871805202205300801089877' FROM DUAL UNION
    SELECT 5416910, '341000000008140881805202205300814623875' FROM DUAL UNION
    SELECT 5416911, '341000000008140891805202205300807948888' FROM DUAL UNION
    SELECT 5416912, '341000000008140901805202205300800020314' FROM DUAL UNION
    SELECT 5416944, '341000000008140911805202205300800193753' FROM DUAL UNION
    SELECT 5416945, '341000000008140921805202205300800023582' FROM DUAL UNION
    SELECT 5416946, '341000000008140931805202205300800093758' FROM DUAL UNION
    SELECT 5416987, '341000000008141271805202205300901828898' FROM DUAL UNION
    SELECT 5416988, '341000000008141281805202205300900010065' FROM DUAL UNION
    SELECT 5417035, '341000000008141291805202205300900001019' FROM DUAL UNION
    SELECT 5417085, '341000000008141381805202205300900098483' FROM DUAL UNION
    SELECT 5417086, '341000000008141391805202205300900021338' FROM DUAL UNION
    SELECT 5417087, '341000000008141401805202205300900005915' FROM DUAL UNION
    SELECT 5417088, '341000000008141411805202205300900016574' FROM DUAL UNION
    SELECT 5417089, '341000000008141421805202205300900504960' FROM DUAL UNION
    SELECT 5417090, '341000000008141431805202205300900302976' FROM DUAL UNION
    SELECT 5417091, '341000000008141441805202205300900023608' FROM DUAL UNION
    SELECT 5417092, '341000000008141451805202205300900108958' FROM DUAL UNION
    SELECT 5417093, '341000000008141461805202205300900002078' FROM DUAL UNION
    SELECT 5417142, '341000000008141491805202205300900016574' FROM DUAL UNION
    SELECT 5417201, '341000000008141611805202205300903375189' FROM DUAL UNION
    SELECT 5417202, '341000000008141621805202205300900001679' FROM DUAL UNION
    SELECT 5417203, '341000000008141631805202205300900007359' FROM DUAL UNION
    SELECT 5417204, '341000000008141641805202205300900109520' FROM DUAL UNION
    SELECT 5417205, '341000000008141651805202205300900044991' FROM DUAL UNION
    SELECT 5417235, '341000000008141721805202205300900044712' FROM DUAL UNION
    SELECT 5417236, '341000000008141731805202205300900024931' FROM DUAL UNION
    SELECT 5417237, '341000000008141741805202205300900009698' FROM DUAL UNION
    SELECT 5417238, '341000000008141751805202205300900001022' FROM DUAL UNION
    SELECT 5417239, '341000000008141761805202205300900715759' FROM DUAL UNION
    SELECT 5417240, '341000000008141771805202205300900155081' FROM DUAL UNION
    SELECT 5417241, '341000000008141781805202205300903317982' FROM DUAL UNION
    SELECT 5417242, '341000000008141791805202205300901406309' FROM DUAL UNION
    SELECT 5417280, '341000000008141881805202205301000001429' FROM DUAL UNION
    SELECT 5417281, '341000000008141891805202205301000001931' FROM DUAL UNION
    SELECT 5417282, '341000000008141901805202205301000019040' FROM DUAL UNION
    SELECT 5417283, '341000000008141911805202205301000026801' FROM DUAL UNION
    SELECT 5417316, '341000000008141971805202205301002180241' FROM DUAL UNION
    SELECT 5417317, '341000000008141981805202205301000022406' FROM DUAL UNION
    SELECT 5417318, '341000000008141991805202205301000023960' FROM DUAL UNION
    SELECT 5417319, '341000000008142001805202205301000107751' FROM DUAL UNION
    SELECT 5417320, '341000000008142011805202205301000497314' FROM DUAL UNION
    SELECT 5417361, '341000000008142201805202205301000628749' FROM DUAL UNION
    SELECT 5417362, '341000000008142211805202205301000379784' FROM DUAL UNION
    SELECT 5417363, '341000000008142221805202205301000082286' FROM DUAL;
  rw_pagamentos cr_pagamentos%ROWTYPE;
  
  CURSOR cr_registros_lft(pr_idsicredi IN tbconv_registro_remessa_pagfor.idsicredi%TYPE) IS
     SELECT LFT.IDSICRED, 
            SUBSTR(PRO.DSPROTOC, 1, 39) dsprotoc,
            LFT.CDCOOPER,
            LFT.NRDCONTA,
            LFT.CDAGENCI,
            LFT.CDTRIBUT,
            LFT.NRREFERE,
            LFT.VLLANMTO,
            LFT.VLRJUROS,
            LFT.VLRMULTA,
            (LFT.VLLANMTO + LFT.VLRJUROS + LFT.VLRMULTA) VLRTOTAL,
            LFT.NRCPFCGC,
            LFT.DTAPURAC,
            LFT.DTLIMITE,
            REG.DHRETORNO_PROCESSAMENTO,
            LFT.DTMVTOLT
       FROM CRAPLFT LFT,
            TBCONV_REGISTRO_REMESSA_PAGFOR REG,
            CRAPPRO PRO
      WHERE lft.idsicred = pr_idsicredi
        AND pro.cdcooper = lft.cdcooper
        AND pro.nrdconta = lft.nrdconta
        AND pro.dtmvtolt = lft.dtmvtolt
        AND pro.cdtippro = 16
        AND pro.nrseqaut = lft.nrautdoc
        AND reg.idsicredi = lft.idsicred;
  rw_registros_lft cr_registros_lft%ROWTYPE;

BEGIN     


  FOR rw_pagamentos IN cr_pagamentos LOOP
    
      vr_idsicredi    := rw_pagamentos.identificador;
      vr_autenticacao := rw_pagamentos.autenticacao_mecanica;
        
      OPEN cr_registros_lft(pr_idsicredi => vr_idsicredi);
      FETCH cr_registros_lft INTO rw_registros_lft;
      CLOSE cr_registros_lft;
      
      -- Gerar o comprovante base64
      PAGA0003.pc_comprovante_darf_gps_tivit (pr_cdcooper  => rw_registros_lft.cdcooper,
                                              pr_nrdconta  => rw_registros_lft.nrdconta,
                                              pr_cdagenci  => rw_registros_lft.cdagenci,
                                              pr_dtmvtolt  => rw_registros_lft.dtmvtolt,
                                              pr_cdempres  => 'A0',
                                              pr_cdagente  => 341,
                                              pr_dttransa  => rw_registros_lft.dhretorno_processamento,
                                              pr_hrtransa  => TO_NUMBER(TO_CHAR(rw_registros_lft.dhretorno_processamento,'sssss')),
                                              pr_dsprotoc  => rw_registros_lft.dsprotoc,
                                              pr_dsautent  => vr_autenticacao,
                                              pr_idsicred  => rw_registros_lft.idsicred,
                                              pr_nrsequen  => 0,
                                              pr_cdtribut  => rw_registros_lft.cdtribut,
                                              pr_nrrefere  => rw_registros_lft.nrrefere,
                                              pr_vllanmto  => rw_registros_lft.vllanmto,
                                              pr_vlrjuros  => rw_registros_lft.vlrjuros,
                                              pr_vlrmulta  => rw_registros_lft.vlrmulta,
                                              pr_vlrtotal  => rw_registros_lft.vlrtotal,
                                              pr_nrcpfcgc  => rw_registros_lft.nrcpfcgc,
                                              pr_dtapurac  => rw_registros_lft.dtapurac,
                                              pr_dtlimite  => rw_registros_lft.dtlimite,
                                              pr_cddpagto  => 0,
                                              pr_cdidenti2 => ' ',
                                              pr_mmaacomp  => 0,
                                              pr_vlrdinss  => 0,
                                              pr_vlrouent  => 0,
                                              pr_flgcaixa  => FALSE,
                                              pr_dscomprv  => vr_dscomprovante);
                                              
      -- Gravar o comprovante
      GENE0006.pc_grava_comprovante_parceiro (pr_cdcooper               => rw_registros_lft.cdcooper,
                                              pr_dsprotoc               => rw_registros_lft.dsprotoc,
                                              pr_dscomprovante_parceiro => vr_dscomprovante,
                                              pr_dscritic               => vr_dscritic);   
        
      GENE0006.pc_grava_arrecadador_parceiro (pr_cdcooper => rw_registros_lft.cdcooper,
                                              pr_nrdconta => rw_registros_lft.nrdconta,
                                              pr_dsprotoc => rw_registros_lft.dsprotoc,
                                              pr_cdagente => 341,
                                              pr_dscritic => vr_dscritic);
     
  END LOOP;
  
  COMMIT;

END;