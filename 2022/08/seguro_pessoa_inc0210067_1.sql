DECLARE
  vr_ind_arq        utl_file.file_type;
  vr_linha          VARCHAR2(32767);
  vr_cdcritic       NUMBER;
  vr_dscritic       VARCHAR2(2000);
  vr_nmdir          VARCHAR2(4000) := CECRED.gene0001.fn_param_sistema('CRED',3,'ROOT_MICROS')||'cpd/bacas/INC0210067';
  vr_nmarq          VARCHAR2(100)  := 'ROLLBACK_INC0210067_1.sql';
  vr_exc_saida      EXCEPTION;
  vcount            NUMBER;

  CURSOR cr_principal(pr_cdcooper CECRED.crapseg.cdcooper%TYPE) IS
    SELECT p.cdcooper,
           p.nrdconta,
           p.nrctrseg,
           p.nrctremp,
           p.tpregist,
           p.nrproposta,
           p.dtinivig,
           p.dtdenvio,
           p.idseqtra,
           s.cdagenci,
           s.cdoperad,
           s.dtmvtolt
      FROM CECRED.crapseg s,
           CECRED.tbseg_prestamista p
     WHERE p.cdcooper = pr_cdcooper
       AND p.cdcooper = s.cdcooper
       AND p.nrdconta = s.nrdconta
       AND p.nrctrseg = s.nrctrseg
       AND p.tpregist = 3
       AND s.cdsitseg = 2
       AND TO_CHAR(p.dtdenvio,'DD/MM/YYYY') = '09/08/2022'
       AND p.nrproposta IN  ('770352412457',
                             '770349849844',
                             '770349849860',
                             '770350064125',
                             '770349075873',
                             '770349722097',
                             '770351841044',
                             '770350228845',
                             '770352613070',
                             '770353103954',
                             '770352627631',
                             '770351673761',
                             '770353104853',
                             '770354292807',
                             '770353432001',
                             '770353430610',
                             '770351623896',
                             '770350468412',
                             '770350638679',
                             '770350638687',
                             '770350638695',
                             '770350638709',
                             '770350644563',
                             '770350449345',
                             '770350076018',
                             '770350076042',
                             '770350076050',
                             '770350076069',
                             '770349989417',
                             '770352390470',
                             '770350614508',
                             '770351457201',
                             '770351457180',
                             '770351457171',
                             '770353997858',
                             '770353967177',
                             '770353958640',
                             '770350903798',
                             '770359794703',
                             '770359794215',
                             '770350347933',
                             '770352539627',
                             '770351913320',
                             '770350409238',
                             '770350409246',
                             '770350409254',
                             '770353859536',
                             '770349943727',
                             '770349943735',
                             '770349943743',
                             '770349941856',
                             '770359949820',
                             '770353074067',
                             '770353431110',
                             '770358285554',
                             '770358285562',
                             '770358285570',
                             '770358285589',
                             '770358560067',
                             '770358560059',
                             '770357383056',
                             '770357866340',
                             '770358917640',
                             '770359985592',
                             '770354133148',
                             '770359639252',
                             '770359985851',
                             '770358419135',
                             '770358460410',
                             '770359327838',
                             '770354337681',
                             '770352317659',
                             '770351800437',
                             '770359313144',
                             '770359313152',
                             '770351438053',
                             '770352526266',
                             '770350507906',
                             '770350507914',
                             '770350507922',
                             '770349792176',
                             '770350139001',
                             '770351823143',
                             '770357186617',
                             '770357186625',
                             '770357186633',
                             '770357166926',
                             '770357186668',
                             '770351750286',
                             '770351750294',
                             '770351750308',
                             '770351750243',
                             '770351323345',
                             '770351282681',
                             '770349966549',
                             '770359330790',
                             '770350537937',
                             '770359116497',
                             '770353075179',
                             '770352311944',
                             '770359294476',
                             '770359377037',
                             '770359294468',
                             '770359088329',
                             '770359088310',
                             '770357915619',
                             '770357915600',
                             '770356130863',
                             '770355306828',
                             '770358076823',
                             '770357221994',
                             '770357222001',
                             '770357222010',
                             '770357222028',
                             '770357222036',
                             '770357221986',
                             '770357081041',
                             '770357536103',
                             '770357200857',
                             '770357200865',
                             '770357200873',
                             '770357200881',
                             '770353826506',
                             '770353804626',
                             '770357962323',
                             '770358405860',
                             '770350337393',
                             '770350338942',
                             '770350338950',
                             '770350338969',
                             '770350074651',
                             '770350074660',
                             '770350074678',
                             '770357260779',
                             '770357260752',
                             '770355052567',
                             '770357875447',
                             '770357875455',
                             '770357875463',
                             '770357875439',
                             '770358237762',
                             '770349021129',
                             '770349021137',
                             '770349021145',
                             '770357244404',
                             '770355640477',
                             '770355314928',
                             '770355314936',
                             '770355314944',
                             '770356328973',
                             '770356328981',
                             '770356328990',
                             '770356328906',
                             '770357535484',
                             '770357387396',
                             '770357387400',
                             '770356857933',
                             '770355837262',
                             '770355197565',
                             '770355197573',
                             '770349790106',
                             '770349790114',
                             '770349790122',
                             '770349790130',
                             '770349790149',
                             '770349067633',
                             '770357139066',
                             '770358607691',
                             '770356902181',
                             '770356902190',
                             '770356011058',
                             '770354313014',
                             '770352158615',
                             '770353110284',
                             '770353110438',
                             '770353110446',
                             '770359780575',
                             '770359988796',
                             '770358401643',
                             '770358368859',
                             '770358368832',
                             '770358368891',
                             '770354541165',
                             '770354541173',
                             '770354541181',
                             '770354541190',
                             '770354541203',
                             '770354541211',
                             '770354541220',
                             '770353750496',
                             '770358628184',
                             '770358628192',
                             '770358627048',
                             '770358094945',
                             '770358208878',
                             '770358208916',
                             '770358208924',
                             '770359116373',
                             '770355718948',
                             '770355718956',
                             '770355677087',
                             '770349094037',
                             '770350092188',
                             '770358289843',
                             '770358210139',
                             '770358210147',
                             '770358210155',
                             '770355036243',
                             '770354688875',
                             '770354688883',
                             '770354688891',
                             '770354688905',
                             '770359857098',
                             '770359857055',
                             '770351335009',
                             '770351229195',
                             '770351229209',
                             '770351229217',
                             '770351229187',
                             '770350604421',
                             '770350604430',
                             '770350412190',
                             '770350412204',
                             '770350080856',
                             '770350096213',
                             '770357379601',
                             '770357379610',
                             '770357899796',
                             '770355413993',
                             '770355414043',
                             '770358343716',
                             '770358343724',
                             '770358343732',
                             '770358343708',
                             '770350338861',
                             '770359292562',
                             '770357485843',
                             '770357485860',
                             '770357485827',
                             '770356906349',
                             '770350241710',
                             '770355149803',
                             '770355149811',
                             '770355149781',
                             '770352807508',
                             '770352746363',
                             '770572919749',
                             '770572919757',
                             '770572919773',
                             '770572919781',
                             '770572919790',
                             '770572919803',
                             '770572919811',
                             '770350394427',
                             '770350394435',
                             '770353877151',
                             '770357148804',
                             '770352083178',
                             '770353899279',
                             '770353897802',
                             '770353896490',
                             '770357926998',
                             '770356303342',
                             '770356303369',
                             '770356303377',
                             '770356303326',
                             '770356857674',
                             '770350287906',
                             '770351272090',
                             '770351154039',
                             '770358932754',
                             '770353639846',
                             '770353619365',
                             '770353618458',
                             '770357866782',
                             '770357866766',
                             '770357194555',
                             '770356656814',
                             '770356656806',
                             '770356656822',
                             '770356656830',
                             '770356656849',
                             '770356656857',
                             '770358834272',
                             '770358834515',
                             '770358834523',
                             '770358834531',
                             '770358834540',
                             '770358834558',
                             '770358834566',
                             '770358834574',
                             '770355360350',
                             '770355360369',
                             '770355359492',
                             '770573322320',
                             '770573322355',
                             '770573322363',
                             '770573322371',
                             '770573322380',
                             '770573322312',
                             '770356894995',
                             '770356895010',
                             '770356894987',
                             '770355527000',
                             '770355196216',
                             '770355196224',
                             '770355196232',
                             '770349025248',
                             '770349025256',
                             '770349025299',
                             '770349025302',
                             '770353108107',
                             '770355575020',
                             '770355218422',
                             '770354688824',
                             '770354688832',
                             '770354688840',
                             '770354688859',
                             '770354688867',
                             '770349028611',
                             '770349028620',
                             '770349028638',
                             '770349028646',
                             '770349028662',
                             '770349028670',
                             '770350460586',
                             '770351764775',
                             '770573021517',
                             '770573021525',
                             '770573021533',
                             '770573021509',
                             '770357518849',
                             '770355254321',
                             '770355254330',
                             '770355254348',
                             '770355254313',
                             '770357356180',
                             '770357356164',
                             '770350478698',
                             '770350482148',
                             '770350476741',
                             '770359096771',
                             '770359096780',
                             '770359096283',
                             '770356271904',
                             '770356271890',
                             '770356448499',
                             '770356448502',
                             '770356931670',
                             '770355706710',
                             '770573730453',
                             '770349097818',
                             '770572919722',
                             '770572919730',
                             '770356388798',
                             '770356388810',
                             '770356388771',
                             '770358991912',
                             '770357458021',
                             '770357458030',
                             '770357458048',
                             '770357458056',
                             '770357458064',
                             '770358826768',
                             '770358826776',
                             '770358826784',
                             '770358826792',
                             '770573541391',
                             '770357670829',
                             '770357746850',
                             '770354596857',
                             '770573541359',
                             '770573541367',
                             '770573541375',
                             '770573541383',
                             '770349672421',
                             '770349672464',
                             '770359338333',
                             '770359338341',
                             '770359869134',
                             '770613653961',
                             '770613653970',
                             '770613653988',
                             '770355275949',
                             '770573037251',
                             '770573037260',
                             '770573037278',
                             '770573037286',
                             '770573037294',
                             '770573037308',
                             '770573037316',
                             '770573037324',
                             '770573646568',
                             '770356998740',
                             '770356998758',
                             '770356998766',
                             '770356998731',
                             '770356998774',
                             '770356998782',
                             '770356892445',
                             '770354863693',
                             '770354863707',
                             '770354863715',
                             '770354863685',
                             '770350895361',
                             '770350832920',
                             '770350833099',
                             '770357822009',
                             '770358887767',
                             '770355032108',
                             '770354276909',
                             '770354276895',
                             '770357799112',
                             '770355325300',
                             '770354440334',
                             '770354440342',
                             '770354440300',
                             '770573422155',
                             '770573422163',
                             '770573422171',
                             '770573421531',
                             '770355016013',
                             '770358736408',
                             '770358736416',
                             '770358736424',
                             '770358736394',
                             '770350048065',
                             '770350935444',
                             '770353118692',
                             '770353118706',
                             '770359059876',
                             '770359059841',
                             '770356683625',
                             '770573322851',
                             '770573273931',
                             '770573273940',
                             '770573273958',
                             '770573273966',
                             '770573273974',
                             '770355782867',
                             '770355782875',
                             '770359225385',
                             '770358282679',
                             '770355227839',
                             '770355227820',
                             '770573583671',
                             '770359834802',
                             '770359834810',
                             '770359020724',
                             '770355938212',
                             '770355438554',
                             '770355516792',
                             '770354804115',
                             '770573732979',
                             '770349104768',
                             '770349104776',
                             '770349104784',
                             '770354998017',
                             '770354998025',
                             '770354997932',
                             '770573725018',
                             '770354997940',
                             '770354997959',
                             '770354997967',
                             '770354997975',
                             '770354997983',
                             '770354997991',
                             '770354998009',
                             '770359731515',
                             '770354421151',
                             '770354421160',
                             '770354421178',
                             '770354419750',
                             '770357523320',
                             '770613141634',
                             '770612891010',
                             '770612891028',
                             '770573614895',
                             '770358019501',
                             '770358271839',
                             '770358271847',
                             '770358271855',
                             '770350584676',
                             '770350584684',
                             '770350584692',
                             '770359291302',
                             '770359291299',
                             '770352792730',
                             '770352792640',
                             '770352792667',
                             '770352793310',
                             '770350427279',
                             '770350427287',
                             '770350427309',
                             '770350417516',
                             '770351331976',
                             '770354900831',
                             '770354900840',
                             '770354958643',
                             '770358554075',
                             '770613687750',
                             '770613687742',
                             '770357200750',
                             '770357200768',
                             '770357200776',
                             '770357200784',
                             '770356401077',
                             '770356401069',
                             '770354676028',
                             '770354676036',
                             '770354676052',
                             '770354676060',
                             '770354676079',
                             '770354675501',
                             '770357179882',
                             '770357179726',
                             '770355227987',
                             '770354977028',
                             '770354977044',
                             '770354977052',
                             '770354977060',
                             '770354977079',
                             '770354977087',
                             '770354977095',
                             '770354977109',
                             '770354977117',
                             '770354977125',
                             '770354977133',
                             '770354977141',
                             '770354977150',
                             '770354977168',
                             '770356189833',
                             '770356189850',
                             '770350387404',
                             '770354426986',
                             '770351717696',
                             '770359304676',
                             '770355443671',
                             '770354796902',
                             '770573645812',
                             '770573019598',
                             '770352404110',
                             '770356509625',
                             '770613587110',
                             '770355103676',
                             '770355103684',
                             '770355103650',
                             '770355103692',
                             '770350462066',
                             '770573801121',
                             '770355312127',
                             '770350102760',
                             '770350102779',
                             '770657292818',
                             '770355213552',
                             '770355264530',
                             '770573595920',
                             '770350395458',
                             '770350395466',
                             '770350395474',
                             '770350395482',
                             '770350465774',
                             '770657292982',
                             '770657292990',
                             '770657293059',
                             '770356564049',
                             '770358929257',
                             '770355922278',
                             '770657346780',
                             '770356485327',
                             '770356485319',
                             '770357251001',
                             '770357627079',
                             '770357627087',
                             '770357413354',
                             '770356296621',
                             '770356296613',
                             '770657293822',
                             '770657293830',
                             '770657293849',
                             '770350323376',
                             '770350323384',
                             '770357968399',
                             '770357393302',
                             '770357006660',
                             '770357006686',
                             '770657294144',
                             '770657294152',
                             '770657294160',
                             '770657294179',
                             '770356038096',
                             '770355479811',
                             '770613488758',
                             '770657294411',
                             '770657294420',
                             '770350190058',
                             '770350190066',
                             '770350190082',
                             '770354697947',
                             '770573542010',
                             '770573542029',
                             '770573542037',
                             '770657294802',
                             '770349066238',
                             '770349052512',
                             '770349058219',
                             '770350596658',
                             '770349937441',
                             '770351790423',
                             '770351793872',
                             '770355651240',
                             '770657295051',
                             '770657295060',
                             '770657295086',
                             '770657295094',
                             '770573321529',
                             '770657295868',
                             '770613449663',
                             '770572961516',
                             '770657345563',
                             '770354132583',
                             '770354130408',
                             '770354130424',
                             '770354130432',
                             '770359552998',
                             '770613110348',
                             '770359353057',
                             '770359353065',
                             '770356499620',
                             '770356499611',
                             '770657389927',
                             '770657390321',
                             '770657390330',
                             '770349886405',
                             '770353570773',
                             '770657390895',
                             '770358593712',
                             '770358593720',
                             '770358685595',
                             '770657390976',
                             '770657390984',
                             '770350328246',
                             '770352323772',
                             '770351673915',
                             '770357161037',
                             '770357161045',
                             '770357161029',
                             '770358285937',
                             '770356672143',
                             '770572935086',
                             '770657391190',
                             '770657391204',
                             '770613191917',
                             '770612892610',
                             '770612892628',
                             '770612892636',
                             '770612892644',
                             '770612892652',
                             '770612892660',
                             '770657469068',
                             '770657469017',
                             '770359908229',
                             '770350586067',
                             '770350215352',
                             '770350241906',
                             '770354144433',
                             '770352775916',
                             '770613002359',
                             '770613002340',
                             '770657789410',
                             '770657391816',
                             '770657391824',
                             '770657391832',
                             '770657391913',
                             '770354299887',
                             '770354299895',
                             '770354299879',
                             '770354299917',
                             '770354299941',
                             '770354299950',
                             '770657392030',
                             '770657636894',
                             '770657456101',
                             '770356134508',
                             '770356227808',
                             '770573275888',
                             '770572898180',
                             '770613244883',
                             '770613244891',
                             '770355334317',
                             '770355334236',
                             '770354721589',
                             '770354721597',
                             '770354721600',
                             '770354721619',
                             '770354721627',
                             '770354721635',
                             '770354721643',
                             '770613653082',
                             '770613653090',
                             '770613653104',
                             '770613653112',
                             '770613653120',
                             '770613653139',
                             '770613653074',
                             '770657456500',
                             '770657891584',
                             '770613491309',
                             '770613491317',
                             '770613491325',
                             '770356359224',
                             '770356359240',
                             '770356359259',
                             '770356359208',
                             '770356359267',
                             '770357223776',
                             '770357200954',
                             '770357200962',
                             '770357200970',
                             '770657813400',
                             '770657891843',
                             '770613061070',
                             '770613061088',
                             '770613061096',
                             '770613388117',
                             '770613283323',
                             '770358909795',
                             '770613599312',
                             '770573408942',
                             '770350028609',
                             '770350028617',
                             '770350028625',
                             '770350028633',
                             '770350028641',
                             '770350028650',
                             '770657892440',
                             '770657892459',
                             '770657892505',
                             '770657892513',
                             '770573811640',
                             '770573811615',
                             '770359979274',
                             '770359979282',
                             '770357515785',
                             '770354806177',
                             '770354806185',
                             '770354806169',
                             '770354563487',
                             '770354563460',
                             '770354969599',
                             '770355036049',
                             '770354969602',
                             '770354969610',
                             '770355424103',
                             '770355424090',
                             '770357204208',
                             '770355219887',
                             '770355219895',
                             '770355219909',
                             '770355219917',
                             '770355219925',
                             '770355219933',
                             '770355219941',
                             '770355219950',
                             '770355219968',
                             '770355219860',
                             '770357366380',
                             '770357366399',
                             '770357366372',
                             '770354916592',
                             '770354916576',
                             '770572941639',
                             '770572941647',
                             '770572941655',
                             '770572941663',
                             '770572941671',
                             '770572941680',
                             '770572941698',
                             '770356034163',
                             '770355438546',
                             '770573519566',
                             '770573519582',
                             '770573519590',
                             '770573519558',
                             '770354963582',
                             '770356810481',
                             '770356810490',
                             '770356810503',
                             '770356810511',
                             '770356204484',
                             '770354767864',
                             '770354807122');

  CURSOR cr_crapcop IS
    SELECT c.cdcooper
          ,d.dtmvtolt
      FROM CECRED.crapcop c,
           CECRED.crapdat d
     WHERE c.flgativo = 1
       AND c.cdcooper <> 3
       AND c.cdcooper = d.cdcooper;
       
  CURSOR cr_prestamista(pr_cdcooper CECRED.tbseg_prestamista.cdcooper%TYPE,
                        pr_nrdconta CECRED.tbseg_prestamista.nrdconta%TYPE,
                        pr_dtmvtolt CECRED.tbseg_prestamista.dtinivig%TYPE)IS
    SELECT p.nrctrseg,
           p.idseqtra
      FROM CECRED.tbseg_prestamista p
     WHERE p.cdcooper = pr_cdcooper
       AND p.nrdconta = pr_nrdconta
       AND p.dtinivig = pr_dtmvtolt
       AND p.tpregist = 1;
       
  CURSOR cr_crawseg(pr_cdcooper CECRED.crawseg.cdcooper%TYPE,
                    pr_nrdconta CECRED.crawseg.nrdconta%TYPE,
                    pr_nrctrseg CECRED.crawseg.nrctrseg%TYPE)IS
    SELECT w.progress_recid
      FROM CECRED.crawseg w
     WHERE w.cdcooper = pr_cdcooper
       AND w.nrdconta = pr_nrdconta
       AND w.nrctrseg = pr_nrctrseg;
  rw_crawseg cr_crawseg%ROWTYPE;
       
  CURSOR cr_crapseg(pr_cdcooper CECRED.crawseg.cdcooper%TYPE,
                    pr_nrdconta CECRED.crawseg.nrdconta%TYPE,
                    pr_nrctrseg CECRED.crawseg.nrctrseg%TYPE)IS
    SELECT s.progress_recid
      FROM CECRED.crapseg s
     WHERE s.cdcooper = pr_cdcooper
       AND s.nrdconta = pr_nrdconta
       AND s.nrctrseg = pr_nrctrseg
       AND s.tpseguro = 4;
   rw_crapseg cr_crapseg%ROWTYPE;

  BEGIN
    BEGIN
      CECRED.GENE0001.pc_abre_arquivo(pr_nmdireto => vr_nmdir
                                     ,pr_nmarquiv => vr_nmarq
                                     ,pr_tipabert => 'W'
                                     ,pr_utlfileh => vr_ind_arq
                                     ,pr_des_erro => vr_dscritic);

      IF vr_dscritic IS NOT NULL THEN
         vr_dscritic := vr_dscritic ||'  Não pode abrir arquivo '|| vr_nmdir || vr_nmarq;
         RAISE vr_exc_saida;
      END IF;

      CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,'BEGIN');

      FOR rw_crapcop IN cr_crapcop LOOP
        vcount := 0;
        vr_linha := '';

        FOR rw_principal IN cr_principal(pr_cdcooper => rw_crapcop.cdcooper) LOOP
          vr_linha :=   'UPDATE CECRED.tbseg_prestamista '
                      ||'   SET tpregist = ''' || rw_principal.tpregist || ''''
                      ||' WHERE idseqtra = ' || rw_principal.idseqtra ||' ; ';
                      
          CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,vr_linha);
          
          UPDATE CECRED.tbseg_prestamista p
             SET p.tpregist = 0
           WHERE p.idseqtra = rw_principal.idseqtra;          
          
          CECRED.segu0003.pc_efetiva_proposta_sp(pr_cdcooper  => rw_crapcop.cdcooper,
                                                 pr_nrdconta  => rw_principal.nrdconta,
                                                 pr_nrctrato  => rw_principal.nrctremp,
                                                 pr_cdagenci  => rw_principal.cdagenci,
                                                 pr_nrdcaixa  => 0,
                                                 pr_cdoperad  => rw_principal.cdoperad,
                                                 pr_nmdatela  => 'SCRIPT',
                                                 pr_idorigem  => 1,
                                                 pr_cdcritic  => vr_cdcritic,
                                                 pr_dscritic  => vr_dscritic);
                                                 
          FOR rw_prestamista IN cr_prestamista(pr_cdcooper => rw_crapcop.cdcooper,
                                                pr_nrdconta => rw_principal.nrdconta,
                                                pr_dtmvtolt => rw_crapcop.dtmvtolt) LOOP
                                                
                vr_linha :=   'DELETE CECRED.tbseg_prestamista '
                            ||' WHERE idseqtra = ' || rw_prestamista.idseqtra ||' ; ';
                     
                CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,vr_linha);
                
                OPEN cr_crawseg(pr_cdcooper => rw_crapcop.cdcooper,
                                pr_nrdconta => rw_principal.nrdconta,
                                pr_nrctrseg => rw_prestamista.nrctrseg);
                FETCH cr_crawseg INTO rw_crawseg;
                  IF cr_crawseg%FOUND THEN
                    vr_linha :=   'DELETE CECRED.crawseg '
                                ||' WHERE progress_recid = ' || rw_crawseg.progress_recid ||' ; ';
                     
                    CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,vr_linha);                     
                  END IF; 
                CLOSE cr_crawseg;
                
                OPEN cr_crapseg(pr_cdcooper => rw_crapcop.cdcooper,
                                pr_nrdconta => rw_principal.nrdconta,
                                pr_nrctrseg => rw_prestamista.nrctrseg);
                FETCH cr_crapseg INTO rw_crapseg;
                  IF cr_crapseg%FOUND THEN
                    vr_linha :=   'DELETE CECRED.crapseg '
                                ||' WHERE progress_recid = ' || rw_crapseg.progress_recid ||' ; ';
                     
                    CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,vr_linha);                     
                  END IF; 
                CLOSE cr_crapseg;
          END LOOP;

          IF vcount = 1000 THEN
            COMMIT;
          ELSE
            vcount := vcount + 1;
          END IF;
        END LOOP;

        COMMIT;
      END LOOP;

      CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,' COMMIT;');
      CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,' END; ');
      CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq,'/ ');
      CECRED.GENE0001.pc_fecha_arquivo(pr_utlfileh => vr_ind_arq );
    EXCEPTION
       WHEN vr_exc_saida THEN
            vr_dscritic := vr_dscritic || SQLERRM || DBMS_UTILITY.FORMAT_ERROR_BACKTRACE;
            dbms_output.put_line(vr_dscritic);
            ROLLBACK;
       WHEN OTHERS THEN
            vr_dscritic := vr_dscritic || SQLERRM || DBMS_UTILITY.FORMAT_ERROR_BACKTRACE;
            dbms_output.put_line(vr_dscritic);
            ROLLBACK;
    END;
END;
/
