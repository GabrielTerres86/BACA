declare
  vr_dados_rollback CLOB;
  vr_texto_rollback VARCHAR2(32600);
  vr_nmarqbkp       VARCHAR2(100);
  vr_nmdireto       VARCHAR2(4000);
  vr_rootmicros    VARCHAR2(5000);
  vr_qtd            INTEGER;
  vr_dscritic       crapcri.dscritic%TYPE;
  vr_exc_erro EXCEPTION;

  CURSOR cr_segprestnaocont IS
  select   c.CDCOOPER
       , c.NRDCONTA
       , c.TPSEGURO
       , c.NRCTRSEG
       , d.dtmvtolt
       , c.dtfimvig
       , p.NRPROPOSTA
       , p.TPCUSTEI
       , c.dtcancel
       , c.cdsitseg
       , c.cdopeexc
       , c.cdageexc
       , c.dtinsexc
       , c.cdopecnl
    from cecred.tbseg_prestamista p
    inner join cecred.crapseg c on (c.NRDCONTA= p.NRDCONTA and c.CDCOOPER = p.CDCOOPER and c.nrctrseg = p.nrctrseg)
    inner join cecred.crapdat d on p.cdcooper   = d.cdcooper
    WHERE p.TPCUSTEI = 1
    and c.cdsitseg !=5
  and   p.nrproposta in(770359924550  ,
770359590261  ,
770657726621  ,
770658240676  ,
770658315145  ,
770359849494  ,
770613076620  ,
770354360349  ,
770657866741  ,
770656310812  ,
770613041524  ,
770349996812  ,
770351444584  ,
770349996804  ,
770658491083  ,
770656542985  ,
770658452339  ,
770573248597  ,
770657981362  ,
770656309679  ,
770655883282  ,
770613673083  ,
770655820566  ,
770656198389  ,
770613302611  ,
770612883530  ,
770351445050  ,
770351445092  ,
770658328816  ,
770658187490  ,
770658173650  ,
770354301016  ,
770573218264  ,
770359058969  ,
770358154964  ,
770658123270  ,
770658033883  ,
770658500660  ,
770655968601  ,
770657948802  ,
770658103598  ,
770658455583  ,
770612881090  ,
770352646792  ,
770352646814  ,
770352646822  ,
770613326413  ,
770656182563  ,
770573022149  ,
770656223782  ,
770573457030  ,
770573554868  ,
770350743456  ,
770350743430  ,
770350743421  ,
770350743448  ,
770353510428  ,
770573241444  ,
770658151860  ,
770658540190  ,
770658052675  ,
770658052683  ,
770658052713  ,
770658103598  ,
770355535045  ,
770658025660  ,
770655968946  ,
770353601768  ,
770353602373  ,
770353602381  ,
770353602390  ,
770354413140  ,
770358108083  ,
770357738393  ,
770658141953  ,
770658287346  ,
770657853569  ,
770658361791  ,
770658472291  ,
770358230563  ,
770573042557  ,
770573754050  ,
770573783719  ,
770657984094  ,
770658485652  ,
770658485687  ,
770613281410  ,
770657267929  ,
770656077441  ,
770356890744  ,
770355015092  ,
770658355163  ,
770354176262  ,
770658123475  ,
770658034693  ,
770351228431  ,
770658575031  ,
770658142046  ,
770656254084  ,
770612909962  ,
770356337611  ,
770658333518  ,
770658054880  ,
770655802673  ,
770658055038  ,
770658150057  ,
770353109189  ,
770613237631  ,
770573256328  ,
770573256433  ,
770358476279  ,
770613126856  ,
770658269291  ,
770655908471  ,
770358381162  ,
770358659098  ,
770613726594  ,
770658170279  ,
770613193855  ,
770657408034  ,
770658020579  ,
770613585958  ,
770613585974  ,
770613585982  ,
770613585990  ,
770613586008  ,
770613586016  ,
770573822501  ,
770573658248  ,
770655893105  ,
770658066471  ,
770655706488  ,
770656405007  ,
770656256591  ,
770658561898  ,
770658290169  ,
770656180781  ,
770657763098  ,
770657763128  ,
770657796662  ,
770658115464  ,
770656542705  ,
770656542748  ,
770613310355  ,
770613702385  ,
770613382607  ,
770613382631  ,
770613382640  ,
770658039997  ,
770658056417  ,
770655768424  ,
770349835800  ,
770349835819  ,
770349835827  ,
770349835797  ,
770658039504  ,
770350322850  ,
770352663271  ,
770658126091  ,
770352717959  ,
770353067877  ,
770572954021  ,
770658479784  ,
770658081950  ,
770351923490  ,
770351923504  ,
770658341510  ,
770613463968  ,
770658398237  ,
770658188488  ,
770613059083  ,
770352348422  ,
770655940847  ,
770353707841  ,
770354399733  ,
770353734121  ,
770613721282  ,
770656044772  ,
770613311521  ,
770655782427  ,
770658506340  ,
770657815365  ,
770657737330  ,
770658222635  ,
770658247360  ,
770658328166  ,
770656403446  ,
770656403454  ,
770656403462  ,
770658619497  ,
770658622285  ,
770350478094  ,
770656444444  ,
770658273698  ,
770658108778  ,
770658481924  ,
770658604902  ,
770656300264  ,
770657393436  ,
770657416452  ,
770658335618  ,
770657763268  ,
770658012282  ,
770353733737  ,
770658381024  ,
770612902283  ,
770657458163  ,
770349057069  ,
770349057077  ,
770353751956  ,
770353752030  ,
770658033972  ,
770352328081  ,
770352328090  ,
770612975795  ,
770613198652  ,
770613198660  ,
770613198679  ,
770573089715  ,
770573089790  ,
770658524062  ,
770655967990  ,
770613204032  ,
770350258760  ,
770350268812  ,
770350266437  ,
770353429930  ,
770353509500  ,
770353345125  ,
770657324434  ,
770658048511  ,
770658335049  ,
770354329310  ,
770354329328  ,
770354329336  ,
770354329344  ,
770354329352  ,
770354329360  ,
770658267574  ,
770658140833  ,
770658141058  ,
770657962732  ,
770658117076  ,
770658126369  ,
770657984515  ,
770656564601  ,
770658018400  ,
770658608495  ,
770658632922  ,
770656528680  ,
770658575910  ,
770658632051  ,
770658632132  ,
770658352881  ,
770657932027  ,
770657932035  ,
770657932043  ,
770657932051  ,
770657932060  ,
770657648353  ,
770658409123  ,
770657736023  ,
770657949442  ,
770349966069  ,
770349966077  ,
770353838709  ,
770656072695  ,
770351996749  ,
770658159712  ,
770351550376  ,
770573538170  ,
770613719555  ,
770658527452  ,
770657983403  ,
770658337459  ,
770658472763  ,
770658472771  ,
770658472780  ,
770655818278  ,
770655989170  ,
770655989188  ,
770350521879  ,
770350521844  ,
770350521852  ,
770358283500  ,
770358283519  ,
770358283535  ,
770358283543  ,
770358283551  ,
770658191632  ,
770658507850  ,
770658117378  ,
770658125273  ,
770354030969  ,
770658562355  ,
770658562371  ,
770658562398  ,
770658562401  ,
770658562410  ,
770658562428  ,
770613702288  ,
770657725676  ,
770655821872  ,
770655821880  ,
770657546887  ,
770656198869  ,
770352721417  ,
770613185917  ,
770658208640  ,
770658208829  ,
770658208853  ,
770350332790  ,
770350332766  ,
770573472985  ,
770573666585  ,
770573538064  ,
770573429524  ,
770573415892  ,
770359516533  ,
770359516568  ,
770359516576  ,
770572867285  ,
770658625101  ,
770358799485  ,
770358799531  ,
770658314165  ,
770658367862  ,
770658367870  ,
770658367889  ,
770658367900  ,
770658367919  ,
770658367935  ,
770658371959  ,
770658037781  ,
770658037838  ,
770658038818  ,
770353718363  ,
770658267914  ,
770658014510  ,
770658014528  ,
770658014536  ,
770358177948  ,
770657754579  ,
770657754749  ,
770655801189  ,
770657754358  ,
770657758167  ,
770656044594  ,
770657444901  ,
770351226803  ,
770573712579  ,
770359537930  ,
770573013409  ,
770658142267  ,
770658112520  ,
770350905472  ,
770350921990  ,
770350256768  ,
770350256733  ,
770573484266  ,
770612776610  ,
770612776628  ,
770612776601  ,
770612776636  ,
770573692799  ,
770572925218  ,
770359907176  ,
770359907222  ,
770656272996  ,
770658338862  ,
770658338889  ,
770658338897  ,
770658338900  ,
770658338935  ,
770658054090  ,
770658111680  ,
770658111698  ,
770658547429  ,
770655696270  ,
770613384502  ,
770657761621  ,
770657761648  ,
770657761664  ,
770657761672  ,
770657761680  ,
770657761699  ,
770657761702  ,
770657761710  ,
770657761753  ,
770658135970  ,
770658625420  ,
770351327863  ,
770352463515  ,
770351327901  ,
770658526251  ,
770658527851  ,
770658027441  ,
770658630849  ,
770657864420  ,
770657288942  ,
770658452649  ,
770657992895  ,
770658006940  ,
770658502174  ,
770658502670  ,
770658611640  ,
770658437755  ,
770658126067  ,
770658137425  ,
770658221205  ,
770658626175  ,
770353927779  ,
770655982787  ,
770656176709  ,
770658575082  ,
770658588370  ,
770658588389  ,
770658117106  ,
770658140680  ,
770658141112  ,
770658124714  ,
770658126946  ,
770657767018  ,
770613182560  ,
770613182578  ,
770613182586  ,
770613182594  ,
770353980637  ,
770354132532  ,
770658116347  ,
770657756504  ,
770658596101  ,
770658596292  ,
770658384619  ,
770658636227  ,
770572939405  ,
770658020633  ,
770658021125  ,
770658021133  ,
770658021141  ,
770658021150  ,
770657262838  ,
770658131745  ,
770655856064  ,
770658123823  ,
770658373005  ,
770658038648  ,
770658038877  ,
770658039393  ,
770658176684  ,
770658472372  ,
770655954902  ,
770359481632  ,
770573438116  ,
770658396870  ,
770658054643  ,
770658111442  ,
770658645757  ,
770658015168  ,
770658383280  ,
770658383396  ,
770350367276  ,
770350367268  ,
770612814333  ,
770612814392  ,
770657950025  ,
770657985236  ,
770658160125  ,
770658226231  ,
770658277391  ,
770658573004  ,
770658573756  ,
770656180790  ,
770354898179  ,
770354898098  ,
770354898101  ,
770354898128  ,
770354898136  ,
770354898144  ,
770354898160  ,
770358616054  ,
770358616216  ,
770658141937  ,
770658138219  ,
770612844348  ,
770658403630  ,
770658337017  ,
770655967958  ,
770573022165  ,
770658064223  ,
770658302442  ,
770613023429  ,
770613023534  ,
770656199334  ,
770655798706  ,
770658286838  ,
770658286846  ,
770613289224  ,
770657616117  ,
770657871150  ,
770658627325  ,
770353667769  ,
770658138251  ,
770658183451  ,
770658572466  ,
770658549022  ,
770658488180  ,
770657951137  ,
770657983110  ,
770613454268  ,
770658590197  ,
770658336916  ,
770658238833  ,
770658238841  ,
770658238850  ,
770658238868  ,
770658238876  ,
770658238884  ,
770612867925  ,
770658275704  ,
770351169982  ,
770351170026  ,
770351170085  ,
770353877860  ,
770353727540  ,
770573380924  ,
770573830563  ,
770613112243  ,
770351397543  ,
770656256532  ,
770359767315  ,
770356367766  ,
770356186281  ,
770658138456  ,
770657436399  ,
770658123440  ,
770351818344  ,
770658469118  ,
770351866560  ,
770351866578  ,
770351866586  ,
770656043873  ,
770359290454  ,
770358084508  ,
770657352934  ,
770658122657  ,
770658122690  ,
770573372328  ,
770658161636  ,
770658609394  ,
770655754318  ,
770656095725  ,
770359921853  ,
770359921870  ,
770658401084  ,
770658401106  ,
770658175580  ,
770353344293  ,
770353870742  ,
770353870750  ,
770658324063  ,
770657888613  ,
770658505815  ,
770656035617  ,
770658139819  ,
770657983322  ,
770353343882  ,
770573594967  ,
770658116240  ,
770658034561  ,
770353805495  ,
770353859773  ,
770353859781  ,
770353859790  ,
770353859803  ,
770353859811  ,
770573747453  ,
770354577852  ,
770354578255  ,
770354578263  ,
770354578271  ,
770354578280  ,
770354578301  ,
770354578310  ,
770354578328  ,
770354578336  ,
770354578379  ,
770354578387  ,
770354578409  ,
770354578417  ,
770354578425  ,
770573027760  ,
770572956121  ,
770657485519  ,
770658065203  ,
770657950734  ,
770657972517  ,
770655968474  ,
770353709739  ,
770353931768  ,
770353977636  ,
770359658516  ,
770359680988  ,
770359993005  ,
770359120982  ,
770613241809  ,
770613019529  ,
770613019537  ,
770613019545  ,
770613019553  ,
770613019561  ,
770658156128  ,
770658300431  ,
770658300997  ,
770359424418  ,
770356409264  ,
770573519035  ,
770351824000  ,
770658626671  ,
770657797154  ,
770355738442  ,
770355738450  ,
770350180311  ,
770350347534  ,
770350180320  ,
770573705688  ,
770612976155  ,
770658243152  ,
770573829204  ,
770350238816  ,
770352181064  ,
770658381008  ,
770572942317  ,
770573151313  ,
770573151321  ,
770573151330  ,
770573151348  ,
770658202731  ,
770658557386  ,
770657759031  ,
770656541814  ,
770353342746  ,
770657301841  ,
770354402289  ,
770359657994  ,
770359317042  ,
770613117970  ,
770657278823  ,
770658048708  ,
770658376896  ,
770573323386  ,
770573323394  ,
770658517945  ,
770612986380  ,
770612986436  ,
770612986444  ,
770612986452  ,
770658584189  ,
770658034464  ,
770657294110  ,
770657294128  ,
770658504088  ,
770658556738  ,
770658375636  ,
770658192949  ,
770658454897  ,
770658554280  ,
770658542206  ,
770656219564  ,
770359545410  ,
770572993051  ,
770613099824  ,
770613102620  ,
770613102639  ,
770658143603  ,
770354391350  ,
770354403510  ,
770657743046  ,
770657743062  ,
770657642860  ,
770573319656  ,
770613109960  ,
770613565795  ,
770657932191  ,
770354303396  ,
770573022416  ,
770573606736  ,
770657961132  ,
770352586595  ,
770354066823  ,
770351291575  ,
770658125206  ,
770658409298  ,
770354093383  ,
770354093405  ,
770613357831  ,
770658027417  ,
770656206101  ,
770657982830  ,
770658036297  ,
770573172299  ,
770658449397  ,
770658444905  ,
770658527045  ,
770658117173  ,
770657985295  ,
770658035509  ,
770352725200  ,
770657883921  ,
770658525654  ,
770658486934  ,
770658117386  ,
770657984604  ,
770658621777  ,
770658624830  ,
770350182330  ,
770658507125  ,
770658126938  ,
770657983950  ,
770658035290  ,
770658080393  ,
770657765848  ,
770350349740  ,
770350349723  ,
770353529838  ,
770658123556  ,
770657983713  ,
770658034529  ,
770350230041  ,
770656256605  ,
770655875484  ,
770658337890  ,
770354267780  ,
770354267829  ,
770359075073  ,
770657468002  ,
770658034537  ,
770658224948  ,
770658634739  ,
770350171924  ,
770350750614  ,
770350170960  ,
770353072846  ,
770359851766  ,
770656256575  ,
770658381636  ,
770658219618  ,
770657649325  ,
770658414810  ,
770658414828  ,
770658414836  ,
770351394951  ,
770657763179  ,
770655968121  ,
770658360612  ,
770655676007  ,
770656175265  ,
770656150092  ,
770656150106  ,
770573436660  ,
770573436679  ,
770573436687  ,
770613410147  ,
770658621190  ,
770351095245  ,
770658435280  ,
770350644717  ,
770350251618  ,
770350644725  ,
770657598615  ,
770658288474  ,
770658131478  ,
770354319144  ,
770658141368  ,
770658149300  ,
770350565973  ,
770350457690  ,
770350864105  ,
770657970301  ,
770658597698  ,
770613574450  ,
770612879621  ,
770613703209  ,
770655702105  ,
770655702156  ,
770658063839  ,
770573476034  ,
770573599080  ,
770351420219  ,
770351420227  ,
770351420235  ,
770351475935  ,
770656256524  ,
770572986756  ,
770573363868  ,
770658396412  ,
770351469595  ,
770353107062  ,
770353973444  ,
770354152169  ,
770657950505  ,
770657762350  ,
770658560492  ,
770658323989  ,
770658277936  ,
770658553429  ,
770658553810  ,
770658554239  ,
770658555278  ,
770658645170  ,
770658645986  ,
770613307605  ,
770351081902  ,
770657535273  ,
770657535907  ,
770657535915  ,
770657535958  ,
770657535966  ,
770658407872  ,
770658107020  ,
770655895957  ,
770658625322  ,
770658636839  ,
770658636847  ,
770658636855  ,
770658636863  ,
770658517619  ,
770658639803  ,
770658639862  ,
770658639757  ,
770658640089  ,
770351470461  ,
770350343091  ,
770350178554  ,
770656181389  ,
770657983560  ,
770658413783  ,
770656198591  ,
770658636073  ,
770655991166  ,
770658157370  ,
770655861939  ,
770655696130  ,
770655696156  ,
770655696164  ,
770657948438  ,
770658037404  ,
770658038486  ,
770658038982  ,
770658177125  ,
770657963895  ,
770613146962  ,
770658189603  ,
770612798613  ,
770657884707  ,
770353591142  ,
770658507737  ,
770658545337  ,
770658115162  ,
770658115170  ,
770613314687  ,
770613307907  ,
770658403273  ,
770354709511  ,
770613130365  ,
770657887056  ,
770657462926  ,
770573426592  ,
770572858391  ,
770573813251  ,
770658229818  ,
770656258284  ,
770657789240  ,
770657789267  ,
770657789275  ,
770658600575  ,
770351592311  ,
770353366742  ,
770573625471  ,
770573098544  ,
770657301558  ,
770359989822  ,
770658505211  ,
770658141104  ,
770658126342  ,
770658034499  ,
770572862194  ,
770658220861  ,
770658129635  ,
770657628077  ,
770657628450  ,
770657628468  ,
770657628476  ,
770657869236  ,
770657932159  ,
770658125176  ,
770657983985  ,
770353978349  ,
770613312064  ,
770573311426  ,
770658059351  ,
770658083139  ,
770658620606  ,
770658620614  ,
770658401327  ,
770658554247  ,
770658645072  ,
770658039806  ,
770658116606  ,
770658035053  ,
770658598279  ,
770658407244  ,
770658361317  ,
770658361341  ,
770658362674  ,
770350548343  ,
770350541276  ,
770350541250  ,
770657317357  ,
770657984418  ,
770658488554  ,
770658488627  ,
770658585649  ,
770658586220  ,
770658505521  ,
770658116797  ,
770658116886  ,
770658139096  ,
770658139452  ,
770658139525  ,
770658140086  ,
770658140752  ,
770658125010  ,
770658126237  ,
770658137999  ,
770658034448  ,
770658035452  ,
770658221280  ,
770358655572  ,
770358249361  ,
770358249396  ,
770658338250  ,
770658288938  ,
770656407425  ,
770658021494  ,
770658035495  ,
770657869708  ,
770657869716  ,
770657869724  ,
770657869783  ,
770658450891  ,
770658504347  ,
770349029839  ,
770349029820  ,
770658506188  ,
770658139746  ,
770658123548  ,
770658125141  ,
770658036122  ,
770658011863  ,
770658011871  ,
770658378678  ,
770658140299  ,
770613729631  ,
770658545485  ,
770573836944  ,
770573557263  ,
770658450255  ,
770658173120  ,
770351065206  ,
770658208772  ,
770658232185  ,
770656269260  ,
770656447044  ,
770657983241  ,
770351291400  ,
770351323680  ,
770658123319  ,
770658590626  ,
770657803464  ,
770658595555  ,
770658472518  ,
770613237330  ,
770573727622  ,
770613626794  ,
770658444506  ,
770658125036  ,
770658035622  ,
770572955206  ,
770657757950  ,
770658496689  ,
770658035894  ,
770658420534  ,
770655882677  ,
770658125281  ,
770657983373  ,
770658507869  ,
770658508040  ,
770658141457  ,
770658138120  )
union
select   c.CDCOOPER
       , c.NRDCONTA
       , c.TPSEGURO
       , c.NRCTRSEG
       , d.dtmvtolt
       , c.dtfimvig
       , p.NRPROPOSTA
       , p.TPCUSTEI
       , c.dtcancel
       , c.cdsitseg
       , c.cdopeexc
       , c.cdageexc
       , c.dtinsexc
       , c.cdopecnl
    from cecred.tbseg_prestamista p
    inner join cecred.crapseg c on (c.NRDCONTA= p.NRDCONTA and c.CDCOOPER = p.CDCOOPER and c.nrctrseg = p.nrctrseg)
    inner join cecred.crapdat d on p.cdcooper   = d.cdcooper
    WHERE p.TPCUSTEI = 1
    and c.cdsitseg !=5
  and   p.nrproposta in(
770613063269  ,
770613063293  ,
770613063307  ,
770658340360  ,
770655958630  ,
770658115758  ,
770658086871  ,
770658109936  ,
770658572920  ,
770658572954  ,
770658572962  ,
770658413953  ,
770656205210  ,
770658505491  ,
770658507605  ,
770658403010  ,
770658019260  ,
770658645404  ,
770656563877  ,
770658509381  ,
770656397799  ,
770658361520  ,
770658479520  ,
770658082957  ,
770658340603  ,
770359507682  ,
770658117050  ,
770658645056  ,
770613391975  ,
770658075845  ,
770658468634  ,
770657519219  ,
770613534601  ,
770658585509  ,
770657951005  ,
770613743782  ,
770613321535  ,
770354642581  ,
770656441739  ,
770656450053  ,
770656450061  ,
770656450070  ,
770656450088  ,
770359057610  ,
770358415482  ,
770658254430  ,
770658457578  ,
770658457616  ,
770658153722  ,
770657736899  ,
770657736910  ,
770658581791  ,
770350613862  ,
770349020289  ,
770350613854  ,
770350556141  ,
770573227514  ,
770573022190  ,
770573274083  ,
770658308661  ,
770359540213  ,
770359540477  ,
770612962065  ,
770655763384  ,
770656260610  ,
770657982520  ,
770657983896  ,
770657985163  ,
770655762345  ,
770357851335  ,
770658018213  ,
770353360760  ,
770656336501  ,
770613380981  ,
770612902127  ,
770657267309  ,
770657636312  ,
770354306840  ,
770656403918  ,
770656403926  ,
770612872880  ,
770351831545  ,
770658388258  ,
770658217542  ,
770613004254  ,
770355681297  ,
770658347969  ,
770349585170  ,
770349585170  ,
770656147431  ,
770349574624  ,
770349524252  ,
770349524252  ,
770349544342  ,
770349544342  ,
770349598175  ,
770349598175  ,
770655884858  ,
770656136774  ,
770349410915  ,
770655884700  ,
770349375001  ,
770349375001  ,
770349307855  ,
770349307855  ,
770655884645  ,
770655884670  ,
770656313730  ,
770655884688  ,
770655884653  ,
770658473123  ,
770359154976  ,
770612951209  ,
770613393021  ,
770657758345  ,
770657622427  ,
770657622443  ,
770657622451  ,
770657555606  ,
770658432869  ,
770656261846  ,
770656261854  ,
770656261862  ,
770658101439  ,
770658102397  ,
770658502131  ,
770658502140  ,
770658515276  ,
770655698710  ,
770656130750  ,
770572868907  ,
770658121456  ,
770349071738  ,
770612954186  ,
770658013831  ,
770658380907  ,
770655899588  ,
770658006959  ,
770353772341  ,
770658241796  ,
770656399066  ,
770657948098  ,
770658432907  ,
770658432990  ,
770353154737  ,
770353154745  ,
770353322915  ,
770657614475  ,
770657354732  ,
770657354759  ,
770354523710  ,
770354523868  ,
770658492411  ,
770354273233  ,
770573646150  ,
770573646177  ,
770613739246  ,
770657995380  ,
770658249266  ,
770658353349  ,
770658082558  ,
770656046520  ,
770656174625  ,
770656182865  ,
770657421316  ,
770573544412  ,
770658160761  ,
770657765821  ,
770658335790  ,
770658547917  ,
770613667318  ,
770656267640  ,
770573066537  ,
770658631276  ,
770658631330  ,
770658631349  ,
770658631357  ,
770658004026  ,
770658378279  ,
770658333453  ,
770655875212  ,
770656265736  ,
770656265744  ,
770613361049  ,
770658503375  ,
770658008188  ,
770658624652  ,
770658040090  ,
770657591416  ,
770359209584  ,
770355793915  ,
770356174690  ,
770356174704  ,
770356174712  ,
770355056139  ,
770355056147  ,
770355056155  ,
770355056163  ,
770355056171  ,
770658562690  ,
770656541946  ,
770656267224  ,
770573482603  ,
770356471300  ,
770356471318  ,
770356471326  ,
770356471334  ,
770657343986  ,
770657947148  ,
770657981630  ,
770655707506  ,
770656137932  ,
770658215191  ,
770658216074  ,
770658216350  ,
770658216104  ,
770356985176  ,
770356985222  ,
770657801364  ,
770657801402  ,
770658339311  ,
770658214950  ,
770573612469  ,
770657263826  ,
770658338269  ,
770658338331  ,
770658338340  ,
770658530780  ,
770658530801  ,
770573760794  ,
770657324396  ,
770657800678  ,
770352814644  ,
770359763247  ,
770657713945  ,
770657986356  );

  PROCEDURE pc_valida_direto(pr_nmdireto IN VARCHAR2,
                             pr_dscritic OUT crapcri.dscritic%TYPE) IS
  BEGIN
    DECLARE
      vr_dscritic  crapcri.dscritic%TYPE;
      vr_typ_saida VARCHAR2(3);
      vr_des_saida VARCHAR2(1000);
    BEGIN
      IF NOT cecred.gene0001.fn_exis_diretorio(pr_nmdireto) THEN
        cecred.gene0001.pc_OSCommand_Shell(pr_des_comando => 'mkdir ' ||
                                                      pr_nmdireto ||
                                                      ' 1> /dev/null',
                                    pr_typ_saida   => vr_typ_saida,
                                    pr_des_saida   => vr_des_saida);
        IF vr_typ_saida = 'ERR' THEN
          vr_dscritic := 'CRIAR DIRETORIO ARQUIVO --> Nao foi possivel criar o diretorio para gerar os arquivos. ' ||
                         vr_des_saida;
          RAISE vr_exc_erro;
        END IF;
        cecred.gene0001.pc_OSCommand_Shell(pr_des_comando => 'chmod 777 ' ||
                                                      pr_nmdireto ||
                                                      ' 1> /dev/null',
                                    pr_typ_saida   => vr_typ_saida,
                                    pr_des_saida   => vr_des_saida);
        IF vr_typ_saida = 'ERR' THEN
          vr_dscritic := 'PERMISSAO NO DIRETORIO --> Nao foi possivel adicionar permissao no diretorio dos arquivos. ' ||
                         vr_des_saida;
          RAISE vr_exc_erro;
        END IF;
      END IF;
    EXCEPTION
      WHEN vr_exc_erro THEN
        pr_dscritic := vr_dscritic;
    END;
  END;

BEGIN
  vr_rootmicros     := cecred.gene0001.fn_param_sistema('CRED',3,'ROOT_MICROS');
  vr_nmdireto       := vr_rootmicros|| 'cpd/bacas';
  pc_valida_direto(pr_nmdireto => vr_nmdireto || '/INC0231613',
                   pr_dscritic => vr_dscritic);

  IF TRIM(vr_dscritic) IS NOT NULL THEN
    RAISE vr_exc_erro;
  END IF;

  vr_nmdireto := vr_nmdireto || '/INC0231613';

  vr_dados_rollback := NULL;
  dbms_lob.createtemporary(vr_dados_rollback, TRUE, dbms_lob.CALL);
  dbms_lob.open(vr_dados_rollback, dbms_lob.lob_readwrite);

  cecred.gene0002.pc_escreve_xml(vr_dados_rollback,
                          vr_texto_rollback,
                          '-- Programa para rollback das informacoes' ||
                          chr(13),
                          FALSE);
  cecred.gene0002.pc_escreve_xml(vr_dados_rollback,
                          vr_texto_rollback,
                          'BEGIN' || chr(13),
                          FALSE);

  vr_nmarqbkp := 'ROLLBACK_INC0231613_NC' || to_char(sysdate, 'hh24miss') ||
                 '.sql';
    for rw_segprestnaocont in cr_segprestnaocont loop
          UPDATE cecred.crapseg p
             SET p.dtfimvig = rw_segprestnaocont.dtfimvig,
                 p.dtcancel = rw_segprestnaocont.dtmvtolt,
                 p.cdsitseg = 5,
                 p.cdopeexc = 1,
                 p.cdageexc = 1,
                 p.dtinsexc = rw_segprestnaocont.dtmvtolt,
                 p.cdopecnl = 1
           WHERE p.cdcooper = rw_segprestnaocont.cdcooper
             AND p.nrdconta = rw_segprestnaocont.nrdconta
             AND p.nrctrseg = rw_segprestnaocont.nrctrseg
             AND p.tpseguro = rw_segprestnaocont.tpseguro;
      cecred.gene0002.pc_escreve_xml(vr_dados_rollback,
                              vr_texto_rollback,
                              'UPDATE crapseg    ' || chr(13) ||
                              '   SET dtfimvig            = ' || '''' ||rw_segprestnaocont.dtfimvig  || '''' ||
                              chr(13) || ',   dtcancel    = ' || '''' ||rw_segprestnaocont.dtcancel || '''' ||
                              chr(13) || ',   cdsitseg    = ' || '''' ||rw_segprestnaocont.cdsitseg || '''' ||
                              chr(13) || ',   cdopeexc    = ' || '''' ||rw_segprestnaocont.cdopeexc || '''' ||
                              chr(13) || ',   cdageexc    = ' || '''' ||rw_segprestnaocont.cdageexc || '''' ||
                              chr(13) || ',   dtinsexc    = ' || '''' ||rw_segprestnaocont.dtinsexc || '''' ||
                              chr(13) || ',   cdopecnl    = ' || '''' ||rw_segprestnaocont.cdopecnl || '''' ||

                              chr(13) ||' WHERE CDCOOPER =  ' || rw_segprestnaocont.cdcooper ||
                              chr(13) || '   AND nrdconta = ' ||rw_segprestnaocont.nrdconta ||
                              chr(13) || '   AND nrctrseg = ' || rw_segprestnaocont.nrctrseg ||
                              chr(13) || '   AND tpseguro = ' ||rw_segprestnaocont.tpseguro || ';' ||
                              chr(13),
                              FALSE);

    end loop;
  cecred.gene0002.pc_escreve_xml(vr_dados_rollback,
                          vr_texto_rollback,
                          'COMMIT;' || chr(13),
                          FALSE);
  cecred.gene0002.pc_escreve_xml(vr_dados_rollback,
                          vr_texto_rollback,
                          'END;' || chr(13),
                          FALSE);

  cecred.gene0002.pc_escreve_xml(vr_dados_rollback,
                          vr_texto_rollback,
                          chr(13),
                          TRUE);

  cecred.GENE0002.pc_solicita_relato_arquivo(pr_cdcooper  => 3
                                     ,
                                      pr_cdprogra  => 'ATENDA'
                                     ,
                                      pr_dtmvtolt  => trunc(SYSDATE)
                                     ,
                                      pr_dsxml     => vr_dados_rollback
                                     ,
                                      pr_dsarqsaid => vr_nmdireto || '/' ||
                                                      vr_nmarqbkp
                                     ,
                                      pr_flg_impri => 'N'
                                     ,
                                      pr_flg_gerar => 'S'
                                     ,
                                      pr_flgremarq => 'N'
                                     ,
                                      pr_nrcopias  => 1
                                     ,
                                      pr_des_erro  => vr_dscritic);


  dbms_lob.close(vr_dados_rollback);
  dbms_lob.freetemporary(vr_dados_rollback);
  COMMIT;
END;
/
