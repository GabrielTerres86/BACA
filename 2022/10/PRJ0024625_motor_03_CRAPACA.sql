DECLARE
  VR_ERRO EXCEPTION;
  VR_CDCRITIC NUMBER;
  VR_DSCRITIC VARCHAR2(1000);
  CURSOR CR_PARAM IS
      SELECT COUNT(1) AS VALUE FROM CRAPACA WHERE NMDEACAO = 'PAREST_ALTERA_PARAM' AND UPPER(LSTPARAM) LIKE UPPER('%pr_neurotechpf,pr_neurotechpj,pr_motorfornecedor%');
  RW_PARAM CR_PARAM%ROWTYPE;
BEGIN
  DBMS_OUTPUT.PUT_LINE('SCRIPT INICIADO EM ' || TO_CHAR(SYSDATE, 'DD/MM/YYYY HH24:MI:SS'));

  OPEN CR_PARAM;
  FETCH CR_PARAM INTO RW_PARAM;
  CLOSE CR_PARAM;

  -- ALTERAÇÃO DA MENSAGERIA
  IF (RW_PARAM.VALUE = 0) THEN
    BEGIN
      UPDATE CRAPACA SET LSTPARAM = LSTPARAM||',pr_neurotechpf,pr_neurotechpj,pr_motorfornecedor' WHERE NMDEACAO = 'PAREST_ALTERA_PARAM';
      COMMIT;
    EXCEPTION
      WHEN OTHERS THEN
        VR_CDCRITIC := 0;
        VR_DSCRITIC := 'ERRO AO ATUALIZAR A O CAMPO LSTPARAM DA TABELA "CRAPACA" ONDE NMDACAO = "PAREST_ALTERA_PARAM"'||CHR(13)||SQLERRM;
        RAISE VR_ERRO;
    END;
  END IF;


  -- INCLUSÃO DE NOVA MENSAGERIA
  BEGIN
    INSERT INTO crapaca ( NMDEACAO, NMPACKAG, NMPROCED, LSTPARAM, NRSEQRDR)
                 VALUES ('PAREST_CONS_PARAM_NEUROTECH', 'TELA_PAREST', 'pc_consulta_parametros_neurotech_web', 'pr_tlcooper', 362);
    COMMIT;
  EXCEPTION
    WHEN OTHERS THEN
      VR_CDCRITIC := 0;
      VR_DSCRITIC := 'ERRO AO INCLUIR O CAMPO LSTPARAM DA TABELA "CRAPACA" ONDE NMDACAO = "PAREST_CONS_PARAM_NEUROTECH"'||CHR(13)||SQLERRM;
      RAISE VR_ERRO;
  END;


  DBMS_OUTPUT.PUT_LINE('SCRIPT  FINALIZADO COM SUCESSO EM ' || TO_CHAR(SYSDATE, 'DD/MM/YYYY HH24:MI:SS'));
EXCEPTION
  WHEN VR_ERRO THEN
    DBMS_OUTPUT.PUT_LINE('ERRO NA EXECUCAO DO SCRIPT . EXCECAO: ' || TO_CHAR(VR_CDCRITIC) || VR_DSCRITIC);
    ROLLBACK;
    RAISE_APPLICATION_ERROR(-20001, 'ERRO NA EXECUCAO DO SCRIPT . EXCECAO: ' || TO_CHAR(VR_CDCRITIC) || VR_DSCRITIC);
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('ERRO NAO TRATADO NA EXECUCAO DO SCRIPT  EXCECAO: ' || SUBSTR(SQLERRM, 1, 255));
    ROLLBACK;
    RAISE_APPLICATION_ERROR(-20002, 'ERRO NAO TRATADO NA EXECUCAO DO SCRIPT. EXCECAO: ' || SUBSTR(SQLERRM, 1, 255));
END;