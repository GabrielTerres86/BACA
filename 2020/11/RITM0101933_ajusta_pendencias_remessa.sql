DECLARE
 
  vr_exc_erro EXCEPTION;

  CURSOR cr_pagto IS
    SELECT r.rowid
          ,DECODE(p.dtmovimento,TO_DATE('21/10/2020','DD/MM/RRRR'),TO_DATE('21/10/2020 19:00:00','DD/MM/RRRR HH24:MI:SS'),TO_DATE('23/10/2020 18:30:00','DD/MM/RRRR HH24:MI:SS')) dtretorno
          ,DECODE(p.dtmovimento,TO_DATE('21/10/2020','DD/MM/RRRR'),'1QTH21101900.ret','1QTH23101837.ret') nmarquivo
      FROM tbconv_registro_remessa_pagfor r
          ,tbconv_remessa_pagfor p 
    WHERE r.idremessa = p.idremessa 
      AND p.cdagente_arrecadacao = 3
      AND r.idsicredi in (2245825,2245826,2245827,2245853,2245882,2245883,2246751,2246788,2246816,2246817,2246818,2249090,2249091,2249092,2249203,2249204,2249205,2249206,2249242,2249243,2249244,2249245,2249246,2249247,2249248,2249249,2249250,2249280,2249281,2249282,2249283,2249284,2249785,2249786,2249787,2245133,2245307,2245308,2245309,2245310,2245311,2245312,2245313,2245314,2245315,2245317,2245494,2245495,2245514,2245537,2245538,2245539,2245620,2245621,2245653,2245654,2245655,2245675,2245676,2245707,2245708,2245709,2245710,2245736,2245771,2245772,2245906,2245907,2245908,2245937,2245938,2245963,2245964,2245965,2245966,2245998,2245999,2246037,2246038,2246039,2246040,2246041,2246063,2246064,2246105,2246106,2246107,2246108,2246109,2246157,2246158,2246159,2246192,2246193,2246194,2246195,2246232,2246233,2246234,2246235,2246267,2246268,2246269,2246301,2246302,2246303,2246304,2246305,2246306,2246346,2246378,2246379,2246380,2246428,2246508,2246509,2246510,2246511,2246512,2246513,2246514,2246515,2246516,2246517,2246563,2246564,2246566,2246567,2246568,2246569,2246570,2246606,2246641,2246642,2246643,2246682,2246683,2246684,2246685,2246686,2246687,2246717,2246718,2246719,2246720,2246878,2246879,2246906,2246907,2246908,2246909,2246939,2246940,2246941,2246942,2246943,2246994,2246995,2246996,2246997,2247034,2247079,2247137,2247165,2247213,2247238,2247271,2247306,2247351,2247396,2247428,2247454,2247455,2247457,2247506,2247507,2247562,2247563,2247564,2247607,2247629,2247630,2247672,2247673,2247674,2247675,2247676,2247703,2247704,2247729,2247764,2247765,2247766,2247767,2247837,2247838,2247839,2247840,2247841,2247886,2247887,2247888,2247889,2247890,2247916,2247917,2247918,2247948,2247949,2247976,2247977,2247978,2247979,2247980,2248013,2248014,2248015,2248016,2248017,2248018,2248019,2248020,2248080,2248082,2248083,2248084,2248139,2248140,2248141,2248142,2248143,2248144,2248145,2248146,2248147,2248181,2248182,2248183,2248184,2248185,2248214,2248215,2248216,2248217,2248218,2248219,2248220,2248221,2248222,2248271,2248272,2248332,2248333,2248334,2248370,2248371,2248372,2248406,2248407,2248408,2248409,2248410,2248443,2248444,2248445,2248446,2248447,2248448,2248489,2248544,2248545,2248546,2248547,2248639,2248640,2248641,2248642,2248643,2248645,2248691,2248692,2248693,2248695,2248696,2248697,2248698,2248755,2248756,2248757,2248758,2248792,2248831,2248832,2248833,2248835,2248836,2248837,2248838,2248839,2248840,2248841,2248842,2248843,2248844,2248845,2248846,2248921,2248922,2248923,2248961,2248962,2248963,2248964,2248965,2248966,2248967,2248968,2248969,2248970,2248971,2249014,2249015,2249016,2249017,2249121,2249122,2249123,2249124,2249125,2249126,2249127,2249128,2249129,2249169,2249170,2249171,2249172,2249332,2249333,2249334,2249335,2249377,2249378,2249379,2249380,2249381,2249382,2249383,2249384,2249385,2249386,2249387,2249388,2249389,2249390,2249426,2249427,2249428,2249459,2249460,2249461,2249486,2249487,2249488,2249489,2249490,2249491,2249519,2249520,2249521,2249582,2249583,2249584,2249610,2249611,2249664,2249665,2249666,2249667,2249692,2249694,2249695,2249696,2249697,2249698,2249699,2249722,2249723,2249724,2249725,2249726,2249727,2249728,2249729,2249730,2249731,2249732,2249760,2249761,2249762,2249763,2253640,2253818,2253862,2254002,2254570,2254662,2254518,2254517,2254516,2254695,2254691,2254693,2254694,2254692,2254690,2254688,2254689,2254807,2254869,2254870,2254887,2254888,2254947,2254951,2254992,2255023,2255102,2255136,2255149,2255185,2255184,2255197,2255199,2255198,2255232,2255267,2255269,2255268,2255335,2255337,2255336,2255368,2255364,2255421,2255482,2255488,2255489,2255492,2255491,2255490,2255534,2255537,2255539,2255549,2255541,2255544,2255540,2255585,2255582,2255593,2255594,2255598,2255596,2255597,2255595,2255627,2255624,2255633,2255679,2255680,2255683,2255682,2255681,2255734,2255765,2255764,2255892,2255887,2255902,2255904,2255903,2255929,2255940,2255942,2255941,2255999,2255997,2256003,2256004,2256005,2256000,2256001,2256002,2256076,2256193,2256247,2256249,2256257,2256256,2256258,2256293,2256368,2256373,2256390,2256433,2256429,2256430,2256435,2256471,2256469,2256481,2256480,2256479,2256529,2256523,2256532,2256524,2256537,2256536,2256601,2256604,2256610,2256611,2256612,2256614,2256613,2256615,2256653,2256652,2256708,2256707,2256700,2256699,2256698,2256695,2256694,2256743,2256757,2256756,2256750,2256748,2256759,2256761,2256760,2256821,2256815,2256814,2256808,2256805,2256816,2256824,2256868,2256872,2256873,2256874,2256912,2256911,2256916,2256917,2256918,2256920,2256959,2256966,2256964,2256974,2256975,2256996,2257004,2257003,2257005,2257039,2257070,2257075,2257080,2257081,2257113,2257112,2257108,2257114,2257111,2257116,2257165,2257192,2257194,2257193,2257195,2257222,2257225,2257227,2257239,2257263,2257264,2257265,2257279,2257280,2257277,2257276,2257298,2257299,2257313,2257312,2257314,2257315,2257337,2257336,2257367,2257359,2257362,2257443,2257445,2257446,2257476,2257477,2257526,2257580,2257579,2257582,2257620,2257622,2257621,2257677,2257680,2257679,2257678,2257682,2257705,2257737,2257732,2257741,2257744,2257743,2257742,2257768,2257771,2257770,2257769,2257813,2257814,2257815,2257816,2257824,2257819,2257820,2257821,2257823,2257817,2257828,2257827,2257854,2257867,2257915,2257918,2257917,2257916,2257956,2257975,2257977,2257976,2258017,2258021,2258030,2258029,2258025,2258031,2258033,2258032,2258073,2258087,2258078,2258089,2258091,2258090,2258132,2258147,2258151,2258150,2258149,2258181,2258194,2258184,2258195,2258196,2258197,2258201,2258199,2258200,2258198,2258235,2258246,2258249,2258248,2258247,2258310,2258311,2258312,2258313,2258306,2258308,2258309,2258365,2258366,2258372,2258373,2258377,2258448,2258449,2258447,2258446,2258496,2258514,2258561,2258567,2258568,2258566,2258620,2258623,2258621,2258622,2258680,2258683,2258684,2258657,2258658,2258677,2258678,2258688,2258687,2258745,2258746,2258760,2258752,2258749,2258764,2258767,2258766,2258765,2258814,2258813,2258818,2258820,2258819,2258873,2258867,2258875,2258877,2258876,2258934,2258992,2258994,2258993,2259029,2259030,2259035,2259032,2259033,2259031,2259043,2259090,2259089,2259133,2259166,2259169,2259168,2259167,2259172,2259173,2259176,2259175,2259174,2259239,2259238,2259302,2259314,2259315,2259319,2259317,2259318,2259316,2259374,2259371,2259375,2259378,2259377,2259376,2259430,2259438,2259432,2259440,2259439,2259486,2259497,2259539,2259540,2259544,2259542,2259543,2259541,2259605,2259607,2259606,2259648,2259691,2259698,2259699,2259702,2259701,2259700,2259749,2259751,2259750,2259800,2259801,2259805,2259803,2259804,2259802,2259821,2259831,2259830,2259856,2259855,2259858,2259859,2259860,2259861,2259866,2259863,2259864,2259865,2259862,2259899,2259952,2259955,2259954,2259953,2259981,2259980,2260009,2260028,2260029,2260030,2260060,2260093,2260118,2260125,2260127,2260126,2260153,2260188,2260242,2260247,2260246,2260248,2260264,2260267,2260266,2260293,2260292)
      AND r.cdstatus_processamento <> 3;
  rw_pagto cr_pagto%ROWTYPE;
   
BEGIN
  
  FOR rw_pagto IN cr_pagto LOOP    
    
    BEGIN
      UPDATE tbconv_registro_remessa_pagfor reg
         SET reg.cdstatus_processamento  = 3
            ,reg.dhretorno_processamento = rw_pagto.dtretorno
            ,reg.nmarquivo_retorno       = rw_pagto.nmarquivo
            ,reg.dsprocessamento         = 'Aceito para processamento - Contingência via Sicredi'
       WHERE reg.rowid = rw_pagto.rowid;
    EXCEPTION
      WHEN OTHERS THEN
        dbms_output.put_line('Erro ao atualizar registro da tbconv_registro_remessa_pagfor. Erro -> '|| SQLERRM);
        RAISE vr_exc_erro;
    END;
    
  END LOOP;
  
  COMMIT;
  
  EXCEPTION
    WHEN vr_exc_erro THEN
      ROLLBACK;
    WHEN OTHERS THEN
      dbms_output.put_line('Erro não tratado no script. Erro -> '|| SQLERRM);
      ROLLBACK;
      
END;
