DECLARE
  VR_ERRO EXCEPTION;
  VR_CDCRITIC NUMBER;
  VR_DSCRITIC VARCHAR2(1000);
  CURSOR CR_PARAM IS
      SELECT COUNT(1) AS VALUE FROM CRAPACA WHERE NMDEACAO = 'WEBS0001_ANALISE_MOTOR' AND UPPER(LSTPARAM) LIKE UPPER('%pr_dsclasse_rating%');
  RW_PARAM CR_PARAM%ROWTYPE;
BEGIN
  DBMS_OUTPUT.PUT_LINE('SCRIPT "20210108190027295_RITM0086856" INICIADO EM ' || TO_CHAR(SYSDATE, 'DD/MM/YYYY HH24:MI:SS'));

  OPEN CR_PARAM;
  FETCH CR_PARAM INTO RW_PARAM;
  CLOSE CR_PARAM;

  IF (RW_PARAM.VALUE = 0) THEN
    BEGIN
      UPDATE CRAPACA SET LSTPARAM = LSTPARAM||',pr_dsclasse_rating' WHERE NMDEACAO = 'WEBS0001_ANALISE_MOTOR';
      COMMIT;
    EXCEPTION
      WHEN OTHERS THEN
        VR_CDCRITIC := 0;
        VR_DSCRITIC := 'ERRO AO ATUALIZAR A O CAMPO LSTPARAM DA TABELA "CRAPACA" ONDE NMDACAO = "WEBS0001_ANALISE_MOTOR"'||CHR(13)||SQLERRM;
        RAISE VR_ERRO;
    END;
  END IF;

  DBMS_OUTPUT.PUT_LINE('SCRIPT "20210108190027295_RITM0086856" FINALIZADO COM SUCESSO EM ' || TO_CHAR(SYSDATE, 'DD/MM/YYYY HH24:MI:SS'));
EXCEPTION
  WHEN VR_ERRO THEN
    DBMS_OUTPUT.PUT_LINE('ERRO NA EXECUCAO DO SCRIPT "20210108190027295_RITM0086856". EXCECAO: ' || TO_CHAR(VR_CDCRITIC) || VR_DSCRITIC);
    ROLLBACK;
    RAISE_APPLICATION_ERROR(-20001, 'ERRO NA EXECUCAO DO SCRIPT "20210108190027295_RITM0086856". EXCECAO: ' || TO_CHAR(VR_CDCRITIC) || VR_DSCRITIC);
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('ERRO NAO TRATADO NA EXECUCAO DO SCRIPT "20210108190027295_RITM0086856" EXCECAO: ' || SUBSTR(SQLERRM, 1, 255));
    ROLLBACK;
    RAISE_APPLICATION_ERROR(-20002, 'ERRO NAO TRATADO NA EXECUCAO DO SCRIPT. EXCECAO: ' || SUBSTR(SQLERRM, 1, 255));
END;