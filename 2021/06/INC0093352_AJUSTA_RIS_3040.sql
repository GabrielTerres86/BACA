DECLARE
  -- Variavel tratamento de erro
  VR_EXCSAIDA EXCEPTION;
  VR_MSGSAIDA VARCHAR2(200);
      
  /*Cursor com as respectivas cooperativas, contas e contratos a utilizadas na remoção da central de risco*/
  CURSOR CR_COOP_CONTA_CONTRATO_DELETE IS
    SELECT REGEXP_SUBSTR('11207,88307,115851,132861,165719,166391','[^,]+', 1, LEVEL) AS PR_NRDCONTA,
           REGEXP_SUBSTR('15379,25748,19019,26292,11165719,195','[^,]+', 1, LEVEL) AS PR_NRCTRATO,
           REGEXP_SUBSTR('14,14,14,14,14,14','[^,]+', 1, LEVEL) AS PR_CDCOOPER
    FROM DUAL 
  CONNECT BY REGEXP_SUBSTR('11207,88307,115851,132861,165719,166391','[^,]+', 1, LEVEL) IS NOT NULL;
      
BEGIN
  -- Loop no cursor de 6 contratos da Evolua apontados com necessidade de remoção da central de riscos
  FOR RET_CONTRATO_DELETE IN CR_COOP_CONTA_CONTRATO_DELETE LOOP   
    BEGIN
      DELETE CRAPVRI WHERE CDCOOPER = RET_CONTRATO_DELETE.PR_CDCOOPER AND NRDCONTA = RET_CONTRATO_DELETE.PR_NRDCONTA AND NRCTREMP = RET_CONTRATO_DELETE.PR_NRCTRATO; 
      DELETE CRAPRIS WHERE CDCOOPER = RET_CONTRATO_DELETE.PR_CDCOOPER AND NRDCONTA = RET_CONTRATO_DELETE.PR_NRDCONTA AND NRCTREMP = RET_CONTRATO_DELETE.PR_NRCTRATO;
    EXCEPTION
      WHEN OTHERS THEN
        VR_MSGSAIDA := 'Erro ao limpar tabela -->'||SQLERRM;
        RAISE VR_EXCSAIDA;
    END;
    dbms_output.put_line('Registro removidos com sucesso (Cooperativa/Conta/Contrato): '|| RET_CONTRATO_DELETE.PR_CDCOOPER ||'/'|| RET_CONTRATO_DELETE.PR_NRDCONTA ||';'|| RET_CONTRATO_DELETE.PR_NRCTRATO);
    COMMIT;
  END LOOP;
EXCEPTION
 WHEN VR_EXCSAIDA THEN
    DBMS_OUTPUT.PUT_LINE(VR_MSGSAIDA);
    ROLLBACK;
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('Erro ao executar remoção de dados: '||SQLERRM);
    ROLLBACK;
END;
