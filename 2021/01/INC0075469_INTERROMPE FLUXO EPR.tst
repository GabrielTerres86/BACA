PL/SQL Developer Test script 3.0
735
-- Created on 21/01/2021 by F0033047 
declare
  CURSOR cr_emprestimos IS
    SELECT w.rowid, w.*
      FROM crawepr w
     WHERE (w.cdcooper = 1 AND
           w.nrdconta in (3598535,
                           3590933,
                           888257,
                           11646497,
                           9242678,
                           7906587,
                           2632594,
                           9715851,
                           10501789,
                           10110283,
                           9022481,
                           3810682,
                           11948620,
                           625787,
                           8952477,
                           11375892,
                           2306956,
                           8747504,
                           11881445,
                           9794719,
                           2266962,
                           6422047,
                           8403686,
                           9379622,
                           11905255,
                           10375350,
                           840726,
                           80471390,
                           2701073,
                           9548807,
                           9256725,
                           9403582,
                           3753956,
                           6295096,
                           2354608,
                           6855261,
                           3607526,
                           6040306,
                           2040603,
                           2630656,
                           9690360,
                           10570900,
                           12068314,
                           8317275,
                           2764741,
                           2526883,
                           9357211,
                           8976368,
                           6769438,
                           11882182,
                           3838048,
                           80424368,
                           10860770,
                           11311932,
                           12068314,
                           10919600,
                           80277683,
                           7666250,
                           11795646,
                           11742330,
                           6407099,
                           8066213,
                           9432248,
                           6929877,
                           3775976,
                           10417133,
                           9780483,
                           9130578,
                           6640958,
                           6286771,
                           8449244,
                           9931376,
                           6777538,
                           12033600,
                           6462375,
                           2801680,
                           2395959,
                           8484325,
                           2737167,
                           12027596,
                           10532277,
                           10227784,
                           9712798,
                           10296336,
                           10724095,
                           9152466,
                           8485690,
                           11598263,
                           11498331,
                           831336,
                           2199416,
                           10576819,
                           2702517,
                           2039419,
                           3046761,
                           3615294,
                           1876260,
                           3845834,
                           7440790,
                           6282512,
                           8892490,
                           11776676,
                           3097234,
                           1941267,
                           9064699,
                           8206139,
                           2051281,
                           10500111,
                           3663035,
                           2261626,
                           9357580,
                           9673318,
                           11772220,
                           11995637,
                           11355395,
                           8701318,
                           13242,
                           8064792,
                           8847932,
                           10350683,
                           2272393,
                           6246885,
                           6942130,
                           12113026,
                           866288,
                           7942907,
                           10383816,
                           7061170,
                           10478442,
                           11331380,
                           9115250,
                           7774826,
                           9716106,
                           3528421,
                           2205556,
                           8190950,
                           8849145,
                           11913223,
                           12025615,
                           7452292,
                           12064238,
                           12094510,
                           9851925,
                           6480640,
                           722111,
                           2133962,
                           11110279,
                           11833084,
                           7993234,
                           11216581,
                           10343431,
                           10902520,
                           11516810,
                           3652106,
                           6666574,
                           10806067,
                           9360620,
                           10166033,
                           11920548,
                           7145250,
                           4024443,
                           3864251,
                           10872604,
                           2601761,
                           2600374,
                           6184707,
                           6038433,
                           2196077,
                           10089209,
                           8323216,
                           7272375,
                           3893952,
                           3982351,
                           2972506,
                           12111686,
                           10764500,
                           2476738,
                           3903265,
                           7649274,
                           1843389,
                           12197670,
                           3609294,
                           1627,
                           9985778,
                           7923848,
                           3538109,
                           7804199,
                           3767833,
                           862118,
                           2739100,
                           2026988,
                           2610086,
                           11079185,
                           6777260,
                           12004979,
                           6708420,
                           3863450,
                           6950469,
                           11950307,
                           2785889,
                           4707,
                           2038048,
                           10228632,
                           9232940,
                           9364250,
                           4033329,
                           7564473,
                           3797660,
                           10026339,
                           2849941,
                           2115263,
                           10545930,
                           12191043,
                           2845342,
                           7403240,
                           8217491,
                           11804211,
                           80340954,
                           7459980,
                           3750078,
                           2515180,
                           733130,
                           2362902,
                           7251858,
                           7032714,
                           80343988,
                           11392436,
                           9597280,
                           8937630,
                           11543973,
                           12068314,
                           8650969,
                           11626100,
                           7634862) AND
           w.nrctremp in (3332651,
                           3323414,
                           3319850,
                           3144342,
                           3210050,
                           3337447,
                           3051508,
                           3315222,
                           3291131,
                           3180811,
                           3142951,
                           2676516,
                           3178095,
                           3214833,
                           3236096,
                           3154618,
                           3246347,
                           3229302,
                           3168049,
                           3205775,
                           3258857,
                           3247096,
                           3198271,
                           3263285,
                           3123224,
                           3255666,
                           3290620,
                           3189487,
                           3194882,
                           3288660,
                           3209079,
                           3298803,
                           2984463,
                           3282137,
                           3264558,
                           3311668,
                           3137074,
                           2631323,
                           3189719,
                           3299158,
                           3209381,
                           3179414,
                           3252857,
                           3185615,
                           3319078,
                           3020699,
                           3215898,
                           3133071,
                           3037777,
                           3304576,
                           3325228,
                           3205113,
                           3158747,
                           3266371,
                           3326608,
                           3239575,
                           3268732,
                           3245534,
                           3288736,
                           3024119,
                           3333112,
                           3319165,
                           15305970,
                           3246653,
                           3239059,
                           3273563,
                           15306788,
                           3235085,
                           3168690,
                           3300223,
                           3285230,
                           3212772,
                           15307256,
                           3254553,
                           2856029,
                           3247656,
                           3215769,
                           3051530,
                           3133350,
                           3210439,
                           3120756,
                           3368799,
                           3194810,
                           3301730,
                           3186173,
                           3258676,
                           3192507,
                           3203922,
                           3372286,
                           3190490,
                           3354018,
                           3274551,
                           3101345,
                           3284367,
                           3381010,
                           3290166,
                           3259524,
                           3384557,
                           3364548,
                           3285473,
                           3223665,
                           3385991,
                           3073394,
                           3320473,
                           3229555,
                           3184006,
                           3163661,
                           3268670,
                           3393690,
                           3243466,
                           3335146,
                           3394087,
                           2973560,
                           3333311,
                           3372177,
                           3320939,
                           3236174,
                           3375840,
                           3385672,
                           3368214,
                           3302166,
                           3363250,
                           3218521,
                           3326256,
                           3065645,
                           3131980,
                           3396959,
                           2965679,
                           3302284,
                           3398872,
                           3253048,
                           3229439,
                           3399423,
                           3399812,
                           3243337,
                           3361640,
                           3315064,
                           3111849,
                           3358931,
                           3404048,
                           3284063,
                           3275603,
                           3335422,
                           3190664,
                           3406749,
                           3365036,
                           3307330,
                           3370072,
                           3218567,
                           3141684,
                           3392172,
                           3198907,
                           3246426,
                           3344285,
                           3357597,
                           3399156,
                           3413511,
                           3138658,
                           3295085,
                           3396990,
                           3415463,
                           3297350,
                           15313179,
                           3173551,
                           3270442,
                           3303959,
                           15313373,
                           15313548,
                           3369238,
                           3315632,
                           3230772,
                           3389898,
                           3413630,
                           3247422,
                           3325396,
                           3037049,
                           3299495,
                           3407064,
                           3293938,
                           3391932,
                           3419935,
                           3392170,
                           3401431,
                           3191225,
                           3312971,
                           3270891,
                           3241866,
                           3190326,
                           3230896,
                           2941018,
                           3326555,
                           3359641,
                           3173658,
                           3299624,
                           3289222,
                           3033085,
                           3359790,
                           3399597,
                           3141120,
                           3369213,
                           3401286,
                           3395050,
                           3413129,
                           3367006,
                           3401264,
                           3404500,
                           3245709,
                           3391820,
                           3396652,
                           3265938,
                           3388647,
                           3296209,
                           3401803,
                           3198809,
                           3236056,
                           2828418,
                           3416708,
                           3160484,
                           3402215,
                           3407120,
                           3213847,
                           3392918,
                           3235812,
                           3407649,
                           3313841,
                           3265550,
                           3208476,
                           3199348,
                           3306832,
                           3219733,
                           3404233,
                           3414925,
                           3290065,
                           3235895))
        OR (w.cdcooper = 2 AND
           w.nrdconta in (699756,
                           205893,
                           875589,
                           898090,
                           845973,
                           343650,
                           674621,
                           901458,
                           928585,
                           684333,
                           927660) AND
           w.nrctremp in (288158,
                           288596,
                           288532,
                           288519,
                           287386,
                           289137,
                           289123,
                           288591,
                           287821,
                           289300,
                           288650)
           
           )
        OR (w.cdcooper = 6 AND
           w.nrdconta in
           (166154, 151556, 218731, 509230, 222658, 223026, 149616, 149616) AND
           w.nrctremp in
           (238656, 240117, 239515, 239045, 240034, 240188, 240197, 239824)
           
           )
        OR (w.cdcooper = 7 AND
           w.nrdconta in (324345,
                           348503,
                           327212,
                           296341,
                           76201,
                           367613,
                           157635,
                           316296,
                           363634) AND
           w.nrctremp in
           (47676, 46011, 48107, 48116, 48095, 47902, 48058, 48149, 48151)
           
           )
        OR (w.cdcooper = 8 AND w.nrdconta in (35297) AND
           w.nrctremp in (8266)
           
           )
        OR (w.cdcooper = 9 AND
           w.nrdconta in (379204,
                           239534,
                           119245,
                           358401,
                           167517,
                           123080,
                           313483,
                           313483,
                           328367,
                           315672,
                           14877,
                           121142,
                           145343,
                           306037,
                           306037,
                           204951,
                           375772,
                           362719,
                           378330,
                           50695,
                           187267,
                           300306,
                           900966,
                           639,
                           277355,
                           736,
                           259705,
                           378003,
                           317640,
                           317640,
                           303674,
                           145343,
                           43605,
                           360970,
                           311120,
                           267473,
                           901792,
                           333107,
                           227293,
                           364223,
                           223867,
                           349542,
                           2712,
                           378119,
                           378119,
                           378119,
                           321621,
                           9806,
                           190888) AND
           w.nrctremp in (44529,
                           44185,
                           44472,
                           44890,
                           44796,
                           44913,
                           44914,
                           44915,
                           44918,
                           44270,
                           44484,
                           44732,
                           44928,
                           44552,
                           44547,
                           44961,
                           44790,
                           44975,
                           44071,
                           44999,
                           44984,
                           45003,
                           44875,
                           45005,
                           44501,
                           45021,
                           44916,
                           45009,
                           45002,
                           44996,
                           45034,
                           45039,
                           44076,
                           44929,
                           44926,
                           44550,
                           40355,
                           45004,
                           44899,
                           44733,
                           39813,
                           45010,
                           44901,
                           44867,
                           44872,
                           44870,
                           45043,
                           44900,
                           44888)
           
           )
        OR (w.cdcooper = 10 AND w.nrdconta in (47015, 56847) AND
           w.nrctremp in (20722, 20749)
           
           )
        OR (w.cdcooper = 11 AND
           w.nrdconta in (469939, 510041, 510912, 573876, 530670, 262625) AND
           w.nrctremp in
           (3547442, 3547902, 109985, 113879, 113954, 112657)
           
           )
        OR (w.cdcooper = 13 AND w.nrdconta in (73083, 105090, 528633) AND
           w.nrctremp in (94230, 96458, 3542495)
           
           )
        OR (w.cdcooper = 14 AND
           w.nrdconta in
           (75590, 231274, 87505, 104060, 231096, 171441, 90972) AND
           w.nrctremp in (21985, 22173, 22086, 22121, 22105, 22149, 21614)
           
           )
        OR (w.cdcooper = 16 AND
           w.nrdconta in (757306,
                           162205,
                           307378,
                           255491,
                           156906,
                           482854,
                           806633,
                           688762,
                           506753) AND
           w.nrctremp in (10011463,
                           10011493,
                           10011401,
                           10011701,
                           210248,
                           231119,
                           229995,
                           229485,
                           231152)
           
           )
          
       AND NOT EXISTS (SELECT 1
              FROM crapepr p
             WHERE p.cdcooper = w.cdcooper
               AND p.nrdconta = w.nrdconta
               AND p.nrctremp = w.nrctremp);
 

  i           integer := 0;
  vr_dscritic VARCHAR2(1000);
  vr_dsmensag VARCHAR2(4000);
  vr_cdcritic INTEGER;
  
begin
  dbms_output.enable(1000000);
  FOR RW_EMPRESTIMO IN cr_emprestimos LOOP
    i := i + 1;
  
    ESTE0001.pc_interrompe_proposta_est(pr_cdcooper => RW_EMPRESTIMO.cdcooper, --> Codigo da cooperativa
                                        pr_cdagenci => RW_EMPRESTIMO.cdagenci, --> Codigo da agencia
                                        pr_cdoperad => RW_EMPRESTIMO.cdopeste,
                                        pr_cdorigem => 5, --> Origem da operacao
                                                       pr_nrdconta =>
                                                       RW_EMPRESTIMO.nrdconta, --> Numero da conta do cooperado
                                        pr_nrctremp => RW_EMPRESTIMO.nrctremp, --> Numero da proposta de emprestimo atual/antigo
                                        pr_dtmvtolt => trunc(sysdate), --> Data do movimento
                                        pr_cdcritic => vr_cdcritic, --> Codigo da critica
                                        pr_dscritic => vr_dscritic); --> Descricao da critica
  
    IF vr_dscritic IS NOT NULL OR vr_cdcritic > 0 THEN
      DBMS_OUTPUT.put_line('Erro ao interromper fluxo da cooperativa: ' || RW_EMPRESTIMO.cdcooper || 
                           ' proposta:' || RW_EMPRESTIMO.nrctremp || 
                           ' conta: ' || RW_EMPRESTIMO.NRDCONTA);
                           
    ELSE
      UPDATE crawepr c
         SET c.insitapr = 0,
             c.cdopeapr = '',
             c.dtaprova = NULL,
             c.hraprova = 0,
             c.insitest = 0,
             c.inaverba = 0
       WHERE c.rowid = RW_EMPRESTIMO.rowid;
       
      ESTE0001.pc_incluir_proposta_est(pr_cdcooper => RW_EMPRESTIMO.cdcooper--> Codigo da cooperativa
                             ,pr_cdagenci => RW_EMPRESTIMO.cdagenci--> Codigo da agencia
                             ,pr_cdoperad => RW_EMPRESTIMO.cdopeste--> codigo do operador
                             ,pr_cdorigem => 5 --> Origem da operacao
                             ,pr_nrdconta => RW_EMPRESTIMO.nrdconta --> Numero da conta do cooperado
                             ,pr_nrctremp => RW_EMPRESTIMO.nrctremp --> Numero da proposta de emprestimo atual/antigo
                             ,pr_dtmvtolt => trunc(sysdate) --> Data do movimento
                             ,pr_nmarquiv => NULL
                             ,pr_dsmensag => vr_dsmensag
                             ,pr_cdcritic => vr_cdcritic
                             ,pr_dscritic => vr_dscritic);
       
       IF vr_dscritic IS NOT NULL OR vr_cdcritic > 0 THEN
         DBMS_OUTPUT.put_line('Erro ao agendar envio ao motor: ' || RW_EMPRESTIMO.cdcooper || 
                           ' proposta:' || RW_EMPRESTIMO.nrctremp || 
                           ' conta: ' || RW_EMPRESTIMO.NRDCONTA); 
       END IF;
       
    END IF;
  
  END LOOP;
  commit;
  DBMS_OUTPUT.put_line('total de registros:' || i);

end;
0
0
