-- Created on 01/09/2021 by T0033801 
DECLARE 

CURSOR C1 IS
--EVOLUA
SELECT REGEXP_SUBSTR('40312,40312,197815,41343,41343,41343,47880,143294,143294,277860,224723,217778,217778,744,247081,65889,269638,246514,168459,72923,121185,139262,19208,74837,282235,1350','[^,]+', 1, LEVEL) AS PR_NRDCONTA,
       REGEXP_SUBSTR('18049,18050,26315,12786,12787,12788,16677,13986,13987,1,2,1,2,727823,1,23297,1,1,1,15759,1,1,251544,10097,1,829023','[^,]+', 1, LEVEL) AS PR_NRCTRATO,
       REGEXP_SUBSTR('14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14','[^,]+', 1, LEVEL) AS PR_CDCOOPER 
  FROM DUAL 
CONNECT BY REGEXP_SUBSTR('40312,40312,197815,41343,41343,41343,47880,143294,143294,277860,224723,217778,217778,744,247081,65889,269638,246514,168459,72923,121185,139262,19208,74837,282235,1350','[^,]+', 1, LEVEL) IS NOT NULL
UNION ALL
--ACENTRA
SELECT REGEXP_SUBSTR('148776,259195','[^,]+', 1, LEVEL) AS PR_NRDCONTA,
       REGEXP_SUBSTR('40398,41485','[^,]+', 1, LEVEL) AS PR_NRCTRATO,
       REGEXP_SUBSTR('5,5','[^,]+', 1, LEVEL) AS PR_CDCOOPER 
  FROM DUAL 
CONNECT BY REGEXP_SUBSTR('148776,259195','[^,]+', 1, LEVEL) IS NOT NULL
UNION ALL
--VIACREDI
SELECT REGEXP_SUBSTR('10987444,12207438,12625930,12388360,12932884,11597453,12850020,10957260,11384603,3579727,12390950,12556050','[^,]+', 1, LEVEL) AS PR_NRDCONTA,
       REGEXP_SUBSTR('3258644,1,3853624,4028942,1,4038607,4085318,2850568,2670142,3863688,4224107,4212277','[^,]+', 1, LEVEL) AS PR_NRCTRATO,
       REGEXP_SUBSTR('1,1,1,1,1,1,1,1,1,1,1,1','[^,]+', 1, LEVEL) AS PR_CDCOOPER 
  FROM DUAL 
CONNECT BY REGEXP_SUBSTR('10987444,12207438,12625930,12388360,12932884,11597453,12850020,10957260,11384603,3579727,12390950,12556050','[^,]+', 1, LEVEL) IS NOT NULL;

BEGIN
   
    FOR R1 IN C1 LOOP           
      --Exclusao da proposta
      BEGIN
       DELETE
         FROM CRAPPRP
        WHERE CDCOOPER = R1.PR_CDCOOPER
          AND NRDCONTA = R1.PR_NRDCONTA
          AND NRCTRATO = R1.PR_NRCTRATO;
       EXCEPTION
         WHEN OTHERS THEN
           ROLLBACK;
      END;

      --Exclusão do rendimento
      BEGIN
       DELETE
         FROM CRAPRPR
        WHERE CDCOOPER = R1.PR_CDCOOPER
          AND NRDCONTA = R1.PR_NRDCONTA
          AND NRCTRATO = R1.PR_NRCTRATO;
      EXCEPTION
         WHEN OTHERS THEN
           ROLLBACK;
      END;

      --Exclusão do bem da proposta
      BEGIN
       DELETE
         FROM CRAPBPR
        WHERE CDCOOPER = R1.PR_CDCOOPER
          AND NRDCONTA = R1.PR_NRDCONTA
          AND NRCTRPRO = R1.PR_NRCTRATO;
      EXCEPTION
         WHEN OTHERS THEN
           ROLLBACK;
      END;

      --Exclusão do SCR para do aval
      BEGIN
       DELETE
         FROM CRAPAVT
        WHERE CDCOOPER = R1.PR_CDCOOPER
          AND NRDCONTA = R1.PR_NRDCONTA
          AND NRCTREMP = R1.PR_NRCTRATO;
      EXCEPTION
         WHEN OTHERS THEN
           ROLLBACK;
      END;

      --Exclusão das notas do rating por contrato
      BEGIN
       DELETE
         FROM CRAPNRC
        WHERE CDCOOPER = R1.PR_CDCOOPER
          AND NRDCONTA = R1.PR_NRDCONTA
          AND NRCTRRAT = R1.PR_NRCTRATO;
      EXCEPTION
         WHEN OTHERS THEN
           ROLLBACK;
      END;

      --Exclusão do historico das notas por contrato
      BEGIN
       DELETE
         FROM CECRED.TBRAT_HIST_NOTA_CONTRATO
        WHERE CDCOOPER = R1.PR_CDCOOPER
          AND NRDCONTA = R1.PR_NRDCONTA
          AND NRCTRRAT = R1.PR_NRCTRATO;
      EXCEPTION
         WHEN OTHERS THEN
           ROLLBACK;
      END;

      --Exclusão das informações do rating por contrato
      BEGIN
       DELETE
         FROM CECRED.TBRAT_INFORMACAO_RATING
        WHERE CDCOOPER = R1.PR_CDCOOPER
          AND NRDCONTA = R1.PR_NRDCONTA
          AND NRCTRRAT = R1.PR_NRCTRATO;
      EXCEPTION
         WHEN OTHERS THEN
           ROLLBACK;
      END;
      COMMIT;
    END LOOP;
EXCEPTION
  WHEN OTHERS THEN
    ROLLBACK;
END;