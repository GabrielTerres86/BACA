<!--
  Programa: crap030.htm

  Alteracoes: 31/05/2016 - Alteraçoes Oferta DEBAUT Sicredi (Lucas Lunelli - [PROJ320])

  Alteracoes: 
              12/09/2016 - Adicionado chamada da função "callBlass(event)" - (Evandro - RKAM). 
-->
<html>

<head>
<meta http-equiv="Content-Language" content="pt-br">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="Pragma"        content="No-Cache">
<meta http-equiv="Expires"       content="0">
<script language=JavaScript src="/script/formatadadosie.js"></script>
<link rel=StyleSheet type="text/css" href="/script/viacredi.css">
<title>INCLUSÃO DE AUTORIZAÇÃO DE DÉBITO</title>
<script language=JavaScript src="/script/jquery.js"></script>
<script language="JavaScript">

var cnxPinpad; 		/* COMUNICAÇÃO PINPAD NOVO */
var WrkPinpad = ""; /* KEY DE COMUNICAÇÃO PINPAD NOVO */
var EncPinpad = ""; /* CRYTO PASSWORD */
var focoOK = true; /* CONTROLE DE FOCO CAMPO SENHA CARTÃO */

/*************** ROTINAS PINPAD NOVO ********************************/

function lerCartaoPinpadNovo(oPinpad) {

	var contador = 0;
	
	// Se nao houver conexao ativa, conecta */	
	oPinpad = conexaoPinpadNovo(oPinpad);
	
	if (oPinpad == false) {return;}
	
	document.getElementById('divAguardePassagem').style.display = "block";
	document.getElementById('divRealizePassagem').style.display = "none";

	if (document.getElementById('v_cartao').value != "") {
		document.getElementById('v_cartao').value = ""
	}
	
	setTimeout(function(){
	
		while (document.getElementById('v_cartao').value == "") {
									
			if  (contador > 2) { break; }
			
			solicitaPassagemPinpadNovo(oPinpad, document.getElementById('v_cartao'));
			contador = contador + 1;	
		}
		
		oPinpad = fechaConexaoPinpadNovo(oPinpad);
		
		if  (document.getElementById('v_cartao').value != "") {
			document.getElementById('divAguardePassagem').style.display = "none";
			submitForm();
		}
		
	},500);
}

function solicitaSenhaPinpadNovo(oPinpad, valor) {	
	if (valor == ""){
		// Se nao houver conexao ativa, conecta */
		oPinpad = conexaoPinpadNovo(oPinpad);
		if (oPinpad == false) {return;}

		document.getElementById('divAguardeSenha').style.display = "block";
		
		focoOK = false;
		
		obtemSenhaCypto(oPinpad, document.getElementById('v_nrdocard'), document.getElementById('v_dssencrd'), document.getElementById('divAguardeSenha'));	
	}
}

function mataConexaoPinpad() {

	cnxPinpad = conexaoPinpadNovo(cnxPinpad);
	if (cnxPinpad != false && typeof cnxPinpad != 'undefined') {
		fechaConexaoPinpadNovo(cnxPinpad);
	}

}

/*************** FIM ROTINAS PINPAD NOVO ********************************/

function submitForm() {

	document.getElementById('divProcessando').style.display = 'block';
	
	mataConexaoPinpad();

	if (EncPinpad != "" &&
		WrkPinpad != "") {
		document.getElementById('v_infocry').value = EncPinpad;
		document.getElementById('v_chvcry').value = WrkPinpad;
	}
	
	for (var i=0;i<document.forms[0].length;i++){
		document.forms[0].elements[i].disabled=false;			
	}
	
    document.forms[0].submit();   
}

</script>
</head>

<body background="/images/moeda.jpg" bgproperties="fixed" class="fundo" onLoad="JavaScript: controlaCampos(); mudaFoco(); click();" onKeyUp="callBlass(event); callBLini(event); callBLsal(event);"> 
<form onKeyDown="change_page(event)" method=post>

<input type="hidden" name="vh_foco" id="vh_foco">
<input type="hidden" name="vh_nome" id="vh_nome">
<input type="hidden" name="v_msg">
<input type="hidden" name="v_indempre">
<input type="hidden" name="v_cntanter" id="v_cntanter">
<input type="hidden" name="tmp_cdempcon" id="tmp_cdempcon">

<input type="hidden" name="v_btn_ok" value="false">
<input type="hidden" name="v_btn_cancela" value="false">
<input type="hidden" name="v_infocry">
<input type="hidden" name="v_chvcry">
<input type="hidden" name="v_nrdocard" id="v_nrdocard">

<p style="word-spacing: 0; line-height: 100%; margin-top: 0; margin-bottom: 0">&nbsp;</p>
<div align="center">
  <center>
  <table width="100%" class=cabtab>
    <tr>
      <td width="15%" align="center"> <input type="text" name="v_coop" size="11" class="transp" readOnly>
      </td>
      <td width="20%" align="center"> PA&nbsp; <input type="text" name="v_pac" size="1" class="transp"  readOnly>
      </td>
      <td width="20%" align="center"> CAIXA&nbsp; <input type="text" name="v_caixa" size="1" class="transp" readOnly>
      </td>
      <td width="30%" align="center"> OPERADOR&nbsp; <input type="text" name="v_operador" size="7" class="transp" readOnly>
      </td>
      <td width="15%" align="center"> <input type="text" name="v_data" size="10" class="transp" readOnly>
      </td>
    </tr>
  </table>
  </center>
</div>
<div align="center">
  <center>
	  <table width="100%" class=cabtab>
		<tr>
		  <td class=titulo>INCLUSÃO DE AUTORIZAÇÃO DE DÉBITO</td>
		  <td width="21%" class=programa align="right">P.030&nbsp; V.1.00</td>
		</tr>
	  </table>
  </center>
</div>

<div align="center">
	<center>
		<table cellspacing = 0 cellpadding= 0 width=100%>
			<tr>
				<td width="100%" valign="middle" align="center">
					<div align="center">
						<center>
							<table valign="middle" align="center" width="100%" cellspacing = 0 cellpadding = 1 class=tcampo>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>								
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>						
								<tr id="trCartao">
									<td width="50%" class="linhaform" align="right">Cartão:</td>
									<td><input type="password" name="v_cartao" id="v_cartao" size="54" class="input" maxlength="36" onFocus="if(this.value.length <= 0) { lerCartaoPinpadNovo(''); } " onKeyDown="JavaScript:validaInteiro(event);"  onkeyup="if (this.value.length == 36){submitForm();}" onChange="JavaScript: submitForm();" onClick="lerCartaoPinpadNovo('');" style="text-align: right"></td>
								</tr>
								<tr>
									<td width="50%" align="right" class="linhaform">Conta/Dv:</td>
									<td colspan="3">
										<input type="text" name="v_conta" onKeyDown="JavaScript:validaInteiro(event); FormataConta(this,8,event);" onchange="submitForm();" style="text-align: right" maxlength="10" size="10" class="input" disabled>
										<input type="text" name="v_nome" size="40" class=input style="font-weight: bold" disabled>
									</td>
							   </tr>							   
							</table>
							<table valign="middle" id = "tab_form" align="center" width="100%" cellspacing = 0 cellpadding = 1 class=tcampo>								
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr><td align="right" class="linhaform" width="100%" colspan="2"><hr class="input"></td></tr>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr>
									<td width=50% align="right">Segmento:&nbsp;</td>
									<td width=50% align="left"  class="linhaform" >
										<select name="v_segmento" id="v_segmento" size="1" style="width: 310px" onchange = "document.getElementById('v_indempre').value = 0; document.forms[0].submit();"></select>
									</td>
								</tr>
								<tr>
									<td width=50% align="right">Conv&ecirc;nio:&nbsp;</td>
									<td width=50% align="left">
										<select name="v_cdempcon" id="v_cdempcon" size="1" style="width: 310px"></select>
									</td>
								</tr>								
								<tr>
									<td width=50% align="right">Identificador:&nbsp;</td>
									<td width=50% align="left" ><input type="text" name="v_cdrefere" size="20" class="input" maxlength="17" onKeyDown="JavaScript:validaInteiro(event);" style="text-align: right"></td>
								</tr>								
								<tr>
									<td width=50% align="right">Limite máximo para débito: &nbsp;</td>
									<td width=50% align="left">
										Sim <input type="radio" value="1" name="inlimite" id="inlimite" onClick="mudaLimite();" checked >&nbsp; &nbsp;
										Não <input type="radio" value="2" name="inlimite" id="inlimite" onClick="mudaLimite();" >
									</td>
								</tr>								
								<tr>
									<td width=50% align="right">Autorizo o débito até o valor máximo de &nbsp;</td>
									<td width=50% align="left" ><input type="text" name="v_vlrmaxdb" id="v_vlrmaxdb" size="16" class="input" maxlength="14" onKeyDown="JavaScript:validaInteiro(event); FormataValor(this,11,event);" style="text-align: right"></td>
								</tr>								
								<tr>
									<td width=50% align="right">Descrição no extrato: &nbsp;</td>
									<td width=50% align="left" ><input type="text" name="v_dshisext" id="v_dshisext" size="20" maxlength="20" class="input" style="text-align: right">  &nbsp; (opcional) </td>
								</tr>								
								<tr>
									<td width=50% align="right">Senha Cartão: &nbsp;</td>
									<td width=50% align="left" ><input type="password" name="v_dssencrd" id="v_dssencrd" size="10" class="input" maxlength="6" onmousedown="return false;" onFocus="solicitaSenhaPinpadNovo('', this.value);" onBlur="if (this.value != '') { mataConexaoPinpad(); document.forms[0].ok.focus(); } else { mataConexaoPinpad(); document.forms[0].v_dshisext.focus(); }" onKeyDown="JavaScript:validaInteiro(event);" style="text-align: right"></td>
								</tr>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr>
									<td width=50% align="right" >
										<input type="button" id="Ok" value="Ok" name="ok" class="button" ondblclick="return false;" onclick="document.getElementById('v_indempre').value = document.getElementById('v_cdempcon').selectedIndex; document.forms[0].ok.disabled='true';document.forms[0].v_btn_ok.value='true'; submitForm();">
									</td>
									<td width=50% align="left" >
										&nbsp;&nbsp;&nbsp;<input type="button" value="Cancelar" name="cancela" class="button" onclick="document.forms[0].cancela.disabled='true'; document.forms[0].v_btn_cancela.value='true'; submitForm();"></td>														  
									</td>
								</tr>							
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
								<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
							</table>   
						</center>
					</div>
				</td>
			</tr>
		</table>
	</center>
</div>
</form>

<div id="divAguardeSenha" name="divAguardeSenha" style="display:none;  z-index: -1; width:100%; height:100px; margin-top:-97px; margin-left: 50px; text-align:center;" align="center" >
	<form>
		<table class="tableForm" style="text-align:center; background-color:rgb(255, 255, 206); width: 250px;">
			<tr>
				<td colspan="2" id="msgAguardeSenha"><font style="font-family: Arial, Verdana, sans-serif; font-size:11pt;">Aguarde a digitação da senha</font></td>
			</tr>
		</table>        
</form>
</div>	

<div id="divAguardePassagem" name="divAguardePassagem" style="display:none; z-index: -1; position:fixed; width:100%; height:100px; margin-top:-97px; margin-left: 50px; text-align:center;" align="center" >
	<form>
		<table class="tableForm" style="text-align:center; background-color:rgb(255, 255, 206); width: 250px;">
			<tr>
				<td colspan="2" id="msgAguardePassagem"><font style="font-family: Arial, Verdana, sans-serif; font-size:11pt;">Aguarde a passagem do cartão</font></td>
			</tr>
		</table>        
	</form>
</div>

<div id="divRealizePassagem" name="divRealizePassagem" style="display:none; z-index: -1; position:fixed; width:100%; height:100px; margin-top:-97px; margin-left: 50px; text-align:center;" align="center" >
	<form>
		<table class="tableForm" style="text-align:center; background-color:rgb(255, 255, 206); width: 350px;">
			<tr>
				<td colspan="2" id="msgRealizePassagem"><font style="font-family: Arial, Verdana, sans-serif; font-size:11pt;">Clique no campo cartão e realize a passagem</font></td>
			</tr>
		</table>        
	</form>
</div>

<div id="divProcessando" name="divProcessando" style="display:none; z-index: -1; position:fixed; width:100%; height:100px; margin-top:-97px; margin-left: 50px; text-align:center;" align="center" >
	<form>
		<table class="tableForm" style="text-align:center; background-color:rgb(255, 255, 206); width: 250px;">
			<tr>
				<td colspan="2" id="divProcessando"><font style="font-family: Arial, Verdana, sans-serif; font-size:11pt;">Processando...</font></td>
			</tr>
		</table>        
</form>
</div>

</body>
</html>

<script language="JavaScript">

var objempcon = new Array();

function populaConvenios(){

	var opt;
	var index = "";

	for(i=0;i<tmp_objempcon.length;i++){
		eval('var obj='+tmp_objempcon[i]);
		objempcon.push(obj);
	}
	
	for(i=0;i<objempcon.length;i++){
				
		if  (document.getElementById("v_segmento").value != 99 &&
			 document.getElementById("v_segmento").value != objempcon[i].cdsegmto) {
			 continue;
		}
		
		if (document.getElementById("tmp_cdempcon").value != "" && 
			document.getElementById("tmp_cdempcon").value  == objempcon[i].cdempcon){
			index = i;
		}
				
		opt = document.createElement("option");
		opt.value = objempcon[i].cdempcon;
		opt.innerHTML = objempcon[i].nmextcon;
		document.getElementById("v_cdempcon").appendChild(opt);

	}
	
	if (index != ""){
		document.getElementById('v_cdempcon').selectedIndex = index;
	}
	
	return false;
	
}

function controlaCampos(){

	document.getElementById('v_cntanter').value = document.getElementById('v_conta').value;
	document.getElementById('vh_nome').value = document.getElementById('v_nome').value;
		
	if (document.getElementById("v_conta").value != ''){
		populaConvenios();
	}
	
	if (document.getElementById("v_nome").value == "" ||
		document.getElementById("v_cartao").value == "") {
		
		for (var i=0;i<document.forms[0].length;i++){
			document.forms[0].elements[i].disabled=true;			
		}
		
		if (document.getElementById("v_cartao").value == "" &&
			document.getElementById("v_conta").value != "") {
			document.getElementById('divRealizePassagem').style.display = "block";
		}
		
		document.getElementById("v_cartao").disabled = false;
		
		document.getElementById("v_caixa").disabled = false;
		document.getElementById("v_coop").disabled = false;
		document.getElementById("v_data").disabled = false;
		document.getElementById("v_operador").disabled = false;
		document.getElementById("v_pac").disabled = false;
		
		document.getElementById('vh_foco').value = "10";
		
		return false;
	} else {	
		for (var i=0;i<document.forms[0].length;i++){
			document.forms[0].elements[i].disabled=false;
		}
		document.getElementById("v_nome").disabled = true;
		document.getElementById("v_conta").disabled = true;
	}
	
	if (document.getElementById("v_indempre").value > 0){
		document.getElementById("v_cdempcon").selectedIndex = document.getElementById("v_indempre").value;
	}
	
	if (document.getElementById("v_cdempcon").value == 0) {
		document.getElementById("v_cdempcon").disabled = true;
	}
	
	mudaLimite();
	
	return true;

}

function mudaLimite(){

	if  (document.getElementById("inlimite").checked == false) {
		document.getElementById("v_vlrmaxdb").value = ""
		document.getElementById("v_vlrmaxdb").disabled = true;
		document.getElementById("v_dshisext").focus();
	} else {
		document.getElementById("v_vlrmaxdb").disabled = false;
		document.getElementById("v_vlrmaxdb").focus();
	}	
}

</script>
