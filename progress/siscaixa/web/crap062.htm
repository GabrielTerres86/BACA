<!-----------------------------------------------------------------------------------------------
   Programa: siscaixa/web/crap062.w
   Sistema : Caixa On-line
   Sigla   : CRED   
   Autor   : Lucas Lunelli
   Data    : Abril/2016                      Ultima atualizacao:

  Alteracoes:   

----------------------------------------------------------------------------------------------->

<html>
<head>
<meta http-equiv="Content-Language" content="pt-br">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="Pragma"        content="No-Cache">
<meta http-equiv="Expires"       content="0">
<script language=JavaScript src="/script/formatadadosie.js"></script>
<link rel=StyleSheet type="text/css" href="/script/viacredi.css">

<script language=JavaScript src="/script/jquery.js"></script>
<script language="JavaScript">

var cnxPinpad; 		/* COMUNICAÇÃO PINPAD NOVO */
var WrkPinpad = ""; /* KEY DE COMUNICAÇÃO PINPAD NOVO */
var EncPinpad = ""; /* CRYTO PASSWORD */

/*************** ROTINAS PINPAD NOVO ********************************/

function lerCartaoPinpadNovo(oPinpad) {

	var contador = 0;
	
	// Se nao houver conexao ativa, conecta */	
	oPinpad = conexaoPinpadNovo(oPinpad);
	
	if (oPinpad == false) {return;}
	
	document.getElementById('divAguardePassagem').style.display = "block";	
	
	if (document.getElementById('v_dsdcartao').value != "") {
		document.getElementById('v_dsdcartao').value = ""
	}
	
	setTimeout(function(){
	
		while (document.getElementById('v_dsdcartao').value == "") {
									
			if  (contador > 2) { break; }
			
			solicitaPassagemPinpadNovo(oPinpad, document.getElementById('v_dsdcartao'));
			contador = contador + 1;	
		}
		
		oPinpad = fechaConexaoPinpadNovo(oPinpad);
		
		if  (document.getElementById('v_dsdcartao').value != "") {
			document.getElementById('divAguardePassagem').style.display = "none";
			submitFormulario();
		}
		
	},500);
}

function solicitaSenhaPinpadNovo(oPinpad) {
	
	// Se nao houver conexao ativa, conecta */
	oPinpad = conexaoPinpadNovo(oPinpad);
	if (oPinpad == false) {return;}

	document.getElementById('divAguardeSenha').style.display = "block";
	
	obtemSenhaCypto(oPinpad, document.getElementById('v_cartao'), document.getElementById('v_senha'), document.getElementById('divAguardeSenha'));	
}

/*************** FIM ROTINAS PINPAD NOVO ********************************/

function inicializa() {

	document.getElementById('vok').value = "";
	document.getElementById('cancela').value = "";

	if (document.getElementById('v_nome').value == '') {
		$("#v_conta").attr("disabled", "disabled");
		$("#tab_form").find("input,button,textarea,select").attr("disabled", "disabled");
		$("#tab_botoes").find("input,button,textarea,select").attr("disabled", "disabled");
	}
	
	document.getElementById("mensagem").innerHTML = document.getElementById("v_mensagem").value;

}

function cancelFormulario() {

	$("#campos").find("input,button,textarea,select").attr("disabled", "disabled");	
	document.getElementById('cancela').value = "cancela";
	document.getElementById("frmSMS").submit();

}

function submitFormulario() {

	var strSenha =  document.getElementById('v_senha').value;
	
    if (strSenha != "" && strSenha != " ") {
	
	    document.getElementById('vok').value = "ok";
	   
		if (EncPinpad != "" &&
			WrkPinpad != "") {
			document.getElementById('v_infocry').value = EncPinpad;
			document.getElementById('v_chvcry').value = WrkPinpad;
		}
	}
		
	document.getElementById("frmSMS").submit();
}
                                                 
</script>
<title>CADASTRO SMS PARA DEBITO AUTOMÁTICO</title></head>

<body background="/images/moeda.jpg" bgproperties="fixed" class="fundo" onLoad="JavaScript: mudaFoco(); inicializa();" onKeyUp="callBlass(event); callBLini(event); callBLsal(event);" oncontextmenu="return false;"> 
	<div>
		<form name="action" onKeyDown="change_page(event)" method=post name="frmSMS" id="frmSMS">
			<input type="hidden" name="vh_foco" >
			<input type="hidden" name="v_msg">
			<input type="hidden" name="v_infocry">
			<input type="hidden" name="v_chvcry">
			<input type="hidden" name="v_nrdocard">
			<input type="hidden" name="v_cartao">
			<input type="hidden" name="v_mensagem">
			<input type="hidden" name="v_action">                

            <p style="word-spacing: 0; line-height: 100%; margin-top: 0; margin-bottom: 0">&nbsp;</p>
			<div align="center">
				<center>
					<table width="100%" class=cabtab>
						<tr>
							<td width="15%" align="center"> <input type="text" name="v_coop" size="11" class="transp" readOnly></td>
							<td width="20%" align="center"> PA&nbsp; <input type="text" name="v_pac" size="1" class="transp"  readOnly></td>
							<td width="20%" align="center"> CAIXA&nbsp; <input type="text" name="v_caixa" size="1" class="transp" readOnly></td>
							<td width="30%" align="center"> OPERADOR&nbsp; <input type="text" name="v_operador" size="7" class="transp" readOnly></td>
							<td width="15%" align="center"> <input type="text" name="v_data" size="10" class="transp" readOnly></td>
						</tr>
					</table>
				</center>
			</div>
			<div align="center">
				<center>
					<table width="100%" class=cabtab>
						<tr>
							<td class=titulo>CADASTRO SMS PARA DEBITO AUTOMÁTICO</td>
							<td width="21%" class=programa align="right">P.062&nbsp; V.2.01</td>
						</tr>
					</table>
				</center>
			</div>               
            <div align="center" id="campos" name="campos">
				<center>					
					<table cellspacing = 0 cellpadding= 0 width=100%>
						<tr>
							<td width="100%" valign="middle" align="center">
								<div align="center">
									<center>
										<table valign="middle"  align="center" width="100%" cellspacing = 0 cellpadding = 1 class=tcampo>
											<tr><td width=100% >&nbsp;</td></tr>								
											<tr><td width=100% >&nbsp;</td></tr>								
											<tr><td width=100% align="center">
												Cartão: <input type="password" name="v_dsdcartao" id="v_dsdcartao" size="50" class="input" maxlength="36" onFocus="if(this.value.length <= 0) { lerCartaoPinpadNovo(''); }" onKeyDown="JavaScript:validaInteiro(event); " onkeyup="if (this.value.length == 36){ submitFormulario(); }" onChange="JavaScript: submitFormulario(); " onClick="lerCartaoPinpadNovo('');" style="text-align: right">
											</td></tr>								
											<tr valign="bottom"> 
												<td align="center" width=100%>Conta/DV:
													<input type="text" name="v_conta" id="v_conta" maxlength="10" size="10" class="input" style="text-align: right" disabled>
													<input type="text" name="v_nome" id="v_nome" size="40" class=input style="font-weight: bold" disabled></td>
											</tr>							   
										</table>
										
										<table valign="middle" id = "tab_form" align="center" width="100%" cellspacing = 0 cellpadding = 1 class=tcampo>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
											<tr><td align="right" class="linhaform" width="100%" colspan="2"><hr class="input"></td></tr>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
											<tr>												
												<td width=50% align="right">Celular:&nbsp;</td>												
												<td width=50% align="left" ><input type="text" name="v_nrDDD" id="v_nrDDD" size="4" class="input" maxlength="2" onKeyDown="JavaScript:validaInteiro(event);" style="text-align: right">												
																			<input type="text" name="v_nrtelefo" id="v_nrtelefo" size="12" class="input" maxlength="9" onKeyDown="JavaScript:validaInteiro(event);" style="text-align: right"></td>
											</tr>
											<tr>
												<td class="linhaform" align="right" style="width:14%">Senha:</td>												
												<td ><input class="input" type="password" name="v_senha" id="v_senha" size="10" maxlength="6" onmousedown="return false;" onBlur="if (this.value != '') { sok.focus(); } else { v_nrtelefo.focus(); }"  onFocus="solicitaSenhaPinpadNovo('', this.value);" onKeyDown="JavaScript:validaInteiro(event);" style="text-align: right"></td>
											</tr>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>											
										</table>
										
										<table class="tableForm" style="text-align:center; background-color:rgb(255, 255, 206);" valign="middle" id = "tab_mensagem" align="center" width="100%" cellspacing = 0 cellpadding = 1>
											<tr><td height="10px" width=100% ></td></tr>
											<tr><td height=15px width=100% ><span class=tcampo id="mensagem"> &nbsp; </span></td></tr>
											<tr><td height="10px" width=100% ></td></tr>
										</table>
										
										<table valign="middle" id = "tab_botoes" align="center" width="100%" cellspacing = 0 cellpadding = 1 class=tcampo>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
											<tr>												
												<td width=50% align="right" >
													<input type="button" id="sok" name="sok" value="Ok" ondblclick="return false;" onClick="submitFormulario();" class="button">&nbsp;&nbsp;&nbsp;
													<input type="hidden" id="vok" name="vok" value="">
												</td>
												<td width=50% align="left" >
													&nbsp;&nbsp;&nbsp;<input type="button" id="btcancela" value="Cancelar" name="btcancela" ondblclick="return false;" onClick="cancelFormulario();" class="button">
													<input type="hidden" id="cancela" name="cancela" value="">
												</td>
											</tr>							
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>
											<tr><td width=50% >&nbsp;</td><td width=50% >&nbsp;</td></tr>									
											
										</table>
									</center>
								</div>
							</td>
						</tr>
					</table>
				</center>
			</div>
		</form>
	</div>
	
<div id="divAguardePassagem" name="divAguardePassagem" style="display:none; width:100%; height:100px; margin-top:-85px; margin-right:55px; text-align:center;" align="center" >
        <form>
        <table class="tableForm" style="text-align:center; background-color:rgb(255, 255, 206); width: 250px;">
                    <tr>
                            <td colspan="2" id = "msgAguardePassagem">
                                    <font style="font-family: Arial, Verdana, sans-serif; font-size:11pt;">Aguarde a passagem do cartão</font>
                            </td>
                    </tr>
            </table>        
    </form>
</div>
<div id="divAguardeSenha" name="divAguardeSenha" style="display:none; width:100%; height:100px; margin-top:-85px; margin-right:55px; text-align:center;" align="center" >
        <form>
        <table class="tableForm" style="text-align:center; background-color:rgb(255, 255, 206); width: 250px;">
                    <tr>
                            <td colspan="2" id = "msgAguardeSenha">
                                    <font style="font-family: Arial, Verdana, sans-serif; font-size:11pt;">Aguarde a digitação da senha</font>
                            </td>
                    </tr>
            </table>        
    </form>
</div>	
</body>
</html>