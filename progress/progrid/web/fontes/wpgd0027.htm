<!-- Generated by WebSpeed - http://www.webspeed.com/ 

Alterações: 20/01/2012 - Não mostrar validação para PAC, cuja seleção foi 
                         encerrada sem evento (integração) selecionado 
                         (Isara - RKAM)
                         
            23/01/2012 - Permitir "Liberar para a Agenda" o PAC, cuja seleção 
                         foi encerrada sem evento (integração) selecionado
                         (Isara - RKAM)
                         
            24/01/2012 - Inclusão do campo aux_resposta para armazenar o retorno 
                         da mensagem e enviar para o wpgd0027.w
                         (Isara - RKAM)
                         
            15/02/2012 - Não permitir adicionar eventos se o status da agenda for
                         igual a 1 (Isara - RKAM)
                         
            08/01/2013 - Correção function Salvar() para permitir liberar apenas
                         um evento (Daniel - CECRED).
                         
            12/11/2015 - Adicionado coluna "Tema" e novo botão para selecionar todos 
                         os eventos. Projeto 229 - Melhorias OQS (Lombardi).
            
            03/06/2016 - Ajustes para exibir mensagem aguardo corretamente
                         Projeto 229 - Melhorias OQS (Odirlei-AMcom).            
                         
-->

<html>
<head>

<link href="/cecred/css/estilo2.css" rel="stylesheet" type="text/css">
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="/cecred/css/base/jquery.ui.all.css">

<script type="text/javascript" src="/cecred/scripts/scripts.js"></script>	
<script type="text/javascript" src="/cecred/scripts/jquery.js"></script>
<script type="text/javascript" src="/cecred/scripts/jquery.ui.core.js"></script>
<script type="text/javascript" src="/cecred/scripts/jquery.ui.datepicker.js"></script>
<script type="text/javascript" src="/cecred/scripts/funcoes.js"></script>
<script src="/cecred/js/funcoes.js"></script>

<meta name="AUTHOR" content="Solusoft/Bt - wpgd0027 - C.18">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="wsoptions" content="no-output">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta http-equiv="Cache-Control" content="No-Cache">
<meta http-equiv="Pragma"        content="No-Cache">
<meta http-equiv="Expires"       content="0">
<title>Confirmação dos Eventos</title>
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
<!--script SRC="/cecred/jsbiblio/sorttable.js"></script-->
</head>
<body style="margin-left: 3px; ">
  <div id="divAguardo"></div>
  <div id="divError"></div>
  <div id="divConfirm"></div>
  <div id="divBloqueio"></div>
  <div id="divF2"></div>
  <div id="divUsoGenerico"></div>
  <iframe src="' + UrlSite + 'blank.php" id="iframeBloqueio"></iframe>
  
<script language="JavaScript">
  function aguarde(){
  
    if (document.form.aux_cdagenci.value == '' ||
        document.form.aux_dtanoage.value == '' ) {    
      return false;
    } 
    
    // abre a janela com a mesagem de aguarde    
    showMsgAguardo("Carregando Dados...");
  }  
    
  showMsgAguardo("Carregando Dados...");
  
  NomeDoProgramaPrincipal  = '/wpgd0027.w';
  NomeDoProgramaDeListagem = '/wpgd0027ls.w';
  NomeDoProgramaDeAjuda    = '/wpgd0027aj.w';
</script>

<form action="#." method="POST" name="form" width="975">
        
    <input type="hidden" name="aux_dsendurl" value="">
    <input type="hidden" name="aux_idevento" value="">
    <input type="hidden" name="aux_cddopcao" value="">
    <input type="hidden" name="aux_nrdrowid" value="">
    <input type="hidden" name="aux_lspermis" value="">
    <input type="hidden" name="aux_dsretorn" value="">
    <input type="hidden" name="aux_stdopcao" value="">  
    <input type="hidden" name="cdevento" 	   value="">
    <input type="hidden" name="cdagenci"     value="">
    <input type="hidden" name="aux_cdcopope" value="">  
    <input type="hidden" name="aux_cdoperad" value="">
    <input type="hidden" name="dtanoage"     value="">
    <input type="hidden" name="aux_lsevesel" value="">
    <input type="hidden" name="aux_lsagesel" value="">
    <input type="hidden" name="aux_lstqesel" value="">
    <input type="hidden" name="aux_lsconsel" value=""> 
    <input type="hidden" name="aux_resposta" value="">    
    <input type="hidden" name="aux_dsurlphp" value="">    
  
  <!-- Inicio do modelo com abas -->
  <div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 25px; top: 2px; visibility: ;"><img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom">        </div>
  <table width="975" height="460"  border="0" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
          <tr>
            <td height="20" colspan="5"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
                  <td width="5%"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
                  <td width="5%"><img src="/cecred/images/geral/spacer.gif" width="48" height="10"></td>
                  <td width="43%" height="20" class="linkGuia"><div align="left">Confirma&ccedil;&atilde;o dos Eventos</div> </td>
                  <td width="43%" class="linkGuia"><div align="right">wpgd0027</div></td>
                  <td width="4%" align="right" valign="middle" class="linkGuia"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
          </tr>
        </table></td>
    </tr>
          <tr valign="top" bgcolor="#FFFFFF">
                  <td colspan="5">
                          <table width="100%" height="100%"  border="0" align="left" cellpadding="0" cellspacing="1" bgcolor="#999999">
                                  <tr>
                                          <td height="200" valign="top" bgcolor="#FFFFFF">
                                                  <table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
                                                          <tr>
                                                                  <td height="15" rowspan="3" align="left">&nbsp;</td>
                                                                  <td height="20"  align="left" valign="top">
<!-- Interrupcao do modelo - início das abas -->
                                                                          <table width="99%"  border="0" align="center" cellspacing="1">
                                                                                  <tr align="left">
                                                                                    <td colspan="7" class="NomeCampo"><img src="/cecred/images/geral/spacer.gif" width="48" height="10"></td>
                                                                            </tr>
                                                                                  <tr>
                                                                                          <td width="10%" align="right" class="NomeCampo"> Agenda: </td>
                                                                                          <td width="9%" class="NomeCampo">
                                                                                                  <input id="aux_dtanoage" name="aux_dtanoage" class="Campo" type="text" size="4" onChange="aguarde();RecarregaConsulta();">
                                                                                          </td>
                                                                                          <td width="19%" align="right" class="NomeCampo"> Cooperativa: </td>
                                                                                          <td width="13%" class="NomeCampo">
                                                                                                  <select name="aux_cdcooper" class="Campo" id="cdcooper" onChange="aguarde();document.form.aux_dtanoage.value = ''; document.form.aux_cddopcao.value=''; document.form.aux_cdagenci.value=''; document.form.submit();">
                                                                                                  </select>
                                                                                          </td>
                                                                                          <td width="9%" class="NomeCampo"><div class="NomeCampo" align="right">PA:</div></td>
                                                                                          <td width="30%" class="NomeCampo">
                                                                                                  <select name="aux_cdagenci" class="Campo" id="aux_cdagenci" onChange="aguarde();document.form.cdagenci.value = document.form.aux_cdagenci.value; document.form.submit();"></select>
                                                                                          </td>                                                                                                        
                                                                                          <td width="22%" class="NomeCampo"><div align="right"><a href="#." onclick="adEvento();">Adicionar<br>Eventos</a>&nbsp;</div></td>                                                                                                                                                                                    
                                                                                  </tr>
                                                                                  <tr>
                                                                                          <td align="right" class="NomeCampo">Verba destinada: </td>
                                                                                          <td class="NomeCampo"><input name="aux_vlprogri" type="text" disabled="true" class="CampoNumerico" id="aux_vlprogri" size="8" readonly></td>
                                                                                          <td align="right" class="NomeCampo">Custo estimado: </td>
                                                                                          <td class="NomeCampo"><input name="aux_vlcuseve" type="text" disabled="true" class="CampoNumerico" id="aux_vlcuseve" size="8" readonly></td>
                                                                                          <td class="NomeCampo"><div class="NomeCampo" align="right">Saldo:</div></td>
                                                                                          <td colspan="3" class="NomeCampo"><input name="aux_salcusto" type="text" class="CampoNumerico" id="aux_salcusto" size="8" readonly></td>
                                                                                  </tr>
                                                                                  <tr>
                                                                                          <td align="right" class="NomeCampo" nowrap>Qtde Integrações: </td>
                                                                                          <td width="13%" align="right" class="NomeCampo"><div align="left">
                                                                                          <input name="aux_qtintegr" type="text" disabled="true" class="CampoNumerico" size="8" readonly>
                                                                                          </div></td>
                                                                                          <td class="NomeCampo" nowrap><div class="NomeCampo" align="right">Valor Integrações: </div></td>
                                                                                          <td width="9%" class="NomeCampo"><input name="aux_vlintegr" type="text" disabled="true" class="CampoNumerico" size="8" readonly></td>
                                                                                  </tr>
                                                                           </table>
                                                                    <!-- Fim dos dados do programa - retorno ao modelo -->
                                                                  </td>
                                                          </tr>
                                                          <tr>
                                                            <td height="8"  align="left" valign="top">
                                                                
                                                                                <div id="divVerba" align="left">
                                                                                  <table width="100%" border="0" align="center">
                                                                                          <tr>
                                                                                                  <td>
                                                                                                                  <table width="100%" border="0" cellpadding="0" cellspacing="0" class="dataTable">
                                                                                                                          <tr>
                                                                                                                                  <td id="separador1" width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col1" width="100" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">PA</td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col2" width="70" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Qtde Eventos</td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col3" width="170" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Evento</td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col4" width="150" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Tema</td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col5" width="150" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"> Eixo tem&aacute;tico </td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col6" width="70" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Carga horária</td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col7" width="70" height="25" align="right" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Custo</td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col8" width="55" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Confirmado&nbsp;&nbsp;</td>
                                                                                                                                  <td id="tbevento_col9" width="15" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg">
                                                                                                                                    <input id="cbSelecTodos" type="checkbox" name="cbSelecTodos" onclick="SelecionaTodos();">
                                                                                                                                  </td>
                                                                                                                                  <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                                                                                                                  <td id="tbevento_col10" width="15" height="25" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">&nbsp;</td>
                                                                                                                          </tr>
                                                                                                    </table>      
                                                                                                  </td>
                                                                                          </tr>
                                                                                          <tr>
                                                                                                  <td>
                                                                                                          <div style="overflow: auto; height:'350';">
                                                                                                                  <table id="tbevento" width="100%" border="0" cellspacing="0" cellpadding="0" class="dataTable">
                                                                                                                          <!-- INCLUI DADOS -->
                                                                                                                          <tbody></tbody>
                                                                                                                  </table>      
                                                                                                          </div>
                                                                                                  </td>
                                                                                          </tr>
                                                                                  </table>
                                                                          </div>
                                                                
                                                                </td>
                                                    </tr>
                                                          <tr>
                                                            <td height="10"  align="left" valign="bottom">
                                                                <table width="175" align="center">
                                                                  <tr>
                                                                        <td align="center"><img src="/cecred/images/botoes/btn_liberar_para_agenda.gif" style="cursor:hand" onClick="Salvar()" name="btn_libera"></td>
                                                                  </tr>
                                                            </table>
                                                                </td>
                                                    </tr>
                                            </table>
                                          </td>
                                  </tr>
                    </table>
                  </td>
          </tr>
  </table>
  <!-- fim do modelo -->
  
</form>

<script language="JavaScript">
NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
document.form.action = NomeDoProgramaPrincipal;

var itemselec = false;
var UrlSite     = parent.window.location.href.substr(0,parent.window.location.href.lastIndexOf("/") + 1); // Url do site
var UrlImagens	= UrlSite + "imagens/"; // Url para imagens

function mostraEventos(){
  var row;var cell;
  var liberar = true;
  var cor='#F7F7F7';
  var status = false;
 
  document.form.aux_vlcuseve.value = 0;
  document.form.aux_vlprogri.value = 0;
  document.form.aux_salcusto.value = 0;

  // Apaga todas as linhas, menos a do cabeçalho
  for (var i=document.all.tbevento.rows.length; i>0; i--)
      document.all.tbevento.deleteRow(i-1); 
      
  var aux_disabled = "";
  var mevento_length = mevento.length;
  for(i=0;i<mevento_length;i++){   //aguarde();
    if (cor == '#FFFFFF')
      cor = '#F7F7F7';
    else
      cor = '#FFFFFF';

    // Valor de Verba do PAC
    //document.form.aux_vlprogri.value = mevento[i].vlverbap;
    
    if(aux_disabled == "")
      aux_disabled = 'disabled="disabled"';
    else
      aux_disabled = '';
    
    var linha =  '<tr id="' + i + '" bgColor="' + cor + '">' +
                   '<in' + 'put type="hidden" value="' + (mevento[i].ctevento == 2 ? 'integracao' : (mevento[i].flgevobr ? 'obrigatorio' : 'evento')) + '" name="aux_tpevento">' +
                   '<td class=txtNormal height=30 width=5 align=left></td>' +
    // PA
                   '<td class="txtPequeno" height="30" width="90" align="left">' + 
                      mevento[i].nmresage + 
                     '<in' + 'put type="hidden" value="' + mevento[i].cdagenci + '" name="aux_agencsel">' +
                   '</td>' +
                   '<td class="txtNormal" height="30" width="5" align="left"></td>' +
    // Quantidade de eventos
                   '<td class="txtPequeno" height="30" width="70" align=center>' +
                     '<in' + 'put type="text" size="2"  style="margin-right:5px" class="Campo qtocoeve" maxlength="5" id="aux_qtocoeve" name="aux_qtocoeve" value="' + ConverteDec(mevento[i].qtocoeve, "1") + '" onkeyup="AtualizaSaldo();atribuiQtdEventos(this.value, '+ i +')" ' + (mevento[i].ctevento == '2' && mevento[i].idstagen == 2 ?  '' : mevento[i].flgevobr ) + '>' +
                     '<in' + 'put type="hidden" size="3"  maxlength="5" id="qtocoeve' + i +'" value="' + ConverteDec(mevento[i].qtocoeve, "1") + '"><img src="/cecred/images/btn_calendario.gif" style="cursor:hand;margin-right:5px" width="15" height="15" onclick="cadastraQtdEventos(' + ConverteDec(mevento[i].qtocoeve, "1") + ','+mevento[i].cdevento+','+ i +','+mevento[i].ctevento +',\''+ mevento[i].flgtdpac+'\')">' +
                   '</td>' +
                   '<td class="txtNormal" height="30" width="5" align="left"></td>' +
    //Evento
                   '<td class="txtPequeno" height="30" width="170" align="left">' +
                      mevento[i].nmevento +
                     '<in' + 'put type="hidden" value="' + mevento[i].cdevento + '" name="aux_cdevento">' +
                   '</td>' +
                   '<td class="txtNormal" height="30" width="5" align="left"></td>' +
    //Tema
                   '<td class="txtPequeno" height="30" width="140" align="left">' + mevento[i].dstemeix + '</td>' +
                   '<td class="txtNormal" height="30" width="5" align="left"></td>' +
    //Eixo Tematico
                   '<td class="txtPequeno" height="30" width="135" align="left">' + mevento[i].dseixtem + '</td>' +
                   '<td class="txtNormal" height="30" width="5" align="left"></td>' +
    //Carga Horaria
                   '<td class="txtPequeno" height="30" width="65" align="right" textAlign="right">' + mevento[i].qtcarhor + '</td>' +
                   '<td class="txtNormal" height="30" width="5" align="left"></td>' +
    //Custo
                   '<td class="txtPequeno" height="30" width="70" align="right" textAlign="right">' +
                     mevento[i].vlcuseve +
                     '<in' + 'put type=hidden value="' + ConverteDec(mevento[i].vlcuseve, "1") + '" name=aux_vlcusevi>' +
                   '</td>' +
                   '<td class="txtNormal" height="30" width="5" align="left"></td>' +
    // Flag de Selecionado
                   '<td class="txtPequeno" title="" height="30" width=55 align="center">' +
                     '<in' + 'put type="checkbox" name="aux_flgselec"  class="' + (mevento[i].ctevento != '2' ? 'evento' : 'integracao') + '" onclick="AtualizaSaldo();" ' + mevento[i].flgevsel + ' ' + mevento[i].flgevobr + '>' +
                   '</td>' +
                   '<td class="txtNormal" height="30" width="15" align="left"></td>' +
                   '<td class="txtPequeno" height="30" width="5" align="left"></td>' +
                   '<td class="txtNormal" height="30" width="15" align="left"></td>' +
                 '</tr>';
    $('tbody','#tbevento').append(linha);
    
    //document.form.aux_vlcuseve.value = parseFloat(document.form.aux_vlcuseve.value) + parseFloat(ConverteDec(mevento[i].vlcuseve, "1"));

    
    if (mevento[i].idstagen > 1)
            status = true;
            
    // se ja foram enviados os eventos, desabilita o botão de envio
    if (mevento[i].idstagen < 3)
        liberar = false;
  }
  
  hideMsgAguardo();
  
  // se ja foram enviados os eventos, desabilita o botão de envio
  if (liberar){
    document.form.btn_libera.style.filter='progid:DXImageTransform.Microsoft.BasicImage(opacity=0.2)';
    document.form.btn_libera.style.cursor='default';
    document.form.btn_libera.disabled=true;
  }
  else{
    document.form.btn_libera.style.filter='';
    document.form.btn_libera.style.cursor='hand';
    document.form.btn_libera.disabled=false;
  }
  
  //document.form.aux_salcusto.value = parseFloat(document.form.aux_vlprogri.value) - parseFloat(document.form.aux_vlcuseve.value);

  /* Não mostrar validação para PAC, cuja seleção foi encerrada sem evento (integração) selecionado */
  
  for(i=0;i<mevento.length;i++){
      if (mevento[i].idstagen > 1)
              status = true;
  }
  
  if((document.all.tbevento.rows.length > 0) || (status == true))
      AtualizaSaldo();
  else
    if (document.form.aux_cdagenci.value != '') 
      alert("A seleção dos eventos ainda não foi concluída pelo PA.\nAguarde sua conclusão para prosseguir com a confirmação.");

  // faz com que a janela de aguarde feche
  //window.focus();
  window.close();
}

function CarregaPrincipal () {
   //top.topFrame.document.all.titulo.innerHTML = 'Distribuição de Verbas - ' + document.form.aux_idevento.value;
   //jan3 = open('wpgd0027a.htm','fraux');
   jan3 = open('wpgd0027b.htm','fraux');
   window.status = "";
}

function LimparCampos() {}
function Habilita() {}
function HabilitaSalvar() {}

function ValidaDados(form)
    { 
       var msg="";
         
       /*  msg = msg + top.frcod.VE("ca",form.nmfornec,"O campo de nome do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.dsendfor,"O campo de endereço do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.nmcidfor,"O campo de cidade do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.nmbaifor,"O campo de bairro do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.nrcepfor,"O campo de CEP do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.cdufforn,"O campo de UF do Fornecedor","nao");
        msg = msg + top.frcod.VE("in",form.nrfonfor,"O telefone do Fornecedor","sim", "0", "99999999");
        msg = msg + top.frcod.VE("in",form.nrfaxfor,"O FAX do Fornecedor","sim", "0", "99999999");
        msg = msg + top.frcod.VE("in",form.cddddfor,"O DDD do telefone do Fornecedor","sim", "0", "99999999");
        msg = msg + top.frcod.VE("in",form.cddddfax,"O DDD do FAX do Fornecedor","sim", "0", "99999999");
*/
         
        if (msg == "")
            return true
        else
        {
           top.frcod.MostraResultado('1',msg);
           return false
        }
    }

function Recarrega()
{
   document.form.submit();
}

function RecarregaConsulta()
{
    if (document.form.aux_cdagenci.value != '' ||
        document.form.aux_dtanoage.value != '' ) {          
        document.form.submit();
    }
}

// Guardar os valores da tabela para que sejam salvos no banco de dados
function ArmazenaValores()
{
   document.form.aux_lsevesel.value = '';
   document.form.aux_lsconsel.value = '';
   document.form.aux_lsagesel.value = '';
   document.form.aux_lstqesel.value = '';

   if ((document.all.tbevento.rows.length == 0) && (itemselec == false))
       return false;    

   if ((parseFloat(document.form.aux_salcusto.value) < 0)&&(!confirm("A soma do custo dos eventos dos PAs está superior à verba destinada aos PAs. O saldo atual é de " + document.form.aux_salcusto.value + ". Deseja prosseguir com a confirmação?"))) 
      return false;
   
   // Se tem mais de um PAC
   if(document.all.tbevento.rows.length > 1)
   {
      for(i=0;i<document.form.aux_cdevento.length;i++) {
        // Grava os valores em forma de lista, separados por ";", para que seja lido pelo progress
        if (document.form.aux_lsevesel.value == '') 
        {
           document.form.aux_lsevesel.value = document.form.aux_cdevento[i].value;
           document.form.aux_lsconsel.value = (document.form.aux_flgselec[i].checked ? '1' : '0');
           document.form.aux_lsagesel.value = document.form.aux_agencsel[i].value;
           document.form.aux_lstqesel.value = document.form.aux_qtocoeve[i].value;
        }
        else
        {
           document.form.aux_lsevesel.value = document.form.aux_lsevesel.value + ';'
                                            + document.form.aux_cdevento[i].value;
           document.form.aux_lsconsel.value = document.form.aux_lsconsel.value + ";"
                                            + (document.form.aux_flgselec[i].checked ? '1' : '0');
           document.form.aux_lsagesel.value = document.form.aux_lsagesel.value + ';'
                                            + document.form.aux_agencsel[i].value;
          document.form.aux_lstqesel.value = document.form.aux_lstqesel.value + ";"
                                             + document.form.aux_qtocoeve[i].value;
        }
      }
    }
    else
    {            
       if (itemselec == false && !document.form.aux_flgselec.disabled) {
          document.form.aux_lsevesel.value = document.form.aux_cdevento.value;
          document.form.aux_lsconsel.value = document.form.aux_flgselec.checked ? '1' : '0';
          document.form.aux_lsagesel.value = document.form.aux_agencsel.value;
          document.form.aux_lstqesel.value = document.form.aux_qtocoeve.value;
       }
    }
   return true;
}

function Salvar()
{   
   /* Permitir "Liberar para a Agenda" o PA, cuja seleção foi encerrada sem evento (integração) selecionado */
   for(i=0;i<mevento.length;i++){
       itemselec = true;
   }
       
   //ZeraModoExclusao();
   if ((document.all.tbevento.rows.length < 1) && (itemselec == false)) {
      return false;
   }
   
   document.form.aux_stdopcao.value = 'al';
   var vaux = document.form.aux_lspermis.value;      
   
   if ((vaux.substring(1,2) == 'A') || (document.form.aux_stdopcao.value == 'i')) {              
        if ( document.form.aux_cddopcao.value!='sa')  {                    
           /*if (ValidaDados(document.forms[0])) {*/                    
               //Habilita(); 
               //HabilitaSalvar(); 
               if (!ArmazenaValores())
                   return false;
               if ((document.all.tbevento.rows.length >= 1) && itemselec) {
                  if (!ConfirmaLiberacao())
                     return false;
                  document.form.aux_cddopcao.value='sa';
                  aguarde();
                  status = 'Salvando. Por favor, aguarde ...';
                  document.form.submit();
                  return true;         
               }
          /*  } 
            else { 
              return false;
            }  */
        } 
   }
   else { 
         alert('Desculpe, mas você não tem permissão para executar esta função.'); 
         return false;
   }
}

// Converte um valor com decimal separado por "," para separado por "."
function ConverteDec(str, tipo)
{
   if(tipo == "1")
   {
      str = str.replace(".","");
      str = str.replace(",",".");
      return str;
   }
   else
   {
      str = str.replace(",","");
      str = str.replace(".",",");
      return str;
   }
}

function AtualizaSaldo()
{
   var aux_custo = 0;
   var aux_total = 0;
   var aux_saldo = 0;
   
   var aux_vlintegr = 0;
   var aux_qtintegr = 0;
   
   // Valor total é convertido para formato JavaScript
   document.form.aux_vlprogri.value = ConverteDec(document.form.aux_vlprogri.value,"1");

   // Total é gravado em sua variável
   aux_total = parseFloat(document.form.aux_vlprogri.value);
   
   if(document.form.aux_flgselec.length > 1)
   {
     for(i=0;i<document.all.tbevento.rows.length; i++)
     {
       //desabilita selecao caso a quantidade de eventos seja '0'
       if(document.form.aux_qtocoeve[i].value < 1)
       {
         document.form.aux_flgselec[i].checked = false;
         document.form.aux_flgselec[i].disabled = true;
       }
       else
       {
         document.form.aux_flgselec[i].disabled = (document.form.aux_tpevento[i].value != 'evento' ? true : false);
         document.form.aux_flgselec[i].checked = (document.form.aux_tpevento[i].value != 'evento' ? true : document.form.aux_flgselec[i].checked);
       }
       
       if(document.form.aux_flgselec[i].checked)
       {
         if(document.form.aux_flgselec[i].className == 'evento')
         {
           // Soma todos os custos que estiverem com a flag de seleção marcada
           aux_custo = aux_custo + parseFloat(document.form.aux_vlcusevi[i].value * document.form.aux_qtocoeve[i].value);
         }
         else
         {
           aux_vlintegr = aux_vlintegr + parseFloat(document.form.aux_vlcusevi[i].value * document.form.aux_qtocoeve[i].value);
           aux_qtintegr = aux_qtintegr + document.form.aux_qtocoeve[i].value;
         }
       }
     }
   }
   else
   {
     //desabilita selecao caso a quantidade de eventos seja '0'
     if(document.form.aux_qtocoeve.value < 1)
     {
       document.form.aux_flgselec.checked = false;
       document.form.aux_flgselec.disabled = true;
     }
     else
     {
       document.form.aux_flgselec.disabled = (document.form.aux_tpevento.value != 'evento' ? true : false);
       document.form.aux_flgselec.checked = (document.form.aux_tpevento.value != 'evento' ? true : document.form.aux_flgselec.checked);
     }
     
     if(document.form.aux_flgselec.checked)
     {
       if(document.form.aux_flgselec.className == 'evento')
       {
         // Soma todos os custos que estiverem com a flag de seleção marcada
         aux_custo = aux_custo + parseFloat(document.form.aux_vlcusevi.value * document.form.aux_qtocoeve.value, "1");
       }
       else
       {
         aux_vlintegr = aux_vlintegr + parseFloat(document.form.aux_vlcusevi.value * document.form.aux_qtocoeve.value, "1");
         aux_qtintegr = aux_qtintegr + document.form.aux_qtocoeve.value;
       }
     }
   }
   
   document.form.aux_qtintegr.value = aux_qtintegr;
   document.form.aux_vlintegr.value = formatCurrency(aux_vlintegr);
   
   // Variável de saldo recebe o total menos a soma dos custos
   aux_saldo = aux_total - aux_custo - parseFloat(ConverteDec(document.form.aux_vlintegr.value,"1"));

   // Se saldo < 0, exibe em vermelho
   if (aux_saldo < 0){
      document.form.aux_salcusto.style.color = 'red';          
   }
   else{
      document.form.aux_salcusto.style.color = '';
   }
   // Converte as varíaveis usando a função de conversão
   document.form.aux_vlcuseve.value = formatCurrency(aux_custo);
   document.form.aux_salcusto.value = formatCurrency(aux_saldo);
   document.form.aux_vlprogri.value = formatCurrency(aux_total);
}

function MostraPACs()
{
   
   for (var i=document.all.aux_cdagenci.options.length; i>=0; i--)
      document.all.aux_cdagenci.remove(i); 

   var oOption;
   
   for(i=0;i<mpac.length;i++)
   {
      if (mpac[i].cdcooper == document.form.aux_cdcooper.value)
      {
         oOption = document.createElement("OPTION");
         document.all.aux_cdagenci.options.add(oOption);
         oOption.innerText = mpac[i].nmresage.substring(0, 15);
         oOption.value = mpac[i].cdagenci;
      }
   }
   
   oOption = document.createElement("OPTION");
   document.all.aux_cdagenci.options.add(oOption);
   oOption.innerText = 'TODOS';
   oOption.value = -1;
}

function PosicionaPAC()
{    
   
   showMsgAguardo("Carregando Dados...");
   if(document.form.cdagenci.value != "")
   {
      //document.form.aux_cdeixtem.value = document.form.cdeixtem.value;
      MostraPACs();
      document.form.aux_cdagenci.value = document.form.cdagenci.value;          
   }
   else
   {      
      // posiciona a seleção no primeiro registro de Cooperativas, se só tiver 1
      if(document.all.aux_cdcooper.options.length == 1)
         document.form.aux_cdcooper.value = document.all.aux_cdcooper.options[0].value;

      // posiciona a seleção no primeiro registro de PACs, se só tiver 1
      if(document.all.aux_cdagenci.options.length == 1)
         document.form.aux_cdagenci.value = document.all.aux_cdagenci.options[0].value;
   }

   document.form.aux_cddopcao.value='';
      
   mostraEventos();

   // faz com que a janela de aguarde feche
  // window.focus();
}

function adEvento(){

   if(mevento.length <= 0)
   {
          alert('Este PA não concluiu a Seleção dos Eventos! Impossível adicionar eventos!'); 
      return false;
   }

   // Verifica se o usuário tem permissão de inclusão
   if (document.form.aux_lspermis.value.substring(0,1) != 'I'){ 
      alert('Desculpe, mas você não tem permissão para executar esta função.'); 
      return false;
   }

   if (document.form.aux_cdagenci.value == '') {
      alert("PA deve ser selecionado");
   }
   else
   {                             
                VarURL = document.form.aux_dsendurl.value  + '/wpgd0027a.htm' +
                 '?aux_cdagenci=' + document.form.aux_cdagenci.value +
                 '&aux_cdcooper=' + document.form.aux_cdcooper.value +
                 '&aux_idevento=' + document.form.aux_idevento.value +
                 '&aux_salcusto=' + document.form.aux_salcusto.value +
                 '&aux_dtanoage=' + document.form.aux_dtanoage.value ;
                window.open(VarURL,'','toolbar=no,location=no,diretories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=500,height=350,top=10,left=10');
   }
}

// Traz as informações atualizadas do banco de dados
function Recarrega(){
   document.form.aux_cddopcao.value = "rec";
   document.form.submit();
}

//formatação dos campos
function formatCurrency(num) 
{
   num = num.toString().replace(/\$|\,/g,'');
   if(isNaN(num))
      num = "0";
   sign = (num == (num = Math.abs(num)));
   num = Math.floor(num*100+0.50000000001);
   cents = num%100;
   num = Math.floor(num/100).toString();
   if(cents<10)
      cents = "0" + cents;
   for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
      num = num.substring(0,num.length-(4*i+3))+'.'+
   num.substring(num.length-(4*i+3));
   return (((sign)?'':'-') + num + ',' + cents);
}

function ConfirmaLiberacao()
{
    document.form.aux_resposta.value = 0;
    if(document.form.aux_lsevesel.value == "")
       if(!confirm("Não há eventos selecionados pelo PA. Deseja prosseguir com a liberação?"))
         return false;
    if(document.all.tbevento.rows.length > 1)
    {
      for(i = 0 ; i < document.all.tbevento.rows.length; i++)
        if (document.form.aux_tpevento[i].value != 'evento' && !document.form.aux_flgselec[i].checked)
        {
           alert("Eventos obrigatórios devem ter pelo menos uma sugestão de data cadastrada.");
           return false;
        }
    }
    else
        if (document.form.aux_tpevento.value != 'evento' && !document.form.aux_flgselec.checked)
        {
           alert("Eventos obrigatórios devem ter pelo menos uma sugestão de data cadastrada.");
           return false;
        }
    return true;
}

function SelecionaTodos () {
    if (document.form.cbSelecTodos.checked) {
        for (i = 0; i < document.getElementsByName('aux_flgselec').length; i++)
            if (!document.getElementsByName('aux_flgselec')[i].disabled)
                document.getElementsByName('aux_flgselec')[i].checked = true;
    }
    else {
        for (i = 0; i < document.getElementsByName('aux_flgselec').length; i++)
            if (!document.getElementsByName('aux_flgselec')[i].disabled)
                document.getElementsByName('aux_flgselec')[i].checked = false;
    }
    AtualizaSaldo();
}

// valida os parâmetros da agenda
if(document.form.aux_dtanoage.value == ''){
   alert('Parâmetro da Agenda Não Encontrado!!!');
   
   document.form.aux_dtanoage.value = '';
   document.form.aux_cdagenci.value = '';
   document.form.aux_cdcooper.value = '';
   
}
else
   MostraPACs();


function atribuiQtdEventos(quantidade,i){ 
 $("#qtocoeve"+i).val(quantidade) ;
} 

function cadastraQtdEventos(quantidade, cdevento,i,tpevento,flgtdpac){ 
	var arrCaminho = document.form.aux_dsurlphp.value.split('-');
	
	if (quantidade != $("#qtocoeve"+i).val()){ 
		quantidade =  $("#qtocoeve"+i).val();
	}
    
    /* Para os eventos que estao definidos para todos os pas
       nao pode permitir informar zero
    */
    if ( flgtdpac =='S' && quantidade <= 0){
      alert("Para este evento a quantidade de eventos deve ser maior que zero."); 
      return false;
    
    }
    
	if (quantidade > 0){ 
		VarURL = arrCaminho[0] +'/telas/wpgd0020/cadastra_qtdeventos.php?cdcooper='+document.form.aux_cdcopope.value +'&aux_cdcooper='+ document.form.aux_cdcooper.value+'&cdoperad='+ document.form.aux_cdoperad.value+'&idevento='+document.form.aux_idevento.value+'&cdevento='+cdevento+'&dtanoage='+document.form.aux_dtanoage.value +'&nmdatela=wpgd0020&tldatela=Sugestão de Datas&idcokses='+arrCaminho[1]+'&cdagenci='+ mevento[i].cdagenci+'&qtdeventos='+quantidade+'&tpevento='+tpevento+'&flgcusfe='+mevento[i].flgcusfe;
		window.open(VarURL,'','toolbar=no,location=no,diretories=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=815,height=530,top=10,left=10'); 
			
	}else{
		var exclui = confirm('Informações de datas já gravadas será excluída!');
		if (exclui == true) { 
		   document.form.aux_cddopcao.value = 'exe'; 
		   document.form.cdevento.value = cdevento;
		   status = 'Excluindo. Por favor, aguarde ...'; 
		   document.form.submit(); 
		   $("#qtocoeve"+i).val(quantidade);
		   return true;
		}
	}
}

//Valida botão Salvar
function ValidaSalvar() 
{    
  var itemselec = false;
	var arreixos = new Array();
	var valida = true	
        
	for(i=0;i<document.form.aux_flgselec.length;i++) {            
		if (document.form.aux_flgselec[i].checked == true) {                
			cdeixtem = document.form.cdeixtem[i].value ;
			if (arreixos[cdeixtem] == undefined){
				arreixos[cdeixtem] = parseInt(document.form.qttoteve[i].value,10);
			}else{
				arreixos[cdeixtem] = parseInt(arreixos[cdeixtem],10) +  parseInt(document.form.qttoteve[i].value,10);
			}
				
			itemselec = true;                                                                                      
			//break;
		}                                      
	}     
	for(i=0;i<meixos.length;i++){ 
		if (arreixos[meixos[i].cdeixtem] < meixos[i].qtmineve){
			alert("A quantidade de eventos selecionados por eixo é menor que a quantidade mínima de eventos cadastrada por eixo para " + meixos[i].dseixtem + ".");
		    return false;
		    break;	
		}
	 	
   }

					   
	if (itemselec == false) {
		alert("Nenhum evento selecionado para ser salvo.");
	}
	return true;
}


</script>
</body>
