<!-- 
Alterações:  27/02/2008 - Não permitir atualizações quando o mês da Data Final do
                                      evento já estiver Fechado, E usuário não possuir
                                                  permissão de acesso 'U' (Diego).
                                                - Melhoria de performance (alterada a paginacao, modo de
                                                  salvamento, lista de eventos) e inclusao da linha de
                                                  fim de listagem (Evandro).
                                                  
                          23/10/2012 - Incluso limitação no campo Faltas para 3 posições. (Daniel)
-->

<!-- Generated by WebSpeed - http://www.webspeed.com/ -->
<html>
<head>
<meta name="AUTHOR" content="Solusoft/Bt - wpgd0034 - C.18">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="wsoptions" content="no-output">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta http-equiv="Cache-Control" content="No-Cache">
<meta http-equiv="Pragma"        content="No-Cache">
<meta http-equiv="Expires"       content="0">
<title>Cadastro de Frequencia</title>
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
<!--script SRC="/cecred/jsbiblio/sorttable.js"></script-->
</head>
<body style="margin-left: 3px; ">

<script language="JavaScript">
   NomeDoProgramaPrincipal  = '/wpgd0034.w';
   NomeDoProgramaDeListagem = '/wpgd0034ls.w';
   NomeDoProgramaDeAjuda    = '/wpgd0034aj.w';
   NomeDoProgramaDeZoom     = '/zoom/zoei04.w';
</script>

<form action="#." method="POST" name="form">
    <input type="hidden" name="aux_dsendurl" value="">
    <input type="hidden" name="aux_idevento" value="">
    <input type="hidden" name="idevento"     value="">
    <input type="hidden" name="aux_cddopcao" value="">
    <input type="hidden" name="aux_nrdrowid" value="">
    <input type="hidden" name="aux_lspermis" value="">
    <input type="hidden" name="aux_dsretorn" value="">
    <input type="hidden" name="aux_stdopcao" value=""> 
    <input type="hidden" name="cdagenci"     value="">
    <input type="hidden" name="nrseqeve"     value="">         
    <input type="hidden" name="aux_lsevesel" value="">
    <input type="hidden" name="aux_lsconsel" value="">
        <input type="hidden" name="aux_contador" value="">
        <input type="hidden" name="aux_flgalter" value="no">
        
        <!-- Para o carregamento dos registros em partes -->
        <input type="hidden" name="aux_carregar" value="">
        <input type="hidden" name="aux_reginils" value="">
        <input type="hidden" name="aux_regfimls" value="">         
        
    <input type="hidden" name="aux_fechamen" value="">
  
  <!-- Inicio do modelo com abas -->

  <div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 25px; top: 2px; visibility: ;">
     <img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom">
  </div>
  <table width="575" height="360"  border="0" align="left" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
     <tr>
        <td height="20" colspan="5">
           <table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                 <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
                 <td width="56"><img src="/cecred/images/geral/spacer.gif" width="48" height="10"></td>
                 <td width="258" height="20" class="linkGuia">Cadastro de Frequ&ecirc;ncias </td>
                 <td width="257" class="linkGuia"><div align="right">wpgd0034</div></td>
                 <td width="11" align="right" valign="middle" class="linkGuia"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
              </tr>
           </table>
        </td>
     </tr>
     <tr valign="top" bgcolor="#FFFFFF">
        <td colspan="5">
           <table width="100%" height="100%"  border="0" align="left" cellpadding="0" cellspacing="1" bgcolor="#999999">
              <tr>
                 <td height="200" valign="top" bgcolor="#FFFFFF">
                    <table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
                       <tr>
                          <td height="15" rowspan="3" align="left">&nbsp;</td>
                          <td height="20"  align="left" valign="top">
<!-- Interrupcao do modelo - início das abas -->
                             <table width="99%"  border="0" align="center" cellspacing="1">
                                <tr align="left">
                                   <td colspan="7" class="NomeCampo"><img src="/cecred/images/geral/spacer.gif" width="48" height="10"></td>
                                </tr>
                                <tr>
                                   <td width="15%" align="right" class="NomeCampo"> Agenda: </td>
                                   <td width="7%" class="NomeCampo"><input name="aux_dtanoage" type="text" size="4" onChange="limpa_opcao();"></td>
                                   <td width="21%" align="right" class="NomeCampo"> Cooperativa: </td>
                                   <td width="15%" class="NomeCampo"><select name="aux_cdcooper" class="Campo" id="aux_cdcooper" onChange="document.form.aux_dtanoage.value=''; document.form.aux_cddopcao.value=''; document.form.aux_cdagenci.value=''; document.form.nrseqeve.value=''; document.form.aux_nrseqeve.value=''; document.form.submit();"></select></td>
                                   <td width="11%" class="NomeCampo"><div align="right">PA:</div></td>
                                   <td width="31%" class="NomeCampo"><select name="aux_cdagenci" class="Campo" id="aux_cdagenci" onChange="document.form.aux_cddopcao.value=''; document.form.cdagenci.value = document.form.aux_cdagenci.value; document.form.nrseqeve.value=''; document.form.aux_nrseqeve.value=''; document.form.aux_carregar.value=''; document.form.aux_contador.value='';document.form.submit();"></select></td>
                                </tr>
                                <tr>
                                   <td align="right" class="NomeCampo">Evento: </td>
                                   <td colspan="5" class="NomeCampo"><select name="aux_nrseqeve" class="NomeCampo" onChange="document.form.nrseqeve.value = document.form.aux_nrseqeve.value; document.form.aux_cddopcao.value=''; document.form.aux_carregar.value=''; document.form.aux_regfimls.value=''; document.form.aux_reginils.value=''; document.form.aux_contador.value='0'; document.form.submit();"></select> </td>
                                </tr>                                
                             </table>
<!-- Fim dos dados do programa - retorno ao modelo -->
                          </td>
                       </tr>
                       <tr>
                          <td height="8"  align="left" valign="top">
                             <div id="divVerba" align="left">
                                <table width="100%" border="0" align="center">
                                   <tr>
                                      <td colspan="3">
                                         <table width="100%" border="0" cellpadding="0" cellspacing="0" class="dataTable">
                                            <tr>
                                               <td id="separador1" width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                               <td id="tbinscritos_col1" width="30" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">N&ordm;</td>
                                               <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                               <td id="tbinscritos_col2" width="150" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"> Participante </td>
                                               <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                               <td id="tbinscritos_col3" width="70" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Conta</td>
                                               <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                               <td id="tbinscritos_col4" width="70" height="25" align="right" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Faltas</td>
                                               <td width="5" height="25" align="center" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                               <td id="tbinscritos_col6" width="15" height="25" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">&nbsp;</td>
                                            </tr>
                                         </table>      
                                      </td>
                                   </tr>
                                   <tr>
                                      <td colspan="3">
                                         <div style="overflow: auto; height:'180';">
                                            <table id="tbinscritos" width="100%" border="0" cellspacing="0" cellpadding="0" class="dataTable">
                                               <!-- INCLUI DADOS -->
                                            </table>      
                                         </div>
                                      </td>
                                   </tr>
                                   <tr>
                                                                      <td align="center" valign="bottom" scope="col" width="38">&nbsp;
                                                                          </td>                                                                   
                                      <td align="center" valign="bottom" scope="col">
                                         <img id="salva" style="cursor:hand" src="/cecred/images/botoes/btn_salvar.gif" width="60" height="20" onClick="document.form.aux_carregar.value='proximos'; document.form.aux_contador.value = minscri[minscri.length -1].numeroch; Salvar()">
                                      </td>
                                      <td align="right" valign="bottom" scope="col">
                                                                             <img id="anteriores" style="cursor:hand" src="/cecred/images/botoes/btn_anterior.gif" onClick="carrega_registros(this.id);" title="Anterior">
                                                                                 <img id="proximos" style="cursor:hand" src="/cecred/images/botoes/btn_posterior.gif"  onClick="carrega_registros(this.id);" title="Próximo">                                                         
                                                                          </td>
                                   </tr>
                                </table>
                             </div>
                          </td>
                       </tr>
<!--
                       <tr>
                          <td height="10"  align="left" valign="bottom">&nbsp;</td>
                       </tr>-->
                    </table>
                 </td>
              </tr>
           </table>
        </td>
     </tr>
  </table>
  <!-- fim do modelo -->
</form>

<script language="JavaScript">


NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
document.form.action = NomeDoProgramaPrincipal;


function CarregaPrincipal () 
   {
      //top.topFrame.document.all.titulo.innerHTML = 'Cadastro de Fornecedores - ' + document.form.aux_idevento.value;
      //jan2 = open('wpgd0009a.htm','fraux');
      window.status = "";
   } // function CarregaPrincipal () 

function Habilita()
   {
   } // function Habilita()

function HabilitaSalvar()
   {
   } // function HabilitaSalvar()

function LimparCampos()
   {
   } // function LimparCampos()

function Recarrega()
   {
      document.form.submit();
   } // function Recarrega()

function MostraPartic()
   {
      var row;
      var cell;
      var cor='#F7F7F7';

      for (var i=document.all.tbinscritos.rows.length; i>0; i--)
           document.all.tbinscritos.deleteRow(i-1); 
      
      for (i=0;i<minscri.length;i++)
          {
             if ((document.form.aux_cdcooper.value == minscri[i].cdcooper)    && 
                ((document.form.aux_cdagenci.value == minscri[i].cdageins) ||
                                  // Assembleia
                                 (document.form.aux_cdagenci.value == 0))                     &&
                 (document.form.aux_nrseqeve.value == minscri[i].nrseqeve))
                { 
                   row=tbinscritos.insertRow(); 
                   if (cor == '#FFFFFF')
                          cor = '#F7F7F7';
                      else
                          cor = '#FFFFFF';

                   row.bgColor = cor;

                   //Inscrito   Cooperado   Vínculo   Contato   Comentários   Confirmar   Data Confirmação   

                   cell=row.insertCell();   // Separador
                   cell.className = 'txtNormal';
                   cell.width= document.all.separador1.width;
                   cell.height = 26;
                   cell.align = 'left';
                   cell.innerText='';

                   // Numero
                   cell=row.insertCell();   
                   cell.className = 'txtPequeno';
                   cell.height = 26;
                   cell.align = 'left';
                   cell.width = document.all.tbinscritos_col1.width;
                   cell.innerText=minscri[i].numeroch; 

                   cell=row.insertCell();   // Separador
                   cell.className = 'txtNormal';
                   cell.width= document.all.separador1.width;
                   cell.height = 26;
                   cell.align = 'left';
                   cell.innerText='';
                   
                   // Nome do inscrito
                   cell=row.insertCell();   
                   cell.className = 'txtPequeno';
                   cell.height = 26;
                   cell.align = 'left';
                   cell.width = document.all.tbinscritos_col2.width;
                   cell.innerText=minscri[i].nminseve; 

                   cell=row.insertCell();   // Separador
                   cell.className = 'txtNormal';
                   cell.width= document.all.separador1.width;
                   cell.height = 26;
                   cell.align = 'left';
                   cell.innerText='';

                   // Conta
                   cell=row.insertCell();   
                   cell.className = 'txtPequeno';
                   cell.height = 26;
                   cell.align = 'left';
                   cell.width = document.all.tbinscritos_col3.width;
                   cell.innerText=minscri[i].nrdconta; 

                   cell=row.insertCell();   // Separador
                   cell.className = 'txtNormal';
                   cell.width= document.all.separador1.width;
                   cell.height = 26;
                   cell.align = 'left';
                   cell.innerText='';

                   // Faltas
                   cell=row.insertCell();   
                   cell.className = 'txtPequeno';
                   cell.height = 26;
                   cell.align = 'left';
                   cell.width = document.all.tbinscritos_col4.width;
                   linky='<in' + 'put type="text" name="qtfaleve' + minscri[i].numeroch + '" maxlength="3" size="3" class="Campo" onChange="document.form.aux_flgalter.value=' + "'yes'" + '" value="' + minscri[i].qtfaleve + '">';
                                   // Guarda o rowid do registro
                       linky=linky+
                                         '<in' + 'put type="hidden" name="nrdrowid' + minscri[i].numeroch + '" value="' + minscri[i].nrdrowid + '">';
                   cell.innerHTML=linky;
                                   
                                   // guarda o ROWID do 1º da lista e seu numero
                                   if(i==0){
                                      document.form.aux_reginils.value = minscri[i].nrdrowid;
                                   }
                  
                                     // guarda o ROWID do último da lista
                                   if(i==minscri.length -1)
                                             document.form.aux_regfimls.value = minscri[i].nrdrowid;
                } // if
          } // for
                  
      // linha de final da listagem se nao tiver 100 linhas
          if(document.all.tbinscritos.rows.length!='100'){
                row=tbinscritos.insertRow();
         if(cor == '#FFFFFF')
            cor = '#F7F7F7';
         else
            cor = '#FFFFFF';
         row.bgColor = cor;

         cell=row.insertCell();   
         cell.className = 'txtPequeno';
         cell.height = 26;
         cell.align = 'center';
         cell.width = '100%';
             cell.colSpan = 8;
             cell.innerText='Fim da listagem';
          }                  

   } // function MostraPartic()

function MostraPACs()
   {
        
      for (var i=document.all.aux_cdagenci.options.length; i>=0; i--)
          document.all.aux_cdagenci.remove(i); 

      var oOption;
   
      for (i=0;i<mpac.length;i++)
          {
             if (mpac[i].cdcooper == document.form.aux_cdcooper.value)
                {
                   oOption = document.createElement("OPTION");
                   document.all.aux_cdagenci.options.add(oOption);
                   oOption.innerText = mpac[i].nmresage.substring(0, 15);
                   oOption.value = mpac[i].cdagenci;
                }
          }
      document.form.aux_cdagenci.value = '';      
      
   } // function MostraPACs()

function PosicionaPAC(){

   // posiciona a cooperativa
   if (document.all.aux_cdcooper.options.length == 1)
       document.form.aux_cdcooper.value = document.all.aux_cdcooper.options[0].value;
 
   // posiciona o PAC
   if(document.form.cdagenci.value != '')
      document.form.aux_cdagenci.value = document.form.cdagenci.value;
   else
      document.form.aux_cdagenci.value = '';                         
}

function MostraEventos()
   {
      for (var i=document.all.aux_nrseqeve.options.length; i>=0; i--)
          document.all.aux_nrseqeve.remove(i); 

      var oOption;
      
      for (i=0;i<mevento.length;i++)
          {
                     // PROGRID
             if ((mevento[i].cdcooper == document.form.aux_cdcooper.value) &&
                             (mevento[i].cdagenci == document.form.aux_cdagenci.value) &&
                                 (mevento[i].cdagenci != 0))
                {
                   oOption = document.createElement("OPTION");
                   document.all.aux_nrseqeve.options.add(oOption);
                   oOption.innerText = mevento[i].nmevento;
                   oOption.value = mevento[i].nrseqeve;
                }
      
             // ASSMEBLEIA
             if ((mevento[i].cdcooper == document.form.aux_cdcooper.value) && (mevento[i].cdagenci == 0))
                {
                   oOption = document.createElement("OPTION");
                   document.all.aux_nrseqeve.options.add(oOption);
                   oOption.innerText = mevento[i].nmevento;
                   oOption.value = mevento[i].nrseqeve;
                }
          }
      document.form.aux_nrseqeve.value = '';
      if (document.form.aux_cdagenci.value == '') 
         {
            oOption = document.createElement("OPTION");
            document.all.aux_nrseqeve.options.add(oOption);
            oOption.innerText = "-Selecione PA-";
            oOption.value = '0';
            document.form.aux_nrseqeve.value = '0';
         }
      document.form.aux_nrseqeve.value = '';

      
      

   } // function MostraEventos()

function PosicionaEventos()
   {
      if (document.form.aux_stdopcao.value != "")
             {
                //document.form.aux_cdeixtem.value = document.form.cdeixtem.value;
                MostraEventos();
                document.form.aux_nrseqeve.value = document.form.aux_stdopcao.value;
                // MostraPartic();
             }
         else
             {
                // posiciona a seleção no primeiro registro de Eventos, se só tiver 1
               // if (document.all.aux_nrseqeve.options.length == 1)
                //       document.form.aux_nrseqeve.value = document.all.aux_nrseqeve.options[0].value;
                //   else
                       document.form.aux_nrseqeve.value = '';
                if (document.form.aux_cdagenci.value == "")
                   document.form.aux_nrseqeve.value = '';
             }
                         
                    /* Verifica se o evento selecionado encontra-se fechado */ 
      for(i=0;i<mevento.length;i++)
         {
           if (mevento[i].nrseqeve == document.form.aux_nrseqeve.value)
              {
                document.form.aux_fechamen.value = mevento[i].fechamen;
              }
             }

                                                  
   } // function PosicionaEventos()


function Salvar()
   {
      var vaux = document.form.aux_lspermis.value; 
      if ((vaux.substring(1,2) == 'A') || (document.form.aux_stdopcao.value == 'i')) 
             {
                document.form.aux_cddopcao.value='sa'; 
                document.form.aux_stdopcao.value = "";
                status = 'Salvando. Por favor, aguarde ...'; 
                document.form.submit();
             }
         else
             { 
                alert('Desculpe, mas você não tem permissão para executar esta função.'); 
                return false;
             }
   } // function salvar()
   
function carrega_registros(direcao){

   document.form.aux_cddopcao.value='';
   document.form.aux_stdopcao.value='';
   
   if(minscri.length==0){
      alert('Não há registros de inscrições!');
          return false;
   }
   
   if(direcao=="anteriores"){
      document.form.aux_contador.value = minscri[0].numeroch;
   }
   else{
      document.form.aux_contador.value = minscri[minscri.length -1].numeroch;
   }
   
   if(document.form.aux_flgalter.value=='yes') 
     {
       if((document.form.aux_lspermis.value.search('U') != '-1') ||
                  (document.form.aux_fechamen.value != 'Sim'))
                  {
            if (confirm("Há alterações nesta página, deseja salvá-las antes de continuar?")){
                           document.form.aux_cddopcao.value='sa'; 
                document.form.aux_stdopcao.value = "";
                        }
          }                
         }

   Habilita();
   document.form.aux_carregar.value = direcao;
   document.form.submit();
}

function limpa_opcao(){
   document.form.aux_cddopcao.value='';
   document.form.submit();
}
   
MostraPACs();
PosicionaPAC();

MostraEventos();
PosicionaEventos();

MostraPartic();

//document.form.aux_stdopcao.value = "";

if (document.form.aux_fechamen.value == 'Sim') 
   {           
         // Verifica se o usuário tem permissão 
     if (document.form.aux_lspermis.value.search('U') == '-1'){ 
               document.form.salva.style.filter='progid:DXImageTransform.Microsoft.BasicImage(opacity=0.2)';  
         document.form.salva.style.cursor='default';
         document.form.salva.disabled=true;
         }
   }

</script>
</body>
