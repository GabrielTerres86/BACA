<!--
  Alteraçoes: 29/08/2017 - Inclusao do filtro por Programa,Prj. 322 (Jean Michel).
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="wsoptions" content="no-output">
<title>Fechamentos</title>
<base target="mainFrame"> 
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
</head>
<body style="margin-left: 3px; ">
<form action="#." method="POST" name="form">
    <input name="idevento"     type="hidden" value="">
    <input name="cdeixtem"     type="hidden" value="">
    <input name="cdagenci"     type="hidden" value="">
    <input name="cdcooper"     type="hidden" value="">        
    <input name="aux_idevento" type="hidden" value="">                
    <input name="aux_cddopcao" type="hidden" id="aux_cddopcao"  value="">
    <input name="aux_lspermis" type="hidden" id="aux_lspermis"  value="">
    <input name="aux_nrdrowid" type="hidden" id="aux_nrdrowid"  value="">    
    <input name="aux_dsretorn" type="hidden" id="aux_dsretorn"  value="">    
    <input name="aux_stdopcao" type="hidden" id="aux_stdopcao"  value="">    
    <input name="aux_dsendurl" type="hidden" id="aux_dsendurl"  value="">    
    <input name="nrseqpgm" type="hidden" id="nrseqpgm"  value="">    
         
<!-- Início do modelo geral -->
<div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 25px; top: 2px; visibility: ;"><img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom"></div>
   <table width="575" height="360" border="0" align="left" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
      <tr>
         <td height="20" colspan="5">
            <table width="100%"  border="0" cellspacing="0" cellpadding="0">
               <tr>
                  <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
                  <td width="56"><img src="/cecred/images/geral/spacer.gif" width="10" height="10"></td>
                  <td width="406" height="20" align="left" class="linkGuia">Fechamentos</td>
                  <td width="91" height="20" align="right" class="linkGuia">wpgd0038</td>          
                  <td width="11" align="right"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
          </tr>
           </table>
         </td>
      </tr>
      <tr valign="top" bgcolor="#FFFFFF">
         <td colspan="5">
            <table width="100%" height="100%" border="0" align="left" cellpadding="0" cellspacing="0" bgcolor="#999999">
               <tr>
                  <td valign="top" bgcolor="#FFFFFF">
                     <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr>
                           <td align="center" valign="middle">
                             <!-- Interrupção do modelo geral, início dos dados específicos da tela -->
                              <table border="0" align="center" cellspacing="1" cellpadding="1">
                                 <tr>
                                    <td align="right" class="NomeCampo">Agenda:</td>
                                    <td><input type="text" name="aux_dtanoage" size="8" onChange="verifica_coop();"></td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo">Cooperativa:</td>
                                    <td><select name="aux_cdcooper" class="Campo" onChange="document.form.cdcooper.value = document.form.aux_cdcooper.value; document.form.aux_dtanoage.value = ''; document.form.submit();"></select></td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo">PA:</td>
                                             <td><select name="aux_cdagenci" class="Campo" id="aux_cdagenci" onChange="document.form.cdagenci.value = document.form.aux_cdagenci.value;document.form.submit()"></select></td>
                                 </tr>
                                 <tr>
                                      <td align="right" class="NomeCampo">Tipo de Evento:</td>
                                               <td><select name="aux_tpevento" class="Campo" id="aux_tpevento" onChange="document.form.submit();"></select></td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo" ><div id="divNrseqpgmLabel">Programa:</div></td>
                                    <td colspan="2"><div id="divNrseqpgm"><select name="aux_nrseqpgm" type="hidden" class="Campo" id="aux_nrseqpgm" onChange="document.form.nrseqpgm.value = document.form.aux_nrseqpgm.value; document.form.submit();"></select></div></td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo">Evento:</td>
                                    <td><select name="aux_cdevento" class="Campo" id="aux_cdevento"></select></td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo">Período:</td>  
                                    <td>
                                       <input type="text" name="dataInicial" size="10" maxlength="10" value="" class="Campo" id="dataInicial"> 
                                       a   
                                       <input type="text" name="dataFinal" size="10" maxlength="10" value="" class="Campo" id="dataFinal">
                                    </td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo">&nbsp;</td>
                                    <td class="NomeCampo"><input type="checkbox" name="consideraEventosForaDaAgenda" id="consideraEventosForaDaAgenda" value="ON">Considerar eventos sem data agendada</td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo">Tipo:</td>
                                    <td class="NomeCampo">Inscrições nos eventos por PA</td>
<!--                                <td><select name="tipoDeRelatorio" class="Campo" id="tipoDeRelatorio"></select></td>    -->
                                 </tr>
                              </table>
                             <!-- Fim dos dados específicos da tela, reinício do modelo geral -->
                           </td>
                        </tr>
                        <tr>
                           <td height="15" align="center" valign="bottom">
                              <table width="100%" border="0" cellpadding="1" cellspacing="1" align="center">
                                 <tr>
                                    <td align="center"><img style="cursor: hand;" src="/cecred/images/botoes/btn_visualizar_impressao.gif" alt="Procurar fechamentos para os dados informados" onClick="imprimir()"></td>
                                 </tr>
                              </table>
                           </td>
                        </tr>
                     </table>
                  </td>
               </tr>
           </table>
         </td>
      </tr>
   </table>
<!-- Fim do modelo geral -->
</form>
</body>
  <SCRIPT LANGUAGE="JAVASCRIPT">
    NomeDoProgramaPrincipal  = '/wpgd0038.w';
    NomeDoProgramaDeListagem = '/wpgd0007ls.w';
    NomeDoProgramaDeAjuda    = '/wpgd0007aj.w';

    NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
    document.form.action = NomeDoProgramaPrincipal;

    var aux_vazio = false;

    function Habilita()
    {
      
    }
    function HabilitaSalvar()
    {
      
    }
    function ValidaDados(form)
        { 
            var msg="";
            return true
        }

    function LimparCampos()
        {
        }

    function ExaminaCampo(Campo)
        {
        }
     
    function CarregaPrincipal()
        {  
        }    

    function MostraPACs()
    {
       var numeroDePacs = 0;

       for (var i=document.all.aux_cdagenci.options.length; i>=0; i--)
          document.all.aux_cdagenci.remove(i); 

       var oOption;
       
       numeroDePacs = 0;
       for(i=0;i<mpac.length;i++)
       {
          if (mpac[i].cdcooper == document.form.cdcooper.value)
          {
             numeroDePacs = numeroDePacs + 1;
             oOption = document.createElement("OPTION");
             document.all.aux_cdagenci.options.add(oOption);
             oOption.innerText = mpac[i].nmresage.substring(0, 50);
             oOption.value = mpac[i].cdagenci;
          }
       }
       if (numeroDePacs > 1) 
          {
             oOption = document.createElement("OPTION");
             document.all.aux_cdagenci.options.add(oOption);
             oOption.innerText = "TODOS";
             oOption.value = "0";
          }
    }

    function PosicionaPAC()
    {
       // posiciona a cooperativa
       if (document.form.cdcooper.value != '')
           document.form.aux_cdcooper.value = document.form.cdcooper.value;

       if(document.form.cdagenci.value != '')
       {
          //document.form.aux_cdeixtem.value = document.form.cdeixtem.value;
          MostraPACs();
          document.form.aux_cdagenci.value = document.form.cdagenci.value;
       }
       else
       {
          // posiciona a seleção no primeiro registro de PAs, se só tiver 1
          if(document.all.aux_cdagenci.options.length == 1)
             document.form.aux_cdagenci.value = document.all.aux_cdagenci.options[0].value;
       }
    }

    function MostraEventos()
    {
       
       var numeroDeEventos = 0;
       
       for (var i=document.all.aux_cdevento.options.length; i>=0; i--)
          document.all.aux_cdevento.remove(i); 

       var oOption;

       numeroDeEventos = 0;
       for(i=0;i<mevento.length;i++)
       {
          if ((mevento[i].cdcooper == document.form.aux_cdcooper.value)&&
              (mevento[i].cdagenci == document.form.aux_cdagenci.value))
          {
             numeroDeEventos = numeroDeEventos + 1;
             oOption = document.createElement("OPTION");
             document.all.aux_cdevento.options.add(oOption);
             oOption.innerText = mevento[i].nmevento.substring(0, 80);
                     oOption.value = mevento[i].nrseqeve;
          }
       }
       if (numeroDeEventos > 1) 
          {
             oOption = document.createElement("OPTION");
             document.all.aux_cdevento.options.add(oOption);
             oOption.innerText = "TODOS";
             oOption.value = "0";
          }
       if ((document.all.aux_cdevento.options.length == 0) && (document.form.aux_cdagenci.value != ""))
              {
                     oOption = document.createElement("OPTION");
                   document.all.aux_cdevento.options.add(oOption);
                   oOption.innerText = "--Não existem eventos disponíveis--";
                       oOption.value = "0";
                       aux_vazio = "true";
               }
       if ((document.all.aux_cdevento.options.length == 0) && (document.form.aux_cdagenci.value == ""))
                       {
                          oOption = document.createElement("OPTION");
                          document.all.aux_cdevento.options.add(oOption);
                          oOption.innerText = "--Selecione o PA--";
                          oOption.value = "0";
                              aux_vazio = "false";
                       }
       document.form.aux_cdevento.value = '';
       PosicionaEventos()   
    }

    function PosicionaEventos()
    {     
       if(document.form.aux_cdevento.value != "")
       { 
          MostraEventos();
       }
       else
       {
          // posiciona a seleção no primeiro registro de Eventos, se só tiver 1
          if(document.all.aux_cdevento.options.length == 1)
             document.form.aux_cdevento.value = document.all.aux_cdevento.options[0].value;
          else
             document.form.aux_cdevento.value = '';

          if (document.form.aux_cdagenci.value == "")
             document.form.aux_cdevento.value = '';
       }
    }

    function imprimir()
       {
          msg      = "";
          nrseqeve = "";

          if (document.form.aux_dtanoage.value=="") 
             msg = "-> Selecione o ano a agenda.\n";
          if (document.form.aux_cdcooper.value=="") 
             msg = msg + "-> Selecione uma cooperativa.\n";
          if (document.form.aux_cdagenci.value=="") 
             msg = msg + "-> Selecione um PA.\n";
              if((document.all.aux_cdevento.options.length == 1) && (aux_vazio == 'true'))
              msg = msg + "Os eventos para esse PA ainda não estão disponíveis. Aguarde a liberação da agenda!!!\n";
              else        
              if (document.form.aux_cdevento.value=="") 
                      msg = msg + "-> Selecione um evento.\n";  
                
          msg = msg + top.frcod.VE("da",document.form.dataInicial,"-> A data inicial para pesquisa","sim");
          msg = msg + top.frcod.VE("da",document.form.dataFinal,"-> A data final para pesquisa","sim");

                  
          if (msg!="") 
                 alert(msg);
             else
                 {                          
                                     linha = "wpgd0038a" + 
                           "?parametro1=" + document.form.aux_idevento.value +  
                           "&parametro2=" + document.form.aux_cdcooper.value + 
                           "&parametro3=" + document.form.aux_cdagenci.value + 
                           "&parametro4=" + document.form.aux_dtanoage.value + 
                           "&parametro5=" + nrseqeve +
                           "&parametro6=" + document.form.aux_cdevento.value  + 
                           "&parametro7=" + document.form.dataInicial.value + 
                           "&parametro8=" + document.form.dataFinal.value;           
                               if (document.form.consideraEventosForaDaAgenda.checked) 
                          linha = linha + "&parametro9=SIM";
                      else
                          linha = linha + "&parametro9=NAO";

                   linha = linha + "&parametro10=3";    /*   + document.form.tipoDeRelatorio.value; */

                   linha = linha + "&parametro11=" + document.form.aux_tpevento.value;
                   
                   linha = linha + "&parametro12=" + document.form.aux_nrseqpgm.value;
                   
                   imp = window.open(linha,"imp","toolbar=no,location=no,diretories=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,top=10,left=10,width=740,height=400");

                 }
       } // imprimir()

    function verifica_coop(){

       if (document.form.aux_cdcooper.value == ''){
           alert('A Cooperativa deve ser escolhida!');
               return false;
       }
       
       document.form.submit();
    }
       
    MostraPACs();
    PosicionaPAC();

    MostraEventos();
    PosicionaEventos();
    if((document.all.aux_cdevento.options.length == 1) && (aux_vazio == 'true'))
           alert('Os eventos para esse PA ainda não estão disponíveis. Aguarde a liberação da agenda!!!');

      if(document.form.nrseqpgm.value != 0){
        document.form.aux_nrseqpgm.value = document.form.nrseqpgm.value;
      }
      
      if(document.form.aux_idevento.value == 2){
        document.getElementById("divNrseqpgm").style.display = "none";
        document.getElementById("divNrseqpgmLabel").style.display = "none";
        document.form.nrseqpgm.value = 0;
      }
    </SCRIPT>
</html>