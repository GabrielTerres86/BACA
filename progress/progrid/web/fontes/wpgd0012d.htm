<!--
	Alteracoes: 09/10/2015 - Criação da tela PRJ229 - Melhorias Progrid (Vanessa).
              
              09/12/2015 - Inclusão do campo cdcopope (Vanessa)
              
              13/06/2016 - Ajustes layout(Odirlei-AMcom)
                
-->

<html>
    <head>
    <title>Recursos (wpgd0012d)</title>
    </head>
    <body onload="MostraRecursos()">
    <link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
    <script SRC="/cecred/jsbiblio/biblio.js"></script>
    <script SRC="/cecred/jsbiblio/frcod.js"></script>
    <script SRC="/cecred/js/funcoes.js"></script>
    <script SRC="/cecred/scripts/jquery.js"></script>
    <form action="#." method="POST" name="form">
      <input name="aux_cddopcao" type="hidden" value="">    
      <input name="aux_lspermis" type="hidden" value="">    
      <input name="aux_nrdrowid" type="hidden" value="">
      <input name="aux_stdopcao" type="hidden" value="">
      <input name="aux_dsretorn" type="hidden" value="">  
      <input name="aux_dsendurl" type="hidden" value="">  
      <input name="aux_idevento" type="hidden" value="">  
      <input name="aux_cdcopope" type="hidden" value="">
      <input name="nrseqdig"     type="hidden" value="">  
  
      <input name="dtmvtolt"     type="hidden" value="">
      <input name="dtvalpro"     type="hidden" value="">
      <input name="aux_cdtemeix" type="hidden" value="">
      <input name="aux_cdeixtem" type="hidden" value="">
      <input name="aux_cdevento" type="hidden" value="">
      <input name="nmevefor"     type="hidden" value="">
      <input name="dsobjeti"     type="hidden" value="">
      <input name="dsconteu"     type="hidden" value="">
      <input name="dsmetodo"     type="hidden" value="">
      <input name="aux_dspublic" type="hidden" value="">
      <input name="dsobserv"     type="hidden" value="">
      <input name="dsidadpa"     type="hidden" value="">
      <input name="aux_idforrev" type="hidden" value="">
      <input name="dsprereq"     type="hidden" value="">
      <input name="txfacili"     type="hidden" value="">
      <input name="vlinvest"     type="hidden" value="">
      <input name="aux_flgtrinc" type="hidden" value="">
      <input name="qtcarhor"     type="hidden" value="">
      <input name="aux_lsfacili" type="hidden" value="">
      <input name="aux_idvapost" type="hidden" value="">
  
  
  
      <!-- Início do modelo geral -->
      <table width="100%" border="0" align="left" cellpadding="0" cellspacing="0">
        <tr valign="botton">
          <td>
	        <table border="0" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
		      <tr>
                <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
                <td align="center" nowrap width="150" class="linkGuia">Adicionar Recurso</td>
                <td width="11" align="right"><img src="/cecred/images/geral/guia_direita.gif" width="8" height="21"></td>
              </tr>
            </table>
          </td>
        </tr>
        <tr valign="top" bgcolor="#FFFFFF">
          <td colspan="4">
            <table width="100%" height="100%"  border="0" align="left" cellpadding="0" cellspacing="1" bgcolor="#999999">
              <tr>
                <td valign="top" bgcolor="#FFFFFF">
                  <table width="100%" height="100%"  border="0" cellpadding="4" cellspacing="0">
                    <tr bgcolor="#FFFFFF">
                      <td>&nbsp;
                    
                      </td>
                    </tr>
                    <tr> 
                      <td height="15" align="left">&nbsp;</td>
                      <td height="15" align="left">
                        <!-- Interrupção do modelo geral, início dos dados específicos da tela -->
                        <table border="0" align="left" cellspacing="0">
                          <tr>
                            <td align="right" class="NomeCampo">Fornecedor:</td>
                            <td align="left">
						      <input name="aux_dspropos" id="aux_dspropos" type="hidden" class="Campo" size="60" maxlength="65" readOnly="true" value="">	
						      <input name="aux_nrcpfcgc" type="text" class="Campo" onFocus="window.status = 'Fornecedor'" size="60" maxlength="65" readOnly="true" value="">
                            </td>
                          </tr>
                          <tr>
                            <td align="right" class="NomeCampo">Recurso:</td>
                            <td align="left">
						    <select name="aux_nrseqdig" id="aux_nrseqdig"  size="1" class="Campo">								
						    </select> 
                         
                            </td>
                          </tr>
					      <tr>
					  
					  	    <td align="right" class="NomeCampo"><div class="divQuantidade">Quantidade:</div></td>
                              <td align="left" height="20" class="NomeCampo">
						      <input name="aux_idrecpor" type="hidden" value="">
						      <input name="aux_cdtiprec" type="hidden" value="">
						      <div class="divQuantidade"><input name="qtrecfor" id="qtrecfor" type="text" class="Campo" size="10" maxlength="5"></div>
						      <div class="divParticipante"> a cada <input name="qtgrppar" id="qtgrppar" type="text" class="Campo" size="6" maxlength="5">
						       Participantes &nbsp;&nbsp;&nbsp;&nbsp;</div>
						    </td>
					
					      </tr>  
                          <tr>
                            <td align="right" class="NomeCampo">&nbsp;&nbsp;&nbsp;&nbsp;</td>                           
                          </tr>
                        </table>
                        <!-- Fim dos dados específicos da tela, reinício do modelo geral -->
                      </td>
                    </tr>
                    <tr>
                      <td colspan="2">
                        <table width="100" align="center">
                          <tr>
                            <td><img style="cursor:hand;" src="/cecred/images/botoes/btn_cadastrar.gif" width="58" height="20" onClick="return Incluir()"></td>
                            <td><img style="cursor:hand;" src="/cecred/images/botoes/btn_salvar.gif" width="60" height="20" onClick="return Salvar()"></td>
                            </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
      <!-- Fim do modelo geral -->
    </form>
    </body>
    <script language="JavaScript">
        NomeDoProgramaPrincipal = '/wpgd0012d.w';

        NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
        document.form.action = NomeDoProgramaPrincipal;
        document.form.aux_nrcpfcgc.style.border = 'none';

        function CarregaPrincipal() {
            if (document.form.aux_stdopcao.value == "") {
                LimparCampos();
            }

        }

        function MostraRecursos() {
            for (var i = document.all.aux_nrseqdig.options.length; i >= 0; i--)
                document.all.aux_nrseqdig.remove(i);

            var oOption;
            var nrseqdig;

            oOption = document.createElement("OPTION");
            document.all.aux_nrseqdig.options.add(oOption);
            oOption.innerText = "Selecione o Recurso";
            oOption.value = 0;

            for (i = 0; i < recursos.length; i++) {
                oOption = document.createElement("OPTION");
                document.all.aux_nrseqdig.options.add(oOption);
                oOption.innerText = recursos[i].dsrecurs;
                oOption.value = recursos[i].nrseqdig;
                oOption.idrecpor = recursos[i].idrecpor;
                oOption.cdtiprec = recursos[i].cdtiprec;
                if (recursos[i].nrseqdig == document.form.nrseqdig.value) {
                    oOption.selected = document.form.nrseqdig.value;
                }

            }

        }


        function LimparCampos() {
            document.form.nrseqdig.value = 0;
            document.form.qtgrppar.value = "";
            document.form.qtrecfor.value = "";
            document.form.nrseqdig.focus();
        }

        function Incluir() {

            var vaux = document.form.aux_lspermis.value;
            if (vaux.substring(0, 1) == 'I') {
                if (document.form.aux_stdopcao.value == 'i') {
                    MostraResultado('1', 'Você já esta no modo de inclusão.');
                    return false
                }
                else {
                    document.form.aux_cddopcao.value = 'in';
                    document.form.aux_stdopcao.value = 'i'
                    LimparCampos();
                    return true
                }
            }
            else {
                MostraResultado('1', 'Desculpe, mas você não tem permissão para executar esta função.');
                return false
            }
        }

        function Salvar() {

            var vaux = document.form.aux_lspermis.value;
            if ((vaux.substring(1, 2) == 'A') || (document.form.aux_stdopcao.value == 'i')) {
                if (ValidaDados(document.forms[0])) {
                    document.form.aux_cddopcao.value = 'sa';
                    status = 'Salvando. Por favor, aguarde ...';
                    document.form.aux_nrcpfcgc.value = TiraFormato(document.form.aux_nrcpfcgc.value);
                    document.form.aux_nrseqdig.disabled = false;
                    document.form.submit();
                    return true;
                }
                else {
                    return false;
                }
            }
            else {
                MostraResultado('1', 'Desculpe, mas você não tem permissão para executar esta função.');
                return false;
            }
        }
        function ValidaDados(form) {
            var msg = "";

            if (form.aux_nrseqdig.value == 0) {
                msg = "Selecione um Recurso!";
            }


            if ((form.aux_idrecpor.value == 1 || form.aux_idrecpor.value == 3) && form.aux_cdtiprec.value != 2) {
                if (form.qtrecfor.value == 0) {
                    msg = "Digite uma Quantidade!";
                }
                if (form.aux_idrecpor.value == 3 && form.qtgrppar.value == 0) {
                    msg = "Digite uma Quantidade para cada Participante!";
                }
            }


            if (msg == "")
                return true
            else {
                MostraResultado('1', msg);
                return false
            }
        }

        // Tirar os formatos de CPF e CNPJ, deixando somente os numeros
        function TiraFormato(campo) {
            //Retirar a formatação de CPF e CNPJ
            campo = campo.replace(".", "");
            campo = campo.replace(".", "");
            campo = campo.replace(".", "");
            campo = campo.replace("/", "");
            campo = campo.replace("-", "");

            return campo;
        }

        function Restaurar() {
            alert('Atualizacao executada com sucessos');

            if (document.form.txfacili.value != "") {
                arrtxfacili = document.form.txfacili.value.split("-");
                document.form.txfacili.value = "";
                for (i = 1; i < arrtxfacili.length; i++) {
                    document.form.txfacili.value = document.form.txfacili.value + '-' + arrtxfacili[i] + '\n';
                }
            }

            window.opener.document.form.dtvalpro.value = document.form.dtvalpro.value;
            window.opener.document.form.aux_idvapost.value = document.form.aux_idvapost.value;
            window.opener.document.form.aux_cdtemeix.value = document.form.aux_cdtemeix.value;
            window.opener.document.form.aux_cdeixtem.value = document.form.aux_cdeixtem.value;
            window.opener.document.form.cdeixtem.value = document.form.aux_cdtemeix.value;
            window.opener.document.form.aux_cdevento.value = document.form.aux_cdevento.value;
            window.opener.document.form.cdevento.value = document.form.aux_cdevento.value;
            window.opener.document.form.aux_flgtrinc.value = document.form.aux_flgtrinc.value;
            window.opener.document.form.aux_lsfacili.value = document.form.aux_lsfacili.value;
            window.opener.document.form.aux_dspublic.value = document.form.aux_dspublic.value;
            window.opener.document.form.aux_idforrev.value = document.form.aux_idforrev.value;
            window.opener.document.form.nmevefor.value = document.form.nmevefor.value;
            window.opener.document.form.dsobjeti.value = document.form.dsobjeti.value;
            window.opener.document.form.dsconteu.value = document.form.dsconteu.value;
            window.opener.document.form.dsmetodo.value = document.form.dsmetodo.value;
            window.opener.document.form.dsobserv.value = document.form.dsobserv.value;
            window.opener.document.form.dsprereq.value = document.form.dsprereq.value;
            window.opener.document.form.txfacili.value = document.form.txfacili.value;
            window.opener.document.form.vlinvest.value = document.form.vlinvest.value;
            window.opener.document.form.dsidadpa.value = document.form.dsidadpa.value;
            window.opener.document.form.qtcarhor.value = document.form.qtcarhor.value;
            window.opener.document.form.aux_nmpagina.value = "divRecurso";

            window.opener.mostraDiv('divRecurso');
        }

        // não deixa digitar no CPF/CNPJ
        document.form.aux_nrcpfcgc.style.border = 'none';
        $(".divQuantidade").css("float", "left");
        $(".divQuantidade").css("display", "none");
        $(".divParticipante").css("display", "none");

        var idrecpor = document.form.aux_idrecpor.value;
        var cdtiprec = document.form.aux_cdtiprec.value;

        if ((idrecpor == 1 || idrecpor == 3) && cdtiprec != 2) {
            $(".divQuantidade").css("display", "block");
            if (idrecpor == 3) {
                $(".divParticipante").css("display", "block");
            } else {
                $(".divParticipante").css("display", "none");
            }
        } else {
            $(".divQuantidade").css("display", "none");
            $(".divParticipante").css("display", "none");
        }


        $('#qtrecfor').bind('keyup', function () {
            $(this).val($(this).val().replace(/[^0-9]/g, ''));
        });

        $('#qtgrppar').bind('keyup', function () {
            $(this).val($(this).val().replace(/[^0-9]/g, ''));
        });

        $("#aux_nrseqdig").change(function () {
            var idrecpor = $(this).children(":selected").attr("idrecpor");
            var cdtiprec = $(this).children(":selected").attr("cdtiprec");

            document.form.aux_idrecpor.value = idrecpor;
            document.form.aux_cdtiprec.value = cdtiprec;

            if ((idrecpor == 1 || idrecpor == 3) && cdtiprec != 2) {
                $(".divQuantidade").css("display", "block");
                if (idrecpor == 3 && cdtiprec != 2) {
                    $(".divParticipante").css("display", "block");
                } else {
                    $(".divParticipante").css("display", "none");
                }
            } else {
                $(".divQuantidade").css("display", "none");
                $(".divParticipante").css("display", "none");
            }

        });

        if (document.form.nrseqdig.value > 0) {
            $("#aux_nrseqdig").attr('disabled', 'disabled');
        }

    </script>
</html>