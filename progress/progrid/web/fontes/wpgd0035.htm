<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="wsoptions" content="no-output">
<title>Frequencia</title>
<base target="mainFrame">
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
</head>
<body style="margin-left: 3px; ">
<form action="#." method="POST" name="form">
    <input name="idevento"     type="hidden" value="">
    <input name="cdeixtem"     type="hidden" value="">
        <input name="cdcooper"     type="hidden" value="">
        <input name="cdagenci"     type="hidden" value="">
    <input name="aux_idevento" type="hidden" value="">                
    <input name="aux_cddopcao" type="hidden" id="aux_cddopcao"  value="">
    <input name="aux_lspermis" type="hidden" id="aux_lspermis"  value="">
    <input name="aux_nrdrowid" type="hidden" id="aux_nrdrowid"  value="">    
    <input name="aux_dsretorn" type="hidden" id="aux_dsretorn"  value="">    
    <input name="aux_stdopcao" type="hidden" id="aux_stdopcao"  value="">    
    <input name="aux_dsendurl" type="hidden" id="aux_dsendurl"  value="">    
    
<!-- Início do modelo geral -->
<div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 25px; top: 2px; visibility: ;"><img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom"></div>
   <table width="575" height="360" border="0" align="left" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
      <tr>
         <td height="20" colspan="5">
            <table width="100%"  border="0" cellspacing="0" cellpadding="0">
               <tr>
                  <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
                  <td width="56"><img src="/cecred/images/geral/spacer.gif" width="10" height="10"></td>
                  <td width="406" height="20" align="left" class="linkGuia">Relatório de Certificados</td>
                  <td width="91" height="20" align="right" class="linkGuia">wpgd0035</td>          
                  <td width="11" align="right"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
                  </tr>
            </table>
         </td>
      </tr>
      <tr valign="top" bgcolor="#FFFFFF">
         <td colspan="5">
            <table width="100%" height="100%" border="0" align="left" cellpadding="0" cellspacing="0" bgcolor="#999999">
               <tr>
                  <td valign="top" bgcolor="#FFFFFF">
                     <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr>
                           <td align="center" valign="middle">
                             <!-- Interrupção do modelo geral, início dos dados específicos da tela -->
                              <table border="0" align="center" cellspacing="1" cellpadding="1">
                                 <tr>
                                    <td align="right" class="NomeCampo">Agenda:</td>
                                    <td><input type="text" name="aux_dtanoage" size="8" onChange="verifica_coop();"></td>
                                    <td align="right" class="NomeCampo">Cooperativa:</td>
                                    <td><select name="aux_cdcooper" class="Campo" onChange="document.form.cdcooper.value = document.form.aux_cdcooper.value; document.form.aux_dtanoage.value=''; document.form.submit();"></select></td>
                                    <td align="right" class="NomeCampo">PA:</td>
                                    <td><select name="aux_cdagenci" class="Campo" id="aux_cdagenci" onChange="document.form.cdagenci.value = document.form.aux_cdagenci.value; document.form.submit();"></select></td>
                                 </tr>
                                 <tr>
                                    <td align="right" class="NomeCampo">Evento:</td>
                                    <td colspan="5"><select name="aux_cdevento" class="Campo" id="aux_cdevento" onChange="carregar()"></select></td>
                                 </tr>
                                  <tr>
                                     <td align="center" colspan="6"><iframe name="dados" id="dados" src="wpgd0035a?acao=telabranca" width="570" height="250" frameborder="NO" border="0" framespacing="0" scrolling="auto"></iframe></td>
                                  </tr>
                              </table>
                             <!-- Fim dos dados específicos da tela, reinício do modelo geral -->
                           </td>
                        </tr>
                        <tr>
                           <td height="15" align="center" valign="bottom">
                              <table width="100%" border="0" cellpadding="1" cellspacing="1" align="center">
                                 <tr>
                                    <td align="center">
                                      <!-- <img style="cursor: hand;" src="/cecred/images/botoes/btn_procurar.gif" alt="Procurar a lista de inscrições para o evento" onClick="carregar()"> -->
                                       <img style="cursor: hand;" src="/cecred/images/botoes/btn_visualizar_impressao.gif" alt="Imprmir os certificados para os inscritos selecionados" onClick="imprimir();">
                                    </td>
                                 </tr>
                              </table>
                           </td>
                        </tr>
                     </table>
                  </td>
               </tr>
           </table>
         </td>
      </tr>
   </table>
<!-- Fim do modelo geral -->
</form>
</body>
</html>

<SCRIPT LANGUAGE="JAVASCRIPT">
   NomeDoProgramaPrincipal  = '/wpgd0035.w';
   NomeDoProgramaDeListagem = '/wpgd0035ls.w';
   NomeDoProgramaDeAjuda    = '/wpgd0035aj.w';
   
   NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
   document.form.action = NomeDoProgramaPrincipal;

   var flagImprimir = "nao";

function Habilita()
{
  
}
function HabilitaSalvar()
{
  
}
function ValidaDados(form)
    { 
        var msg="";
         
       // msg = msg + top.frcod.VE("ca",form.dseixtem,"A descrição do eixo temático","nao");
         
        if (msg == "")
                return true
            else
                {
                    top.frcod.MostraResultado('1',msg);
                    return false
                }
    }

function LimparCampos()
    {
       /*
        document.form.cdeixtem.value = '';
        document.form.dseixtem.value = '';
        focus();
        document.form.dseixtem.focus();
        document.form.dseixtem.select();
        */
    }

function ExaminaCampo(Campo)
    {
       /*
       if (document.form.aux_stdopcao.value != 'i' & Campo == 'cdeixtem' )  {
           document.form.dseixtem.focus();
           document.form.dseixtem.select();
       } 
       */     
    }
 
function CarregaPrincipal()
    {  
      //top.topFrame.document.all.titulo.innerHTML = 'Cadastro de Eixos Temáticos';
    }    

function MostraPACs()
{
   for (var i=document.all.aux_cdagenci.options.length; i>=0; i--)
      document.all.aux_cdagenci.remove(i); 

   var oOption;
   
   for(i=0;i<mpac.length;i++)
   {   
      if (mpac[i].cdcooper == document.form.cdcooper.value)
      {
         oOption = document.createElement("OPTION");
         document.all.aux_cdagenci.options.add(oOption);
         oOption.innerText = mpac[i].nmresage.substring(0, 50);
                 oOption.value = mpac[i].cdagenci;
      }
   }

   limpa();
}

function PosicionaPAC()
{
   // posiciona a cooperativa
   if (document.form.cdcooper.value != '')
       document.form.aux_cdcooper.value = document.form.cdcooper.value;
   else
       document.form.aux_cdcooper.value = '';

   if(document.form.cdagenci.value != '')
      document.form.aux_cdagenci.value = document.form.cdagenci.value;
   else
      document.form.aux_cdagenci.value = '';
}

function MostraEventos()
{
   for (var i=document.all.aux_cdevento.options.length; i>=0; i--)
      document.all.aux_cdevento.remove(i); 

   var oOption;

   for(i=0;i<mevento.length;i++)
   {
      if ((mevento[i].cdcooper == document.form.aux_cdcooper.value)&&
          (mevento[i].cdagenci == document.form.aux_cdagenci.value))
      {
         oOption = document.createElement("OPTION");
         document.all.aux_cdevento.options.add(oOption);
         oOption.innerText = mevento[i].nmevento.substring(0, 80);
                 /*alterado para ler o evento atraves do nnrseqeve*/
                 oOption.value = mevento[i].nrseqeve;
/*         oOption.value = mevento[i].cdevento;*/
      }
   }
   document.form.aux_cdevento.value = '';
   if (document.form.aux_cdagenci.value == '') 
   {
      oOption = document.createElement("OPTION");
      document.all.aux_cdevento.options.add(oOption);
      oOption.innerText = "--Selecione PA--";
      oOption.value = '0';
      document.form.aux_cdevento.value = '0';
   }

   document.form.aux_cdevento.value = '';
   limpa();
   PosicionaEventos();
}

function PosicionaEventos()
{
   if(document.form.aux_cdevento.value != "")
   {
      //document.form.aux_cdeixtem.value = document.form.cdeixtem.value;
      MostraEventos();
      //document.form.aux_cdevento.value = document.form.cdevento.value;
   }
   else
   {
      // posiciona a seleção no primeiro registro de Eventos, se só tiver 1
      if(document.all.aux_cdevento.options.length == 1){
         document.form.aux_cdevento.value = document.all.aux_cdevento.options[0].value;

                 // se tiver só um evento no pac, carrega os dados
                 if(document.form.aux_cdagenci.value!="")
                    carregar();
          }
      else
         document.form.aux_cdevento.value = '';

      if (document.form.aux_cdagenci.value == "")
         document.form.aux_cdevento.value = '';
   }
}

function imprimir()
   {
      if (flagImprimir!="sim") 
            alert("-> Selecione antes um evento.\n")
         else
             dados.imprimir();                         
   }

function carregar()
   {
   
      msg      = "";
      nrseqeve = "";

      if (document.form.aux_dtanoage.value=="") 
         msg = "-> Selecione o ano a agenda.\n";
      if (document.form.aux_cdcooper.value=="") 
         msg = msg + "-> Selecione uma cooperativa.\n";
      if (document.form.aux_cdagenci.value=="") 
         msg = msg + "-> Selecione um PA.\n";
      if (document.form.aux_cdevento.value=="") 
         msg = msg + "-> Selecione um evento.\n";
            
      if (msg==""){
             for (i = 0; i < mevento.length; i++){
            if ((mevento[i].cdcooper == document.form.aux_cdcooper.value) && (mevento[i].cdagenci == document.form.aux_cdagenci.value) && (mevento[i].nrseqeve == document.form.aux_cdevento.value)){ 
               // Se nao possui inscricoes, gera erro
                           if (mevento[i].nrinscri == '0')
                  msg = "-> Evento não possui inscrições.\n";
                           else{
                              if ((mevento[i].nrconfir == '0') &&
                      (mevento[i].nrinscri != '0')) 
                       msg = "-> Evento possui inscrições, mas nenhuma ainda confirmada.\n";
                  else
                                           nrseqeve = mevento[i].cdevento;
               }                            
            }
         }
      }          
              
      if (msg!=""){ 
          alert(msg);
                  limpa();         
          }
      else{          
              linha = "wpgd0035a" + 
                  "?parametro1=" + document.form.aux_idevento.value +  
                  "&parametro2=" + document.form.aux_cdcooper.value + 
                  "&parametro3=" + document.form.aux_cdagenci.value + 
                  "&parametro4=" + document.form.aux_dtanoage.value + 
                  "&parametro5=" + nrseqeve +
                  "&parametro6=" + document.form.aux_cdevento.value;

          imp = window.open(linha,"dados","toolbar=no,location=no,diretories=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,top=10,left=10,width=640,height=400");          
      }
   }   

function limpa()
   {
      flagImprimir = "nao";
      dados.document.writeln('<html><head><title>Frequencia</title></head><body bgcolor="#FFFFFF"> </body></html>');
   }

function ativa(opcao) 
  { 
     flagImprimir = opcao;
  }
  
function verifica_coop(){

   if (document.form.aux_cdcooper.value == ''){
       alert('A Cooperativa deve ser escolhida!');
           return false;
   }   
   document.form.submit();
}  

// valida os parâmetros da agenda
if(document.form.aux_dtanoage.value == ''){
   alert('Parâmetro da Agenda Não Encontrado!!!');
   
   document.form.aux_cdcooper.value='';  
}
else{
   MostraPACs();
   PosicionaPAC();

   MostraEventos();
   PosicionaEventos();
}

</SCRIPT>

