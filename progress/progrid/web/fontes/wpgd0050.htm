<!-- 

  Alterações: 07/01/2013 - Criado a funcao CarregaPrincipal e incluido a
                           mensagem "Importando arquivo. Aguarde..." na
                           funcao Executar (Adriano).
                           
              04/09/2013 - Nova forma de chamar as agências, de PAC agora 
                           a escrita será PA (André Euzébio - Supero).    

              14/06/2016 - Ajustado para permitir importar inscritos
                           de eventos progrid, extensao .EVE
                           Projeto 229 - Melhorias OQS (Odirlei-AMcom)  
                           
              02/08/2017 - Ajustado para nao permitir importar inscritos
                           de eventos já encerrados, Nao permitir inscriçoes
                           duplicadas e nao permitir importaçao no eventos
                           assembleares, Prj. 322 (Jean Michel)

-->
<html>
<head>
<title>Inscrições para Importar</title>
</head>
<body onunload="FechaMens()" style="margin-left: 3px; ">
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
<script SRC="/cecred/jsbiblio/sorttable.js"></script>
<script SRC="/cecred/jsbiblio/biblio.js"></script>
<script SRC="/cecred/jsbiblio/frcod.js"></script>
<script language="JavaScript">
   NomeDoProgramaPrincipal  = '/wpgd0050.w';
   NomeDoProgramaDeListagem = '/wpgd0050ls.w';
   NomeDoProgramaDeAjuda    = '/wpgd0050aj.w';
   NomeDoProgramaDeZoom     = '/zoom/zwpgd0050.w';
</script>
<form action="#." method="POST" name="form">
<input type="hidden" name="aux_dsendurl" value="">
<input type="hidden" name="aux_lspermis" value="">
<input type="hidden" name="aux_nrdrowid" value="">
<input type="hidden" name="aux_fechamen" value="">
<input type="hidden" name="cdageins"     value="">
<input type="hidden" name="aux_idstaeve" value="">
<input type="hidden" name="aux_idevento" value="">
<input type="hidden" name="cdarqsel"         value="">
<input type="hidden" name="cdevesel"         value="">
<input type="hidden" name="nmarqsel"         value="">
<input type="hidden" name="aux_cddopcao" id = "aux_cddopcao" value="">

<div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 25px; top: 2px; visibility: ;"><img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom"></div>
  <table width="575" border="0" align="left" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
    <tr>
      <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
      <td width="56"><img src="/cecred/images/geral/spacer.gif" width="10" height="10"></td>
      <td width="280" height="20" align="left" class="linkGuia">Inscrições para Importar</td>
      <td width="287" height="20" align="right" class="linkGuia">wpgd0050</td>          
          <td width="11" align="right" valign="middle" class="linkGuia"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
    </tr>
    <tr valign="top" bgcolor="#FFFFFF">
      <td colspan="5">
        <table width="574" height="300"  border="0" align="left" cellpadding="0" cellspacing="1" bgcolor="#999999">
          <tr>
            <td height="200" valign="top" bgcolor="#FFFFFF">
              <table width="575" height="337" border="0" cellpadding="0" cellspacing="0">
                <tr>
                  <td>&nbsp;</td>
                  <td height="50" align="left" valign="top">
                     <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr>
                          <td align="right" class="NomeCampo">&nbsp;</td>
                          <td class="NomeCampo" align="left">&nbsp;</td>
                          <td class="NomeCampo" align="right">&nbsp;</td>
                          <td class="NomeCampo" align="left">&nbsp;</td>
                          <td colspan=2 align="right" class="NomeCampo">&nbsp;</td>
                          <td colspan=2 align="right" class="NomeCampo">&nbsp;</td>
                        </tr>
                        <tr>
                          <td align="right" class="NomeCampo"> Agenda: </td>
                          <td class="NomeCampo" align="left"><input name="aux_dtanoage" type="text"  size="5" onChange="mudaAnoAgenda();"></td>
                          
                          <td class="NomeCampo" align="left" width="150px">&nbsp;</td>
                          <td colspan=2 class="NomeCampo" align="right" width="200px" >Cooperativa: </td>
                          <td colspan=2 class="NomeCampo" align="left" width="150px">
                              <select name="aux_cdcooper" class="Campo"  style = "width:150px;PADDING-RIGHT: 10px" onChange="document.form.aux_dtanoage.value='';  document.form.cdarqsel.value=''; document.form.nmarqsel.value=''; document.form.aux_cddopcao.value='selage'; document.form.aux_cdagenci.value=''; document.form.submit();"></select>
                          </td>
                          <td class="NomeCampo" align="right">&nbsp;</td>
                        </tr>
                        <tr>
                           <td align="right" class="NomeCampo">
                             &nbsp;Arquivos:
                           </td>
                           <td colspan=6 align="left" class="NomeCampo">
                               <select name="aux_nmarqimp" class="Campo" style = "width:540px;PADDING-RIGHT: 10px" onChange="document.form.aux_cddopcao.value='selarq'; abreArquivo(this.value);">
                               </select>
                           </td>
                           <td class="NomeCampo" align="right">&nbsp;</td>
                         </tr>
                      </table>
                  </td>
                </tr>
                <tr>
                  <td height="15" align="left">&nbsp;</td>
                  <td height="100%" align="left" valign="top">
                    <table width="100%" border="0" align="center" cellspacing="1">
                      <tr>
                                                <br>
                                                <td colspan="8" height="2" align="left" background="/cecred/images/menu/mnu_slc.gif"></td>
                                          </tr>
                                          <tr>
                                                  <td>&nbsp;</td>
                                                  <td>&nbsp;</td>
                                                  <td>&nbsp;</td>
                                          </tr>
                                          <tr>
                                                  <td height="22" width="60" align="right" class="NomeCampo"><img src="/cecred/images/icones/ico_cooperativa.gif" width="19" height="19" align="right"></td>
                          <td height="22" colspan="11" align="left" class="NomeCampo"><strong>Dados do Arquivo:</strong></td>
                      </tr>
                                          <tr>
                        <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo">PA: </td>
                        <td width="370">
                          <input name="aux_cdagearq" class="NomeCampo" style = "border:0;width:300px;" type="text" readonly >
                        </td>
                      </tr>
                                          <tr>
                        <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo">Abertura: </td>
                        <td width="370">
                          <input name="aux_dsabearq" class="NomeCampo" style = "border:0;width:300px; type="text" readonly >
                        </td>
                      </tr>
                                          <tr>
                        <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo">Operador: </td>
                        <td width="370">
                          <input name="aux_dsopearq" class="NomeCampo" style = "border:0;width:300px; type="text" readonly >
                        </td>
                      </tr>
                                          <tr>
                        <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo">Local: </td>
                        <td width="370">
                          <input name="aux_dslocarq" class="NomeCampo" style = "border:0;width:300px; type="text" readonly >
                        </td>
                      </tr>
                      <tr>
                        <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo">Inscritos: </td>
                        <td width="370">
                          <input name="aux_qtinsarq" class="NomeCampo" style = "border:0;width:300px; type="text" readonly >
                        </td>
                      </tr>
                      <tr>
                        <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo"><div name="div_auxevento" id="div_auxevento" style="display=none" >Evento: </div></td>
                        <td width="370">
                          <input name="aux_nmevearq" class="NomeCampo" style = "border:0;width:300px; type="text"  readonly >
                        </td>
                      </tr>
                                          
                      <tr>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                              <td>&nbsp;</td>
                      </tr>
                      <tr>
                              <td height="22" width="60" align="right" class="NomeCampo"><img src="/cecred/images/icones/ico_cooperativa.gif" width="19" height="19" align="right"></td>
                          <td height="22" colspan="11" align="left" class="NomeCampo"><strong>Dados para importação:</strong></td>
                      </tr>
                                          <tr>
                        <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo">PA: </td>
                        <td width="370">
                                                        <select name="aux_cdagenci" class="NomeCampo" onChange="document.form.aux_cddopcao.value='seqpac'; document.form.cdageins.value = document.form.aux_cdagenci.value; document.form.aux_nrseqeve.value=''; document.form.cdevesel.value='';  document.form.submit();">
                                                        </select>
                        </td>
                      </tr>
                                          <tr>
                                                <td align="right" class="NomeCampo">&nbsp;</td>
                        <td align="right" class="NomeCampo" > Evento: </td>
                        <td width="370">
                                                        <select name="aux_nrseqeve" class="NomeCampo" onChange="document.form.aux_cddopcao.value='';">
                                                        </select>
                        </td>
                      </tr>
                                          
                    </table>                      
                    <table border="0" align="center" cellpadding="1" cellspacing="1">
                      <tr height="50" valign="middle">
                        <th scope="col"><img id="executar" style="cursor:hand" src="/cecred/images/botoes/btn_executar.gif" onClick="return Executar()"></th>                                                
                      </tr>
                    </table>
                                  </td>
                                </tr>
                      </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>                                
  </table>
</form>

<script type="text/vbscript">

sub msgRegImp(n)

        x = MsgBox("Existem inscrições cadastradas manualmente. Deseja exclui-las?",n)
        
        If x = 7 Then
                document.getElementById("aux_cddopcao").value = "imp"
            document.form.submit()
        End If

        If x = 6 Then
                document.getElementById("aux_cddopcao").value = "del-manual"
            document.form.submit()
        End If
end sub

sub msgRegMix(n)

        x = MsgBox("Existem inscrições cadastradas manualmente e inscrições importadas pelo sistema. Deseja excluir as cadastradas manualmente?",n)
        
        If x = 7 Then
                document.getElementById("aux_cddopcao").value = "imp"
            document.form.submit()
        End If

        If x = 6 Then
                document.getElementById("aux_cddopcao").value = "del-manual"
            document.form.submit()
        End If
end sub
        

</script>

<script language="JavaScript">

NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
document.form.action = NomeDoProgramaPrincipal;

MostraArquivos();
MostraPACs();

if (document.form.aux_idevento.value == 2)
   {  
     document.form.aux_nmevearq.style.visibility = "hidden";          
     document.getElementById("div_auxevento").style.display = "none";
     
   }else{
     document.form.aux_nmevearq.style.visibility = "visible";          
     document.getElementById("div_auxevento").style.display = "block";
   }

if(document.form.cdageins.value != 0)
   {
      document.form.aux_cdagenci.value = document.form.cdageins.value;
   }

   
MostraEventos();

if(document.form.cdevesel.value != 0)
   {
      document.form.aux_nrseqeve.value = document.form.cdevesel.value;
   }

if (document.form.aux_cddopcao.value == "verreg") {
        if (regexist.length > 0 ) {
                        
                var strregis = regexist.join();
                document.form.nmarqsel.value = document.all.aux_nmarqimp.options[document.all.aux_nmarqimp.options.value].innerText;
                
                if (strregis.search("no") >= 0){
                        if (strregis.search("yes") >= 0){
                                document.form.aux_cddopcao.value = '';
                                msgRegMix(3);
                        } else{                                
                                document.form.aux_cddopcao.value = '';
                                msgRegImp(3);
                        }
                } else {
                        document.form.aux_cddopcao.value = 'imp';
                        document.form.submit();
                }
        }
        else {
        
                document.form.aux_cddopcao.value = 'imp';
                document.form.submit();
                
        }
}

function mudaAnoAgenda(){

        document.form.nmarqsel.value = '';        
        document.form.cdarqsel.value = '';
        document.form.submit();

}


function abreArquivo(){

        document.form.nmarqsel.value = document.all.aux_nmarqimp.options[document.all.aux_nmarqimp.options.value].innerText;        
        document.form.cdarqsel.value = document.form.aux_nmarqimp.value;
        document.form.aux_cdagenci.value = "";
        document.form.submit();        

}

function MostraArquivos()
{
    
   /* Mensagem quando não há eventos */
   if (nmarqui.length == 0){
       alert('Não há arquivos para importar!');
           return false;
   }

   var oOption;
   
   for(i = 0 ; i < nmarqui.length ; i++)
   {
       
        oOption = document.createElement("OPTION");
        document.all.aux_nmarqimp.options.add(oOption);
        oOption.innerText = nmarqui[i].nmarqimp;
                
                oOption.value = i;
                
   }
   
   if(document.form.cdarqsel.value != "") {
                document.form.aux_nmarqimp.value = document.form.cdarqsel.value;
                mostraDadosArquivo(document.form.cdarqsel.value);
   }else {        
                   document.form.aux_nmarqimp.value = '';
        }
                

}

function mostraDadosArquivo(){

        if (document.form.aux_cddopcao.value != ""){
        
                document.form.aux_cdagearq.value = dadosarquivo[0].dsagearq;
                document.form.aux_dsabearq.value = dadosarquivo[0].dsabearq;
                document.form.aux_dsopearq.value = dadosarquivo[0].dsopearq;
                document.form.aux_dslocarq.value = dadosarquivo[0].dslocarq;
                document.form.aux_qtinsarq.value = dadosarquivo[0].qtinsarq;        
        }

}


if (document.form.aux_fechamen.value == 'Sim') 
   {           
         // Verifica se o usuário tem permissão 
     if (document.form.aux_lspermis.value.search('U') == '-1'){ 
             document.form.excluir.style.filter='progid:DXImageTransform.Microsoft.BasicImage(opacity=0.2)';  
         document.form.excluir.style.cursor='default';
         document.form.excluir.disabled=true;
    
               document.form.salvar.style.filter='progid:DXImageTransform.Microsoft.BasicImage(opacity=0.2)';  
         document.form.salvar.style.cursor='default';
         document.form.salvar.disabled=true;

               document.form.encerrar.style.filter='progid:DXImageTransform.Microsoft.BasicImage(opacity=0.2)';  
         document.form.encerrar.style.cursor='default';
         document.form.encerrar.disabled=true;
         }
   }
   
// -------------------------

function MostraPACs()
{
   for (var i=document.all.aux_cdagenci.options.length; i>=0; i--)
      document.all.aux_cdagenci.remove(i); 
          
        if (nmarqui.length == 0){
                return false;
    }

   var oOption;
   var x = document.getElementById("aux_cdagenci");
   for(i=0;i<mpac.length;i++)
   {
      if (mpac[i].cdcooper == document.form.aux_cdcooper.value)
      {
         oOption = document.createElement("OPTION");
         document.all.aux_cdagenci.options.add(oOption);
         oOption.innerText = mpac[i].nmresage.substring(0, 15);
         oOption.value = mpac[i].cdagenci;
         
      }
   }
   
}


function MostraEventos()
{
                
   /* Mensagem quando não há eventos */
   if ((mevento.length==0) &&
      (document.form.aux_cdagenci.value!='')){
       alert('Não há eventos agendados para fazer inscrições!');
           return false;
   }
   
   for (var i=document.all.aux_nrseqeve.options.length; i>=0; i--)
      document.all.aux_nrseqeve.remove(i); 
          
   if (nmarqui.length == 0 ||
           document.form.aux_cdagenci.value == '') {
                return false;
   }

   var oOption;
         
   for(i=0;i<mevento.length;i++)
   {
      if ((mevento[i].cdcooper == document.form.aux_cdcooper.value)&&
          (mevento[i].cdagenci == document.form.aux_cdagenci.value))
      {
         oOption = document.createElement("OPTION");
         document.all.aux_nrseqeve.options.add(oOption);
         oOption.innerText = mevento[i].nmevento;
         oOption.value = mevento[i].nrseqeve;                 
                 
      }
      // ASSMEBLEIA
      if ((mevento[i].cdcooper == document.form.aux_cdcooper.value)&&
          (mevento[i].cdagenci == 0))
      {
         oOption = document.createElement("OPTION");
         document.all.aux_nrseqeve.options.add(oOption);
         oOption.innerText = mevento[i].nmevento;
         oOption.value = mevento[i].nrseqeve;

      }
   }
}

function Executar(){

        var vaux = document.form.aux_lspermis.value; 
        
        document.form.cdevesel.value = document.form.aux_nrseqeve.value
        
        if(vaux.substring(0,1) == 'I'){
                if (document.form.aux_nmarqimp.value == '') {
                        alert("Arquivo para importação não selecionado.");
                        return false;
                }
           
                if (document.form.aux_cdagenci.value == '') {
                        alert("PA não selecionado.");
                        return false;
                }
           
                if (document.form.aux_nrseqeve.value == '') {
                        alert("Evento não selecionado.");
                        return false;
                }
           
           //Envia instrução para verificar se já existem incrições para esse PA/Evento
                document.form.aux_cddopcao.value = 'verreg';
        status = "Importando arquivo. Aguarde...";
                document.form.submit();
        } else {
                MostraResultado('1','Desculpe, mas você não tem permissão para executar esta função.'); 
                return false
        }

}

function CarregaPrincipal(){
    
    window.status = "";
    
}


</script>
</body>
