<!--
Alterações:  20/01/2012 - Incluída a função ValidaSalvar (Isara - RKAM).

                         23/02/2012 - Ajuste para também permitir encerrar a seleção de eventos
                                                  para os PAC's que tenham somente os eventos de integração
                                                  de cooperados (Adriano).


-->

<html>
<head>
<meta name="AUTHOR" content="Solusoft/Bt - wpgd0020 - C.18">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="wsoptions" content="no-output">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta http-equiv="Cache-Control" content="No-Cache">
<meta http-equiv="Pragma"        content="No-Cache">
<meta http-equiv="Expires"       content="0">
<title>Distribuição de Verbas</title>
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
<!--script SRC="/cecred/jsbiblio/sorttable.js"></script-->
</head>
<body style="margin-left: 3px; ">

<script language="JavaScript">
   NomeDoProgramaPrincipal  = '/wpgd0020.w';
   NomeDoProgramaDeListagem = '/wpgd0020ls.w';
   NomeDoProgramaDeAjuda    = '/wpgd0020aj.w';
   NomeDoProgramaDeZoom     = '/zoom/zoei04.w';
</script>
<form action="#." method="POST" name="form"><div align="right">
  <input type="hidden" name="aux_dsendurl" value="">
  <input type="hidden" name="aux_idevento" value="">
  <input type="hidden" name="aux_cddopcao" value="">
  <input type="hidden" name="aux_nrdrowid" value="">
  <input type="hidden" name="aux_lspermis" value="">
  <input type="hidden" name="aux_dsretorn" value="">
  <input type="hidden" name="aux_stdopcao" value=""> 
  <input type="hidden" name="cdagenci"     value=""> 
  <input type="hidden" name="aux_lsfselec" value="">
  <input type="hidden" name="aux_lscuseve" value="">
  <div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 18px; top: 2px; visibility: ;"><img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom"></div>
  <!-- Inicio do modelo sem abas -->
  <table width="575" height="360"  border="0" align="left" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
    <tr>
      <td height="20" colspan="5">
          <table width="575" border="0" cellspacing="0" cellpadding="0">
        <tr>
      <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
      <td width="56"><img src="/cecred/images/geral/spacer.gif" width="48" height="10"></td>
      <td width="426" height="20" class="linkGuia">Sele&ccedil;&atilde;o dos Eventos </td>
      <td width="78" class="linkGuia" align="right">wpgd0020</td>
      <td width="11" align="right" valign="middle" class="linkGuia"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
    </tr>
      </table>
          </td>
      </tr>
    <tr valign="top" bgcolor="#FFFFFF">
      <td colspan="5">
        <table width="100%" height="100%"  border="0" align="left" cellpadding="0" cellspacing="1" bgcolor="#999999">
          <tr>
            <td height="200" valign="top" bgcolor="#FFFFFF">
              <table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
                <tr>
                  <td height="15"  align="left" valign="top">
                    <!-- Interrupcao do modelo - início dos dados do programa -->
                    <table width="99%"  border="0" align="center" cellpadding="0" cellspacing="1">
                      <tr>
                        <td colspan="12" align="right" class="NomeCampo">&nbsp;</td>
                        </tr>
                      <tr>
                                <td width="11%" align="right" class="NomeCampo"> Agenda: </td>
                        <td width="10%" class="NomeCampo">                                                
                          <input name="aux_dtanoage" class="Campo" type="text" size="8" onChange="document.form.aux_cddopcao.value = ''; document.form.submit();" value="0">
                        </td>
                        <td colspan="3" align="right" class="NomeCampo"> Cooperativa: </td>
                        <td width="12%" class="NomeCampo">
                          <select name="aux_cdcooper" class="Campo" id="cdcooper" onChange="document.form.aux_dtanoage.value = ''; document.form.aux_cddopcao.value = ''; document.form.submit();">
                          </select>
                        </td>
            <td width="8%" class="NomeCampo"><div align="right">PA:</div></td>
                        <td colspan="2" class="NomeCampo"><select name="aux_cdagenci" class="Campo" id="aux_cdagenci" onChange="document.form.cdagenci.value = document.form.aux_cdagenci.value; document.form.submit(); /***mostraEventos();***/">
                        </select></td>
                        <td colspan="2" class="NomeCampo"><div align="right">Eventos previstos: </div></td>
                        <td width="5%" class="NomeCampo"><input name="aux_qtdevent" type="text" disabled="true" id="aux_qtdevent" size="2" readonly></td>
                      </tr>
                      <tr>
                        <td colspan="2" align="right" class="NomeCampo">Verba destinada: </td>
                        <td width="13%" align="right" class="NomeCampo"><div align="left">
                          <input name="aux_vlprogri" type="text" disabled="true" class="CampoNumerico" size="8" readonly>
                        </div></td>
                        <td width="3%" align="right" class="NomeCampo">&nbsp;</td>
                        <td width="0%" align="right" class="NomeCampo"><div align="left">
                        </div></td>
                        <td colspan="2" class="NomeCampo"><div align="right">Custo estimado: </div></td>
                        <td width="9%" class="NomeCampo"><input name="aux_vlcuseve" type="text" disabled="true" class="CampoNumerico" id="aux_vlcuseve" size="8" readonly></td>
                        <td width="2%" class="NomeCampo">&nbsp;</td>
                        <td width="20%" class="NomeCampo"><div align="right">Saldo:
                        </div></td>
                        <td colspan="2" class="NomeCampo">
                            <div align="left">
                              <input name="aux_salcusto" type="text" class="CampoNumerico" id="aux_salcusto" size="8" readonly>
                            </div></td>
                        </tr>
                      <tr>
                      <tr>
                        <td colspan="2" align="right" class="NomeCampo">Qtde Integrações: </td>
                        <td width="13%" align="right" class="NomeCampo"><div align="left">
                          <input name="aux_qtintegr" type="text" disabled="true" class="CampoNumerico" size="8" readonly>
                        </div></td>
                        <td width="3%" align="right" class="NomeCampo">&nbsp;</td>
                        <td width="0%" align="right" class="NomeCampo"><div align="left">
                        </div></td>
                        <td colspan="2" class="NomeCampo"><div align="right">Valor Integrações: </div></td>
                        <td width="9%" class="NomeCampo"><input name="aux_vlintegr" type="text" disabled="true" class="CampoNumerico" size="8" readonly></td>
                        <td width="2%" class="NomeCampo">&nbsp;</td>
                        <td width="20%" class="NomeCampo"><div align="right">&nbsp;
                        </div></td>
                        <td colspan="2" class="NomeCampo">
                          <div align="left">
                            &nbsp;
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td colspan="12" height="10"><img src="/cecred/images/geral/spacer.gif" width="1" height="1"></td>
                        </tr>
                    </table>
                    <div id="divVerba" align="left">
                      <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
                         <tr>
                           <td>
                               <table width="100%" border="0" cellpadding="0" cellspacing="0" class="dataTable">
                                 <tr>
                                   <td id="separador1" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">&nbsp;</td>
                                   <td id="tbevento_col1" width="40" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Selecionar</td>
                                                                   <td id="separador2" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                   <td id="tbevento_col2" width="135" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Eixo tem&aacute;tico</td>
                                                                   <td id="separador3" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                                                      <td id="tbevento_col3" width="150" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Evento</td>
                                                                   <td id="separador4" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                                                   <td id="tbevento_col4" width="50" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Tipo</td>
                                                                   <td id="separador5" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                                                   <td id="tbevento_col5" width="40" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">C.Horária</td>
                                                                   <td id="separador6" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                                                   <td id="tbevento_col6" width="50" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Custo</td>
                                                                   <td id="separador7" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                                                   <td id="tbevento_col8" width="50" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Sugestões</td>
                                                                   <td id="separador8" height="25" width="5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                                                   <td id="tbevento_col7" width="5" height="25" align="left" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">&nbsp;</td>
                                 </tr>
                              </table>      
                           </td>
                         </tr>
                                                 <tr>
                           <td>
                             <div style="overflow: auto; height:'180px';">
                               <table width="100%" border="0" cellpadding="0" cellspacing="0" class="dataTable" id="tbevento">
                                                                <!-- INCLIU DADOS -->
                              </table>      
                              </div>
                           </td>
                         </tr>
                      </table>
                          <!-- Fim dos dados do programa - retorno ao modelo -->
                    </div>
                  </td>
                </tr>
                <tr>
                  <td height="15"  align="left" valign="bottom">
                                  <table border="0" align="center" cellpadding="0" cellspacing="0">
                          <tr>
                            <td width="100" align="center" valign="bottom">
                                                        <img src="/cecred/images/botoes/btn_salvar.gif" style="cursor:hand; " onClick="Salvar()">
                                                        </td>
                                                        <td align="center" valign="bottom">
                                                        <img id="encerrar" src="/cecred/images/botoes/cad_aberto.gif" width="34" height="33"  border="0" title="Encerrar a seleção de eventos" onClick="Encerra();" style="cursor:hand; display:none;">
                            <img id="encerrado" src="/cecred/images/botoes/cad_fechado.gif" width="34" height="33"  border="0" title="A seleção de eventos já foi enviada para formação da agenda, não pode mais ser feita alteração." style="display:none;">
                                                        </td>
                        </tr>
                      </table>
                                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</div>
<!-- fim do modelo -->
</form>
<script language="JavaScript">
NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
document.form.action = NomeDoProgramaPrincipal;

function mostraEventos(){
 var row;var cell;

 var cor='#F7F7F7';
 
 document.form.aux_vlcuseve.value = 0;
 document.form.aux_vlprogri.value = 0;
 document.form.aux_salcusto.value = 0;

 //document.all.encerrar.style.visibility="visible";
 //document.all.encerrado.style.visibility="hidden";
 document.all.encerrar.style.display="none";
 document.all.encerrado.style.display="none";
 
 // Apaga todas as linhas, menos a do cabeçalho
 for (var i=document.all.tbevento.rows.length; i>0; i--)
      document.all.tbevento.deleteRow(i-1);           
          
 for(i=0;i<mevento.length;i++){
   
   if((mevento[i].cdcooper == document.form.aux_cdcooper.value)&&
      (mevento[i].cdagenci == document.form.aux_cdagenci.value))
   {
                
      /* verifica se ja esta liberado para o PAC */
          if(mevento[i].flgcusfe == "1"){
         alert("Os dados para este PA não estão prontos. Por favor aguarde mais alguns dias.");
             return false;
      }

      /* Se for evento de integração, não coloca o registro na tabela, apenas
         mostra os dados de quantidade de integrações e o custo delas */
      if (mevento[i].ctevento == '2') 
      {          
         document.form.aux_vlintegr.value = parseFloat(ConverteDec(mevento[i].vlcuseve, "1")) * parseFloat(mevento[i].qtintegr);
         document.form.aux_vlintegr.value = formatCurrency(document.form.aux_vlintegr.value);
         document.form.aux_qtintegr.value = mevento[i].qtintegr;
      }
      /* Não é integração - preenche a tabela normalmente */ 
      else
      { 
         row=tbevento.insertRow(); 
         row.id=mevento[i].cdagenci;
      
         if (cor == '#FFFFFF')
            cor = '#F7F7F7';
         else
            cor = '#FFFFFF';
         
         row.bgColor = cor;
   
         // Valor de Verba do PAC
         document.form.aux_vlprogri.value = formatCurrency(ConverteDec(mevento[i].vlverbap, "1"));
         document.form.aux_qtdevent.value = mevento[i].qtpreeve;
         
      
                cell=row.insertCell();   // Separador
         cell.className = 'txtNormal';
         cell.width= document.all.separador1.width; 
                 cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
             
         // Flag de Selecionado
         cell=row.insertCell();   
         cell.className = 'txtNormal';
         cell.width= document.all.tbevento_col1.width;
         cell.height = 10;
         cell.align = 'left';
         if (mevento[i].flgevobr)
            cell.title = 'Evento obrigatório para a composição da agenda.';
         linky='<in' + 'put type="checkbox" name="aux_flgselec" onclick="AtualizaSaldo();" ' + mevento[i].flgevsel + ' ' + mevento[i].flgevobr + '>';
         cell.innerHTML=linky;                 
      
         cell=row.insertCell();   // Separador
         cell.className = 'txtNormal';
         cell.width= document.all.separador1.width; 
                cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
      
         // Eixo Temático
         cell=row.insertCell();    
         cell.className = 'txtPequeno';
         cell.width= document.all.tbevento_col2.width;
         cell.height = 10;
         cell.align = 'left';
         cell.innerText=mevento[i].dseixtem; 
      
         cell=row.insertCell();
         cell.className = 'txtNormal';
         cell.width= document.all.separador1.width; 
             cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
      
         // Evento
         cell=row.insertCell();    
         cell.className = 'txtPequeno';
         cell.width= document.all.tbevento_col3.width;
         cell.height = 10;
         cell.align = 'left';
         linky=mevento[i].nmevento + '<in' + 'put type="hidden" name="aux_cdevento" value="' + mevento[i].cdevento + '">';
         cell.innerHTML=linky;
      
         cell=row.insertCell();
         cell.className = 'txtNormal';
         cell.width= document.all.separador1.width; 
                cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
      
         // Tipo
         cell=row.insertCell();    
         cell.className = 'txtPequeno';
         cell.width= document.all.tbevento_col4.width;
         cell.height = 10;
         cell.align = 'left';
         cell.innerText=mevento[i].tpevento;
      
         cell=row.insertCell();
         cell.className = 'txtNormal';
         cell.width= document.all.separador1.width; 
                cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
      
         // Carga Horária
         cell=row.insertCell();    
         cell.className = 'txtNormal';
         cell.width= document.all.tbevento_col5.width;
         cell.height = 10;
         cell.align = 'right';
         cell.textAlign = 'right';
         cell.innerText=mevento[i].qtcarhor;
      
         cell=row.insertCell();
         cell.className = 'txtNormal';
         cell.width= document.all.separador1.width; 
                cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
      
         // Custo
         cell=row.insertCell();    
         cell.className = 'txtNormal';
         cell.width= document.all.tbevento_col6.width;
         cell.height = 10;
         cell.align = 'right';
         cell.textAlign = 'right';
         linky=mevento[i].vlcuseve + '<in' + 'put type="hidden" name="aux_vlcusevi" value="' + ConverteDec(mevento[i].vlcuseve, "1") + '">';
         cell.innerHTML=linky;
             
                cell=row.insertCell();
         cell.className = 'txtNormal';
         cell.width= document.all.separador1.width; 
                cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
             
   
         // sugestoes
         cell=row.insertCell();    
         cell.className = 'txtNormal';
         cell.width= document.all.tbevento_col8.width;
         cell.height = 10;
         cell.align = 'right';
         cell.textAlign = 'right';
         cell.innerText=mevento[i].qttoteve;
             
                cell=row.insertCell();
         cell.className = 'txtNormal';
         cell.width= document.all.tbevento_col7.width; 
                cell.height = 26;
         cell.align = 'left';
         cell.innerText='';
                 
         document.form.aux_vlcuseve.value = parseFloat(document.form.aux_vlcuseve.value) + parseFloat(ConverteDec(mevento[i].vlcuseve, "1"));         
         
         
      }
          
          if(mevento[i].flgcusfe == "2"){
                 document.all.encerrar.style.display="none";
         document.all.encerrado.style.display="block";
      }else{
            document.all.encerrar.style.display="block";
            document.all.encerrado.style.display="none";
      }
          
   }
   
   
   
   document.form.aux_vlcuseve.value = formatCurrency(ConverteDec(document.form.aux_vlcuseve.value,"1"));
 } 

 //document.form.aux_salcusto.value = parseFloat(document.form.aux_vlprogri.value) - parseFloat(document.form.aux_vlcuseve.value);

 if(document.all.tbevento.rows.length > 0)
    AtualizaSaldo();

}

function CarregaPrincipal () {
   //top.topFrame.document.all.titulo.innerHTML = 'Distribuição de Verbas - ' + document.form.aux_idevento.value;
   jan3 = open('wpgd0020a.htm','fraux');
   window.status = "";
}

function LimparCampos() {}
function Habilita(){}
function HabilitaSalvar(){}

function ValidaDados(form)
    { 
       var msg="";
         
       /*  msg = msg + top.frcod.VE("ca",form.nmfornec,"O campo de nome do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.dsendfor,"O campo de endereço do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.nmcidfor,"O campo de cidade do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.nmbaifor,"O campo de bairro do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.nrcepfor,"O campo de CEP do Fornecedor","nao");
        msg = msg + top.frcod.VE("ca",form.cdufforn,"O campo de UF do Fornecedor","nao");
        msg = msg + top.frcod.VE("in",form.nrfonfor,"O telefone do Fornecedor","sim", "0", "99999999");
        msg = msg + top.frcod.VE("in",form.nrfaxfor,"O FAX do Fornecedor","sim", "0", "99999999");
        msg = msg + top.frcod.VE("in",form.cddddfor,"O DDD do telefone do Fornecedor","sim", "0", "99999999");
        msg = msg + top.frcod.VE("in",form.cddddfax,"O DDD do FAX do Fornecedor","sim", "0", "99999999");
*/
         
        if (msg == "")
            return true
        else
        {
           top.frcod.MostraResultado('1',msg);
           return false
        }
    }

function Recarrega()
{
   document.form.submit();
}

function Salvar()
{
   // Se não tem nada, não pode fazer nada.
   if (document.all.tbevento.rows.length == 0) 
   { 
      return false;
   } 
//ZeraModoExclusao();
   document.form.aux_stdopcao.value = 'al';
   var vaux = document.form.aux_lspermis.value; 
   if ((vaux.substring(1,2) == 'A') || (document.form.aux_stdopcao.value == 'i')) { 
        if ( document.form.aux_cddopcao.value!='sa')  {
           /*if (ValidaDados(document.forms[0])) {*/
               Habilita(); 
               HabilitaSalvar();               
                           ValidaSalvar();                           
               ArmazenaValores();
               document.form.aux_cddopcao.value='sa'; 
               status = 'Salvando. Por favor, aguarde ...'; 
               document.form.submit(); 
               return true;
               
          /*  } 
            else { 
              return false;
            }  */
        } 
   }
   else { 
         alert('Desculpe, mas você não tem permissão para executar esta função.'); 
         return false;
   }
}

function RetornoDaPesquisa(campo,valor,valor2,valor3,valor4,valor5,valor6,valor7,valor8,valor9,valor10)
{
   if(campo == "media")
   {
      document.form.aux_vlrtotal.value = valor;  // Valor Total (retorna por causa da formatação
      document.form.aux_vlmedpac.value = valor2; // Média por PAC(R$)
      document.form.aux_pemedpac.value = valor3; // Média por PAC(%)
      document.form.aux_vldispac.value = valor4; // Distribuído (R$)
      document.form.aux_pedispac.value = valor5; // Distribuído (%)
      document.form.aux_vlrsaldo.value = valor6; // Saldo (R$)
      document.form.aux_persaldo.value = valor7; // Saldo (%)

      document.form.aux_vlprogri[parseInt(valor8) - 1].value = valor9;
      document.form.aux_peprogri[parseInt(valor8) - 1].value = valor10;
   }

}

function PesquisaCooper()
{
   document.form.aux_vlrtotal.value = '';
   document.form.aux_cddopcao.value = 'pe'; 
   status = 'Pesquisando. Por favor, aguarde ...'; 
   document.form.submit(); 
   return true;
}

function MostraPACs()
{
   for (var i=document.all.aux_cdagenci.options.length; i>=0; i--)
      document.all.aux_cdagenci.remove(i); 

   var oOption;
   
   for(i=0;i<mpac.length;i++)
   {
      if (mpac[i].cdcooper == document.form.aux_cdcooper.value)
      {
         oOption = document.createElement("OPTION");
         document.all.aux_cdagenci.options.add(oOption);
         oOption.innerText = mpac[i].nmresage.substring(0, 15);
         oOption.value = mpac[i].cdagenci;
      }
   }
}

function PosicionaPAC()
{
   if(document.form.aux_cdagenci.value != "")
   {
      //document.form.aux_cdeixtem.value = document.form.cdeixtem.value;
      MostraPACs();          
      document.form.aux_cdagenci.value = document.form.cdagenci.value;
   }
   else
      {
          // posiciona a seleção no primeiro registro de Cooperativas, se só tiver 1
      if(document.all.aux_cdcooper.options.length == 1)
         document.form.aux_cdcooper.value = document.all.aux_cdcooper.options[0].value;
      else
         document.form.aux_cdcooper.value = '';

      // posiciona a seleção no primeiro registro de PACs, se só tiver 1
      if(document.all.aux_cdagenci.options.length == 1)
         document.form.aux_cdagenci.value = document.all.aux_cdagenci.options[0].value;
      else
         document.form.aux_cdagenci.value = '';
   }

   mostraEventos();
}

// Converte um valor com decimal separado por "," para separado por "."
function ConverteDec(str, tipo)
{
   if(tipo == "1")
   {
      str = str.replace(".","");
      str = str.replace(",",".");
      return str;
   }
   else
   {
      str = str.replace(",","");
      str = str.replace(".",",");
      return str;
   }
}

function AtualizaSaldo()
{
   document.form.aux_vlcuseve.value = 0;
   for(i=0;i<document.all.tbevento.rows.length; i++)
   {
      if(document.form.aux_flgselec.length > 1)
      {
         if(document.form.aux_flgselec[i].checked)
         {  
            document.form.aux_vlcuseve.value = parseFloat(ConverteDec(document.form.aux_vlcuseve.value,"1")) + parseFloat(document.form.aux_vlcusevi[i].value);
            document.form.aux_vlcuseve.value = formatCurrency(document.form.aux_vlcuseve.value);
            
         }
      }
      else
      {
         if(document.form.aux_flgselec.checked)
         {
            document.form.aux_vlcuseve.value = parseFloat(ConverteDec(document.form.aux_vlcuseve.value,"1")) + parseFloat(document.form.aux_vlcusevi.value);
            document.form.aux_vlcuseve.value = formatCurrency(document.form.aux_vlcuseve.value);
         }
      }
   }

   document.form.aux_salcusto.value = parseFloat(ConverteDec(document.form.aux_vlprogri.value,"1")) - parseFloat(ConverteDec(document.form.aux_vlcuseve.value,"1")) - parseFloat(ConverteDec(document.form.aux_vlintegr.value,"1"));

   // Se saldo < 0, exibe em vermelho
   if (document.form.aux_salcusto.value < 0)
      document.form.aux_salcusto.style.color = 'red';          
   else
      document.form.aux_salcusto.style.color = '';
          
   document.form.aux_salcusto.value = formatCurrency(document.form.aux_salcusto.value);

}

// Guardar os valores da tabela para que sejam salvos no banco de dados
function ArmazenaValores()
{
   document.form.aux_lsfselec.value = '';
   document.form.aux_lscuseve.value = '';

   
   if ( document.all.tbevento.rows.length > 0)
   {
           if(document.form.aux_flgselec.length > 1) // Se tem mais de um evento
           {        
                  for(i=0;i<document.all.tbevento.rows.length; i++)
                  {
                         // Grava os valores em forma de lista, separados por ";", para que seja lido pelo progress
                         if (document.form.aux_lscuseve.value == '') 
                         {
                                document.form.aux_lsfselec.value = document.form.aux_flgselec[i].checked;
                                document.form.aux_lscuseve.value = document.form.aux_cdevento[i].value;
                         }
                         else
                         {
                                document.form.aux_lsfselec.value = document.form.aux_lsfselec.value + ';' + 
                                                                                                   document.form.aux_flgselec[i].checked;
                                document.form.aux_lscuseve.value = document.form.aux_lscuseve.value    + ';'
                                                                                                 + document.form.aux_cdevento[i].value ;
                         }
                  }
                }
                else
                {        
                   document.form.aux_lsfselec.value = document.form.aux_flgselec.checked;
                   document.form.aux_lscuseve.value = document.form.aux_cdevento.value ;
                }
        }        
}

// Emite as condições básicas na seleção de eventos
function Valida()
{
   var aux_qtdesele = 0;
   var erro = "";
   
   
   // Se não tem nada, não pode fazer nada.
   if (document.all.tbevento.rows.length == 0) 
   {
            if (confirm("A quantidade de eventos selecionados NÃO é o mesmo que o previsto. Sua seleção será analisada pela coordenação do progrid. Deseja prosseguir?") == false)
            erro = "1";
       
      if (erro == "1"){
                return false;
          }else{
                return true;
          }
                

   }
   else
   {
      for(i=0;i<document.all.tbevento.rows.length; i++)
      {
         if(document.form.aux_flgselec.length > 1)
         {        
            if(document.form.aux_flgselec[i].checked)
            {
               aux_qtdesele =  aux_qtdesele + 1;
            }
         }
         else
         {        
                        if(document.form.aux_flgselec.checked)
            {        
               aux_qtdesele =  aux_qtdesele + 1;
            }
         }
      }
   
           
      if(aux_qtdesele != parseInt(document.form.aux_qtdevent.value))
      {
         if (confirm("A quantidade de eventos selecionados NÃO é o mesmo que o previsto. Sua seleção será analisada pela coordenação do progrid. Deseja prosseguir?") == false)
            erro = "1";

                 //alert("A quantidade de eventos selecionados deve ser igual à quantidade de eventos previstos.A atualização pode ser salva, mas não encerrada.");
         //erro = "1";
      }
   
     /* if (parseFloat(document.form.aux_salcusto.value) < 0)
      {
         alert("O saldo não pode ficar negativo. A atualização pode ser salva, mas não encerrada.");
         erro = "1";
      }*/
   
                    
      if (erro == "1")  return false;
      else return true;
   
   }
   
}

// Clicou no fechar o cadeado
function Encerra(){

                
   // Verifica se o usuário tem permissão de salvar
   if (document.form.aux_lspermis.value.substring(1,2) != 'A'){ 
      alert('Desculpe, mas você não tem permissão para executar esta função.'); 
      return false;
   }

   if (Valida())
   { 
      /*rosangela*/
          if (confirm("Após encerrada a seleção dos eventos, os mesmos ficarão bloqueados e as alterações só poderão ser feitas pela coordenação do progrid. Deseja prosseguir?") == false)
            return false;
                        
      if (parseFloat(document.form.aux_salcusto.value) < 0)
         if (confirm("Os eventos selecionados ultrapassam o valor da verba destinada. Sua seleção será analisada pela coordenação do progrid. Deseja prosseguir?") == false)
            return false;
           
          ArmazenaValores();
          document.form.aux_cddopcao.value='enc'; 
          status = 'Salvando. Por favor, aguarde ...'; 
      document.form.submit(); 
      return true;
   }
   
   
}

//formatação dos campos
function formatCurrency(num) 
{
   //alert(num);
   num = num.toString().replace(/\$|\,/g,'');
   if(isNaN(num))
      num = "0";
   sign = (num == (num = Math.abs(num)));
   num = Math.floor(num*100+0.50000000001);
   cents = num%100;
   num = Math.floor(num/100).toString();
   if(cents<10)
      cents = "0" + cents;
   for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
      num = num.substring(0,num.length-(4*i+3))+'.'+
   num.substring(num.length-(4*i+3));
   return (((sign)?'':'-') + num + ',' + cents);
}

//Valida botão Salvar
function ValidaSalvar() 
{    
    var itemselec = false;        
        
        for(i=0;i<document.form.aux_flgselec.length;i++) {            
            if (document.form.aux_flgselec[i].checked == true) {                
                    itemselec = true;                                                                                      
                        break;
            }                                      
        }            
                           
        if (itemselec == false) {
            alert("Nenhum evento selecionado para ser salvo.");
        }        
}

// valida os parâmetros da agenda
if(document.form.aux_dtanoage.value == ''){
   alert('Parâmetro da Agenda Não Encontrado!!!');
   
   document.form.aux_dtanoage.value = '';
   document.form.aux_cdagenci.value = '';
   document.form.aux_cdcooper.value = '';   
}
else
   MostraPACs();   

</script>
</body>
