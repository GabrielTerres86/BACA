<!--
  
  Alteraçoes: 29/08/2017 - Inclusao do filtro por Programa,Prj. 322 (Jean Michel).
  
-->
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <meta name="wsoptions" content="no-output">
    <title>Orçamento</title>
    <base target="mainFrame">
    <link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
  </head>
  <body style="margin-left: 3px; ">
    <form action="#." method="POST" name="form">
      <input name="idevento"     type="hidden" value="">
      <input name="aux_idevento" type="hidden" value="">
      <input name="cdeixtem"     type="hidden" value="">
      <input name="cdcooper"     type="hidden" value="">
      <input name="cdagenci"     type="hidden" value="">
      <input name="nrseqpgm"     type="hidden" value="">
      <input name="aux_cddopcao" type="hidden" id="aux_cddopcao"  value="">
      <input name="aux_lspermis" type="hidden" id="aux_lspermis"  value="">
      <input name="aux_nrdrowid" type="hidden" id="aux_nrdrowid"  value="">    
      <input name="aux_dsretorn" type="hidden" id="aux_dsretorn"  value="">    
      <input name="aux_stdopcao" type="hidden" id="aux_stdopcao"  value="">    
      <input name="aux_dsendurl" type="hidden" id="aux_dsendurl"  value="">    
        
      <!-- Início do modelo geral -->
      <div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 25px; top: 2px; visibility: ;"><img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom"></div>
         <table width="575" height="360" border="0" align="left" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
            <tr>
               <td height="20" colspan="5">
                  <table width="100%"  border="0" cellspacing="0" cellpadding="0">
                     <tr>
                        <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
                        <td width="56"><img src="/cecred/images/geral/spacer.gif" width="10" height="10"></td>
                        <td width="406" height="20" align="left" class="linkGuia">Orçamento</td>
                        <td width="91" height="20" align="right" class="linkGuia">wpgd0036</td>          
                        <td width="11" align="right"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
                        </tr>
                  </table>
               </td>
            </tr>
            <tr valign="top" bgcolor="#FFFFFF">
               <td colspan="5">
                  <table width="100%" height="100%" border="0" align="left" cellpadding="0" cellspacing="0" bgcolor="#999999">
                     <tr>
                        <td valign="top" bgcolor="#FFFFFF">
                           <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">                                         
                              <tr>
                                                         <td width="15%" align="rigth">&nbsp;</td>
                                 <td align="center" valign="middle">
                                   <!-- Interrupção do modelo geral, início dos dados específicos da tela -->
                                    <table border="0" align="left" cellspacing="1" cellpadding="1">
                                       <tr>
                                          <td align="right" class="NomeCampo">Agenda:</td>
                                          <td>
                                            <input type="text" name="aux_dtanoage" size="8" onChange="verifica_coop();">                                                                        
                                          </td>
                                       </tr>
                                       <tr>
                                          <td align="right" class="NomeCampo">Cooperativa:</td>
                                          <td><select name="aux_cdcooper" class="Campo" onChange="document.form.cdcooper.value = document.form.aux_cdcooper.value; document.form.cdagenci.value = ''; document.form.aux_dtanoage.value = ''; document.form.submit();"></select></td>
                                       </tr>
                                       <tr>
                                          <td align="right" class="NomeCampo">PA:</td>
                                          <td><select name="aux_cdagenci" class="Campo" id="aux_cdagenci" onChange="document.form.cdagenci.value = document.form.aux_cdagenci.value; document.form.submit();"></select></td>
                                       </tr>
                                       <tr>
                                          <td align="right" class="NomeCampo">
                                            <div id="divNrseqpgmLabel">Programa:</div>
                                          </td>
                                          <td>
                                            <div id="divNrseqpgm">
                                              <select name="aux_nrseqpgm" class="Campo" id="aux_nrseqpgm" onChange="document.form.nrseqpgm.value = document.form.aux_nrseqpgm.value; document.form.submit();"></select>
                                            </div>  
                                          </td>                                         
                                       </tr>
                                       <tr>
                                          <td align="right" class="NomeCampo">Evento:</td>
                                          <td><select name="aux_cdevento" class="Campo" id="aux_cdevento"></select></td>
                                       </tr>
                                       <tr>
                                          <td align="right" class="NomeCampo">Período:</td>  
                                          <td class="NomeCampo">
                                             <input type="text" name="dataInicial" size="10" maxlength="10" value="" class="Campo" id="dataInicial">
                                             <strong> a </strong>  
                                             <input type="text" name="dataFinal" size="10" maxlength="10" value="" class="Campo" id="dataFinal">
                                          </td>
                                       </tr>
                                       <tr>
                                          <td align="right" class="NomeCampo">&nbsp;</td>
                                          <td class="NomeCampo"><input type="checkbox" name="consideraEventosForaDaAgenda" id="consideraEventosForaDaAgenda" value="ON">Considerar eventos sem data agendada</td>
                                       </tr>
                                       <tr>
                                          <td align="right" class="NomeCampo">Tipo:</td>
                                          <td><select name="tipoDeRelatorio" class="Campo" id="tipoDeRelatorio"></select></td>
                                       </tr>
                                    </table>
                                   <!-- Fim dos dados específicos da tela, reinício do modelo geral -->
                                 </td>
                              </tr>
                              <tr>
                                 <td height="15" align="center" valign="bottom" colspan="2">
                                    <table width="100%" border="0" cellpadding="1" cellspacing="1" align="center">
                                       <tr>
                                          <td align="center"><img style="cursor: hand;" src="/cecred/images/botoes/btn_visualizar_impressao.gif" alt="Procurar a lista de orçamentos" onClick="imprimir()"></td>
                                       </tr>
                                    </table>
                                 </td>
                              </tr>
                           </table>
                        </td>
                     </tr>
                 </table>
               </td>
            </tr>
         </table>
      <!-- Fim do modelo geral -->
    </form>
  </body>
  <script language="JavaScript">
    NomeDoProgramaPrincipal  = '/wpgd0036.w';
    NomeDoProgramaDeListagem = '/wpgd0036ls.w';
    NomeDoProgramaDeAjuda    = '/wpgd0036aj.w';

    NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
    document.form.action = NomeDoProgramaPrincipal;
    var aux_vazio = false;

    function Habilita(){}
    
    function HabilitaSalvar(){}
    
    function ValidaDados(form){ 
      var msg="";
      return true
    }

    function LimparCampos(){}

    function ExaminaCampo(Campo){}
     
    function CarregaPrincipal(){}
            
    function verifica_coop(){

      if (document.form.aux_cdcooper.value == ''){
        alert('A Cooperativa deve ser escolhida!');
        return false;
      }
       
      document.form.submit();
    }            

    function MostraPACs(){
      var numeroDePacs = 0;
      var oOption;
      
      for (var i=document.all.aux_cdagenci.options.length; i>=0; i--){
        document.all.aux_cdagenci.remove(i); 
      }
       
      // posicioca a cooperativa
      if (document.form.cdcooper.value != '')
        document.form.aux_cdcooper.value = document.form.cdcooper.value;
      else
        document.form.aux_cdcooper.value = '';   
       
      numeroDePacs = 0;
      
      for(i=0;i<mpac.length;i++){
        if (mpac[i].cdcooper == document.form.aux_cdcooper.value){
             numeroDePacs = numeroDePacs + 1;
             oOption = document.createElement("OPTION");
             document.all.aux_cdagenci.options.add(oOption);
             oOption.innerText = mpac[i].nmresage.substring(0, 50);
             oOption.value = mpac[i].cdagenci;
        }
      }
      
      if (numeroDePacs > 1 /*&& document.form.aux_idevento.value == 1*/){
        oOption = document.createElement("OPTION");
        document.all.aux_cdagenci.options.add(oOption);
        oOption.innerText = "TODOS";
        oOption.value = "0";
      }
    }

    function PosicionaPAC(){

       // posiciona a cooperativa
       if (document.form.cdcooper.value != '')
           document.form.aux_cdcooper.value = document.form.cdcooper.value;

       if(document.form.cdagenci.value != ''){
          //document.form.aux_cdeixtem.value = document.form.cdeixtem.value;
          //MostraPACs();
          document.form.aux_cdagenci.value = document.form.cdagenci.value;
       }else{
          // posiciona a seleção no primeiro registro de PACs, se só tiver 1
          if(document.all.aux_cdagenci.options.length == 1)
             document.form.aux_cdagenci.value = document.all.aux_cdagenci.options[0].value;
          else
             document.form.aux_cdagenci.value = '';
       }
    }

    function MostraEventos(){
      var numeroDeEventos = 0;

      for (var i=document.all.aux_cdevento.options.length; i>=0; i--)
        document.all.aux_cdevento.remove(i); 

      var oOption;

      numeroDeEventos = 0;
      
      for(i=0;i<mevento.length;i++){
       
        if ((mevento[i].cdcooper == document.form.aux_cdcooper.value)&&
            ((mevento[i].cdagenci == document.form.aux_cdagenci.value) ||
                       (document.form.aux_cdagenci.value == 0))){
          numeroDeEventos = numeroDeEventos + 1;
          oOption = document.createElement("OPTION");
          document.all.aux_cdevento.options.add(oOption);
          oOption.innerText = mevento[i].nmevento.substring(0, 80);
          oOption.value = mevento[i].cdevento;
        }
      }
     
      document.form.aux_cdevento.value = '';

      if (numeroDeEventos > 1){
        oOption = document.createElement("OPTION");
        document.all.aux_cdevento.options.add(oOption);
        oOption.innerText = "TODOS";
        oOption.value = "0";
      }
    
      if ((document.all.aux_cdevento.options.length == 0) && (document.form.aux_cdagenci.value != "")){
        oOption = document.createElement("OPTION");
        document.all.aux_cdevento.options.add(oOption);
        oOption.innerText = "--Não existem eventos disponíveis--";
        oOption.value = "0";
        aux_vazio = "true";
      }
     
      if ((document.all.aux_cdevento.options.length == 0) && (document.form.aux_cdagenci.value == "")){
        oOption = document.createElement("OPTION");
        document.all.aux_cdevento.options.add(oOption);
        oOption.innerText = "--Selecione o PA--";
        oOption.value = "0";
            aux_vazio = "false";
      }
      
      document.form.aux_cdevento.value = '';
      PosicionaEventos()
    }

    function PosicionaEventos(){
      if(document.form.aux_cdevento.value != ""){
        MostraEventos();
      }else{
        // posiciona a seleção no primeiro registro de Eventos, se só tiver 1
        if(document.all.aux_cdevento.options.length == 1)
          document.form.aux_cdevento.value = document.all.aux_cdevento.options[0].value;
        else
          document.form.aux_cdevento.value = '';

        if (document.form.aux_cdagenci.value == "")
          document.form.aux_cdevento.value = '';
      }
    }

    function imprimir(){
      msg      = "";
      nrseqeve = "";

      if (document.form.aux_dtanoage.value=="") 
        msg = "-> Selecione o ano a agenda.\n";
      if (document.form.aux_cdcooper.value=="") 
        msg = msg + "-> Selecione uma cooperativa.\n";
      if (document.form.aux_cdagenci.value=="") 
        msg = msg + "-> Selecione um PA.\n";
      if((document.all.aux_cdevento.options.length == 1) && (aux_vazio == 'true'))
        msg = msg + "Os eventos para esse PA ainda não estão disponíveis. Aguarde a liberação da agenda!!!\n";
      else
      if (document.form.aux_cdevento.value=="") 
          msg = msg + "-> Selecione um evento.\n";
      //if (document.form.aux_cdevento.value=="") 
      //   msg = msg + "-> Selecione um evento.\n";

      msg = msg + top.frcod.VE("da",document.form.dataInicial,"-> A data inicial para pesquisa","sim");
      msg = msg + top.frcod.VE("da",document.form.dataFinal,"-> A data final para pesquisa","sim");


      if (msg!="") 
        alert(msg)
      else{ 
        linha = "wpgd0036a" + 
               "?parametro1=" + document.form.aux_idevento.value +  
               "&parametro2=" + document.form.aux_cdcooper.value + 
               "&parametro3=" + document.form.aux_cdagenci.value + 
               "&parametro4=" + document.form.aux_dtanoage.value + 
               "&parametro5=" + document.form.aux_cdevento.value +
               "&parametro6=" + nrseqeve + 
               "&parametro7=" + document.form.dataInicial.value + 
               "&parametro8=" + document.form.dataFinal.value;
        
        if(document.form.consideraEventosForaDaAgenda.checked) 
          linha = linha + "&parametro9=SIM";
        else
          linha = linha + "&parametro9=NAO";

        linha = linha + "&parametro10=" + document.form.tipoDeRelatorio.value +
                        "&parametro11=" + document.form.nrseqpgm.value;

        imp = window.open(linha,"imp","toolbar=no,location=no,diretories=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,top=10,left=10,width=640,height=400");

      }
    } // imprimir()

    MostraPACs();
    PosicionaPAC();

    if(document.form.nrseqpgm.value != 0){
      document.form.aux_nrseqpgm.value = document.form.nrseqpgm.value;
    }
    MostraEventos();
    PosicionaEventos();

    if((document.all.aux_cdevento.options.length == 1) && (aux_vazio == 'true')){
      alert('Os eventos para esse PA ainda não estão disponíveis. Aguarde a liberação da agenda!!!');
    }
    
    if(document.form.aux_idevento.value == 2){
      document.getElementById("divNrseqpgm").style.display = "none";
      document.getElementById("divNrseqpgmLabel").style.display = "none";
      document.form.nrseqpgm.value = 0;
    }
    
  </script>
</html>