<!--
	Alteracoes: 09/10/2015 - Criação da tela PRJ229 - Melhorias Progrid (Vanessa).
				09/12/2015 - Inclusão do campo cdcopope (Vanessa)
				25/05/2016 - Correcao do carregamento de recursos (Carlos Rafael Tanholi)
-->

<html>
<head>
<title>Recursos (wpgd0008a)</title>
</head>
<body onload="MostraRecursos()">
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
<script SRC="/cecred/jsbiblio/biblio.js"></script>
<script SRC="/cecred/jsbiblio/frcod.js"></script>
<script SRC="/cecred/js/funcoes.js"></script>
<script SRC="/cecred/scripts/jquery.js"></script>
<form action="#." method="POST" name="form">
  <input name="aux_cddopcao" type="hidden" value="">    
  <input name="aux_lspermis" type="hidden" value="">    
  <input name="aux_nrdrowid" type="hidden" value="">
  <input name="aux_stdopcao" type="hidden" value="">
  <input name="aux_dsretorn" type="hidden" value="">  
  <input name="aux_dsendurl" type="hidden" value="">  
  <input name="aux_idevento" type="hidden" value="">  
  <input name="aux_cdcopope" type="hidden"  value="">
  <input name="aux_cdevento" type="hidden"  value="">
  <input name="nrseqdig" type="hidden" value="">


  <!-- Início do modelo geral -->
  <table width="750" border="0" align="left" cellpadding="0" cellspacing="0">
    <tr valign="botton">
      <td>
	    <table border="0" cellpadding="0" cellspacing="0" background="/cecred/images/geral/guia_fundo.gif">
    <tr>
		    <td width="11"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
            <td align="center" nowrap width="150" class="linkGuia">Adicionar Recurso</td>
            <td width="11" align="right"><img src="/cecred/images/geral/guia_direita.gif" width="8" height="21"></td>
          </tr>
	    </table>
	  </td>
    </tr>
    <tr valign="top" bgcolor="#FFFFFF">
      <td colspan="4">
        <table width="100%" height="100%"  border="0" align="left" cellpadding="0" cellspacing="1" bgcolor="#999999">
	<tr>
            <td valign="top" bgcolor="#FFFFFF">
              <table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
                <tr bgcolor="#FFFFFF">
                  <td>&nbsp;
                    
                  </td>
	</tr>
	<tr>
                  <td height="15" align="left">&nbsp;</td>
                  <td height="15" align="left">
                    <!-- Interrupção do modelo geral, início dos dados específicos da tela -->
                    <table border="0" align="center" cellspacing="0">
                      <tr>
                        <td align="right" class="NomeCampo">Recurso:</td>
                        <td align="left">
                          <select name="aux_nrseqdig" id="aux_nrseqdig"  size="1" class="Campo"></select>                          
                        </td>
	</tr>
	<tr>
												<td align="right" class="NomeCampo"><div class="divQuantidade">Quantidade:</div></td>
												<td align="left" height="20" class="NomeCampo">
													<input name="aux_idrecpor" type="hidden" value="">
													<input name="aux_cdtiprec" type="hidden" value="">
													<div class="divQuantidade"><input name="qtreceve" id="qtreceve" type="text" class="Campo" size="10" maxlength="5"></div>
													<div class="divParticipante"> a cada <input name="qtgrppar" id="qtgrppar" type="text" class="Campo" size="6" maxlength="5">
													 Participantes &nbsp;&nbsp;&nbsp;&nbsp;</div>
	  </td>	  
					
	</tr>
	<tr>
                        <td align="right" class="NomeCampo">&nbsp;&nbsp;&nbsp;&nbsp;</td>                           
	</tr>
                    </table>
                    <table width="100" align="center">
    <tr>
                        <td colspan="2"><img style="cursor:hand;" src="/cecred/images/botoes/btn_salvar.gif" width="60" height="20" onClick="return Salvar()"></td>
											</tr>
                    </table>					
                    <!-- Fim dos dados específicos da tela, reinício do modelo geral -->
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
	  </td>
	</tr>	
  </table>
  <!-- Fim do modelo geral -->
</form>
<script language="JavaScript">
   NomeDoProgramaPrincipal  = '/wpgd0008a.w';
   
   NomeDoProgramaPrincipal = document.form.aux_dsendurl.value + NomeDoProgramaPrincipal;
   document.form.action = NomeDoProgramaPrincipal;
   //document.form.aux_nrcpfcgc.style.border='none';
 
function CarregaPrincipal(){
	if (document.form.aux_stdopcao.value == "") {
	   LimparCampos();
	}
	
}

function MostraRecursos(){ 
   for (var i=document.all.aux_nrseqdig.options.length; i>=0; i--)
      document.all.aux_nrseqdig.remove(i); 
  
   var oOption;
   var nrseqdig;

   oOption = document.createElement("OPTION");
   document.all.aux_nrseqdig.options.add(oOption);
   oOption.innerText = "Selecione o Recurso";
   oOption.value = 0;
   
   for(i=0;i<recursos.length;i++){     
	     oOption = document.createElement("OPTION");
         document.all.aux_nrseqdig.options.add(oOption);
         oOption.innerText = recursos[i].dsrecurs;
         oOption.value = recursos[i].nrseqdig;
		 oOption.idrecpor = recursos[i].idrecpor;
		 oOption.cdtiprec = recursos[i].cdtiprec;
		 if ( recursos[i].nrseqdig == document.form.nrseqdig.value){ 
			oOption.selected = document.form.nrseqdig.value;
		}
      
   }
      
}


function LimparCampos(){
    document.form.nrseqdig.value = 0;
    document.form.qtgrppar.value = "";
	document.form.qtreceve.value = "";
    document.form.nrseqdig.focus();
}

function Incluir(){

 var vaux = document.form.aux_lspermis.value; 
  if(vaux.substring(0,1) == 'I'){ 
    if(document.form.aux_stdopcao.value == 'i'){ 
      MostraResultado('1','Você já esta no modo de inclusão.'); 
      return false
    } 
    else{ 
      document.form.aux_cddopcao.value='in'; 
      document.form.aux_stdopcao.value='i'
      LimparCampos(); 
      return true
    } 
  } 
  else{ 
    MostraResultado('1','Desculpe, mas você não tem permissão para executar esta função.'); 
    return false
  }
}

function Salvar(){
   var vaux = document.form.aux_lspermis.value; 
  if((vaux.substring(1,2) == 'A') || (document.form.aux_stdopcao.value == 'i')) 
  {
     if(ValidaDados(document.forms[0]))
     {
            document.form.aux_cddopcao.value='sa'; 
            status = 'Salvando. Por favor, aguarde ...';			
        document.form.aux_cddopcao.value='sa';
        //document.form.aux_nrcpfcgc.value =  TiraFormato(document.form.aux_nrcpfcgc.value);
        document.form.aux_nrseqdig.disabled = false
			document.form.submit();
            return true;
        } 
     else
     { 
            return false;
        }  
   }
  else
  {
     MostraResultado('1','Desculpe, mas você não tem permissão para executar esta função.'); 
         return false;
   }
}
function ValidaDados(form){ 
   var msg="";

   if (form.aux_nrseqdig.value == 0){
	  msg = "Selecione um Recurso!";
   }

	if ((form.aux_idrecpor.value == 1 || form.aux_idrecpor.value == 3) && form.aux_cdtiprec.value != 2){
		if (form.qtreceve.value == 0){
			msg = "Digite uma Quantidade!";
     }
		if (form.aux_idrecpor.value == 3 && form.qtgrppar.value == 0 ){
			msg = "Digite uma Quantidade para cada Participante!";
	 }
  }
   
   
	  
   if (msg == "")
      return true
  else{
      MostraResultado('1',msg);
      return false
     }
     }

// Tirar os formatos de CPF e CNPJ, deixando somente os numeros
function TiraFormato(campo)
{
   //Retirar a formatação de CPF e CNPJ
   campo = campo.replace(".",""); 
   campo = campo.replace(".","");
   campo = campo.replace(".","");
   campo = campo.replace("/","");
   campo = campo.replace("-","");

   return campo;
  }  

function Restaurar(){ 
 alert('Atualização executada com sucesso.');
 window.opener.mostraDiv('divRecurso');
 window.opener.form.submit();
}

$(".divQuantidade").css("float", "left");
$(".divQuantidade").css("display", "block");
$(".divParticipante").css("display", "block");

var idrecpor =  document.form.aux_idrecpor.value;
var cdtiprec =  document.form.aux_cdtiprec.value;

if ((idrecpor == 1 || idrecpor == 3) && cdtiprec != 2){
  $(".divQuantidade").css("display", "block");
  if(idrecpor == 3){
    $(".divParticipante").css("display", "block");
  } else {
    $(".divParticipante").css("display", "none");
 }
}else{
  $(".divQuantidade").css("display", "none");
  $(".divParticipante").css("display", "none");
}

$('#qtreceve').bind('keyup', function() { 
    $(this).val( $(this).val().replace(/[^0-9]/g,'') ); 
});

$('#qtgrppar').bind('keyup', function() { 
    $(this).val( $(this).val().replace(/[^0-9]/g,'') ); 
});

$("#aux_nrseqdig").change(function() {
  var idrecpor = $(this).children(":selected").attr("idrecpor");
  var cdtiprec = $(this).children(":selected").attr("cdtiprec");

  document.form.aux_idrecpor.value = idrecpor;
  document.form.aux_cdtiprec.value = cdtiprec;

  if ((idrecpor == 1 || idrecpor == 3) && cdtiprec != 2){
    $(".divQuantidade").css("display", "block");
    if(idrecpor == 3 && cdtiprec != 2){
      $(".divParticipante").css("display", "block");
    } else {
      $(".divParticipante").css("display", "none");
    }
  }else{
    $(".divQuantidade").css("display", "none");
    $(".divParticipante").css("display", "none");
  }
 
});

if (document.form.nrseqdig.value > 0){
	$("#aux_nrseqdig").attr('disabled', 'disabled');
}   
   
</SCRIPT>
</body>
</html>
