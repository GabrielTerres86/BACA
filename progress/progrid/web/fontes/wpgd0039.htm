<!-- 
Alterações:  06/11/2008 - Tratamento de listagem por paginação (Martin).

             10/12/2008 - Melhoria de performance para a tabela gnapses (Evandro).
             
             20/03/2008 - Checa quais os Inputs do HTML estão disponiveis para serem tratados (Martin)
                         
             05/06/2012 - Adaptação dos fontes para projeto Oracle. Alterado
                          busca na gnapses de CONTAINS para MATCHES (Guilherme Maba).

             21/12/2012 - Mudar estrutura do campo dsobjeti (Gabriel)     
             
             26/01/2016 - Incluir coluna Parceira Institucional para eventos,tratar temas 
                          restritos a publicacao na CRAPTEM E CRAPEDP, não apresentar eventos 
                          do tipo EAD no CAMPO de filtro "Evento".(Carlos Rafael Tanholi)

             08/03/2016 - Alterado para que os eventos do tipo EAD e EAD Assembleia não SEJAM 
                          APRESENTADOS. Projeto 229 - Melhorias OQS (LOMBARDI)
                          
             15/04/2016 - Correcao no carregamento de eventos que sao restritos a publicacao
                          levando em consideracao o cadastro do tema envolvido consistindo o
                          campo idrespub. (Carlos Rafael Tanholi)
-->
<html>
<head>
<meta name="AUTHOR" content="Rosangela">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="wsoptions" content="no-output">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta http-equiv="Cache-Control" content="No-Cache">
<meta http-equiv="Pragma"        content="No-Cache">
<meta http-equiv="Expires"       content="0">
<title>Liberação para Internet</title>
<link href="/cecred/estilos/progrid.css" rel="stylesheet" type="text/css">
<script SRC="/cecred/jsbiblio/sorttable.js"></script>
</head>
<body style="margin-left: 3px; ">
<script language="JavaScript">
  NomeDoProgramaPrincipal  = '/wpgd0039.w';
  NomeDoProgramaDeListagem = '/wpgd0039ls.w';
  NomeDoProgramaDeAjuda    = '/wpgd0039aj.w';
  NomeDoProgramaDeZoom     = '/zoom/zwpgd0039.w';
</script>
<script language="SpeedScript">
        DEF VAR aux_lspermis          AS CHAR                           NO-UNDO.
        DEF VAR IdentificacaoDaSessao AS CHAR      FORMAT "x(47)"             NO-UNDO.
        DEF VAR aux_selected          AS CHAR                                                      NO-UNDO.
        DEF VAR aux_dtanoage          LIKE gnpapgd.dtanoage                            NO-UNDO.
        DEF VAR aux_cdcooper          LIKE gnpapgd.cdcooper                            NO-UNDO.
        DEF VAR aux_idevento          LIKE gnpapgd.idevento                     NO-UNDO.
        DEF VAR v-identificacao       AS CHAR                           NO-UNDO.
        DEF VAR aux_cordalinha        AS CHAR                           NO-UNDO.
        DEF VAR aux_flgerrodata       AS LOGICAL                                                NO-UNDO.
    DEF VAR cQuery                AS CHAR                           NO-UNDO.
    DEF VAR hQuery                AS HANDLE                         NO-UNDO. 
        DEF VAR aux_flgerrofaixa      AS LOGICAL                                                NO-UNDO.                
        DEF VAR aux_dscritic          AS CHAR                           NO-UNDO.
        DEF VAR aux_nrmeseve          AS INT                            NO-UNDO.
        DEF VAR aux_cdevento          AS INT                            NO-UNDO.
    DEF VAR aux_cdagenci          AS INT                            NO-UNDO.        
        DEF VAR aux_maxrows           AS INT  INIT 60                   NO-UNDO. 
        def var aux_contarows         as int                            NO-UNDO.
    DEF VAR aux_dsmeseve          AS CHAR                                                        NO-UNDO.
        DEF VAR aux_dsstatus          AS CHAR                                                        NO-UNDO.
        DEF VAR aux_nmpagina          AS CHAR                                                        NO-UNDO.
    DEF VAR aux_paginacao         AS CHAR                           NO-UNDO.
    DEF VAR aux_ultchave          AS CHAR                           NO-UNDO.
    DEF VAR aux_prichave          AS CHAR                           NO-UNDO.
    DEF VAR aux_dsdolink          AS char                                                NO-UNDO.
    def var aux_camposTela        as char                           no-undo.
        DEF VAR aux_dsdmeses          AS CHAR   EXTENT 12
                                      INIT["JANEIRO","FEVEREIRO","MARÇO","ABRIL","MAIO",
                                                                           "JUNHO","JULHO","AGOSTO","SETEMBRO","OUTUBRO",
                                                                           "NOVEMBRO","DEZEMBRO"]       NO-UNDO.        
    DEF VAR aux_nmprcins          LIKE crappri.nmprcins                     NO-UNDO.
    DEF VAR aux_mostrar 		  AS CHAR                           NO-UNDO.
   
        /*** Declaração de BOs ***/
    DEF VAR h-b1wpgd0008          AS HANDLE                         NO-UNDO.
    DEF VAR h-b1wpgd0030          AS HANDLE                         NO-UNDO.
             
        DEF TEMP-TABLE cratedp NO-UNDO LIKE crapedp.
        
        DEF TEMP-TABLE cratadp NO-UNDO LIKE crapadp.
        
        DEF TEMP-TABLE cratage NO-UNDO
            FIELD cdcooper LIKE crapage.cdcooper
                FIELD cdagenci LIKE crapage.cdagenci
                FIELD nmresage LIKE crapage.nmresage.
        
  

    /* Somente para usar a include que carrega os PAC'S */
    DEF TEMP-TABLE ab_unmap NO-UNDO
        FIELD aux_idevento AS CHAR.

        ASSIGN aux_cdcooper = INT(GET-VALUE("aux_cdcooper"))
           aux_dtanoage = INT(GET-VALUE("aux_dtanoage"))
                   aux_idevento = INT(GET-VALUE("aux_idevento"))
                   aux_nrmeseve = INT(GET-VALUE("aux_nrmeseve"))
                      aux_cdagenci = INT(GET-VALUE("aux_cdagenci"))
                      aux_cdevento = INT(GET-VALUE("aux_cdevento"))                   
                   aux_nmpagina = GET-VALUE("pagina").
                   
        v-identificacao = get-cookie("cookie-usuario-em-uso").

          /* Usado FOR EACH para poder utilizar o CONTAINS e WORD-INDEX, alterado para MATCHES */
      FOR EACH gnapses WHERE gnapses.idsessao MATCHES "*" + v-identificacao + "*" NO-LOCK:
          LEAVE.
      END.

        
    /* trata permissão de acesso */
        RUN PermissaoDeAcesso(INPUT 'wpgd0039', OUTPUT IdentificacaoDaSessao, OUTPUT aux_lspermis).
        
        
        /* Se a cooperativa ainda não foi escolhida, pega a da sessão do usuário */
        IF   aux_cdcooper = 0   THEN
             aux_cdcooper = gnapses.cdcooper.

    FIND LAST gnpapgd WHERE gnpapgd.idevento = aux_idevento   AND 
                            gnpapgd.cdcooper = aux_cdcooper   AND 
                            gnpapgd.dtanonov = aux_dtanoage   NO-LOCK NO-ERROR.

    IF NOT AVAILABLE gnpapgd THEN
       DO:
          IF   aux_dtanoage <> 0   THEN
               RUN RodaJavaScript("alert('Nao existe agenda para o ano (" + STRING(aux_dtanoage) + ") informado!');").

          FIND LAST gnpapgd WHERE gnpapgd.idevento = aux_idevento   AND 
                                  gnpapgd.cdcooper = aux_cdcooper   NO-LOCK NO-ERROR.

       END.

    IF AVAILABLE gnpapgd THEN
       ASSIGN aux_dtanoage = gnpapgd.dtanonov.
    ELSE
       ASSIGN aux_dtanoage = 0.
           
        RUN carrega_pacs.                   
           
    ASSIGN aux_paginacao = if GET-VALUE("aux_paginacao") = "" THEN "" ELSE GET-VALUE("aux_paginacao").
           aux_ultchave  = IF GET-VALUE("aux_ultchave") = "" THEN "" ELSE GET-VALUE("aux_ultchave").
           aux_prichave  = IF GET-VALUE("aux_prichave") = "" THEN "" ELSE GET-VALUE("aux_prichave").

        IF   REQUEST_METHOD = "POST"            THEN        
                 DO:
             /* Salva Eventos */
                     IF   GET-VALUE("aux_cddopcao") = "sa_ev"   THEN
                              DO:                 
                     /* Instancia as BO's para executar as procedures */
                     RUN dbo/b1wpgd0008.p PERSISTENT SET h-b1wpgd0008.
                                 RUN dbo/b1wpgd0030.p PERSISTENT SET h-b1wpgd0030.

                                 /* Se as BO's foram instanciadas */
                                 IF   VALID-HANDLE(h-b1wpgd0008)   AND
                                      VALID-HANDLE(h-b1wpgd0030)   THEN
                                          DO:                 
                                              ASSIGN aux_flgerrodata = NO
                                                                 aux_flgerrofaixa = NO
                                     aux_camposTela   = get-field(?).

                                           /* Faz a atualização das datas na base */ 
                                      FOR EACH crapedp WHERE crapedp.idevento = aux_idevento   AND
                                                             crapedp.cdcooper = aux_cdcooper   AND
                                                             crapedp.dtanoage = aux_dtanoage   AND
                                                             crapedp.tpevento <> 10            AND
                                                             crapedp.tpevento <> 11            NO-LOCK:

                                  /* Verifica se o input HTML procurado está na tela */
                                  IF lookup("aux_dtlibint_" + STRING(crapedp.cdevento),aux_camposTela) = 0 THEN
                                     next.
                                                                                                         
                                                                  /* Verifica se foi digitado datas válidas do calendário */
                                                                  DATE(GET-VALUE("aux_dtlibint_" + STRING(crapedp.cdevento))) NO-ERROR.
                                                                  
                                                                  IF   ERROR-STATUS:ERROR = NO   THEN
                                                       DATE(GET-VALUE("aux_dtretint_" + STRING(crapedp.cdevento))) NO-ERROR.
                                                                  
                                                                  IF   ERROR-STATUS:ERROR = YES   THEN
                                                           DO:
                                                               aux_flgerrodata = YES.
                                                                   NEXT.                                           
                                                           END.                                                                  
                                                                        
                                                  /* Se uma das datas for preenchida a outra também deve ser */
                                                  IF   (DATE(GET-VALUE("aux_dtlibint_" + STRING(crapedp.cdevento))) <> ?  AND
                                                        DATE(GET-VALUE("aux_dtretint_" + STRING(crapedp.cdevento)))  = ?)       OR
                                                           (DATE(GET-VALUE("aux_dtlibint_" + STRING(crapedp.cdevento)))  = ?  AND
                                                            DATE(GET-VALUE("aux_dtretint_" + STRING(crapedp.cdevento))) <> ?)       THEN
                                                            DO:
                                                                aux_flgerrodata = YES.
                                                                    NEXT.                                           
                                                            END.
                                                                                
                                                                  /* Verifica se a faixa de liberação e retirada está "dentro" da faixa da programação */
                                          FIND FIRST crapadp WHERE crapadp.idevento = crapedp.idevento   AND
                                                                               crapadp.cdcooper = crapedp.cdcooper   AND
                                                                                                       crapadp.dtanoage = crapedp.dtanoage   AND
                                                                                                       crapadp.cdevento = crapedp.cdevento   AND
                                                                                                                  ((crapadp.dtlibint <> ? AND DATE(GET-VALUE("aux_dtlibint_" + STRING(crapedp.cdevento))) = ?) OR                                                                                                  
                                                                                                                    crapadp.dtlibint < DATE(GET-VALUE("aux_dtlibint_" + STRING(crapedp.cdevento)))             OR
                                                                                                                    crapadp.dtretint > DATE(GET-VALUE("aux_dtretint_" + STRING(crapedp.cdevento))))            NO-LOCK NO-ERROR.   
                                                                           
                                                                  IF   AVAILABLE crapadp                                               AND
                                                                       GET-VALUE("aux_propagar_" + STRING(crapedp.cdevento)) <> "on"   THEN                                                                       
                                                                           DO:
                                                                              aux_flgerrofaixa = YES.
                                                                                  NEXT.
                                                                           END.                                                                        
                                                                        
                                              EMPTY TEMP-TABLE cratedp.
                                                          CREATE cratedp.
                                                          BUFFER-COPY crapedp TO cratedp.
                                                  
                                                          ASSIGN cratedp.dtlibint = DATE(GET-VALUE("aux_dtlibint_" + STRING(crapedp.cdevento)))
                                                  cratedp.dtretint = DATE(GET-VALUE("aux_dtretint_" + STRING(crapedp.cdevento))).

                                                          RUN altera-registro IN h-b1wpgd0008(INPUT TABLE cratedp, OUTPUT aux_dscritic).
                                                  
                                                          IF   aux_dscritic = ""   THEN
                                                               /* Verifica se deve fazer a propagação das datas escolhidas */
                                                                   IF   GET-VALUE("aux_propagar_" + STRING(crapedp.cdevento)) = "on"   THEN
                                                                        FOR EACH crapadp WHERE crapadp.idevento = crapedp.idevento   AND
                                                                                       crapadp.cdcooper = crapedp.cdcooper   AND
                                                                                                               crapadp.dtanoage = crapedp.dtanoage   AND
                                                                                                               crapadp.cdevento = crapedp.cdevento   NO-LOCK:
                                                                                                                   
                                                                                        EMPTY TEMP-TABLE cratadp.
                                                                                          CREATE cratadp.
                                                                                          BUFFER-COPY crapadp TO cratadp.                                                                                                                   
                                                                                         
                                                                                      ASSIGN cratadp.dtlibint = crapedp.dtlibint
                                                                               cratadp.dtretint = crapedp.dtretint.
                                                                                           
                                                                                    RUN altera-registro IN h-b1wpgd0030(INPUT TABLE cratadp, OUTPUT aux_dscritic).                                                                                           
                                                                END.                                                                                            
                                          END.
                                          
                                                  /* "mata" a instância das BO's */
                              DELETE PROCEDURE h-b1wpgd0008 NO-ERROR.
                                                  DELETE PROCEDURE h-b1wpgd0030 NO-ERROR.
                                      END.
                                  
                     IF   aux_flgerrodata   THEN
                                         RUN RodaJavaScript("alert('ATENÇÃO!!! Um ou mais eventos NÃO foram atualizados.~\n~\nAs datas de Liberar e Retirar deverão estar preenchidas com datas válidas ou ambas em branco.');").

                                 IF   aux_flgerrofaixa  THEN
                                         RUN RodaJavaScript("alert('ATENÇÃO!!! Um ou mais eventos NÃO foram atualizados.~\n~\nAs datas do EVENTO devem estar ~"dentro~" da faixa de~\ndatas de Liberação e Retirada descritas na aba de PROGRAMAÇÃO.');").
                                                  
                                         IF   NOT aux_flgerrodata    AND
                                              NOT aux_flgerrofaixa   THEN
                                      RUN RodaJavaScript("alert('Atualizacao executada com sucesso.')").

                              END. /* Fim Eventos */
                         ELSE
             /* Salva Programação */
                     IF   GET-VALUE("aux_cddopcao") = "sa_pr"   THEN
                              DO:                 
                                  /* Instancia a BO para executar as procedures */
                                 RUN dbo/b1wpgd0030.p PERSISTENT SET h-b1wpgd0030.

                                 /* Se a BO foi instanciada */
                                 IF   VALID-HANDLE(h-b1wpgd0030)   THEN
                                          DO:                 
                                              ASSIGN aux_flgerrodata = NO
                                                                 aux_flgerrofaixa = NO
                                     aux_camposTela = get-field(?).
                              FOR EACH crapadp WHERE crapadp.idevento = aux_idevento   AND
                                                                                                 crapadp.cdcooper = aux_cdcooper   AND
                                                                                                         crapadp.dtanoage = aux_dtanoage   AND
                                                                                                        (crapadp.cdevento = aux_cdevento   OR
                                                                                                         aux_cdevento     = 0) /*TODOS*/   AND
                                                                                                        (crapadp.cdagenci = aux_cdagenci   OR
                                                                                                         aux_cdagenci     = 0) /*TODOS*/   AND
                                                                                                        (crapadp.nrmeseve = aux_nrmeseve   OR
                                                                                                         aux_nrmeseve     = 0) /*TODOS*/   NO-LOCK:

                                  /* Verifica se o input HTML procurado está na tela */
                                  IF lookup("aux_dtlibint_" + STRING(crapadp.nrseqdig) + "_2",aux_camposTela) = 0 THEN
                                      next.
                                                                  /* Verifica se foi digitado datas válidas do calendário */
                                                                  DATE(GET-VALUE("aux_dtlibint_" + STRING(crapadp.nrseqdig) + "_2")) NO-ERROR.

                                                                  IF   ERROR-STATUS:ERROR = NO   THEN
                                                       DATE(GET-VALUE("aux_dtretint_" + STRING(crapadp.nrseqdig) + "_2")) NO-ERROR.
                                                                  
                                                                  IF   ERROR-STATUS:ERROR = YES   THEN
                                                           DO:
                                                               aux_flgerrodata = YES.
                                                                   NEXT.                                           
                                                           END.
                                                                                                         
                                  /* Se uma das datas for preenchida a outra também deve ser */
                                                  IF   (DATE(GET-VALUE("aux_dtlibint_" + STRING(crapadp.nrseqdig) + "_2")) <> ?  AND
                                                        DATE(GET-VALUE("aux_dtretint_" + STRING(crapadp.nrseqdig) + "_2"))  = ?)       OR
                                                           (DATE(GET-VALUE("aux_dtlibint_" + STRING(crapadp.nrseqdig) + "_2"))  = ?  AND
                                                            DATE(GET-VALUE("aux_dtretint_" + STRING(crapadp.nrseqdig) + "_2")) <> ?)       THEN
                                                            DO:
                                                                aux_flgerrodata = YES.
                                                                    NEXT.                                           
                                                            END.
                                                                                
                                                                  /* Verifica se a faixa de liberação e retirada está "dentro" da faixa do evento */
                                          FIND crapedp WHERE crapedp.idevento = crapadp.idevento   AND
                                                                 crapedp.cdcooper = crapadp.cdcooper   AND
                                                                                     crapedp.dtanoage = crapadp.dtanoage   AND
                                                                                                         crapedp.cdevento = crapadp.cdevento   NO-LOCK NO-ERROR.
                                                                                                         
                                                                  IF   NOT AVAILABLE crapedp   THEN
                                                                       NEXT.
                                                                           
                                                                  IF   (crapedp.dtlibint = ? AND DATE(GET-VALUE("aux_dtlibint_" + STRING(crapadp.nrseqdig) + "_2")) <> ?) OR
                                                                       (DATE(GET-VALUE("aux_dtlibint_" + STRING(crapadp.nrseqdig) + "_2")) < crapedp.dtlibint)            OR
                                                                       (DATE(GET-VALUE("aux_dtretint_" + STRING(crapadp.nrseqdig) + "_2")) > crapedp.dtretint)            THEN
                                                                           DO:
                                                                              aux_flgerrofaixa = YES.
                                                                                  NEXT.
                                                                           END.                                                                                                                                                                           
                                                                                                                   
                                                                  EMPTY TEMP-TABLE cratadp.
                                                                    CREATE cratadp.
                                                                    BUFFER-COPY crapadp TO cratadp.                                                                                                                   
                                                                                         
                                                                    ASSIGN cratadp.dtlibint = DATE(GET-VALUE("aux_dtlibint_" + STRING(crapadp.nrseqdig) + "_2"))
                                                                 cratadp.dtretint = DATE(GET-VALUE("aux_dtretint_" + STRING(crapadp.nrseqdig) + "_2")).
                                                                                           
                                                                  RUN altera-registro IN h-b1wpgd0030(INPUT TABLE cratadp, OUTPUT aux_dscritic).                                                                                            
                                          END.
                                          
                                                  /* "mata" a instância da BO */
                                                  DELETE PROCEDURE h-b1wpgd0030 NO-ERROR.
                                      END.
                                  
                                 IF   aux_flgerrodata   THEN
                                         RUN RodaJavaScript("alert('ATENÇÃO!!! Um ou mais eventos NÃO foram atualizados.~\n~\nAs datas de Liberar e Retirar deverão estar preenchidas com datas válidas ou ambas em branco.');").
                                                  
                                 IF   aux_flgerrofaixa  THEN
                                         RUN RodaJavaScript("alert('ATENÇÃO!!! Um ou mais eventos NÃO foram atualizados.~\n~\nAs datas da PROGRAMAÇÃO devem estar ~"dentro~" da faixa de~\ndatas de Liberação e Retirada descritas na aba de EVENTOS.');").

                                         IF   NOT aux_flgerrodata    AND
                                              NOT aux_flgerrofaixa   THEN                                         
                                      RUN RodaJavaScript("alert('Atualizacao executada com sucesso.')").                                                  
                              END. /* Fim Programação */                                  
                 END.
                        
        PROCEDURE PermissaoDeAcesso :
                {includes/wpgd0009.i}
        END PROCEDURE.

        PROCEDURE RodaJavaScript:
            {includes/rodajava.i}
        END PROCEDURE.
        
        PROCEDURE carrega_pacs:
             DEF VAR aux_contador          AS INT                            NO-UNDO.
             DEF VAR aux_flgfirst          AS LOGICAL    INIT TRUE           NO-UNDO.
       DEF VAR vetorpac              AS CHAR                           NO-UNDO.
       DEF VAR aux_registro          AS CHAR                           NO-UNDO.
       DEF VAR aux_campo             AS CHAR                           NO-UNDO.                              
                                
           EMPTY TEMP-TABLE ab_unmap.
           CREATE ab_unmap.
           ASSIGN ab_unmap.aux_idevento = STRING(aux_idevento).                   
                        
             /* PROGRID - Agrupamento de PAC's */
           { includes/wpgd0099.i STRING(aux_dtanoage) }
                 
           /* Alimenta a temp-table de pac's */
           EMPTY TEMP-TABLE cratage.
                      
           DO aux_contador = 1 TO NUM-ENTRIES(vetorpac,"~{"):
           
          /* cada registro é separado por "{" */
              aux_registro = ENTRY(aux_contador,vetorpac,"~{").
          IF   aux_registro = ""   THEN NEXT.
                  
                  CREATE cratage.                  
                         /* cdcooper */
                  ASSIGN aux_campo = SUBSTRING(ENTRY(1,aux_registro,","),11)
                         aux_campo = SUBSTRING(aux_campo,1,LENGTH(aux_campo) - 1)
                                 cratage.cdcooper = INT(aux_campo)
                                 
                                 /* cdagenci */
                         aux_campo = SUBSTRING(ENTRY(2,aux_registro,","),11)
                         aux_campo = SUBSTRING(aux_campo,1,LENGTH(aux_campo) - 1)
                                 cratage.cdagenci = INT(aux_campo)
                                 
                                 /* nmresage */
                         aux_campo = SUBSTRING(ENTRY(3,aux_registro,","),11)
                         aux_campo = SUBSTRING(aux_campo,1,LENGTH(aux_campo) - 2)
                                 cratage.nmresage = aux_campo.
                                 
                  /* despreza o PAC, se a cooperativa não for a selecionada */
                  IF   cratage.cdcooper <> aux_cdcooper   THEN
                       DELETE cratage.
           END.
           
        END PROCEDURE.                        
</script>

<form method="POST" name="form">
  <div align="left">
    <input type="hidden" name="aux_dsendurl" value="">
    <input type="hidden" name="aux_cddopcao" value="">
    <input type="hidden" name="aux_nrdrowid" value="">
    <input type="hidden" name="aux_lspermis" value="`aux_lspermis`">
    <input type="hidden" name="aux_dsretorn" value="">
    <input type="hidden" name="aux_stdopcao" value="">
    <input type="hidden" name="aux_idexclui" value="">
        <input type="hidden" name="aux_idevento" value="`aux_idevento`">        
    <input type="hidden" name="aux_lsevento" value="">                
        <input type="hidden" name="cdcooper"     value="">
    <input type="hidden" name="pagina"       value="`aux_nmpagina`">
        </div>      
          <!-- Inicio do modelo com abas -->
          <div id="Layer1" style="position:absolute; border:0px; width:35px; height:35; z-index:1; left: 18px; top: 2px; visibility: ;"><img src="/cecred/images/icones/ico_fornecedor.gif" width="28" height="32" align="bottom"> </div>
          <table width="575" height="360"  border="0" align="left" cellpadding="0" cellspacing="0">
    <tr>
      <td height="20">
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
          <tr>
            <td>
              <table width="100%" border="0" cellpadding="0" cellspacing="0">
                <tr>
                  <td width="1%" height="20"><img src="/cecred/images/geral/guia_esquerda.gif" width="11" height="21"></td>
                  <td width="10%" height="20" align="center" nowrap background="/cecred/images/geral/guia_fundo.gif" class="linkGuia">&nbsp;</td>
                  <td width="48%" height="20" align="left" nowrap background="/cecred/images/geral/guia_fundo.gif" class="linkGuia">Liberação para Internet </td>
                  <td width="40%" height="20" align="right" nowrap background="/cecred/images/geral/guia_fundo.gif" class="linkGuia">wpgd0039</td>
                  <td width="1%" height="20" align="right"><img src="/cecred/images/geral/guia_direita.gif" width="11" height="21"></td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr valign="top" bgcolor="#FFFFFF">
      <td>
       <table width="674" height="100%" border="0" align="left" cellpadding="0" cellspacing="1" bgcolor="#999999" >
                 <tr>
        <td height="200" valign="top" bgcolor="#999999">
                
                <table width="674" height="100%" border="0" align="left" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF" >
                    <tr>
            <td height="200" valign="top" bgcolor="#FFFFFF">
              <table width="674" border="0" cellpadding="0" cellspacing="0">
                <tr>
                  <td align="left" valign="top">                        
                              <table width="650"  border="0" cellpadding="0" cellspacing="0">
                      <tr>
                        <td height="10" colspan="5" class="linkMenuAdmin"></td>
                        </tr>
                      <tr>
                            <td width="111" height="25" align="right" class="NomeCampo">Agenda:</td>
                            <td width="120" height="25">
                              <input type="text" name="aux_dtanoage" size="4" class="Campo" onChange="document.form.submit();" value="`aux_dtanoage`"></td>
                            <td class="NomeCampo"><div align="right" class="NomeCampo">Cooperativa: </div></td>
                  <td class="NomeCampo" colspan="3"><select name="aux_cdcooper" class="Campo" id="cdcooper" onChange="document.form.cdcooper.value = document.form.aux_cdcooper.value; document.form.aux_dtanoage.value=''; document.form.aux_cddopcao.value=''; document.form.submit();">
                  <OPTION VALUE="0" class="LinhaTabelaSelect">&nbsp;</OPTION>
                                  <script language="SpeedScript">
                                           /*criando lista de cooperaticas que participam do PROGRID */
                                                FOR EACH crapcop NO-LOCK:
                                                /* Controle de cooperativas (igual a includes/wpgd0099.i) */
                                                        IF NOT AVAIL gnapses                          OR
                                                                   (gnapses.nvoperad <> 0                 AND 
                                                                    gnapses.cdcooper <> crapcop.cdcooper) THEN
                                                                        NEXT.                                                                                                                                
                                                        
                                                        IF aux_cdcooper = crapcop.cdcooper THEN
                                                                aux_selected = "SELECTED".
                                                        ELSE
                                                                aux_selected = "".
                                     </script>
                              <OPTION VALUE="`crapcop.cdcooper`" class="LinhaTabelaSelect" `aux_selected` >`CAPS(crapcop.nmrescop)`</OPTION>
                              <script language="SpeedScript">
                                                END.
                                  </script>
                                  </select>
                                  </td>
                  </tr>                                                                          
                                  <tr height="25" valign="top">
                                     <td class="NomeCampo" align="right" id="aux_nmevento">Evento:</td>
                                          <td class="NomeCampo">
                                          <select name="aux_cdevento" class="Campo" id="cdevento" onchange="document.form.aux_cddopcao.value=''; document.form.submit();" value="`aux_cdevento`">
                                            <script language="SpeedScript">
                                                  FOR EACH crapedp WHERE crapedp.idevento = aux_idevento   AND
                                                                         crapedp.cdcooper = aux_cdcooper   AND
                                                                         crapedp.tpevento <> 10 /*EAD*/    AND
                                                                         crapedp.tpevento <> 11 /*EAD*/    AND
                                                                         crapedp.idrespub <> "S" /*Eventos nao restritos*/ AND
                                                                         crapedp.dtanoage = aux_dtanoage   NO-LOCK
                                                                      BY crapedp.nmevento:                                                                                                                                   
                                                                                                                                   
                                                          FIND FIRST crapeap WHERE crapeap.idevento = crapedp.idevento   AND
                                                                                   crapeap.cdcooper = crapedp.cdcooper   AND
                                                                                   crapeap.dtanoage = crapedp.dtanoage   AND
                                                                                   crapeap.cdevento = crapedp.cdevento   AND
                                                                                   crapeap.flgevsel = TRUE               NO-LOCK NO-ERROR.
                                                                                                                                                 
                                                          IF NOT AVAILABLE crapeap THEN
                                                            NEXT.
                                                            
                                                          /* consiste a restricao do tema relacionado */  
                                                          FIND FIRST craptem WHERE craptem.idevento = crapedp.idevento   AND
                                                                                   craptem.cdcooper = 0                   AND
                                                                                   craptem.nrseqtem = crapedp.nrseqtem   AND
                                                                                   craptem.idrespub = "S" /*Tema restrito*/ 
                                                                                   NO-LOCK NO-ERROR.
                                                                                   
                                                        
                                                          IF AVAILABLE craptem THEN
                                                            NEXT.  
                                                </script>

                                                <OPTION VALUE="`crapedp.cdevento`" class="LinhaTabelaSelect">`crapedp.nmevento FORMAT "x(25)"`</OPTION>

                                                <script language="SpeedScript">
                                                  END.
                                                </script>
                                                <OPTION VALUE="0"  class="LinhaTabelaSelect">TODOS</OPTION>                                                                                                
                                          </select>
                                        </td>
                                     <td class="NomeCampo" align="right" id="aux_nmresage">PA:</td>
                                          <td class="NomeCampo">
                                          <select name="aux_cdagenci" class="Campo" id="cdagenci" onchange="document.form.aux_cddopcao.value=''; document.form.submit();" value="`aux_cdagenci`">
                                            <script language="SpeedScript">
                                                  FOR EACH cratage NO-LOCK BY cratage.nmresage:                                                  
                                                </script>
                                                
                                                <OPTION VALUE="`cratage.cdagenci`"  class="LinhaTabelaSelect">`cratage.nmresage FORMAT "x(18)"`</OPTION>                                                
                                                
                                                <script language="SpeedScript">
                                                  END.
                                                </script>
                                                <OPTION VALUE="0"  class="LinhaTabelaSelect">TODOS</OPTION>                                                                                                
                                          </select>
                                        </td>
                                     <td class="NomeCampo" align="right" width="70" id="aux_nmmeseve">Mês:</td>
                                          <td class="NomeCampo">
                                          <select name="aux_nrmeseve" class="Campo" id="nrmeseve" onchange="document.form.aux_cddopcao.value=''; document.form.submit();" value="`aux_nrmeseve`">
                                            <OPTION VALUE="1"  class="LinhaTabelaSelect">JANEIRO</OPTION>
                                                <OPTION VALUE="2"  class="LinhaTabelaSelect">FEVEREIRO</OPTION>
                                                <OPTION VALUE="3"  class="LinhaTabelaSelect">MARÇO</OPTION>
                                                <OPTION VALUE="4"  class="LinhaTabelaSelect">ABRIL</OPTION>
                                                <OPTION VALUE="5"  class="LinhaTabelaSelect">MAIO</OPTION>
                                                <OPTION VALUE="6"  class="LinhaTabelaSelect">JUNHO</OPTION>
                                                <OPTION VALUE="7"  class="LinhaTabelaSelect">JULHO</OPTION>
                                                <OPTION VALUE="8"  class="LinhaTabelaSelect">AGOSTO</OPTION>
                                                <OPTION VALUE="9"  class="LinhaTabelaSelect">SETEMBRO</OPTION>
                                                <OPTION VALUE="10" class="LinhaTabelaSelect">OUTUBRO</OPTION>
                                                <OPTION VALUE="11" class="LinhaTabelaSelect">NOVEMBRO</OPTION>
                                                <OPTION VALUE="12" class="LinhaTabelaSelect">DEZEMBRO</OPTION>
                                                <OPTION VALUE="0"  class="LinhaTabelaSelect">TODOS</OPTION>
                                          </select>
                                        </td>
                                  </tr>                                  
                  </table>
                  </td>
                  <td width="14" align="left"></td>
                </tr>
                <tr>
                  <td height="27" align="left" valign="top">
                    <table width="650" border="0" align="left" cellpadding="0" cellspacing="0">
                      <tr>
                        <td height="27" align="left" valign="top">
                          <!-- Interrupcao do modelo - início das abas -->
                          <table width="auto"  border="0" align="left" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
                           <tr align="center">
                              <td width="130" height="15" align="left">
                                <table width="128" border="0" cellpadding="0" cellspacing="0" id="AbaEvento">
                                  <tr style="cursor:hand;">
                                    <td background="/cecred/images/menu/mnu_nle.gif" width="4" height="21"></td>
                                    <td width="120"  align="center" class="txtTituloHid" onclick="mostraDiv('divEventos')">Eventos</td>
                                    <td background="/cecred/images/menu/mnu_nld.gif" width="4" height="21"></td>
                                  </tr>
                                </table>
                              </td>
                              <td width="100%" height="15" align="left">
                                <table width="138" border="0" cellpadding="0" cellspacing="0" id="AbaProgramacao">
                                  <tr style="cursor:hand;">
                                    <td background="/cecred/images/menu/mnu_nle.gif" width="4" height="21"></td>
                                    <td width="130"  align="center" class="txtTituloHid" onclick="mostraDiv('divProgramacao')">Programa&ccedil;&atilde;o</td>
                                    <td background="/cecred/images/menu/mnu_nld.gif" width="4" height="21"></td>
                                  </tr>
                                </table>
                              </td>
                            </tr>
                                                        <tr>
                                                          <td width="100%" height="2" colspan="15" align="left" background="/cecred/images/menu/mnu_slc.gif"></td>
                                                        </tr>
                                                  </table>
                                            </td>
                                          </tr>
                                                <tr>
                                                  <td height="27" align="left" valign="top">
                                  <!-- Fim das abas - Início dos dados do programa -->
                                                          <div id="divEventos" align="left">
                                      <table width="650" border="0" cellpadding="0" cellspacing="0">
                                        <tr align="left">
                                        
                                          <td width="1%"   height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">&nbsp;</td>
                                          <td width="35%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos" id="tbevento_col1">Evento</td>
                                          <td width="1%" height="26" id="separador1" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                          <td width="20%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos" id="tbevento_col2">Parceiro Institucional</td>
                                          <td width="1%" height="26" id="separador1"  background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                          <td width="15%"  height="26" id="tbevento_col2" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Liberar</td>
                                          <td width="1%" height="26" id="separador1" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                          <td width="15%"  height="26" id="tbevento_col3" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Retirar</td>
                                          <td width="1%" height="26" id="separador1" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif" width="2" height="15"></td>
                                          <td width="10%"   height="26" id="tbevento_col4" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Propagar?</td>                                                                          
                                        </tr>
                                        <tr>
                                        <td colspan="10">
                                        <div style="overflow: auto; height:180;">
                                          <table width="650" id="tbevento" border="0" cellpadding="0" cellspacing="0">
                                              <script language="SpeedScript">
                                                FOR EACH crapedp WHERE crapedp.idevento = aux_idevento   AND
                                                                       crapedp.cdcooper = aux_cdcooper   AND
                                                                       crapedp.dtanoage = aux_dtanoage   AND 
                                                                       crapedp.tpevento <> 10            AND 
                                                                       crapedp.tpevento <> 11            NO-LOCK
                                                                    BY crapedp.nmevento:
                                                                    
                                                  /* valida se o evento esta restrito para publicacao */
                                                  IF crapedp.idrespub = "S" THEN 
                                                    NEXT.                                                                                                                     
                                             
											 
											 
												  /* verifica se o tema do evento esta restrito para publicacao */
                                                  FIND FIRST craptem WHERE craptem.idevento = 1 AND
                                                                           craptem.cdcooper = 0 AND
                                                                           craptem.cdeixtem = crapedp.cdeixtem AND
                                                                           craptem.nrseqtem = crapedp.nrseqtem  AND 
                                                                           craptem.idrespub = "S" /*Tema restrito*/ 
                                                                           NO-LOCK NO-ERROR.  
				
                                                  IF AVAIl craptem THEN
													NEXT.
                                                    
													
                                                                    
                                                  /* filtra a parceira institucional do evento */                                   
                                                  FIND FIRST crappri WHERE crappri.nrseqpri = crapedp.nrseqpri NO-LOCK NO-ERROR.
                                                                          
                                                  IF AVAIl crappri THEN   
                                                    aux_nmprcins = crappri.nmprcins.                                                                        
                                                  ELSE
                                                    aux_nmprcins = "".	

													
													
                                                  FIND FIRST crapeap WHERE crapeap.idevento = crapedp.idevento   AND
                                                                           crapeap.cdcooper = crapedp.cdcooper   AND
                                                                           crapeap.dtanoage = crapedp.dtanoage   AND
                                                                           crapeap.cdevento = crapedp.cdevento   AND
                                                                           crapeap.flgevsel = TRUE               NO-LOCK NO-ERROR.
                                                                           
                                                  IF NOT AVAILABLE crapeap   THEN
                                                    NEXT.                                                                                                                                   
                                                                   
                                                  IF   aux_cordalinha = "#FFFFFF"   THEN
                                                    aux_cordalinha = "#F7F7F7".
                                                  ELSE
                                                    aux_cordalinha = "#FFFFFF".
                                                  </script>
                                                  <tr>
                                                  <td width="1%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                                  <td width="36%" height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`crapedp.nmevento`</td>
                                                  <td width="1%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>                                                  
                                                  <td width="20%" height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`aux_nmprcins`</td>                                                  
                                                  <td width="1%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>                                                  
                                                  <td width="15%" height="26" class="txtPequeno" bgColor=`aux_cordalinha` colspan="2"><input type="text" name="aux_dtlibint_`crapedp.cdevento`" size="8" class="txtPequeno" onkeyup="validaData(this.name,this.value)" onblur="if((this.value.length!=10)&&(this.value.length!=0)){ alert('Data Invalida! Preencha no formato DD/MM/AAAA'); this.value=''; this.focus();}" value="`crapedp.dtlibint FORMAT('99/99/9999')`"></td>
                                                  <td width="1%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>                                                  
                                                  <td width="15%" height="26" class="txtPequeno" bgColor=`aux_cordalinha` colspan="2"><input type="text" name="aux_dtretint_`crapedp.cdevento`" size="8" class="txtPequeno" onkeyup="validaData(this.name,this.value)" onblur="if((this.value.length!=10)&&(this.value.length!=0)){ alert('Data Invalida! Preencha no formato DD/MM/AAAA'); this.value=''; this.focus();}" value="`crapedp.dtretint FORMAT('99/99/9999')`"></td>
                                                  <td width="1%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>                                                  
                                                  <td width="10%" height="26" class="txtPequeno" bgColor=`aux_cordalinha` colspan="2"><input type="checkbox" name="aux_propagar_`crapedp.cdevento`" class="txtnormal" title="Propaga as datas para os eventos agendados"></td>                                                                                          
                                                  </tr>
                                                  <script language="SpeedScript">
                                                END.                                                                           
                                              </script>
                                            </table>
                                          </div>                                                                          
                                        </td>
                                      </tr>
                                      <tr>
                                        <td height="40" align="center" valign="bottom" colspan="8">
                                          <img style="cursor:hand" src="/cecred/images/botoes/btn_salvar.gif" width="60" height="20" onClick="salvar(document.form.pagina.value);">                                                                            
                                        </td>
                                      </tr>                                                                                                                                
                                     </table>                                                             
                                    </div>                                                  
                                    <div id="divProgramacao" align="left">
                                      <table width="800" border="0" cellpadding="0" cellspacing="0">
                                        <tr align="left">
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">&nbsp;</td>
                                          <td width="10%"  height="26" id="tbprog_col1" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Data</td>
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                          <td width="15%" height="26" id="tbprog_col2" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">PA</td>
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                          <td width="20%" height="26" id="tbprog_col3" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Evento</td>
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                          <td width="14%" height="26" id="tbprog_col4" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Parceiro Institucional</td>
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                          <td width="10%" height="26" id="tbprog_col5" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Status</td>
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                          <td width="8%"  height="26" id="tbprog_col6" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Verificar</td>
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                          <td width="8%"  height="26" id="tbprog_col6" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Liberar</td>                                          
                                          <td width="1%"  height="26" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos"><img src="/cecred/images/geral/div.gif"></td>
                                          <td width="15%" height="26" id="tbprog_col7" background="/cecred/images/menu/fnd_title.jpg" class="txtMenuTitulos">Retirar</td>
                                        </tr>
                                      </table>
                                      <table width="800" border="0" cellpadding="0" cellspacing="0">
                                      <tr>
                                        <td colspan="3">
                                          <div style="overflow: auto; height:'180';">
                                            <table width="800" id="tbprogramacao" border="0" cellpadding="0" cellspacing="0">
                                              <script language="SpeedScript">
                                                /** montagem da query dinamica **/
                                                create query hQuery.
                                                hQuery:SET-BUFFERS(BUFFER crapadp:HANDLE).
                                                assign cQuery = "FOR EACH crapadp WHERE crapadp.idevento = " + string(aux_idevento) + " AND
                                                crapadp.cdcooper = " + string(aux_cdcooper) + " AND
                                                crapadp.dtanoage = " + string(aux_dtanoage).

                                                IF aux_cdevento <> 0 THEN
                                                  assign cQuery = cQuery + " and crapadp.cdevento = " + string(aux_cdevento).
                                                IF aux_cdagenci <> 0  THEN
                                                  assign cQuery = cQuery + " and crapadp.cdagenci = " + string(aux_cdagenci).
                                                IF aux_nrmeseve <> 0  THEN
                                                  assign cQuery = cQuery + " and crapadp.nrmeseve = " + string(aux_nrmeseve).
                                                  assign cQuery = cQuery + " NO-LOCK BY crapadp.nrmeseve
                                                  BY crapadp.dtinieve
                                                  INDEXED-REPOSITION". 
                                                  hQuery:query-prepare(cQuery).
                                                  hQuery:query-open().
                                                IF aux_paginacao <> "" THEN DO:
                                                  IF aux_paginacao = "C" THEN DO:  /* PAGINA CORRENTE */
                                                    hQuery:REPOSITION-TO-ROWID(TO-ROWID(aux_prichave)).
                                                    hQuery:get-next().
                                                  END.
                                                  ELSE
                                                  IF aux_paginacao = "P" THEN DO:  /* PROXIMA PAGINA */
                                                    hQuery:REPOSITION-TO-ROWID(TO-ROWID(aux_ultchave)).
                                                    hQuery:get-next().
                                                    hQuery:get-next().
                                                    IF hQuery:QUERY-OFF-END THEN
                                                      hQuery:get-prev().
                                                  END.
                                                  ELSE DO: /* PAGINA ANTERIOR */
                                                    hQuery:REPOSITION-TO-ROWID(TO-ROWID(aux_prichave)).
                                                    hQuery:REPOSITION-BACKWARD(aux_maxrows).
                                                    hQuery:get-next().
                                                  IF hQuery:QUERY-OFF-END THEN
                                                    hQuery:get-first().
                                                  END.
                                                END.
                                                ELSE DO:
                                                hQuery:get-first().
                                                END.

                                                /** primeira chave **/
                                                ASSIGN aux_prichave = string(rowid(crapadp))
                                                aux_contarows = 0.

                                                REPEAT:
                                                  aux_flgerrodata = NO.

                                                  /* Mes do evento */
                                                  IF   crapadp.dtinieve = ?   THEN
                                                  DO:
                                                    IF   crapadp.nrmeseve = ? OR crapadp.nrmeseve = 0   THEN
                                                      aux_dsmeseve = "".
                                                    ELSE
                                                      aux_dsmeseve = aux_dsdmeses[crapadp.nrmeseve].
                                                  END.
                                                  ELSE
                                                  DO:
                                                    IF   crapadp.dtinieve <> crapadp.dtfineve   THEN
                                                      aux_dsmeseve = STRING(DAY(crapadp.dtinieve),"99") + "/" +
                                                      STRING(MONTH(crapadp.dtinieve),"99") + " a " +
                                                      STRING(DAY(crapadp.dtfineve),"99") + "/" +
                                                      STRING(MONTH(crapadp.dtfineve),"99").
                                                    ELSE
                                                      aux_dsmeseve = STRING(DAY(crapadp.dtinieve),"99") + "/" +
                                                      STRING(MONTH(crapadp.dtinieve),"99").
                                                  END.

                                                  /* PAC */
                                                  FIND cratage WHERE cratage.cdcooper = crapadp.cdcooper   AND
                                                  cratage.cdagenci = crapadp.cdagenci   NO-LOCK NO-ERROR.

                                                  IF   NOT AVAILABLE cratage   THEN do:
                                                    assign aux_ultchave = string(rowid(crapadp))
                                                    aux_contarows = aux_contarows + 1.
                                                    hQuery:get-next().
                                                    IF hQuery:QUERY-OFF-END OR aux_contarows >= aux_maxrows THEN do:
                                                      LEAVE.
                                                    END.
                                                  ELSE 
                                                    NEXT.           
                                                  END.

                                                  /* Evento */
                                                  FIND crapedp WHERE crapedp.idevento = crapadp.idevento   AND
                                                                     crapedp.cdcooper = crapadp.cdcooper   AND
                                                                     crapedp.dtanoage = crapadp.dtanoage   AND
                                                                     crapedp.cdevento = crapadp.cdevento   NO-LOCK NO-ERROR.

													/* valida se o evento esta restrito para publicacao */
                                                 												   
													IF avail crapedp and crapedp.idrespub = "S" THEN 
                                                     aux_mostrar = "style=\"display:none\"".																	 

                                                                                                     

                                                                                                     
                                                    /* verifica se o tema do evento esta restrito para publicacao */
													FIND FIRST craptem WHERE craptem.idevento = 1 AND
													  					     craptem.cdcooper = 0 AND
																			 craptem.cdeixtem = crapedp.cdeixtem AND
																			 craptem.nrseqtem = crapedp.nrseqtem  AND 
																			 craptem.idrespub = "S" 
																			 NO-LOCK NO-ERROR.  
													   
														
														IF AVAIl craptem THEN
															aux_mostrar = "style=\"display:none\"".
                                                    
													
                                                    /* recupera nome do Parceiro Institucional */
                                                    FIND FIRST crappri WHERE crappri.nrseqpri = crapedp.nrseqpri NO-LOCK NO-ERROR.
                                                                            
                                                      IF AVAIl crappri THEN   
                                                        aux_nmprcins = crappri.nmprcins.                                                                        
                                                      ELSE
                                                        aux_nmprcins = "".													
													
													
													/* Status */
                                                    FIND FIRST craptab WHERE craptab.cdcooper = 0               AND
                                                                             craptab.nmsistem = "CRED"          AND
                                                                             craptab.tptabela = "CONFIG"        AND
                                                                             craptab.cdempres = 0               AND
                                                                             craptab.cdacesso = "PGSTEVENTO"    AND
                                                                             craptab.tpregist = 0               NO-LOCK NO-ERROR.

                                                    aux_dsstatus = ENTRY((crapadp.idstaeve * 2) - 1,craptab.dstextab).


                                                                                                
                                                                                                
                                                    /* Verificação para ver se o evento está INCOMPLETO */

                                                    /* restrições somente para o PROGRID */
                                                    IF   aux_idevento = 1   THEN
                                                    DO:
                                                      IF   crapadp.dtfineve = ?   THEN
                                                      aux_flgerrodata = YES.                                                                                                         

                                                      /* Custo do evento */
                                                      FIND FIRST crapcdp WHERE crapcdp.idevento = crapadp.idevento   AND
                                                                               crapcdp.cdcooper = crapadp.cdcooper   AND
                                                                               crapcdp.cdagenci = crapadp.cdagenci   AND
                                                                               crapcdp.dtanoage = crapadp.dtanoage   AND
                                                                               crapcdp.cdevento = crapadp.cdevento
                                                                               NO-LOCK NO-ERROR.

                                                      IF   AVAILABLE crapcdp   AND aux_flgerrodata = NO   THEN
                                                      DO:
                                                        /* Fornecedor ("pertence" a TODAS as cooperativas) */
                                                        FIND gnapfdp WHERE gnapfdp.idevento = crapadp.idevento   AND
                                                                           gnapfdp.cdcooper = 0                  AND
                                                                           gnapfdp.nrcpfcgc = crapcdp.nrcpfcgc
                                                                           NO-LOCK NO-ERROR.

                                                        IF   AVAILABLE gnapfdp   THEN
                                                        DO:
                                                          /* Proposta do fornecedor ("pertence" a TODAS as cooperativas) */
                                                          FIND gnappdp WHERE gnappdp.idevento = crapadp.idevento   AND
                                                                             gnappdp.cdcooper = 0                  AND
                                                                             gnappdp.nrcpfcgc = crapcdp.nrcpfcgc   AND
                                                                             gnappdp.nrpropos = crapcdp.nrpropos
                                                                             NO-LOCK NO-ERROR.

                                                        IF   AVAILABLE gnappdp    THEN
                                                        DO:
                                                          FIND gnappob WHERE gnappob.idevento = gnappdp.idevento AND
                                                                             gnappob.cdcooper = gnappdp.cdcooper AND
                                                                             gnappob.nrcpfcgc = gnappdp.nrcpfcgc AND
                                                                             gnappob.nrpropos = gnappdp.nrpropos
                                                                             NO-LOCK NO-ERROR.

                                                          IF   AVAIL gnappob   THEN                
                                                            IF   gnappob.dsobjeti = "" OR gnappdp.dsconteu = "" OR gnappdp.qtcarhor = 0    THEN
                                                              aux_flgerrodata = YES.
                                                                                    
                                                            IF   aux_flgerrodata = NO   THEN
                                                            DO:
                                                              /* Se não tiver facilitadores */
                                                              IF   NOT CAN-FIND(FIRST gnfacep WHERE gnfacep.idevento = gnappdp.idevento   AND
                                                              gnfacep.cdcooper = gnappdp.cdcooper   AND
                                                              gnfacep.nrcpfcgc = gnappdp.nrcpfcgc   AND
                                                              gnfacep.nrpropos = gnappdp.nrpropos   NO-LOCK)   THEN
                                                              aux_flgerrodata = YES.

                                                              IF   aux_flgerrodata = NO   THEN                                                                                                                                                                                                                                                                                                                                            
                                                              /* Facilitador(es) da proposta */
                                                              FOR EACH gnfacep WHERE gnfacep.idevento = gnappdp.idevento   AND
                                                              gnfacep.cdcooper = gnappdp.cdcooper   AND
                                                              gnfacep.nrcpfcgc = gnappdp.nrcpfcgc   AND
                                                              gnfacep.nrpropos = gnappdp.nrpropos   NO-LOCK:

                                                              /* Cadastro do facilitador */
                                                              FIND gnapfep WHERE gnapfep.idevento = gnfacep.idevento   AND
                                                              gnapfep.cdcooper = gnfacep.cdcooper   AND
                                                              gnapfep.nrcpfcgc = gnfacep.nrcpfcgc   AND
                                                              gnapfep.cdfacili = gnfacep.cdfacili   NO-LOCK NO-ERROR.

                                                              IF  (AVAILABLE gnapfep AND  gnapfep.dscurric = "") OR NOT AVAILABLE gnapfep    THEN
                                                                aux_flgerrodata = YES.
                                                            END.
                                                          END.                                                                                   
                                                        END.
                                                    ELSE
                                                      aux_flgerrodata = YES.
                                                    END.
                                                  ELSE
                                                    aux_flgerrodata = YES.
                                                  END.                                                                                                
                                                ELSE
                                                  aux_flgerrodata = YES.

                                                  /* Verifica dados do local */
                                                  IF   crapadp.cdlocali <> 0   THEN
                                                  DO:
                                                    FIND crapldp WHERE crapldp.idevento = crapadp.idevento   AND
                                                    crapldp.cdcooper = crapadp.cdcooper   AND
                                                    crapldp.cdagenci = crapadp.cdagenci   AND
                                                    crapldp.nrseqdig = crapadp.cdlocali   NO-LOCK NO-ERROR.

                                                  IF   NOT AVAILABLE crapldp OR crapldp.dsendloc = "" OR crapldp.nmbailoc = "" OR LENGTH(STRING(crapldp.nrtelefo)) < 8 OR crapldp.nmcidloc = "" THEN
                                                    aux_flgerrodata = YES.
                                                END. 

                                                END. /* Progrid */

                                                /* Validações tanto para PROGRID quanto ASSEMBLÉIA */
                                                IF crapadp.cdlocali = 0 OR crapadp.dshroeve = "" OR crapadp.dtinieve = ? THEN
                                                  aux_flgerrodata = YES.


                                                /* Monta o link para evento incompleto */
                                                IF aux_flgerrodata = YES THEN
                                                  aux_dsdolink = "<a href=~"#.~" onclick=~"window.open('wpgd0039a.htm" +
                                                  "?aux_idevento=" + STRING(crapadp.idevento) +
                                                  "&aux_cdcooper=" + STRING(crapadp.cdcooper) +
                                                  "&aux_nrseqdig=" + STRING(crapadp.nrseqdig) +
                                                  "',null,'height=350,width=340,left=250,top=150,status=no,toolbar=no,menubar=no,location=no')~">Incompleto</a>".
                                                ELSE
                                                  aux_dsdolink = "".

                                                IF aux_cordalinha = "#FFFFFF" THEN
                                                  aux_cordalinha = "#F7F7F7".
                                                ELSE
                                                  aux_cordalinha = "#FFFFFF".
                                            </script>
                                          <tr `aux_mostrar`>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="10%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`aux_dsmeseve FORMAT "x(13)"`</td>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="15%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`cratage.nmresage`</td>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="20%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`crapedp.nmevento`</td>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="14%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`aux_nmprcins`</td>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="10%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`aux_dsstatus`</td>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="8%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>`aux_dsdolink`</td>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="8%"   height="26"  class="txtPequeno" bgColor=`aux_cordalinha`><input type="text" name="aux_dtlibint_`crapadp.nrseqdig`_2" size="6" class="txtPequeno" onkeyup="validaData(this.name,this.value)" onblur="if((this.value.length!=10)&&(this.value.length!=0)){ alert('Data Invalida! Preencha no formato DD/MM/AAAA'); this.value=''; this.focus();}" value="`crapadp.dtlibint FORMAT('99/99/9999')`"></td>
                                            <td width="1%"   height="26" class="txtPequeno" bgColor=`aux_cordalinha`>&nbsp;</td>
                                            <td width="15%"  height="26" class="txtPequeno" bgColor=`aux_cordalinha`><input type="text" name="aux_dtretint_`crapadp.nrseqdig`_2" size="6" class="txtPequeno" onkeyup="validaData(this.name,this.value)" onblur="if((this.value.length!=10)&&(this.value.length!=0)){ alert('Data Invalida! Preencha no formato DD/MM/AAAA'); this.value=''; this.focus();}" value="`crapadp.dtretint FORMAT('99/99/9999')`"></td>
                                          </tr>
                                        <script language="SpeedScript">
										  aux_mostrar = "".
                                          assign aux_ultchave = string(rowid(crapadp))
                                          aux_contarows = aux_contarows + 1.
                                          hQuery:get-next().
                                          IF hQuery:QUERY-OFF-END OR aux_contarows >= aux_maxrows THEN do:
                                          LEAVE.
                                          END.
                                          END.                                                        
                                          hQuery:query-close().
                                          DELETE OBJECT hQuery. 
                                        </script>
                                      </table>
                                      </div>
                                      </td>
                                      </tr>
                                      <tr>
                                        <td align="center" valign="bottom" scope="col" width="38">&nbsp;</td>                                                                   
                                        <td align="center" valign="bottom" scope="col">
                                          <img style="cursor:hand" src="/cecred/images/botoes/btn_salvar.gif" width="60" height="20" onClick="document.form.aux_paginacao.value='C'; salvar(document.form.pagina.value);">                                                                            
                                        </td>
                                        <td align="right" valign="bottom" scope="col">
                                          <img style="cursor:hand" src="/cecred/images/botoes/btn_anterior.gif"  onClick="document.form.aux_paginacao.value='A'; document.form.submit();" title="Anterior">                                                                            
                                          <img style="cursor:hand" src="/cecred/images/botoes/btn_posterior.gif" onClick="document.form.aux_paginacao.value='P'; document.form.submit();" title="Proximo">                                                                            
                                          <input type="hidden" name="aux_paginacao" value="`aux_paginacao`">
                                          <input type="hidden" name="aux_prichave" value="`aux_prichave`">
                                          <input type="hidden" name="aux_ultchave" value="`aux_ultchave`">
                                        </td>
                                      </tr>
                                      </table>
                                      </div>
                                      </td>
                                      </tr>
                    </table>
                  </td>
                                  <td>&nbsp;</td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
            </td>
        </tr>
      </table>
      </td>
    </tr>
</table>
</body>
</html>
<script language="Javascript">

// valida a digitação da data nos campos
function validaData(campo,valor){

   if((event.keyCode==9)||    // TAB
      (event.keyCode==16)){   // BACK-TAB
          return true;
   } 

   // tira as barras
   document.form[campo].value = document.form[campo].value.replace("/","");
   document.form[campo].value = document.form[campo].value.replace("/","");
   
   // data são 8 caracteres
   document.form[campo].value = document.form[campo].value.substring(0,8);

   // varre o campo em busca de caracteres inválidos e remove-os
   for(var i=0;i< document.form[campo].value.length;i++){
      
          if((document.form[campo].value.substring(i,i+1)!='0')&&
         (document.form[campo].value.substring(i,i+1)!='1')&&
         (document.form[campo].value.substring(i,i+1)!='2')&&
         (document.form[campo].value.substring(i,i+1)!='3')&&
         (document.form[campo].value.substring(i,i+1)!='4')&&
         (document.form[campo].value.substring(i,i+1)!='5')&&
         (document.form[campo].value.substring(i,i+1)!='6')&&
         (document.form[campo].value.substring(i,i+1)!='7')&&
         (document.form[campo].value.substring(i,i+1)!='8')&&
         (document.form[campo].value.substring(i,i+1)!='9'))          
              document.form[campo].value = document.form[campo].value.substring(0,i);   
   }   
      
   // valida o dia e formata a data - DD/MM
   if(document.form[campo].value.length > 2){
      if((document.form[campo].value.substring(0,2) > "31")||
         (document.form[campo].value.substring(0,2) == "00")){
             alert("Dia inválido! Deve ser entre 01 e 31!");
                 document.form[campo].value="";
                 return false;
          }
   
      document.form[campo].value = document.form[campo].value.substring(0,2) + "/" +
                                       document.form[campo].value.substring(2,document.form[campo].value.length);
   }                                                           

   // valida o mes e formata a data - MM/AAAA
   if(document.form[campo].value.length > 5){
      if((document.form[campo].value.substring(3,5) > "12")||
         (document.form[campo].value.substring(3,5) == "00")){
             alert("Mês inválido! Deve ser entre 01 e 12!");
                 document.form[campo].value="";
                 return false;
          }
             
      document.form[campo].value = document.form[campo].value.substring(0,5) + "/" +
                                       document.form[campo].value.substring(5,document.form[campo].value.length);                                                                    
   }
}

function salvar(){

   // Verifica se o usuário tem permissão de salvar
   if (document.form.aux_lspermis.value.substring(1,2) != 'A'){ 
      alert('Desculpe, mas você não tem permissão para executar esta função.'); 
      return false;
   }
   
   // salva Eventos
   if(document.form.pagina.value=="divEventos")
      document.form.aux_cddopcao.value='sa_ev';
   else
      // salva Programação
      document.form.aux_cddopcao.value='sa_pr';
          
   document.form.submit();
}

function mostraDiv(nomediv)
{   
   var nomeaba = '';

   if (nomediv=='') {nomediv='divEventos';}

   if (nomediv=='divEventos'){
       nomeaba='AbaEvento';
           // esconde os combos
           document.all.aux_nmevento.style.visibility='hidden';
           document.all.aux_cdevento.style.visibility='hidden';
           document.all.aux_nmresage.style.visibility='hidden';
           document.all.aux_cdagenci.style.visibility='hidden';
           document.all.aux_nrmeseve.style.visibility='hidden';
           document.all.aux_nmmeseve.style.visibility='hidden';              
   }

   if (nomediv=='divProgramacao'){ 
       nomeaba='AbaProgramacao';
           // mostra os combos
           document.all.aux_nmevento.style.visibility='visible';
           document.all.aux_cdevento.style.visibility='visible';
           document.all.aux_nmresage.style.visibility='visible';
           document.all.aux_cdagenci.style.visibility='visible';           
           document.all.aux_nrmeseve.style.visibility='visible';
           document.all.aux_nmmeseve.style.visibility='visible';           
   }

   document.form.pagina.value=nomediv;
   document.all.divEventos.style.display = 'none';
   document.all.divProgramacao.style.display = 'none';

   document.all.AbaEvento.rows[0].cells[0].background="/cecred/images/menu/mnu_nle.gif";
   document.all.AbaEvento.rows[0].cells[1].background="/cecred/images/menu/mnu_nlc.gif";
   document.all.AbaEvento.rows[0].cells[2].background="/cecred/images/menu/mnu_nld.gif";
   document.all.AbaEvento.rows[0].cells[1].className="txtTituloHid";
   
   document.all.AbaProgramacao.rows[0].cells[0].background="/cecred/images/menu/mnu_nle.gif";
   document.all.AbaProgramacao.rows[0].cells[1].background="/cecred/images/menu/mnu_nlc.gif";
   document.all.AbaProgramacao.rows[0].cells[2].background="/cecred/images/menu/mnu_nld.gif";
   document.all.AbaProgramacao.rows[0].cells[1].className="txtTituloHid";

   document.all[nomeaba].rows[0].cells[0].background="/cecred/images/menu/mnu_sle.gif";
   document.all[nomeaba].rows[0].cells[1].background="/cecred/images/menu/mnu_slc.gif";
   document.all[nomeaba].rows[0].cells[2].background="/cecred/images/menu/mnu_sld.gif";
   document.all[nomeaba].rows[0].cells[1].className="txtTituloVis";

   document.all[nomediv].style.display = 'block';
}

mostraDiv(document.form.pagina.value);

// posiciona os combos
document.form.aux_cdevento.value=`aux_cdevento`;
document.form.aux_cdagenci.value=`aux_cdagenci`;
document.form.aux_nrmeseve.value=`aux_nrmeseve`;

// verifica se existe algum evento
if(document.all.tbevento.rows.length==0)
   alert('Não há eventos selecionados. A agenda ainda não foi gerada!');
else{
   if(document.all.tbprogramacao.rows.length==0)
      alert('Não há eventos a serem liberados. A agenda ainda não foi gerada!');
}
   
</script>
