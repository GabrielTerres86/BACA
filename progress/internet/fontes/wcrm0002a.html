<!--

Alterações: 12/06/2012 - Alterado busca na tabela gncoper para crapcop. Incluído tratamento
						 no nome da cooperativa para retirar espaços (Guilherme Maba).
			
			08/08/2013 - Alterada String de PAC para PA. (Reinert)
-->
<script language="SpeedScript">
DEF VAR aux_nmrescop LIKE crapcop.nmrescop NO-UNDO.
DEF VAR aux_cdcooper LIKE crapcop.cdcooper NO-UNDO.
		
/* Recebe os parametros  */
ASSIGN aux_cdcooper = INT(GET-VALUE("aux_cdcooper")).
       
/* Busca o nome da cooperativa para montagen da chamada inscLink dinamicamente */
FIND FIRST crapcop WHERE crapcop.cdcooper = aux_cdcooper NO-LOCK NO-ERROR. 
    
IF  NOT AVAILABLE crapcop  THEN
    DO:
        {&out} '~<script type=~"text/javascript~">alert(~"Nome da cooperativa nao encontrado~")~;~</script~>'.
        RETURN.
    END.
ELSE	
    aux_nmrescop = LC(REPLACE(crapcop.nmrescop, " ", "")).
</script>
<html>
<head>
<title>CECRED</title>
<script language="SpeedScript">
{&out} '~<link rel=~"stylesheet~" type=~"text/css~" href=~"/extrato-' + aux_nmrescop + '/crm/css/estilos_progrid.css~"~>\n'.
{&out} '~<script type=~"text/javascript~" src=~"/extrato-' + aux_nmrescop + '/crm/js/bloqueio.js~"~>~</script~>\n'.
{&out} '~<script type=~"text/javascript~" src=~"/extrato-' + aux_nmrescop + '/crm/js/ajax.js~"~>~</script~>\n'.
</script>
<script>
function ajax_onResponse() {
	if(checkReadyState(request)) {  
		xmlDoc = request.responseXML;
		// conteudo = a tabela que sera exibida com os dados do evento
		conteudo = "<table width=550 border=0 cellpadding=0 cellspacing=0>";

		var node = xmlDoc.getElementsByTagName('EVENTO');
		var node_facil = xmlDoc.getElementsByTagName('NMFACILI');

		for(i=0; i < node.length; i++) {
			// Tipo do evento
			DSEVENTO = node[i].getElementsByTagName("DSEVENTO").item(0).firstChild.data;
			// Nome do evento
			NMEVENTO = node[i].getElementsByTagName("NMEVENTO").item(0).firstChild.data;
			// Programação
			DTMESEVE = node[i].getElementsByTagName("DTMESEVE").item(0).firstChild.data;
			// Pa
			NMRESAGE = node[i].getElementsByTagName("NMRESAGE").item(0).firstChild.data;
			// Objetivo do evento
			DSOBJETI = node[i].getElementsByTagName("DSOBJETI").item(0).firstChild.data;
			// Conteudo programatico	
			DSCONTEU = node[i].getElementsByTagName("DSCONTEU").item(0).firstChild.data;
			// Carga horária
			QTCARHOR = node[i].getElementsByTagName("QTCARHOR").item(0).firstChild.data;
			// Num Vagas
			QTMAXTUR = node[i].getElementsByTagName("QTMAXTUR").item(0).firstChild.data;
			// Dias do evento
			DSDIAEVE = node[i].getElementsByTagName("DSDIAEVE").item(0).firstChild.data;
			// Data
			DTEXTEVE = node[i].getElementsByTagName("DTEXTEVE").item(0).firstChild.data;
			// Hora
			DSHOREVE = node[i].getElementsByTagName("DSHOREVE").item(0).firstChild.data;
			// Local
			DSLOCALI = node[i].getElementsByTagName("DSLOCALI").item(0).firstChild.data;
			// Endereço
			DSENDLOC = node[i].getElementsByTagName("DSENDLOC").item(0).firstChild.data;
			// Bairro
			NMBAILOC = node[i].getElementsByTagName("NMBAILOC").item(0).firstChild.data;
			// Cidade
			NMCIDLOC = node[i].getElementsByTagName("NMCIDLOC").item(0).firstChild.data;

			// pula linha do conteudo programatico.
			var cont_array=DSCONTEU.split("\n");
			var part_num=0;
			var prog = '';
			while (part_num < cont_array.length){
				prog = prog+cont_array[part_num]+"<br>";
				part_num+=1;
			}
			
			// pula linha do objetivo.
			var cont_array=DSOBJETI.split("\n");
			var part_num=0;
			var obje = '';
			while (part_num < cont_array.length){
				obje = obje+cont_array[part_num]+"<br>";
				part_num+=1;
			}
			
			// Conteudo com nome programação e pa
			conteudo = conteudo+"<tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='tit_normal'><span class='tit_bold'>"+DSEVENTO+":</span> "+NMEVENTO+"</td><td height='25'>&nbsp;</td></tr><tr><td width='5' height='30'></td><td width='228' height='30' class='tit_normal'><span class='tit_bold'>Programa&ccedil;&atilde;o:</span> "+DTMESEVE+"</td><td height='30' colspan='2' class='tit_normal'><span class='tit_bold'>Pa:</span> "+NMRESAGE+"</td><td width='5' height='30'></td></tr>";
			// Conteudo com separador de linhas
			conteudo = conteudo+"<tr><td height='2'></td><td height='15' colspan='3'></td><td height='2'></td></tr><tr><td height='2'></td><td height='2' colspan='3' background='/extrato-`aux_nmrescop`/crm/images/geral/separador_laranja.gif'></td><td height='2'></td></tr><tr><td height='2'></td><td height='15' colspan='3'></td><td height='2'></td></tr>";
			// Conteudo com Objetivo, Conteudo programatico
			conteudo = conteudo+"<tr><td height='30'>&nbsp;</td><td height='50' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'>Objetivo:</span><br/>"+obje+"<br></br></td><td height='30'>&nbsp;</td></tr><tr><td height='30'>&nbsp;</td><td height='50' colspan='3'><span class='fonte_geral'><span class='fonte_geral_bold'>Conte&uacute;do Program&aacute;tico:</span><br />"+prog+"</span></td><td height='30'>&nbsp;</td></tr>";
		    // Conteudo com separador de linhas
    		conteudo = conteudo+"<tr><td height='2'></td><td height='15' colspan='3'></td><td height='2'></td></tr><tr><td height='2'></td><td height='2' colspan='3' background='/extrato-`aux_nmrescop`/crm/images/geral/separador_laranja.gif'></td><td height='2'></td></tr><tr><td height='2'></td><td height='15' colspan='3'></td><td height='2'></td></tr>";
			// Conteudo com Carga horaria
			conteudo = conteudo+"<tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'>Carga Hor&aacute;ria:</span> "+QTCARHOR+"</td><td height='25'>&nbsp;</td></tr>";
			
			// curriculum do facilitador
			for(j=0; j < node_facil.length; j++) {
				// Facilitador
				NMFACILI = xmlDoc.getElementsByTagName('NMFACILI').item(j).firstChild.data;
				DSCURRIC = xmlDoc.getElementsByTagName('NMFACILI')[j].getAttribute('DSCURRIC');
				// pula linha do curriculum.
				var curr_array=DSCURRIC.split("\n");
				var curr_num=0;
				var curr = '';
				while (curr_num < curr_array.length){
					curr = curr+curr_array[curr_num]+"<br>";
					curr_num+=1;
				}

				// Conteudo com Facilitador e seu curriculum
				conteudo = conteudo+"<tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'>Facilitador:</span> "+NMFACILI+"</td><td height='25'>&nbsp;</td></tr><tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'></span> "+curr+"</td><td height='25'>&nbsp;</td></tr>";
				conteudo = conteudo+"<tr><td height='10'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'></td><td height='25'></td></tr>";
			}		

			// Conteudo Num vagas, Dias do evento, Data e hora
			conteudo = conteudo+"<tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'>N&ordm; de Vagas:</span> "+QTMAXTUR+"</td><td height='25'>&nbsp;</td></tr><tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'>Dias do Evento:</span> "+DSDIAEVE+
                                   "</td><td height='25'>&nbsp;</td></tr><tr><td height='25'>&nbsp;</td><td height='25' class='fonte_geral'><span class='fonte_geral_bold'>Data:</span> "+DTEXTEVE+"</td><td width='228' height='25' class='fonte_geral'><span class='fonte_geral_bold'>Hora:</span> "+DSHOREVE+"</td><td width='84' height='25' class='fonte_geral'>&nbsp;</td><td height='25'>&nbsp;</td></tr>";
			// Conteudo com separador de linhas
			conteudo = conteudo+"<tr><td height='2'></td><td height='15' colspan='3'></td><td height='2'></td></tr><tr><td height='2'></td><td height='2' colspan='3' background='/extrato-`aux_nmrescop`/crm/images/geral/separador_laranja.gif'></td><td height='2'></td></tr><tr><td height='2'></td><td height='15' colspan='3'></td><td height='2'></td></tr>";
			// Conteudo com Local, endereço, bairro, cidade e telefone
			conteudo = conteudo+"<tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'>Local:</span> "+DSLOCALI+"</td><td height='25'>&nbsp;</td></tr><tr><td height='25'>&nbsp;</td><td height='25' colspan='3' class='fonte_geral'><span class='fonte_geral_bold'>Endere&ccedil;o:</span> "+
                                   DSENDLOC+"</td><td height='25'>&nbsp;</td></tr><tr><td height='25'>&nbsp;</td><td height='25' class='fonte_geral'><span class='fonte_geral_bold'>Bairro:</span> "+NMBAILOC+"</td><td height='25' colspan='2' class='fonte_geral'><span class='fonte_geral_bold'>Cidade:</span> "+NMCIDLOC+"</td><td height='25'>&nbsp;</td></tr>";
		}
		conteudo = conteudo+'<table>';
		document.getElementById('copy').innerHTML = conteudo;
		return conteudo;
	}
}
</script>
<script language="SpeedScript">
	DEF VAR aux_cdevento LIKE crapedp.cdevento          NO-UNDO.
	DEF VAR aux_cdagenci LIKE crapagp.cdagenci          NO-UNDO.
	DEF VAR aux_nrseqdig LIKE crapadp.nrseqdig          NO-UNDO.
	
	ASSIGN aux_cdevento = INT(GET-VALUE("aux_cdevento"))
           aux_cdagenci = INT(GET-VALUE("aux_cdagenci"))
           aux_nrseqdig = INT(GET-VALUE("aux_nrseqdig")).
</script>	
	
<script language="JavaScript">
 // monta a URL do programa que gera o XML   
   var url = "wcrm0002a_xml.p?aux_cdcooper=" + `aux_cdcooper` + 
             "&aux_cdevento=" + `aux_cdevento` +		 
             "&aux_cdagenci=" + `aux_cdagenci` +
             "&aux_nrseqdig=" + `aux_nrseqdig`;			  
</script>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><style type="text/css">
<!--
body {
	margin-left: 0px;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 0px;
}
-->
</style></head>
<body onLoad="ajax(url);">
<table width="550" border="0" cellpadding="0" cellspacing="0" class="bg_popup">
  <tr>
    <td width="550" height="60" background="/extrato-`aux_nmrescop`/crm/images/geral/topo_popup.gif"><table width="100%" height="64" border="0" cellpadding="0" cellspacing="0">
      <tr>
        <td width="15%">&nbsp;</td>
        <td width="68%" valign="top"><img src="/extrato-`aux_nmrescop`/crm/images/geral/titulo_eventos.gif"><br>
          <br></td>
        <td width="17%" align="center"><img src="/extrato-`aux_nmrescop`/crm/images/icones/imprimir.gif" width="67" height="18" onClick="javascript:self.print();" style="cursor:hand;"></td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td height="15"></td>
  </tr>
  <tr>
    <td height="30"><div id="copy"></div></td>
  </tr>
  <tr>
    <td height="2" class="bg_barra_bottom_claro"></td>
  </tr>
  <tr>
    <td height="5" class="bg_barra_bottom_escuro"></td>
  </tr>
  <tr>
    <td height="7" bgcolor="#FFFFFF"></td>
  </tr>
</table>
</body>
</html>
