<!--

Alterações: 12/06/2012 - Alterado busca na tabela gncoper para crapcop. Incluído tratamento
						 no nome da cooperativa para retirar espaços (Guilherme Maba).

-->
<script language="SpeedScript">
DEF VAR aux_nmrescop LIKE crapcop.nmrescop NO-UNDO.
DEF VAR aux_cdcooper LIKE crapcop.cdcooper NO-UNDO.
		
/* Recebe os parametros  */
ASSIGN aux_cdcooper = INT(GET-VALUE("aux_cdcooper")).
       
/* Busca o nome da cooperativa para montagen da chamada inscLink dinamicamente */
FIND FIRST crapcop WHERE crapcop.cdcooper = aux_cdcooper NO-LOCK NO-ERROR. 
    
IF  NOT AVAILABLE crapcop  THEN
    DO: 
        {&out} '~<script type=~"text/javascript~">alert(~"Nome da cooperativa nao encontrado~")~;~</script~>'.
        RETURN.
    END.
ELSE	
    aux_nmrescop = LC(REPLACE(crapcop.nmrescop, " ", "")).
</script>
<html>
<head>
<title>CECRED</title>
<script language="SpeedScript">
{&out} '~<link rel=~"stylesheet~" type=~"text/css~" href=~"/extrato-' + aux_nmrescop + '/crm/css/estilos_progrid.css~"~>\n'.
{&out} '~<script type=~"text/javascript~" src=~"/extrato-' + aux_nmrescop + '/crm/js/bloqueio.js~"~>~</script~>\n'.
{&out} '~<script type=~"text/javascript~" src=~"/extrato-' + aux_nmrescop + '/crm/js/ajax.js~"~>~</script~>\n'.
</script>
<script>
function ajax_onResponse() {
	if(checkReadyState(request)) {  
		xmlDoc = request.responseXML;
		conteudo = "<table width=100% border=0 cellpadding=0 cellspacing=0>";
		var erro = xmlDoc.getElementsByTagName('ERRO');
        
		if (erro.length > 0) {
			erro = erro.item(0).firstChild.data;
			conteudo = conteudo+'<tr class=fonte_geral><td height=25>&nbsp;&nbsp;</td></tr>';
			conteudo = conteudo+'<tr class=fonte_geral align=center><td height=25><strong>'+erro+'</strong></td></tr>';
			conteudo = conteudo+'<tr class=fonte_geral><td height=25>&nbsp;&nbsp;</td></tr></table>';
		} else {
			var node = xmlDoc.getElementsByTagName('AGENDA');
			corFundo = new Array('#FFFFFF','#F2F4F9');
			j = 0;

			// ano da agenda
			ano_agenda = xmlDoc.getElementsByTagName('AGENDA')[0].getAttribute('DTANOAGE');
			conteudo = conteudo+"<tr><td height=45 width=80% class=tit_topo>&nbsp;&nbsp;PROGRID PARA "+ano_agenda+" </td><td width=20% height=30>&nbsp;</td></tr></table><div style='position:relative; left:-1px; top:0px; width:100%; height:420px; z-index:1; visibility: inherit; overflow:auto;'><table width=100% border=0 cellpadding=0 cellspacing=0>";
			
			for(i=0; i < node.length; i++) {


				nom_evento = node[i].getElementsByTagName("NMEVENTO").item(0).firstChild.data;
				// evento
				cod_evento = node[i].getElementsByTagName("CDEVENTO").item(0).firstChild.data;
				
				conteudo = conteudo+'<tr class=fonte_geral><td bgcolor='+corFundo[j]+' height=25 width=80%>&nbsp;&nbsp;'+nom_evento+'</td><td bgcolor='+corFundo[j]+' width=20% align=right><a class=fonte_geral_azul href=wcrm0002.html?aux_cdcooper='+aux_cdcooper+'&aux_cdevento='+cod_evento+'&aux_cdagenci=0&aux_nrmeseve=0>PROGRAMAÇÃO</a>&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>';
				// define a cor de fundo das linhas
				if(j == 0) { 
					j = 1;
				} else {
					j = 0;
				}
			}
		}
		conteudo = conteudo+'</table></div>';
		document.getElementById('copy').innerHTML = conteudo;
		return conteudo;
	}
}
</script>
<script language="JavaScript">
   // pega a URL completa
   var param = window.location.href;
   
   // verifica se foi passada a cooperativa
   if(param.search("aux_cdcooper=")=="-1"){
      alert("Cooperativa não encontrada!");
	  window.close();
   }      

   // extrai o codigo da cooperativa
   var aux_cdcooper = param.substring(param.search("aux_cdcooper=") + 13,param.length);
   
   // monta a url com a cooperativa recebida
   var url = "wcrm0001_xml.p?aux_cdcooper=" + aux_cdcooper;
</script>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></head>
<body onLoad="ajax(url);" bgcolor="#FFFFFF">
<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td width="13" height="10"></td>
    <td height="10"></td>
  </tr>
  <tr>
    <td height="25">&nbsp;</td>
    <td height="25" class="fonte_geral"><div id="copy"></div></td>
  </tr>
  <tr>
    <td height="25">&nbsp;</td>
    <td height="25" align="right" class="tit_destaque">* A programa&ccedil;&atilde;o &eacute; definida com base nas sugest&otilde;es dos cooperados.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
  </tr>
</table>
</body>
</html>
