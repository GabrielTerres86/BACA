CREATE OR REPLACE VIEW TARIFAS.VW_TARIFA_OPENFINANCE AS
SELECT CRAPLCM.CDCOOPER
      ,CRAPASS.NRCPFCGC
      ,CRAPASS.INPESSOA TPPESSOA  -- 1=PF 2=PJ
      ,CRAPLAT.NRDOCMTO NRCONTRATO
      ,CRAPLCM.DTMVTOLT
      ,CRAPTAR.CDTARIFA
      ,CRAPTAR.DSTARIFA
      ,CRAPLCM.VLLANMTO
  FROM CECRED.CRAPLCM
INNER JOIN CECRED.CRAPASS ON (CRAPLCM.NRDCONTA = CRAPASS.NRDCONTA AND CRAPLCM.CDCOOPER = CRAPASS.CDCOOPER)
INNER JOIN CECRED.CRAPFVL ON (CRAPLCM.CDHISTOR = CRAPFVL.CDHISTOR)
INNER JOIN CECRED.CRAPTAR ON (CRAPFVL.CDTARIFA = CRAPTAR.CDTARIFA)
  LEFT JOIN CECRED.CRAPLAT ON (CRAPLAT.CDCOOPER = CRAPLCM.CDCOOPER AND CRAPLAT.DTMVTOLT = CRAPLCM.DTMVTOLT 
                               AND CRAPLAT.CDAGENCI = CRAPLCM.CDAGENCI AND CRAPLAT.CDBCCXLT = CRAPLCM.CDBCCXLT
                               AND CRAPLAT.NRDOLOTE = CRAPLCM.NRDOLOTE AND CRAPLAT.NRDCTABB = CRAPLCM.NRDCTABB
                               AND CRAPLAT.NRDOCMTO = CRAPLCM.NRDOCMTO);
comment on table TARIFAS.VW_TARIFA_OPENFINANCE is 'View para listar as tarifas de operações de crédito para Open Finance.';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.CDCOOPER is 'Código da cooperativa. #CLASSIFICACAO_DADO: I';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.NRCPFCGC is 'Número do CPF ou CNPJ. #CLASSIFICACAO_DADO: I';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.TPPESSOA is 'Tipo da pessoa, 1-PF 2-PJ. #CLASSIFICACAO_DADO: I';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.NRCONTRATO is 'Número do contrato. #CLASSIFICACAO_DADO: I';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.DTMVTOLT is 'Data da movimentação da tarifa. #CLASSIFICACAO_DADO: I';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.CDTARIFA is 'Código da tarifa. #CLASSIFICACAO_DADO: I';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.DSTARIFA is 'Descrição da tarifa. #CLASSIFICACAO_DADO: I';
comment on column TARIFAS.VW_TARIFA_OPENFINANCE.VLLANMTO is 'Valor de lançamento da tarifa. #CLASSIFICACAO_DADO: I';