DECLARE

  PROCEDURE PC_CRPS330(pr_cdcritic OUT INTEGER
                      ,pr_dscritic OUT VARCHAR2) IS
  
  BEGIN
  
    --********************************
    --/* INICIO DA ROTINA PRINCIPAL */
    --********************************
    DECLARE
    
      /* Cursores da pc_crps330 */
    
      -- Cursor sobre data
      vr_dtmvtolt DATE := to_date('05022024', 'ddmmyyyy');
      vr_ind_arq  utl_file.file_type;
      vr_nmdir    VARCHAR2(4000) := CECRED.gene0001.fn_param_sistema('CRED', 3, 'ROOT_MICROS') || 'cpd/bacas';
      vr_nmarq    VARCHAR2(100) := 'INC0313588.txt';
    
      vr_idprglog tbgen_prglog.idprglog%TYPE := 0;
    
      -- Loop sobre as cooperativas ativas
      CURSOR cr_crapcop IS
        SELECT cdcooper
              ,cdbcoctl
              ,cdagebcb
              ,cdagectl
              ,substr(lpad(nrdocnpj, 15, '0'), 1, 9) nrdocnpj
              ,nrdocnpj nrdocnpj_completo
              ,dsendweb
              ,SUBSTR(nmrescop, 1, 15) AS nmrescop
              ,SUBSTR(nrtelvoz, 2, INSTR(nrtelvoz, ')') - 2) AS nrdddtel
              ,REPLACE(substr(nrtelvoz, INSTR(nrtelvoz, ')') + 1), '-', '') AS nrtelvoz
              ,SUBSTR(nrdocnpj, -6, 6) AS nrdigito
              ,cdcliser
          FROM crapcop
         WHERE cdcooper = 1;
    
      -- Busca os boletos pendentes
      CURSOR cr_crapcob(pr_cdcooper crapcop.cdcooper%TYPE) IS
        SELECT cob.ROWID
              ,cob.cdbandoc
              ,cob.nrdctabb
              ,cob.nrcnvcob
              ,cob.nrdconta
              ,cob.nrdocmto
              ,cob.cdcooper
              ,cob.nrinssac
              ,cob.nrnosnum
              ,to_char(nvl(cob.dtdocmto, cob.dtmvtolt), 'yyyymmdd') AS dtdocmto
              ,cob.dtvencto
              ,cob.vltitulo
              ,cob.cddespec
              ,cob.cdcartei
              ,cob.tpdmulta
              ,cob.tpjurmor
              ,cob.vldescto
              ,cob.vlabatim
              ,cob.vlrmulta
              ,cob.vljurdia
              ,cob.incobran
              ,cob.inserasa
              ,cob.dsdoccop
              ,cob.flgdprot
          FROM crapcob cob
         INNER JOIN TBCOBRAN_HIS_NEG_SERASA hns
            ON hns.nrdocmto = cob.nrdocmto
           AND hns.nrdconta = cob.nrdconta
           AND hns.nrcnvcob = cob.nrcnvcob
           AND hns.nrdctabb = cob.nrdctabb
           AND hns.cdbandoc = cob.cdbandoc
           AND hns.cdcooper = cob.cdcooper
         WHERE hns.DHHISTORICO >= to_date('05022024', 'ddmmyyyy')
           AND hns.DHHISTORICO < to_date('06022024', 'ddmmyyyy')
           AND CASE
               --se boleto pago deve enviar o cancelamento da negativacao
                 WHEN cob.incobran = 5 AND hns.inserasa = 4 THEN
                  1
               --se boleto baixado deve enviar o cancelamento da negativacao
                 WHEN cob.incobran = 3 AND hns.inserasa = 4 THEN
                  1
               --se boleto aberto deve enviar todas as instrucões para o serasa
                 WHEN cob.incobran = 0 AND hns.inserasa = cob.inserasa THEN
                  1
                 ELSE
                  0
               END = 1
           AND hns.inserasa IN (2, 4)
           AND cob.PROGRESS_RECID IN (100465535
                                     ,100860746
                                     ,100963583
                                     ,102013008
                                     ,102061472
                                     ,102225580
                                     ,104033081
                                     ,104440562
                                     ,105715471
                                     ,105913158
                                     ,105972120
                                     ,106598742
                                     ,106598743
                                     ,106864313
                                     ,107457698
                                     ,107525907
                                     ,108132019
                                     ,108311785
                                     ,108861087
                                     ,109124292
                                     ,109528361
                                     ,109955108
                                     ,110136406
                                     ,110136407
                                     ,110144614
                                     ,110255999
                                     ,110750786
                                     ,110770939
                                     ,110770940
                                     ,110848020
                                     ,111139107
                                     ,111640279
                                     ,111640280
                                     ,111640281
                                     ,111640282
                                     ,111640283
                                     ,111640284
                                     ,111640285
                                     ,111640287
                                     ,111640288
                                     ,111910642
                                     ,113303937
                                     ,113719253
                                     ,113861748
                                     ,113981260
                                     ,114148380
                                     ,114172828
                                     ,114400225
                                     ,114417265
                                     ,114487844
                                     ,114635704
                                     ,114844878
                                     ,115210949
                                     ,115552510
                                     ,115552511
                                     ,115552512
                                     ,115677542
                                     ,115735189
                                     ,115735192
                                     ,116085679
                                     ,116206440
                                     ,116543920
                                     ,116562978
                                     ,116852744
                                     ,116929158
                                     ,116960492
                                     ,116960493
                                     ,117140186
                                     ,117374320
                                     ,117479802
                                     ,117606247
                                     ,117808141
                                     ,117859922
                                     ,118120875
                                     ,118347581
                                     ,118672194
                                     ,118695682
                                     ,118844002
                                     ,119005899
                                     ,119022359
                                     ,119151861
                                     ,119151862
                                     ,119286216
                                     ,119377198
                                     ,119391423
                                     ,119476093
                                     ,119525830
                                     ,119529153
                                     ,119535577
                                     ,119610084
                                     ,119625617
                                     ,119835192
                                     ,119835193
                                     ,119862810
                                     ,119936410
                                     ,120086275
                                     ,120258598
                                     ,120453131
                                     ,120571559
                                     ,120721004
                                     ,120749359
                                     ,120933363
                                     ,121122815
                                     ,121127749
                                     ,121209037
                                     ,121333018
                                     ,121357452
                                     ,121373570
                                     ,121446292
                                     ,121461953
                                     ,121888596
                                     ,121909635
                                     ,121959257
                                     ,122182003
                                     ,122195596
                                     ,122468554
                                     ,122534862
                                     ,122607867
                                     ,122638175
                                     ,122723860
                                     ,122837148
                                     ,123001470
                                     ,123045267
                                     ,123060499
                                     ,123190542
                                     ,123232538
                                     ,123253627
                                     ,123257396
                                     ,123351732
                                     ,123417427
                                     ,123620016
                                     ,123747773
                                     ,123829794
                                     ,124023622
                                     ,124171855
                                     ,124262963
                                     ,124280092
                                     ,124285241
                                     ,124307385
                                     ,124485520
                                     ,124488955
                                     ,124535730
                                     ,124655450
                                     ,124683487
                                     ,124738940
                                     ,124843612
                                     ,124888261
                                     ,124888264
                                     ,124935586
                                     ,124940901
                                     ,125013536
                                     ,125087357
                                     ,125097971
                                     ,125098000
                                     ,125147729
                                     ,125300217
                                     ,125313607
                                     ,125315135
                                     ,125338614
                                     ,125377431
                                     ,125421044
                                     ,125466923
                                     ,125561862
                                     ,125570914
                                     ,125724837
                                     ,125799673
                                     ,125857297
                                     ,125865811
                                     ,125865812
                                     ,125870053
                                     ,125872737
                                     ,125926785
                                     ,125997373
                                     ,125998722
                                     ,126001469
                                     ,126001470
                                     ,126036910
                                     ,126049445
                                     ,126049446
                                     ,126049447
                                     ,126049448
                                     ,126049449
                                     ,126130755
                                     ,126140764
                                     ,126159702
                                     ,126194930
                                     ,126279870
                                     ,126293421
                                     ,126327297
                                     ,126331026
                                     ,126341424
                                     ,126351107
                                     ,126365258
                                     ,126372894
                                     ,126451236
                                     ,126451237
                                     ,126485644
                                     ,126532031
                                     ,126546969
                                     ,126669484
                                     ,126680033
                                     ,126682307
                                     ,126682308
                                     ,126710763
                                     ,126710780
                                     ,126763840
                                     ,126771111
                                     ,126889466
                                     ,126891802
                                     ,126946333
                                     ,126946910
                                     ,126972240
                                     ,126978938
                                     ,127007056
                                     ,127016637
                                     ,127159805
                                     ,127171249
                                     ,127189007
                                     ,127195435
                                     ,127207633
                                     ,127269108
                                     ,127269109
                                     ,127285435
                                     ,127290002
                                     ,127371934
                                     ,127397215
                                     ,127523511
                                     ,127527327
                                     ,127527635
                                     ,127527636
                                     ,127527637
                                     ,127557786
                                     ,127665306
                                     ,127699240
                                     ,127699241
                                     ,127735404
                                     ,127735405
                                     ,127769331
                                     ,127774281
                                     ,127827101
                                     ,127850365
                                     ,127854798
                                     ,127854799
                                     ,127906231
                                     ,127913972
                                     ,127913973
                                     ,127919748
                                     ,127958820
                                     ,127972312
                                     ,127980760
                                     ,127988993
                                     ,127993274
                                     ,127993275
                                     ,127993277
                                     ,127993278
                                     ,127993279
                                     ,128022148
                                     ,128108482
                                     ,128108587
                                     ,128118901
                                     ,128164784
                                     ,128196914
                                     ,128202758
                                     ,128202802
                                     ,128262455
                                     ,128262456
                                     ,128262457
                                     ,128282820
                                     ,128286487
                                     ,128294463
                                     ,128318798
                                     ,128336935
                                     ,128345736
                                     ,128364531
                                     ,128366309
                                     ,128366310
                                     ,128381498
                                     ,128391252
                                     ,128399759
                                     ,128399760
                                     ,128399761
                                     ,128414240
                                     ,128434410
                                     ,128451638
                                     ,128465915
                                     ,128493063
                                     ,128498065
                                     ,128503135
                                     ,128503913
                                     ,128518543
                                     ,128655601
                                     ,128661435
                                     ,128661438
                                     ,128669476
                                     ,128694716
                                     ,128725122
                                     ,128726297
                                     ,128726327
                                     ,128736603
                                     ,128738555
                                     ,128751457
                                     ,128818002
                                     ,128818003
                                     ,128853373
                                     ,128870325
                                     ,128878219
                                     ,128880666
                                     ,128923056
                                     ,128949039
                                     ,128987315
                                     ,128994053
                                     ,129016329
                                     ,129038939
                                     ,129041324
                                     ,129064185
                                     ,129081986
                                     ,129100180
                                     ,129110629
                                     ,129115858
                                     ,129122193
                                     ,129122195
                                     ,129162042
                                     ,129166911
                                     ,129218398
                                     ,129218402
                                     ,129230882
                                     ,129353142
                                     ,129401454
                                     ,129406709
                                     ,129431683
                                     ,129472979
                                     ,129534755
                                     ,129563114
                                     ,129618277
                                     ,129659670
                                     ,129667337
                                     ,129667338
                                     ,129679392
                                     ,129690041
                                     ,129690042
                                     ,129690486
                                     ,129692941
                                     ,129715510
                                     ,129716274
                                     ,129756306
                                     ,129804426
                                     ,129804428
                                     ,129806294
                                     ,129809904
                                     ,129814894
                                     ,129814895
                                     ,129824679
                                     ,129832640
                                     ,129841936
                                     ,129843720
                                     ,129939899
                                     ,129992390
                                     ,130005344
                                     ,130012930
                                     ,130025442
                                     ,130114280
                                     ,130116071
                                     ,130118783
                                     ,130137994
                                     ,130144518
                                     ,130192277
                                     ,130223833
                                     ,130243657
                                     ,130256397
                                     ,130258356
                                     ,130277972
                                     ,130301436
                                     ,130301438
                                     ,130320317
                                     ,130328668
                                     ,130345797
                                     ,130407775
                                     ,130407776
                                     ,130411340
                                     ,130417833
                                     ,130464953
                                     ,130479398
                                     ,130508834
                                     ,130511985
                                     ,130558024
                                     ,130558025
                                     ,130598116
                                     ,130602616
                                     ,130606640
                                     ,130606737
                                     ,130626561
                                     ,130632285
                                     ,130632286
                                     ,130649508
                                     ,130674405
                                     ,130678767
                                     ,130683406
                                     ,130699976
                                     ,130713032
                                     ,130744694
                                     ,130754596
                                     ,130754893
                                     ,130755402
                                     ,130760941
                                     ,130761721
                                     ,130818607
                                     ,130838010
                                     ,130863526
                                     ,130863917
                                     ,130878964
                                     ,130891337
                                     ,130891446
                                     ,130902945
                                     ,130903406
                                     ,130921678
                                     ,130929782
                                     ,130929783
                                     ,130932272
                                     ,130932273
                                     ,130940499
                                     ,130952786
                                     ,130963611
                                     ,130972743
                                     ,130990531
                                     ,130991412
                                     ,130993153
                                     ,130993218
                                     ,131006214
                                     ,131039004
                                     ,131040233
                                     ,131116310
                                     ,131128925
                                     ,131137939
                                     ,131183657
                                     ,131211786
                                     ,131219895
                                     ,131287325
                                     ,131329502
                                     ,131364042
                                     ,131379260
                                     ,131401956
                                     ,131407546
                                     ,131422940
                                     ,131439750
                                     ,131441666
                                     ,131442427
                                     ,131443918
                                     ,131445105
                                     ,131474782
                                     ,131475872
                                     ,131486774
                                     ,131537107
                                     ,131542615
                                     ,131546379
                                     ,131574898
                                     ,131576089
                                     ,131618499
                                     ,131635765
                                     ,131651936
                                     ,131657975
                                     ,131668061
                                     ,131669832
                                     ,131707854
                                     ,131710646
                                     ,131732809
                                     ,131741041
                                     ,131753724
                                     ,131766171
                                     ,131768773
                                     ,131779376
                                     ,131790767
                                     ,131818187
                                     ,131819400
                                     ,131845589
                                     ,131850815
                                     ,131860345
                                     ,131907597
                                     ,131907667
                                     ,131940128
                                     ,131969148
                                     ,131986114
                                     ,131996394
                                     ,132021206
                                     ,132026673
                                     ,132027868
                                     ,132031091
                                     ,132032422
                                     ,132047859
                                     ,132067552
                                     ,132089998
                                     ,132103135
                                     ,132136878
                                     ,132137100
                                     ,132152284
                                     ,132152288
                                     ,132152290
                                     ,132155174
                                     ,132158726
                                     ,132172678
                                     ,132175849
                                     ,132177105
                                     ,132184905
                                     ,132190734
                                     ,132199747
                                     ,132212184
                                     ,132235294
                                     ,132243782
                                     ,132262482
                                     ,132262882
                                     ,132270123
                                     ,132289296
                                     ,132299030
                                     ,132327789
                                     ,132332545
                                     ,132339169
                                     ,132339977
                                     ,132346994
                                     ,132350180
                                     ,132350455
                                     ,132362892
                                     ,132362893
                                     ,132376642
                                     ,132392503
                                     ,132395993
                                     ,132399854
                                     ,132422671
                                     ,132442059
                                     ,132442102
                                     ,132491268
                                     ,132495992
                                     ,132516747
                                     ,132516871
                                     ,132526919
                                     ,132529825
                                     ,132549593
                                     ,132558410
                                     ,132561360
                                     ,132565320
                                     ,132584306
                                     ,132586673
                                     ,132588331
                                     ,132598068
                                     ,132600525
                                     ,132600526
                                     ,132603599
                                     ,132608019
                                     ,132615182
                                     ,132645353
                                     ,132664630
                                     ,132679100
                                     ,132685888
                                     ,132690518
                                     ,132701584
                                     ,132708066
                                     ,132741891
                                     ,132752892
                                     ,132759717
                                     ,132759914
                                     ,132763252
                                     ,132769117
                                     ,132769141
                                     ,132769264
                                     ,132788211
                                     ,132790457
                                     ,132794086
                                     ,132797291
                                     ,132798798
                                     ,132831483
                                     ,132838287
                                     ,132846859
                                     ,132846913
                                     ,132850496
                                     ,132866991
                                     ,132871890
                                     ,132873267
                                     ,132895100
                                     ,132898697
                                     ,132913532
                                     ,132913892
                                     ,132918641
                                     ,132936064
                                     ,132936067
                                     ,132937072
                                     ,132962371
                                     ,132997464
                                     ,132998978
                                     ,133000137
                                     ,133011838
                                     ,133043947
                                     ,133054202
                                     ,133054218
                                     ,133060125
                                     ,133064239
                                     ,133067030
                                     ,133069379
                                     ,133090909
                                     ,133095453
                                     ,133109619
                                     ,133113027
                                     ,133113352
                                     ,133143887
                                     ,133192819
                                     ,133216250
                                     ,133218906
                                     ,133220724
                                     ,133231971
                                     ,133241639
                                     ,133242074
                                     ,133251485
                                     ,133259088
                                     ,133266176
                                     ,133266752
                                     ,133281534
                                     ,133308801
                                     ,133312989
                                     ,133322557
                                     ,133351267
                                     ,133361640
                                     ,133380200
                                     ,133389087
                                     ,133447098
                                     ,133466555
                                     ,133470577
                                     ,133490730
                                     ,133511049
                                     ,133522870
                                     ,133541558
                                     ,133541573
                                     ,133548705
                                     ,133553247
                                     ,133575343
                                     ,133583274
                                     ,133594659
                                     ,133609629
                                     ,133634512
                                     ,133641188
                                     ,133641779
                                     ,133644367
                                     ,133645489
                                     ,133645490
                                     ,133655928
                                     ,133674838
                                     ,133677821
                                     ,133685303
                                     ,133733987
                                     ,133736036
                                     ,133736427
                                     ,133754023
                                     ,133770021
                                     ,133787452
                                     ,133795113
                                     ,133820088
                                     ,133824104
                                     ,133845162
                                     ,133845163
                                     ,133852989
                                     ,133871012
                                     ,133871019
                                     ,133875337
                                     ,133881341
                                     ,133889398
                                     ,133892700
                                     ,133892704
                                     ,133901651
                                     ,133906423
                                     ,133912000
                                     ,133927782
                                     ,133928563
                                     ,133929100
                                     ,133948366
                                     ,133948953
                                     ,133967510
                                     ,133975044
                                     ,133981583
                                     ,134007400
                                     ,134015561
                                     ,134037323
                                     ,134059206
                                     ,134067541
                                     ,134071361
                                     ,134083020
                                     ,134092545
                                     ,134092617
                                     ,134094776
                                     ,134099447
                                     ,134106154
                                     ,134112187
                                     ,134123449
                                     ,134127486
                                     ,134127519
                                     ,134127792
                                     ,134127952
                                     ,134131287
                                     ,134132035
                                     ,134143343
                                     ,134156750
                                     ,134161058
                                     ,134161073
                                     ,134165140
                                     ,134166919
                                     ,134184718
                                     ,134187426
                                     ,134187472
                                     ,134187592
                                     ,134212474
                                     ,134216277
                                     ,134230533
                                     ,134235915
                                     ,134237293
                                     ,134246491
                                     ,134251454
                                     ,134251702
                                     ,134262958
                                     ,134262960
                                     ,134272157
                                     ,134289727
                                     ,134290998
                                     ,134293564
                                     ,134293870
                                     ,134294765
                                     ,134296631
                                     ,134310321
                                     ,134310348
                                     ,134311805
                                     ,134316140
                                     ,134322285
                                     ,134331075
                                     ,134341832
                                     ,134345829
                                     ,134346091
                                     ,134364649
                                     ,134374008
                                     ,134376146
                                     ,134376489
                                     ,134383587
                                     ,134384330
                                     ,134393820
                                     ,134397167
                                     ,134399675
                                     ,134404071
                                     ,134421692
                                     ,134442465
                                     ,134471527
                                     ,134476010
                                     ,134476089
                                     ,134496333
                                     ,134496791
                                     ,134498914
                                     ,134505418
                                     ,134517850
                                     ,134529423
                                     ,134558298
                                     ,134585589
                                     ,134585641
                                     ,134609328
                                     ,134613269
                                     ,134613591
                                     ,134620364
                                     ,134627833
                                     ,134637553
                                     ,134637554
                                     ,134648223
                                     ,134649178
                                     ,134651142
                                     ,134652158
                                     ,134653981
                                     ,134664570
                                     ,134668030
                                     ,134671917
                                     ,134696096
                                     ,134721840
                                     ,134781026
                                     ,134828052
                                     ,134828257
                                     ,134836563
                                     ,134840330
                                     ,134841559
                                     ,134841560
                                     ,134847491
                                     ,134869716
                                     ,134897185
                                     ,134898810
                                     ,134898824
                                     ,134898826
                                     ,134942225
                                     ,134967202
                                     ,134972561
                                     ,134997430
                                     ,135017827
                                     ,135025819
                                     ,135026237
                                     ,135026547
                                     ,135027117
                                     ,135027245
                                     ,135027487
                                     ,135028149
                                     ,135029023
                                     ,135029451
                                     ,135029702
                                     ,135030094
                                     ,135030438
                                     ,135033798
                                     ,135034088
                                     ,135034281
                                     ,135034720
                                     ,135035050
                                     ,135035379
                                     ,135035674
                                     ,135035820
                                     ,135035923
                                     ,135036271
                                     ,135036575
                                     ,135039146
                                     ,135055557
                                     ,135057737
                                     ,135059208
                                     ,135061201
                                     ,135067888
                                     ,135109452
                                     ,135125052
                                     ,135130083
                                     ,135131426
                                     ,135158141
                                     ,135158636
                                     ,135159221
                                     ,135168903
                                     ,135172086
                                     ,135174549
                                     ,135174594
                                     ,135174596
                                     ,135174687
                                     ,135174689
                                     ,135175751
                                     ,135176173
                                     ,135176261
                                     ,135176325
                                     ,135177330
                                     ,135178412
                                     ,135178998
                                     ,135195204
                                     ,135200352
                                     ,135202978
                                     ,135237649
                                     ,135238877
                                     ,135247844
                                     ,135247998
                                     ,135248047
                                     ,135248058
                                     ,135250323
                                     ,135263183
                                     ,135266165
                                     ,135268103
                                     ,135291110
                                     ,135305997
                                     ,135320810
                                     ,135346436
                                     ,135355956
                                     ,135355977
                                     ,135364510
                                     ,135368274
                                     ,135369265
                                     ,135375681
                                     ,135386389
                                     ,135410855
                                     ,135428417
                                     ,135428755
                                     ,135431270
                                     ,135452224
                                     ,135491955
                                     ,135503384
                                     ,135504557
                                     ,135504578
                                     ,135513456
                                     ,135543317
                                     ,135547884
                                     ,135548393
                                     ,135549121
                                     ,135565161
                                     ,135566953
                                     ,135575384
                                     ,135575674
                                     ,135575875
                                     ,135575925
                                     ,135576003
                                     ,135580698
                                     ,135623143
                                     ,135623242
                                     ,135623343
                                     ,135623346
                                     ,135640898
                                     ,135646196
                                     ,135663599
                                     ,135707871
                                     ,135708252
                                     ,135714670
                                     ,135738161
                                     ,135745064
                                     ,135801128
                                     ,135803072
                                     ,135829742
                                     ,135848643
                                     ,135903190
                                     ,135904160
                                     ,135904665
                                     ,135933860
                                     ,135996506
                                     ,135996815
                                     ,135997169
                                     ,136005174
                                     ,136021470
                                     ,136024613
                                     ,136024679
                                     ,136053099
                                     ,136097627
                                     ,136203186
                                     ,136205045
                                     ,136332730
                                     ,53763985
                                     ,56232428
                                     ,67192326
                                     ,72150701
                                     ,73319039
                                     ,73943674
                                     ,74039413
                                     ,74039414
                                     ,74039415
                                     ,77453899
                                     ,77934507
                                     ,78242260
                                     ,79292787
                                     ,79391878
                                     ,79392944
                                     ,84305392
                                     ,84625845
                                     ,85892793
                                     ,88765773
                                     ,92182100
                                     ,92712238
                                     ,92859785
                                     ,93328522
                                     ,94144318
                                     ,94237879
                                     ,94538133
                                     ,96563483
                                     ,97107006
                                     ,97653593
                                     ,98013443
                                     ,98360139
                                     ,98360141
                                     ,98686583
                                     ,99118695
                                     ,99148402
                                     ,99474104
                                     ,99800732);
    
      -- Busca Dados do Credor
      CURSOR cr_crapjur(pr_cdcooper crapcop.cdcooper%TYPE
                       ,pr_nrdconta crapjur.nrdconta%TYPE) IS
        SELECT ass.nrcpfcgc
              , --> Documento do Credor 
               gene0007.fn_caract_acento(pr_texto => jur.nmextttl) nmextttl
              , --> Razão Social do Credor   
               gene0007.fn_caract_acento(pr_texto => jur.nmfansia) nmfansia
              , --> Nome Fantasia do Credor
               gene0007.fn_caract_acento(pr_texto => enc.dsendere) dsendere
              , --> Endereço do Credor
               gene0007.fn_caract_acento(pr_texto => enc.nmbairro) nmbairro
              , --> Bairro do Credor
               gene0007.fn_caract_acento(pr_texto => enc.nmcidade) nmcidade
              , --> Município do Credor 
               enc.cdufende
              , --> Sigla Unidade Federativa do Credor    
               enc.nrcepend
              , --> Código de endereçamento postal
               nvl(tfc.nrdddtfc, 0) nrdddtfc
              , --> DDD do Telefone do Credor
               nvl(tfc.nrtelefo, 0) nrtelefo
              , --> Telefone do Credor
               nvl(tfc.nrdramal, 0) nrdramal --> Número de ramal do telefone do Credor 
          FROM crapass ass
              ,crapenc enc
              ,craptfc tfc
              ,crapjur jur
         WHERE jur.cdcooper = pr_cdcooper
           AND jur.nrdconta = pr_nrdconta
           AND ass.cdcooper = jur.cdcooper
           AND ass.nrdconta = jur.nrdconta
           AND enc.cdcooper = jur.cdcooper
           AND enc.nrdconta = jur.nrdconta
           AND tfc.cdcooper(+) = jur.cdcooper
           AND tfc.nrdconta(+) = jur.nrdconta
           AND tfc.idseqttl(+) = 1;
      rw_crapjur cr_crapjur%ROWTYPE;
    
      -- Busca Dados do Devedor
      CURSOR cr_crapsab(pr_cdcooper crapsab.cdcooper%TYPE
                       ,pr_nrdconta crapsab.nrdconta%TYPE
                       ,pr_nrinssac crapsab.nrinssac%TYPE) IS
        SELECT cdtpinsc
              , --> Tipo de pessoa do Devedor (F - Fisica / J - Juridica)
               nrinssac
              , --> Documento do Devedor (CPF ou CNPJ)
               NVL(gene0007.fn_caract_acento(pr_texto => nmdsacad), ' ') nmdsacad
              , --> Nome do Devedor
               NVL(gene0007.fn_caract_acento(pr_texto => dsendsac), ' ') dsendsac
              , --> Endereço do Devedor
               NVL(gene0007.fn_caract_acento(pr_texto => complend), ' ') complend
              , --> Complemento do Endereço do Devedor
               NVL(gene0007.fn_caract_acento(pr_texto => nmbaisac), ' ') nmbaisac
              , --> Bairro do Devedor
               NVL(gene0007.fn_caract_acento(pr_texto => nmcidsac), ' ') nmcidsac
              , --> Município do Devedor
               NVL(cdufsaca, ' ') cdufsaca
              , --> Sigla Unidade Federativa do Devedor
               NVL(nrcepsac, 0) nrcepsac --> CEP do Devedor
          FROM crapsab
         WHERE cdcooper = pr_cdcooper
           AND nrdconta = pr_nrdconta
           AND nrinssac = pr_nrinssac;
      rw_crapsab cr_crapsab%ROWTYPE;
    
      -- Busca os dias de vencimento
      CURSOR cr_param(pr_cdcooper crapcop.cdcooper%TYPE) IS
        SELECT qtdias_vencimento
          FROM tbcobran_param_negativacao
         WHERE cdcooper = pr_cdcooper;
      rw_param cr_param%ROWTYPE;
    
      -- Estrutura para erro
      TYPE typ_reg_remessa_erro IS RECORD(
         nmrescop crapcop.nmrescop%TYPE
        ,nrdconta craprem.nrdconta%TYPE
        ,nrdocmto craprem.nrdocmto%TYPE
        ,nrcnvcob craprem.nrcnvcob%TYPE
        ,dscritic VARCHAR2(4000));
      -- Estruturas para controle de erro
      TYPE typ_tab_tarifas_erro IS TABLE OF typ_reg_remessa_erro INDEX BY PLS_INTEGER;
      TYPE typ_tab_coopera_erro IS TABLE OF typ_reg_remessa_erro INDEX BY PLS_INTEGER;
    
      -- Variaveis Locais da pc_crps330
      vr_dsserasa VARCHAR2(10);
      vr_dstpinsc VARCHAR2(10);
      vr_nrtpinsc VARCHAR2(10);
      vr_nrseqblt NUMBER := 1; -- Numero Sequencial do Boleto
      vr_dsdespec VARCHAR2(10); -- Especia do Titulo
      vr_tab_cob  cecred.cobr0005.typ_tab_cob;
      vr_dstxtpgt VARCHAR2(70) := 'PAGAVEL PREFERENCIALMENTE NAS COOPERATIVAS DO SISTEMA AILOS.';
      vr_dtvencto DATE; -- Data de vencimento calculada
      vr_cdbarras VARCHAR2(100); -- Codigo de barras
      vr_lindigit VARCHAR2(100); -- Linha digitavel do codigo de barras
      vr_vlfatura crapcob.vltitulo%TYPE; -- Valor da fatura para o calculo do valor com multa
      vr_vlrmulta crapcob.vltitulo%TYPE; -- Valor da multa
      vr_vlrjuros crapcob.vltitulo%TYPE; -- Valor dos juros
      vr_nrdigage NUMBER(05); -- Digito da agencia
      vr_nrseqarq PLS_INTEGER; -- NUmero sequencial do arquivo
    
      -- Job de envio de negativação
      vr_nomdojob VARCHAR2(40) := 'JBCOBRAN_ENVIO_SERASA';
    
      --Variaveis de controle do programa
      vr_cdcritic NUMBER := 0;
      vr_dscritic VARCHAR2(4000);
      vr_des_erro VARCHAR2(10);
    
      --Variaveis de Excecao
      vr_exc_saida EXCEPTION;
    
      -- Variaveis de e-mail
      vr_dsendere VARCHAR2(500);
      vr_dsconteu VARCHAR2(5000);
    
      -- Controle de erros      
      vr_tab_tarifas_erro typ_tab_tarifas_erro;
      vr_tab_coopera_erro typ_tab_coopera_erro;
    
      vr_dslinha_arquivo VARCHAR2(4000);
    
    BEGIN
    
      -- Loop sobre as cooperativas
      FOR rw_crapcop IN cr_crapcop
      LOOP
      
        -- Busca a quantidade de dias de vencimento
        OPEN cr_param(rw_crapcop.cdcooper);
        FETCH cr_param
          INTO rw_param;
        CLOSE cr_param;
      
        -- Calcula o digito da agencia
        vr_nrdigage := rw_crapcop.cdagectl * 10;
        vr_nrdigage := vr_nrdigage - (rw_crapcop.cdagectl * 10);
      
        -- Obtem o sequencial do arquivo
        vr_nrseqarq := 1999;
      
        -- Inicializa variavel de sequencial do arquivo
        vr_nrseqblt := 1;
      
        gene0001.pc_OScommand_Shell(pr_des_comando => 'rm ' || vr_nmdir || '/' || vr_nmarq);
        gene0001.pc_OScommand_Shell(pr_des_comando => 'rm ' || vr_nmdir || '/INC0313588_ansi.txt');
      
        CECRED.GENE0001.pc_abre_arquivo(pr_nmdireto => vr_nmdir
                                       ,pr_nmarquiv => vr_nmarq
                                       ,pr_tipabert => 'W'
                                       ,pr_utlfileh => vr_ind_arq
                                       ,pr_des_erro => vr_dscritic);
      
        IF vr_dscritic IS NOT NULL THEN
          raise_application_error(-20004, vr_dscritic);
        END IF;
      
        -- Criar HEADER do arquivo
        vr_dslinha_arquivo := '0' || --> Código do registro = '0' (zero)
                              lPad(rw_crapcop.nrdocnpj, 9, '0') || --> Número do CNPJ
                              to_char(vr_dtmvtolt, 'yyyymmdd') || --> Data do movimento (AAAAMMDD)
                              lPad(rw_crapcop.nrdddtel, 4, '0') || --> Número de DDD do telefone
                              lPad(rw_crapcop.nrtelvoz, 8, '0') || --> Número do telefone
                              RPad(' ', 4, ' ') || --> Número de ramal 
                              RPad('Ailos Cobrancas', 70, ' ') || --> Nome do contato da Instituição Conveniada   
                              RPad('SERASA-CONVEM07', 15, ' ') || --> Identificação do arquivo fixo 'SERASA-CONVEM07'
                              LPAD(vr_nrseqarq, 6, '0') || --> Número da remessa do arquivo seqüencial
                              'E' || --> Código de envio de arquivo  = 'E' (ENTRADA) e 'R' (RETORNO)
                              RPad(' ', 4, ' ') || --> Diferencial de remessa
                              RPad(' ', 40, ' ') || --> Deixar em branco 
                              '002' || --> Versão do Layout  Constante '002'
                              RPad(' ', 660, ' ') || --> Deixar em branco 
                              RPad(' ', 60, ' ') || --> Código de erros  
                              LPAD(vr_nrseqblt, 7, '0'); --> Seqüência do registro no arquivo igual a 0000001
        CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq, vr_dslinha_arquivo);
        -- Atualiza Sequencia do registro no arquivo                                             
        vr_nrseqblt := (vr_nrseqblt + 1);
      
        -- Limpa a variavel
        vr_dsserasa := NULL;
      
        -- Loop sobre os boletos pendentes
        FOR rw_crapcob IN cr_crapcob(rw_crapcop.cdcooper)
        LOOP
        
          -- Consulta campos da Linha Digitavel
          cobr0005.pc_buscar_titulo_cobranca(pr_cdcooper => rw_crapcob.cdcooper
                                            ,pr_nrdconta => rw_crapcob.nrdconta
                                            ,pr_nrcnvcob => rw_crapcob.nrcnvcob
                                            ,pr_nrdocmto => rw_crapcob.nrdocmto
                                            ,pr_incobran => rw_crapcob.incobran
                                            ,pr_cdoperad => '1'
                                            ,pr_nriniseq => 0
                                            ,pr_nrregist => 1
                                            ,pr_cdcritic => vr_cdcritic
                                            ,pr_dscritic => vr_dscritic
                                            ,pr_tab_cob  => vr_tab_cob);
          IF vr_dscritic IS NOT NULL THEN
            raise_application_error(-20001, vr_dscritic);
          END IF;
          -- Fim - Consulta campos da Linha Digitavel
        
          -- Conforme conversado com Victor, para a instrucao de vencimento, deve-se colocar a impressao da 2a. via
          vr_tab_cob(1).dsdinst2 := 'Apos o vencimento ou 2a. via, acesse ' || rw_crapcop.dsendweb;
        
          -- Abre o Cursor Dados do Credor
          OPEN cr_crapjur(rw_crapcob.cdcooper, rw_crapcob.nrdconta);
          FETCH cr_crapjur
            INTO rw_crapjur;
          CLOSE cr_crapjur;
        
          -- Identifica tipo de acao
          IF (rw_crapcob.inserasa = 2) THEN
            vr_dsserasa := 'I';
          ELSE
            vr_dsserasa := 'E';
          END IF;
        
          -- Abre o Cursor Dados do Devedor
          OPEN cr_crapsab(rw_crapcob.cdcooper, rw_crapcob.nrdconta, rw_crapcob.nrinssac);
          FETCH cr_crapsab
            INTO rw_crapsab;
          CLOSE cr_crapsab;
        
          -- Tipo de pessoa do Devedor
          IF (rw_crapsab.cdtpinsc = 1) THEN
            vr_dstpinsc := 'F'; -- Fisica
            vr_nrtpinsc := '2'; -- CPF
          ELSE
            vr_dstpinsc := 'J'; -- Juridica
            vr_nrtpinsc := '1'; -- CNPJ
          END IF;
        
          -- Especie do Titulo
          CASE rw_crapcob.cddespec
            WHEN 1 THEN
              vr_dsdespec := 'DM';
            WHEN 2 THEN
              vr_dsdespec := 'DS';
            WHEN 3 THEN
              vr_dsdespec := 'NP';
            WHEN 4 THEN
              vr_dsdespec := 'DV';
            WHEN 5 THEN
              vr_dsdespec := 'DV';
            WHEN 6 THEN
              vr_dsdespec := 'DM';
            ELSE
              vr_dsdespec := 'DM';
          END CASE;
        
          -- Calcula a data de vencimento 
          vr_dtvencto := gene0005.fn_valida_dia_util(pr_cdcooper => rw_crapcop.cdcooper
                                                    ,pr_dtmvtolt => vr_dtmvtolt + rw_param.qtdias_vencimento);
        
          -- Busca valor de multa
          vr_vlfatura := rw_crapcob.vltitulo;
        
          -- Abatimento deve ser calculado antes dos juros/multa 
          IF rw_crapcob.vlabatim > 0 THEN
            vr_vlfatura := vr_vlfatura - rw_crapcob.vlabatim;
          END IF;
        
          /* MULTA PARA ATRASO */
          vr_vlrmulta := 0;
          IF rw_crapcob.tpdmulta = 1 THEN
            /* Valor */
            vr_vlrmulta := rw_crapcob.vlrmulta;
          ELSIF rw_crapcob.tpdmulta = 2 THEN
            /* % de multa */
            vr_vlrmulta := (rw_crapcob.vlrmulta * vr_vlfatura) / 100;
          END IF;
        
          /* MORA PARA ATRASO */
          vr_vlrjuros := 0;
          IF rw_crapcob.tpjurmor = 1 THEN
            /* dias */
            vr_vlrjuros := rw_crapcob.vljurdia * (vr_dtvencto - rw_crapcob.dtvencto);
          ELSIF rw_crapcob.tpjurmor = 2 THEN
            /* mes */
            vr_vlrjuros := (vr_vlfatura * ((rw_crapcob.vljurdia / 100) / 30) * (vr_dtvencto - rw_crapcob.dtvencto));
          END IF;
        
          -- Busca o codigo de barras
          -- Obs.: calcular codigo de barras com o valor atualizado
          cobr0005.pc_calc_codigo_barras(pr_dtvencto => vr_dtvencto
                                        ,pr_cdbandoc => rw_crapcob.cdbandoc
                                        ,pr_vltitulo => rw_crapcob.vltitulo + vr_vlrjuros + vr_vlrmulta
                                        ,pr_nrcnvcob => rw_crapcob.nrcnvcob
                                        ,pr_nrcnvceb => 0
                                        , -- Utilizado somente para convenios do BB
                                         pr_nrdconta => to_number(SUBSTR(rw_crapcob.nrnosnum, 1, 8))
                                        ,pr_nrdocmto => to_number(SUBSTR(rw_crapcob.nrnosnum, 9, 9))
                                        ,pr_cdcartei => rw_crapcob.cdcartei
                                        ,pr_cdbarras => vr_cdbarras);
        
          -- Busca a linha digitavel
          cobr0005.pc_calc_linha_digitavel(pr_cdbarras => vr_cdbarras, pr_lindigit => vr_lindigit);
        
          -- Cria texto do arquivo
          -- Dados da Anotação - Registro "1"
          vr_dslinha_arquivo := '1' || --> Código do registro = '1'
                                vr_dsserasa || --> Código da operação
                                RPad(rw_crapcop.nrdigito, 6, ' ') || --> Filial e Dígito da Instituição Informante     
                                LPad(rw_crapcop.nrdocnpj_completo, 15, '0') || --> CNPJ da Instituição Conveniada (Base + Filial + Digito)
                                'J' || --> Tipo de Pessoa do Credor
                                '1' || --> Tipo do primeiro documento do Credor
                                LPad(rw_crapjur.nrcpfcgc, 15, '0') || --> Documento do Credor 
                                RPad(rw_crapjur.nmextttl, 70, ' ') || --> Razão Social do Credor    
                                RPad(SUBSTR(NVL(rw_crapjur.nmfansia, ' '), 1, 25), 25, ' ') || --> Nome Fantasia do Credor     
                                RPad(rw_crapjur.dsendere, 45, ' ') || --> Endereço do Credor
                                RPad(rw_crapjur.nmbairro, 20, ' ') || --> Bairro do Credor
                                RPad(rw_crapjur.nmcidade, 25, ' ') || --> Município do Credor 
                                RPad(rw_crapjur.cdufende, 2, ' ') || --> Sigla Unidade Federativa do Credor      
                                LPad(rw_crapjur.nrcepend, 8, '0') || --> Código de endereçamento postal
                                LPad(rw_crapjur.nrdddtfc, 4, '0') || --> DDD do Telefone do Credor
                                LPad(rw_crapjur.nrtelefo, 9, '0') || --> Telefone do Credor
                                RPad(rw_crapjur.nrdramal, 4, ' ') || --> Número de ramal do telefone do Credor 
                                vr_dstpinsc || --> Tipo de pessoa do Devedor (F - Fisica / J - Juridica)
                                vr_nrtpinsc || --> Tipo do primeiro documento do Devedor ( 1  CNPJ ou 2 - CNPJ) 
                                LPad(rw_crapsab.nrinssac, 15, '0') || --> Documento do Devedor (CPF ou CNPJ)
                                RPad(' ', 1, ' ') || --> Tipo do segundo documento do Devedor
                                RPad(' ', 15, ' ') || --> Segundo Documento do Devedor
                                RPad(' ', 2, ' ') || --> UF do Segundo Documento do Devedor
                                RPad(rw_crapsab.nmdsacad, 70, ' ') || --> Nome do Devedor
                                RPad(rw_crapsab.dsendsac, 45, ' ') || --> Endereço do Devedor
                                RPad(rw_crapsab.complend, 25, ' ') || --> Complemento do Endereço do Devedor
                                RPad(rw_crapsab.nmbaisac, 20, ' ') || --> Bairro do Devedor
                                RPad(rw_crapsab.nmcidsac, 25, ' ') || --> Município do Devedor
                                RPad(rw_crapsab.cdufsaca, 2, ' ') || --> Sigla Unidade Federativa do Devedor
                                LPad(rw_crapsab.nrcepsac, 8, '0') || --> CEP do Devedor
                                RPad(' ', 4, ' ') || --> DDD do Telefone do Devedor
                                RPad(' ', 9, ' ') || --> Telefone do Devedor
                                RPad(' ', 70, ' ') || --> Nome do Pai do Devedor
                                RPad(' ', 70, ' ') || --> Nome da Mãe do Devedor
                                RPad(' ', 8, ' ') || --> Data de Nascimento do Devedor
                                RPad(nvl(rw_crapcob.nrnosnum, ' '), 15, ' ') || --> Nosso número  da Instituição Conveniada
                                RPad(vr_dsdespec, 3, ' ') || --> Espécie do Titulo
                                RPad(rw_crapjur.nmcidade, 40, ' ') || -- Cidade que Originou a Anotação
                                RPad(rw_crapjur.cdufende, 2, ' ') || --> UF que Originou a Anotação
                               
                                RPad(nvl(to_char(rw_crapcob.nrdocmto), ' '), 16, ' ') || --> Número do titulo ou contrato
                                RPad(rw_crapcob.dtdocmto, 8, ' ') || --> Data da Emissão do Título 
                                to_char(rw_crapcob.dtvencto, 'YYYYMMDD') || --> Data de Vencimento do Título
                                '001' || --> Tipo de Moeda ( 001  Real )
                                LPad(rw_crapcob.vltitulo * 100, 15, '0') || --> Valor do Titulo -  2 decimais
                                RPad(' ', 15, ' ') || --> Saldo do Contrato 
                                RPad(' ', 1, ' ') || --> Tipo de Endosso do Titulo
                                RPad(' ', 1, ' ') || --> Informação sobre Aceite 
                                '1' || --> Número de Controle(s) do(s) Devedor(es)
                                RPad(' ', 1, ' ') || --> Tipo de Anotação 
                                RPad(rw_crapcob.nrcnvcob, 10, ' ') || --> Uso Reservado da Instituição Conveniada (na inclusão)
                                RPad(nvl(to_char(rw_crapcob.nrdconta), ' '), 10, ' ') || --> Uso Reservado da Instituição Conveniada (na inclusão)
                                RPad(' ', 2, ' ') || --> Motivo de Baixa
                                'B' || --> Indicativo do Tipo de Comunicado ao Devedor
                                RPad(' ', 1, ' ') || --> Indicador de Melhor Endereço
                                RPad(' ', 1, ' ') || --> Indicador de SMS
                                RPad(' ', 4, ' ') || --> Deixar em branco
                                vr_dstpinsc || --> Tipo de pessoa do Principal da Dívida
                                vr_nrtpinsc || --> Tipo do documento do Principal da Dívida
                                LPad(rw_crapsab.nrinssac, 15, '0') || --> Documento do Principal da Dívida
                                RPad(' ', 15, ' ') || --> Deixar em branco
                                RPad(' ', 60, ' ') || --> Códigos de erros
                                LPAD(vr_nrseqblt, 7, '0'); --> Seqüência do registro no arquivo ;
        
          CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq, vr_dslinha_arquivo);
          -- Atualiza Sequencia do registro no arquivo                                             
          vr_nrseqblt := (vr_nrseqblt + 1);
        
          -- Cria texto do arquivo
          -- Boleto Bancário  Registro "2"
          vr_dslinha_arquivo := '2' || --> Código do registro = '2'
                                lpad(rw_crapcop.cdbcoctl, 3, '0') || --> Código do Banco
                                '1' || --> Digito do Banco
                                RPad(rw_crapcop.nmrescop, 15, ' ') || --> Nome do Banco
                                substr(vr_lindigit, 1, 5) || --> Primeiro campo da Linha Digitavel
                                substr(vr_lindigit, 7, 5) || --> Segundo campo da Linha Digitavel
                                substr(vr_lindigit, 13, 5) || --> Terceiro campo da Linha Digitavel
                                substr(vr_lindigit, 19, 6) || --> Quarto campo da Linha Digitavel
                                substr(vr_lindigit, 26, 5) || --> Quinto campo da Linha Digitavel
                                substr(vr_lindigit, 32, 6) || --> Sexto campo da Linha Digitavel
                                substr(vr_lindigit, 39, 1) || --> Sétimo campo da Linha Digitavel
                                substr(vr_lindigit, 41, 14) || --> Oitavo campo da Linha Digitavel
                                RPad(vr_dstxtpgt, 70, ' ') || --> Texto do Local de Pagamento
                                RPad(' ', 70, ' ') || --> Deixar em Branco
                                to_char(vr_dtvencto, 'YYYYMMDD') || --> Data do vencimento do boleto  AAAAMMDD  ou Branco(caso queira a expressão 'CONTRA APRESENTACAO'                
                                'J' || --> Tipo de pessoa do cedente; Física (F) ou Jurídica( J )
                                '1' || --> Tipo do primeiro docto. do cedente: 1-CNPJ ou 2-CPF
                                LPad(rw_crapjur.nrcpfcgc, 15, '0') || --> Documento do cedente 
                                RPad(rw_crapjur.nmextttl, 40, ' ') || --> Nome do cedente do título.
                                rpad(lpad(rw_crapcop.cdagectl, 4, '0') || '-' || vr_nrdigage || ' ' ||
                                     gene0002.fn_mask_conta(rw_crapcob.nrdconta)
                                    ,25
                                    ,' ') || --> Código e Digito da Agência + Código e Digito do cedente
                                RPad(rw_crapcob.dtdocmto, 8, ' ') || --> Data do documento  AAAAMMDD
                                RPad(rw_crapcob.dsdoccop, 25, ' ') || --> Número do documento
                                RPad(' ', 5, ' ') || --> Sigla da espécie do documento  exemplo: NF, DP, etc.
                                RPad(' ', 3, ' ') || --> Código do aceite do título N ou S
                                RPad(' ', 17, ' ') || --> Para uso do banco 
                                RPad(' ', 3, ' ') || --> Deixar em branco
                                to_char(vr_dtmvtolt, 'yyyymmdd') || --> Data do Processamento  AAAAMMDD
                                RPad(nvl(rw_crapcob.nrnosnum, ' '), 25, ' ') || --> Nosso número
                                RPad('01', 5, ' ') || --> Número da Carteira
                                RPad('R$', 3, ' ') || --> Espécie de Moeda (R$) 
                                RPad(' ', 9, ' ') || --> Quantidade de Moeda 
                                RPad(' ', 1, ' ') || --> Qtde de decimais do Valor da Moeda
                                RPad(' ', 9, ' ') || --> Valor da Moeda 
                                LPad(rw_crapcob.vltitulo * 100, 15, '0') || --> Valor do boleto (valor a ser pago pelo devedor ) com 2 decimais, sem ponto e virgula                                            
                                RPad(' ', 15, ' ') || --> Valor do desconto, caso houver, com 2 decimais, sem ponto e virgula                                                                                 
                                RPad(' ', 15, ' ') || --> Valor de outras deduções, caso houver, com 2 decimais, sem ponto e virgula                                           
                                LPad((vr_vlrjuros + vr_vlrmulta) * 100, 15, '0') || --> Valor da mora ou multa, caso houver, com 2 decimais, sem ponto e virgula                                           
                                RPad(' ', 15, ' ') || --> Valor de outros acréscimos, caso houver, com 2 decimais, sem ponto e virgula                                           
                                LPad((rw_crapcob.vltitulo + vr_vlrjuros + vr_vlrmulta) * 100, 15, '0') || --> Valor total a ser cobrado, com 2 decimais, sem ponto e virgula.                                                              
                                RPad(' ', 1, ' ') || --> Tipo de pessoa do sacador; Física (F) ou Jurídica (J )    
                                RPad(' ', 1, ' ') || --> Tipo do primeiro docto. do sacador: 1-CNPJ ou 2-CPF   
                                RPad(' ', 15, ' ') || --> Documento do sacador: 
                                RPad(' ', 50, ' ') || --> Nome do Sacador / Avalista
                                RPad(' ', 318, ' ') || --> Deixar em branco 
                                LPAD(vr_nrseqblt, 7, '0'); --> Seqüência do registro no arquivo
        
          CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq, vr_dslinha_arquivo);
          -- Atualiza Sequencia do registro no arquivo
          vr_nrseqblt := (vr_nrseqblt + 1);
        
          -- Cria texto do arquivo
          -- Boleto Bancário  Registro "3"
          vr_dslinha_arquivo := '3' || --> Código do registro = '3'
                                RPad(nvl(vr_tab_cob(1).dsdinstr, ' '), 70, ' ') || --> Linha de Instrução  1
                                RPad(nvl(vr_tab_cob(1).dsdinst1, ' '), 70, ' ') || --> Linha de Instrução  2
                                RPad(nvl(vr_tab_cob(1).dsdinst2, ' '), 70, ' ') || --> Linha de Instrução  3
                                RPad(nvl(vr_tab_cob(1).dsinfor1, ' '), 70, ' ') || --> Linha de Instrução  4
                                RPad(nvl(vr_tab_cob(1).dsinfor2, ' '), 70, ' ') || --> Linha de Instrução  5
                                RPad(nvl(vr_tab_cob(1).dsinfor3, ' '), 70, ' ') || --> Linha de Instrução  6
                                RPad(nvl(vr_tab_cob(1).dsinfor4, ' '), 70, ' ') || --> Linha de Instrução  7
                                RPad(nvl(vr_tab_cob(1).dsinfor5, ' '), 70, ' ') || --> Linha de Instrução  8
                                RPad(' ', 332, ' ') || --> Deixar em branco 
                                LPAD(vr_nrseqblt, 7, '0'); --> Seqüência do registro no arquivo
        
          CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq, vr_dslinha_arquivo);
          -- Atualiza Sequencia do registro no arquivo
          vr_nrseqblt := (vr_nrseqblt + 1);
        
        END LOOP;
      
        -- Cria TRAIL do arquivo
        vr_dslinha_arquivo := '9' || --> Código do registro = '9'
                              RPad(' ', 892, ' ') || --> Deixar em branco 
                              LPAD(vr_nrseqblt, 7, '0'); --> Seqüência do registro no arquivo
        CECRED.GENE0001.pc_escr_linha_arquivo(vr_ind_arq, vr_dslinha_arquivo);
      
        CECRED.GENE0001.pc_fecha_arquivo(pr_utlfileh => vr_ind_arq);
      
        -- Converte o arquivo para o formato ANSI
        gene0001.pc_OScommand_Shell(pr_des_comando => 'iconv -f utf-8 -t ISO8859-1 ' || vr_nmdir || '/' || vr_nmarq || ' > ' ||
                                                      vr_nmdir || '/INC0313588_ansi.txt');
      
      END LOOP;
    
    END;
  END PC_CRPS330;
BEGIN

  DECLARE
  
    vr_cdcritic INTEGER;
    vr_dscritic VARCHAR2(32000);
  
  BEGIN
  
    PC_CRPS330(pr_cdcritic => vr_cdcritic, pr_dscritic => vr_dscritic);
  
    dbms_output.put_line(vr_cdcritic);
    dbms_output.put_line(vr_dscritic);
  
  END;

  ROLLBACK;
  COMMIT;

END;
