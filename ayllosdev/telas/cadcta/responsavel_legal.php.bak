<?php
/*!
 * FONTE        : responsavel_legal.php
 * CRIAÇÃO      : Andrey Formigari (Mouts)
 * DATA CRIAÇÃO : Setembro/2017
 * OBJETIVO     : Listar Responsaveis Legais na tela CADCTA
 * --------------
 * ALTERAÇÕES   :
 * --------------
 */
 
session_start();	
require_once("../../includes/config.php");
require_once("../../includes/funcoes.php");		
require_once("../../includes/controla_secao.php");
require_once("../../class/xmlfile.php");	
isPostMethod();

// Guardo o número da conta e titular em variáveis
$nrdconta = $_POST["nrdconta"]     == "" ? 0        : $_POST["nrdconta"];
$idseqttl = $_POST["idseqttl"]     == "" ? 0    	: $_POST["idseqttl"];
$nrcpfcto = $_POST["nrcpfcto"]     == "" ? 0   	    : $_POST["nrcpfcto"];
$nrdctato = $_POST["nrdctato_rsp"] == "" ? 0        : $_POST["nrdctato_rsp"];	
$nrdrowid = $_POST["nrdrowid_rsp"] == "" ? 0        : $_POST["nrdrowid_rsp"];	
$operacao = $_POST["operacao_rsp"] == "" ? "CT"     : $_POST["operacao_rsp"];
$cpfprocu = $_POST["cpfprocu"]     == "" ? 0        : $_POST["cpfprocu"];
$nmrotina = $_POST["nmrotina"]     == "" ? 0        : $_POST["nmrotina"];
$dtdenasc = $_POST["dtdenasc"]     == "" ? "?"  	: $_POST["dtdenasc"];
$cdhabmen = $_POST["cdhabmen"]     == "" ? 0   	    : $_POST["cdhabmen"];
$ope_rotinaant = $_POST["ope_rotinaant"] == "" ? "" : $_POST["ope_rotinaant"];
$permalte = $_POST["permalte"]           == "" ? "" : $_POST["permalte"];
$tppessoa = ( isset($_POST["tppessoa"]) ) ? $_POST["tppessoa"] : 0;
$nmdatela = $_POST["nmdatela"]           == "" ? '' : $_POST["nmdatela"];
$flgcadas = $_POST["flgcadas"]           == "" ? '' : $_POST["flgcadas"];
$cddopcao = $_POST['cddopcao_rsp'] == '' ? 'C'  : $_POST['cddopcao_rsp'];	
$op       = $_POST['cddopcao_rsp'] == '' ? '@'  : $_POST['cddopcao_rsp'];
	
$xml  = "";
$xml .= "<Root>";
$xml .= "	<Cabecalho>";
$xml .= "		<Bo>b1wgen0072.p</Bo>";
$xml .= "		<Proc>busca_dados</Proc>";
$xml .= "	</Cabecalho>";
$xml .= "	<Dados>";
$xml .= "       <cdcooper>".$glbvars["cdcooper"]."</cdcooper>";
$xml .= "		<cdagenci>".$glbvars["cdagenci"]."</cdagenci>";   
$xml .= "		<nrdcaixa>".$glbvars["nrdcaixa"]."</nrdcaixa>";   
$xml .= "		<cdoperad>".$glbvars["cdoperad"]."</cdoperad>";   
$xml .= "		<nmdatela>".$glbvars["nmdatela"]."</nmdatela>";	
$xml .= "		<idorigem>".$glbvars["idorigem"]."</idorigem>";	
$xml .= "		<nrdconta>".$nrdconta."</nrdconta>";               
$xml .= "		<idseqttl>".$idseqttl."</idseqttl>";               
$xml .= "		<nrdctato>".$nrdctato."</nrdctato>";               
$xml .= "		<nrdrowid>".$nrdrowid."</nrdrowid>";               
$xml .= "		<cddopcao>".$cddopcao."</cddopcao>";               
$xml .= "		<nmrotina>".$nmrotina."</nmrotina>";  
$xml .= "		<nrcpfcto>".$nrcpfcto."</nrcpfcto>";               
$xml .= "		<cpfprocu>".$cpfprocu."</cpfprocu>";   
$xml .= "		<permalte>".$permalte."</permalte>";   
$xml .= "		<dtdenasc>".$dtdenasc."</dtdenasc>";   
$xml .= "		<cdhabmen>".$cdhabmen."</cdhabmen>";   
$xml .= "	</Dados>";
$xml .= "</Root>";	

$xmlResult = getDataXML($xml);
$xmlObjeto = getObjectXML($xmlResult);	
$registros = $xmlObjeto->roottag->tags[0]->tags;

$menorida = $xmlObjeto->roottag->tags[0]->attributes['MENORIDA'];
?>

<form id="frmConsultaDados" class="formulario" name="frmConsultaDados">
	<fieldset>
		<legend>Respons&aacute;veis Legais </legend>
		<div class="divRegistros">
			<table>
				<thead>
				<tr><th>Conta/dv</th>
					<th>Nome</th>
					<th>CPF/CNPJ</th>
					<th>Documento</th>
				</tr>			
				</thead>
				<tbody> 
					<?php
						foreach($registros as $responsavel) {
					?>
					<tr>
						<td>
							<? if(getByTagName($responsavel->tags,'nrdconta') != 0){ echo formataContaDV(getByTagName($responsavel->tags,'nrdconta'));}else{echo "0";} ?>
						    <input type="hidden" id="nrdrowid" name="nrdrowid" value="<? echo getByTagName($responsavel->tags,'nrdrowid'); ?>" />
                        </td> 
						<td>
							<? echo stringTabela(getByTagName($responsavel->tags,'nmrespon'),33,'maiuscula') ?>
						</td>
						<td>
							<? echo formataNumericos('999.999.999-10',getByTagName($responsavel->tags,'nrcpfcgc'),'.-'); ?>
						</td>
						<td>
							<? echo getByTagName($responsavel->tags,'nridenti') ?>
						</td>
					</tr>
					<?php
						}
					?>
				</tbody>		
			</table>
		</div>
	</fieldset>
</form>
<script type="text/javascript">	
	var menorida = "<?php echo $menorida; ?>";
	if (menorida == 'yes'){
		$('.cnt2-1.responsaveislegais').next().find('a').hide();
	}else{
		$('.cnt2-1.responsaveislegais').next().find('a').show();
	}
</script>