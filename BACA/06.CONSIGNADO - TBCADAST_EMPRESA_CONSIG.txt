-- Create table
create table CECRED.TBCADAST_EMPRESA_CONSIG
(
  idemprconsig         NUMBER(5) not null,
  cdcooper             NUMBER(10) default 0 not null,
  cdempres             NUMBER(10) default 0 not null,
  indconsignado        NUMBER(5) default 0 not null,
  dtativconsignado     DATE,
  tpmodconvenio        NUMBER(1) default 0,
  nrdialimiterepasse   NUMBER(2) default 0,
  indautrepassecc      NUMBER(1) default 0,
  indinterromper       NUMBER(1) default 0,
  dsdemailconsig       VARCHAR2(60),
  indalertaemailemp    NUMBER(1) default 0,
  indalertaemailconsig NUMBER(1) default 0,
  dtinterromper        DATE
);

-- Add comments to the table 
comment on table CECRED.TBCADAST_EMPRESA_CONSIG is 'Informacoes para Emprestimos Consignado por Empresa';
-- Add comments to the columns 
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.idemprconsig is 'Sequencial da tabela.';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.cdcooper is 'Codigo que identifica a Cooperativa.';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.cdempres is 'Codigo da empresa.';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.indconsignado is 'Indicador de convenio de desconto consignado em folha de pagamento esta habilitado. 0 - Desabilitado / 1 - Habilitado.';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.dtativconsignado is 'Data de habilitacao do convenio de desconto consignado.';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.tpmodconvenio is 'Tipo de Modalidade de Convenio (1 - Privado, 2 . Publico e 3 - INSS).';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.nrdialimiterepasse is 'Dia limite para Repasse. (de 1 a 31).';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.indautrepassecc is 'Autorizar Debito Repasse em C/C. (0 - Não Autorizado / 1 - Autorizado)';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.indinterromper is 'Indicador de Interrupcao de Cobranca. (0 - Não Interromper / 1 - Interromper)';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.dsdemailconsig is 'E-mail de contato consignado da empresa.';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.indalertaemailemp is 'Indicador se deve receber alerta no e-mail da empresa (0 - Nao Receber / 1 - Receber)';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.indalertaemailconsig is 'Indicador se deve receber alerta no e-mail de contanto consignado da empresa (0 - Nao Receber / 1 - Receber)';
comment on column CECRED.TBCADAST_EMPRESA_CONSIG.dtinterromper is 'Data de Interrupcao de Cobranca.';

-- Create/Recreate primary, unique and foreign key constraints 
alter table CECRED.TBCADAST_EMPRESA_CONSIG add constraint TBCADAST_EMP_CONSIG_PK primary key (IDEMPRCONSIG);
alter table CECRED.TBCADAST_EMPRESA_CONSIG add constraint TBCACAST_EMP_CONSIG_UK unique (CDCOOPER, CDEMPRES);

-- Create sequence 
create sequence CECRED.SEQ_TBC_EMP_CONS_IDEMPRCONSIG
minvalue 1
maxvalue 9999999999999999999999999999
start with 1
increment by 1
nocache
order;

-- Trigger 
CREATE OR REPLACE TRIGGER CECRED.trg_tbcadast_empresa_consig
    BEFORE INSERT ON cecred.tbcadast_empresa_consig
    FOR EACH ROW
DECLARE
  -- local variables here
BEGIN
    IF :new.idemprconsig IS NULL THEN
      :new.idemprconsig := CECRED.SEQ_TBC_EMP_CONS_IDEMPRCONSIG.nextval;
    END IF;
EXCEPTION
  WHEN OTHERS THEN
    RAISE_APPLICATION_ERROR(-20100,'ERRO NA EXECUCAO DA TABELA TABELA TBCADAST_EMPRESA_CONSIG!');
END trg_tbcadast_empresa_consig;



